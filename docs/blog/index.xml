<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Disease modeling for public health</title>
<link>https://www.jonghoonk.com/blog/index.html</link>
<atom:link href="https://www.jonghoonk.com/blog/index.xml" rel="self" type="application/rss+xml"/>
<description>Disease modeling for public health</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Wed, 10 Jul 2024 15:00:00 GMT</lastBuildDate>
<item>
  <title>Kalman filter in R: FKF package</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/kalman_filter/index.html</link>
  <description><![CDATA[ 




<section id="kalman-filter-to-estimate-the-instantaneous-reproduction-number" class="level3">
<h3 class="anchored" data-anchor-id="kalman-filter-to-estimate-the-instantaneous-reproduction-number">Kalman filter to estimate the instantaneous reproduction number</h3>
<p>Generate infection time series</p>
<p>Generate infection times based on the SIR model in which <img src="https://latex.codecogs.com/png.latex?R_t"> varies First define Rt, which is the same as used in <a href="https://www.sciencedirect.com/science/article/pii/S2468042723000799">the prior study</a></p>
<p>Let’s develop a SIR model as was used in my <a href="https://www.jonghoonk.com/posts/sir_deSolve_odin_diffeqr/">previous post</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(diffeqr)</span>
<span id="cb1-2">de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span>
<span id="cb1-3"></span>
<span id="cb1-4">sir_julia <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb1-5">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb1-6">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.4</span>))</span>
<span id="cb1-7">  p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-8">  </span>
<span id="cb1-9">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N</span>
<span id="cb1-10">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-11">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-12">  du4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N  </span>
<span id="cb1-13">  </span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3,du4))</span>
<span id="cb1-15">}</span>
<span id="cb1-16"></span>
<span id="cb1-17">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>)</span>
<span id="cb1-18">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.0</span>)</span>
<span id="cb1-19">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb1-20">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(sir_julia, u0, tspan, p)</span>
<span id="cb1-21"></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prob_jit &lt;- diffeqr::jitoptimize_ode(de, prob)</span></span>
<span id="cb1-23">sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-24"></span>
<span id="cb1-25">mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb1-26">udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb1-27">tudf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb1-28"></span>
<span id="cb1-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(tudf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, </span>
<span id="cb1-35">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb1-36">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/kalman_filter/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb2-2">I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(tudf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V4)</span>
<span id="cb2-3"> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;- rpois(length(thetat), 100000*thetat)</span></span>
<span id="cb2-4">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(I)</span>
<span id="cb2-5">rt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (I[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>I[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(n<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>I[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(n<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)]</span>
<span id="cb2-6">t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-7">R_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.4</span>))</span>
<span id="cb2-8"></span>
<span id="cb2-9">Rhat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(Rhat, R_true[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(Rhat)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), )</span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/kalman_filter/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BI_t-I_%7Bt-1%7D%7D%7BI_%7Bt-1%7D%7D%5Cequiv%20r_t%20=%20%5Cgamma(R_t-1)%20+%20%5Cepsilon_i"> <img src="https://latex.codecogs.com/png.latex?R_t%20=%20R_%7Bt-1%7D%20+%20%5Ceta_i"></p>


</section>

 ]]></description>
  <category>kalman filter</category>
  <guid>https://www.jonghoonk.com/blog/posts/kalman_filter/index.html</guid>
  <pubDate>Wed, 10 Jul 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/kalman_filter/kalman_filter.png" medium="image" type="image/png" height="135" width="144"/>
</item>
<item>
  <title>Learning ChatGPT 4: Universal Approximation Theorem</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index.html</link>
  <description><![CDATA[ 




<p>Neural networks can approximate any function according to the <a href="https://en.wikipedia.org/wiki/Universal_approximation_theorem">Universal Approximation Theorem</a>. A more precise statement of the theorem is that neural networks with a single hidden layer can be used to approximate any continuous function to any desired precision by the <a href="http://neuralnetworksanddeeplearning.com/chap4.html">e-book</a> by Michael Nielsen. This e-book provides intuitive explanations about the proof. In what follows, I wrote what I was able to understand based on those materials and added a few R code chunks to supplement.</p>
<p>For a simple network with one hidden layer of two neurons, n1 and n2, what is being computed in a hidden neuron is <img src="https://latex.codecogs.com/png.latex?%5Csigma(w%20x%20+%20b)">, where <img src="https://latex.codecogs.com/png.latex?%5Csigma%20(z)%20%5Cequiv%201/(1+e%5E%7B-z%7D)"> is the sigmoid function. And what happens in the output neuron is <img src="https://latex.codecogs.com/png.latex?w_%7B31%7D%20n1%20+%20w_%7B32%7D%20n2%20+%20b">. Here, <img src="https://latex.codecogs.com/png.latex?w_%7B31%7D%20%5Ctext%7Band%7D%20w_%7B32%7D"> refer to weights that correspond to two neurons, n1 and n2, respectively.</p>
<p>The basic idea of the theorem is that weighted sum of outputs of neurons can approximate any functions. This can be visualized by studying a special case in which output from each neuron is close to a step function and weighted sum of a pair of step functions can create a bump of any height and width. With numerous those bumps, one can approximate any continuous function at any desired precision.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">graph_from_literal</span>(Input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--+</span>n1, Input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--+</span>n2, n1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--+</span>Output, n2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--+</span>Output))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In what follows, I will explain how a neural network can create a bump. Before that, let’s get familiar with what is being computed in a single neuron. In the following codes, some combination of weight, <img src="https://latex.codecogs.com/png.latex?w"> , and bias, <img src="https://latex.codecogs.com/png.latex?b">, generate a typical sigmoid function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb2-2">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb2-3">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>With high values for <img src="https://latex.codecogs.com/png.latex?w">, the output becomes close to a step function and the change point occurs at <img src="https://latex.codecogs.com/png.latex?-b/w">. For instance, let’s look at the plot for <img src="https://latex.codecogs.com/png.latex?w=1000,%20b=-300">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb3-2">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span></span>
<span id="cb3-3">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span></span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>One can use the following codes to have a feel for how the weight and bias change the value in the neuron.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(manipulate)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">manipulate</span>(</span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n1"</span>),</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), </span>
<span id="cb4-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span></code></pre></div>
<p>Now let’s create another step function in which the change point occurs at 0.4</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb5-2">w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb5-3">b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span></span>
<span id="cb5-4">y1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b1)))</span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>)</span>
<span id="cb5-6"></span>
<span id="cb5-7">w2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb5-8">b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span></span>
<span id="cb5-9">y2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b2)))</span>
<span id="cb5-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, y2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What happens in the Output node is <img src="https://latex.codecogs.com/png.latex?%5Comega_%7B31%7D%20n1%20+%20%5Comega_%7B32%7D%20n2%20+%20b">. By setting <img src="https://latex.codecogs.com/png.latex?w1"> and <img src="https://latex.codecogs.com/png.latex?w2"> at different sign, we can create a bump.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">w31 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>        </span>
<span id="cb6-2">w32 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>       </span>
<span id="cb6-3">b3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w32 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w31 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Output"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Again, one may use the following codes to have a feel for how two weights and the bias change the output in the Output.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">manipulate</span>(</span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w32 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w31 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Output"</span>),</span>
<span id="cb7-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w31 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb7-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w32 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span></code></pre></div>



 ]]></description>
  <category>Universal Approximation Theorem</category>
  <category>Neural network</category>
  <category>Arbitrary-Width</category>
  <category>Arbitrary-Depth</category>
  <guid>https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index.html</guid>
  <pubDate>Sun, 23 Jun 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/UAT.png" medium="image" type="image/png" height="55" width="144"/>
</item>
<item>
  <title>Learning ChatGPT 3: MNIST</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_3_MNIST/index.html</link>
  <description><![CDATA[ 




<p>This post is about using <a href="https://en.wikipedia.org/wiki/Convolutional_neural_network">convolutional neural network</a> to recognize hand-written digits, <a href="https://en.wikipedia.org/wiki/MNIST_database">MNIST</a> data set. The following contents were adapted based on <a href="https://jtr13.github.io/cc21fall2/tutorial-on-r-torch-package.html">this</a> and <a href="https://blog.naver.com/flynt1/222419808861">this</a> pages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(torch)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(torchvision)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reshape2) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># melt function</span></span></code></pre></div>
</div>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Data were downloaded using the following command: <code>torchvision::mnist_dataset(".", download=T)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"training.rds"</span>)</span>
<span id="cb2-2">test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test.rds"</span>)</span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># train[[1]] indicate numeric values for the image and train[[2]] indicate the correct number</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(train[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60000    28    28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(test[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10000    28    28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">n_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60000</span></span>
<span id="cb6-2">n_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span></code></pre></div>
</div>
<p>Plot the image</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">train[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40000</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">image <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> train[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>]</span>
<span id="cb9-2">image_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(image)</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(image_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Var2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Var1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>value))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reorient the image</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb9-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_3_MNIST/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">train[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40000</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
<p>Convert data to tensor type</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">device <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpu"</span></span>
<span id="cb12-2"></span>
<span id="cb12-3">x_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb12-4">  train[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dtype =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_float32</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_reshape</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(n_train, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>)) </span>
<span id="cb12-7"></span>
<span id="cb12-8">x_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">divide</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalize</span></span>
<span id="cb12-9"></span>
<span id="cb12-10">y_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb12-11">  train[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dtype =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_int64</span>())</span>
<span id="cb12-14"></span>
<span id="cb12-15">x_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb12-16">  test[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dtype =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_float32</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_reshape</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(n_test, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>))</span>
<span id="cb12-19">x_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x_test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">divide</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>) </span>
<span id="cb12-20"></span>
<span id="cb12-21">y_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb12-22">  test[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dtype =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_int64</span>())</span></code></pre></div>
</div>
<p>dataloader</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">batch.size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb13-2"></span>
<span id="cb13-3">train_loader <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dataloader</span>(</span>
<span id="cb13-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tensor_dataset</span>(x_train, y_train),</span>
<span id="cb13-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">batch_size =</span> batch.size,</span>
<span id="cb13-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shuffle =</span> T)</span>
<span id="cb13-8"></span>
<span id="cb13-9">test_loader <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb13-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dataloader</span>(</span>
<span id="cb13-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tensor_dataset</span>(x_test, y_test),</span>
<span id="cb13-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">batch_size =</span> batch.size)</span></code></pre></div>
</div>
<p>Network</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">network <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_module</span>(</span>
<span id="cb14-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cnn.model"</span>,</span>
<span id="cb14-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initialize =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(){</span>
<span id="cb14-4">    self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cv1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_conv2d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">in_channels =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb14-5">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">out_channels =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,</span>
<span id="cb14-6">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kernel_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb14-7">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">padding =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb14-8">    self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cv2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_conv2d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">in_channels =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,</span>
<span id="cb14-9">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">out_channels =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>,</span>
<span id="cb14-10">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kernel_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb14-11">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">padding =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb14-12">    self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pool <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_max_pool2d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kernel_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb14-13">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stride =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb14-14">    self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fc1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb14-15">    self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fc2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb14-16">  },</span>
<span id="cb14-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">forward =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(M){</span>
<span id="cb14-18">    M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [batch.size, 1, 28, 28]</span></span>
<span id="cb14-19">      self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv1</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [batch.size, 32, 28, 28]</span></span>
<span id="cb14-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_relu</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-21">      self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [batch.size, 32, 14, 14]</span></span>
<span id="cb14-22">      self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv2</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [batch.size, 64, 14, 14]</span></span>
<span id="cb14-23">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_relu</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-24">      self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [batch.size, 64, 7, 7]</span></span>
<span id="cb14-25">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_flatten</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start_dim =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-26">      self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fc1</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-27">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_relu</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-28">      self<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fc2</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-29">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_softmax</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb14-30">  }</span>
<span id="cb14-31">)</span></code></pre></div>
</div>
<p>Set the seed, loss function, and the optimizer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1234</span>)</span>
<span id="cb15-2">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">network</span>()</span>
<span id="cb15-3">model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">to</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device)</span>
<span id="cb15-4"></span>
<span id="cb15-5">loss.func <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_cross_entropy_loss</span>()</span>
<span id="cb15-6">optimizer <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim_adam</span>(model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>parameters, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lr=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)</span></code></pre></div>
</div>
<p>Train the network</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">epoch <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb16-2">train_loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>()</span>
<span id="cb16-3">test_loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>()</span>
<span id="cb16-4"></span>
<span id="cb16-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>epoch) {</span>
<span id="cb16-6">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (b <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enumerate</span>(train_loader)){</span>
<span id="cb16-7">    optimizer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_grad</span>()</span>
<span id="cb16-8">    output <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forward</span>(b[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span>
<span id="cb16-9">    loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loss.func</span>(output, b[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]])</span>
<span id="cb16-10">    loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb16-11">    optimizer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>()</span>
<span id="cb16-12">    train_loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(train_loss, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>())</span>
<span id="cb16-13">  }</span>
<span id="cb16-14"></span>
<span id="cb16-15">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (b <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enumerate</span>(test_loader)) {</span>
<span id="cb16-16">    model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>()</span>
<span id="cb16-17">    output <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forward</span>(b[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span>
<span id="cb16-18">    loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loss.func</span>(output, b[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]])</span>
<span id="cb16-19">    test_loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(test_loss, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>())</span>
<span id="cb16-20">    model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train</span>()</span>
<span id="cb16-21">  }</span>
<span id="cb16-22">}</span></code></pre></div>
</div>
<p>Plot the loss</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(train_loss)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">train =</span> train_loss) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(i, train), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_3_MNIST/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(test_loss)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">test =</span> test_loss) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(i, test), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_3_MNIST/index_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Accuracy</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>()</span>
<span id="cb19-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (b <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enumerate</span>(test_loader)) {</span>
<span id="cb19-3">    output <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb19-4">      model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forward</span>(b[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_max</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-6">      .[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]</span>
<span id="cb19-7">    pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(pred, output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">to</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_array</span>())</span>
<span id="cb19-8">}</span>
<span id="cb19-9"></span>
<span id="cb19-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb19-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> y_test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">to</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_array</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(),</span>
<span id="cb19-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pred =</span> pred <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(., caret<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confusionMatrix</span>(pred, label))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    1    2    3    4    5    6    7    8    9   10
        1   976    0    0    0    0    1    3    0    3    0
        2     0 1134    1    0    0    0    2    3    0    3
        3     0    1 1028    4    0    1    0    7    5    2
        4     0    0    0  994    0    3    0    0    1    0
        5     0    0    1    0  981    0    3    0    2   10
        6     0    0    0    7    0  884    3    0    0    3
        7     3    0    0    0    0    2  947    0    1    0
        8     1    0    2    3    0    0    0 1015    2    2
        9     0    0    0    1    0    0    0    1  956    0
        10    0    0    0    1    1    1    0    2    4  989

Overall Statistics
                                          
               Accuracy : 0.9904          
                 95% CI : (0.9883, 0.9922)
    No Information Rate : 0.1135          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.9893          
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: 1 Class: 2 Class: 3 Class: 4 Class: 5 Class: 6
Sensitivity            0.9959   0.9991   0.9961   0.9842   0.9990   0.9910
Specificity            0.9992   0.9990   0.9978   0.9996   0.9982   0.9986
Pos Pred Value         0.9929   0.9921   0.9809   0.9960   0.9840   0.9855
Neg Pred Value         0.9996   0.9999   0.9996   0.9982   0.9999   0.9991
Prevalence             0.0980   0.1135   0.1032   0.1010   0.0982   0.0892
Detection Rate         0.0976   0.1134   0.1028   0.0994   0.0981   0.0884
Detection Prevalence   0.0983   0.1143   0.1048   0.0998   0.0997   0.0897
Balanced Accuracy      0.9976   0.9991   0.9969   0.9919   0.9986   0.9948
                     Class: 7 Class: 8 Class: 9 Class: 10
Sensitivity            0.9885   0.9874   0.9815    0.9802
Specificity            0.9993   0.9989   0.9998    0.9990
Pos Pred Value         0.9937   0.9902   0.9979    0.9910
Neg Pred Value         0.9988   0.9986   0.9980    0.9978
Prevalence             0.0958   0.1028   0.0974    0.1009
Detection Rate         0.0947   0.1015   0.0956    0.0989
Detection Prevalence   0.0953   0.1025   0.0958    0.0998
Balanced Accuracy      0.9939   0.9931   0.9906    0.9896</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>Neural network</category>
  <category>MNIST</category>
  <category>CNN</category>
  <guid>https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_3_MNIST/index.html</guid>
  <pubDate>Sat, 15 Jun 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_3_MNIST/mnist_five.png" medium="image" type="image/png" height="137" width="144"/>
</item>
<item>
  <title>Parallel simulation in R</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/parallel/index.html</link>
  <description><![CDATA[ 




<p>I find that <code>parallel</code>, <code>doParallel</code> and <code>foreach</code> packages provide the easiest approach for parallel computing in R. The <code>doParallel</code> <a href="https://cran.r-project.org/web/packages/doParallel/vignettes/gettingstartedParallel.pdf">vignette</a> provides a great overview. <code>library(doParallel)</code> command automatically loads required packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(doParallel)</span>
<span id="cb1-2">ncores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detectCores</span>()</span>
<span id="cb1-3">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb1-5">nruns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ncores</span>
<span id="cb1-6"></span>
<span id="cb1-7">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-8">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span>c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(i, x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) }</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span>
<span id="cb1-11">res</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 4 2 4 3 4 4 4</code></pre>
</div>
</div>
<p>We can export packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb3-3"></span>
<span id="cb3-4">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.packages=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.table"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> {</span>
<span id="cb3-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">frollmean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb3-7">  }</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span>
<span id="cb3-10">res</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         result.1   result.2   result.3   result.4  result.5
 [1,]          NA         NA         NA         NA        NA
 [2,]          NA         NA         NA         NA        NA
 [3,]          NA         NA         NA         NA        NA
 [4,]          NA         NA         NA         NA        NA
 [5,]          NA         NA         NA         NA        NA
 [6,]          NA         NA         NA         NA        NA
 [7,]  0.10137749 -0.4031421 -0.2978329 -0.1227265 0.5839638
 [8,] -0.13194617 -0.1788683 -0.1939073 -0.1892045 0.6059825
 [9,] -0.05781095 -0.3098454 -0.2936534 -0.1530030 0.6612271
[10,]  0.15194031 -0.2865266 -0.3798726 -0.2400355 0.6041984</code></pre>
</div>
</div>
<p>We may want to set the same seed for each worker.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb5-3"></span>
<span id="cb5-4">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.packages=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.table"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> {</span>
<span id="cb5-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb5-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">frollmean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb5-8">}</span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span>
<span id="cb5-10">res</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        result.1   result.2   result.3   result.4   result.5
 [1,]         NA         NA         NA         NA         NA
 [2,]         NA         NA         NA         NA         NA
 [3,]         NA         NA         NA         NA         NA
 [4,]         NA         NA         NA         NA         NA
 [5,]         NA         NA         NA         NA         NA
 [6,]         NA         NA         NA         NA         NA
 [7,] -0.6236335 -0.6236335 -0.6236335 -0.6236335 -0.6236335
 [8,] -0.5018746 -0.5018746 -0.5018746 -0.5018746 -0.5018746
 [9,] -0.7423937 -0.7423937 -0.7423937 -0.7423937 -0.7423937
[10,] -0.5445709 -0.5445709 -0.5445709 -0.5445709 -0.5445709</code></pre>
</div>
</div>
<p>Different <code>foreach</code> sessions with the same random seed are not reproducible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb7-5">a1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb7-6">b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb7-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb7-8">a2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb7-9">b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb7-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(a1, a2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(b1, b2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span></code></pre></div>
</div>
<p>Reproducibility across different <code>foreach</code> sessions are possible using <a href="https://ftp.heanet.ie/mirrors/cran.r-project.org/web/packages/doRNG/index.html">doRNG</a> package. Examples below were adapted from the <a href="https://stackoverflow.com/questions/8358098/how-to-set-seed-for-random-simulations-with-foreach-and-domc-packages">stackoverflow post</a>.</p>
<p>You use <code>%dorng%</code> instead of <code>%dopar%</code> in the <code>doRNG</code> approach</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(doRNG)</span>
<span id="cb10-2"></span>
<span id="cb10-3">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb10-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb10-7">a1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dorng%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb10-8">b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dorng%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb10-9"></span>
<span id="cb10-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb10-11">a2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dorng%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb10-12">b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dorng%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb10-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(a1, a2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(b1, b2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span></code></pre></div>
</div>
<p>We may want to examine parallel workers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDoParWorkers</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDoParName</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "doParallelSNOW"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDoParVersion</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1.0.17"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span></code></pre></div>
</div>



 ]]></description>
  <category>parallelism</category>
  <category>foreach</category>
  <category>doParallel</category>
  <guid>https://www.jonghoonk.com/blog/posts/parallel/index.html</guid>
  <pubDate>Thu, 13 Jun 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/parallel/right_trunc2.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Basic reproduction number: An algorithmic approach</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/R0_mathematica/index.html</link>
  <description><![CDATA[ 




<p>A <a href="https://www.mdpi.com/2227-7390/12/1/27">recent article</a> published in Mathematics discusses an approach to calculating <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">. Since I have previously written a <a href="https://www.jonghoonk.com/posts/R0-sympy/">post</a> about calculating <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0"> using Sympy, I wanted to explore a new approach proposed by the article.</p>
<p>The article claims that <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0"> is a not function of the original set of ordinary differential equations (ODEs) because <img src="https://latex.codecogs.com/png.latex?(F,%20V)"> gradient decomposition may not be unique for a given set of ODEs. As a reminder, <a href="https://link.springer.com/article/10.1007/BF00178324">Diekmann <em>et al.</em></a> showed that <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0"> is the spectral radius, or Perron–Frobenius eigenvalue, of the next generation operator.</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS/%5Cmathrm%7Bd%7Dt%20&amp;=%20-%5Cbeta%20I%20S/N%20%5C%5C%0A%5Cmathrm%7Bd%7DI/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cbeta%20I%20S/N%20-%20%5Cgamma%20I%5C%5C%0A%5Cmathrm%7Bd%7DR/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cgamma%20I%0A%5Cend%7Balign%7D">
<p>Following Python and Mathematica codes generate that <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0%20=%20%5Cfrac%7B%5Cbeta%7D%7B%5Cgamma%7D."> if <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> and <img src="https://latex.codecogs.com/png.latex?%5Cgamma"> are replaced with <img src="https://latex.codecogs.com/png.latex?b"> and <img src="https://latex.codecogs.com/png.latex?g">, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sympy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-2">b, k, g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b k g'</span>)</span>
<span id="cb1-3">F <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, b],[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb1-4">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[k, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>k, g]])</span>
<span id="cb1-5">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-6">eigval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> M.eigenvals(simplify<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true)</span>
<span id="cb1-7">init_printing(use_unicode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-8">lst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(eigval.keys())</span>
<span id="cb1-9">lst[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>b
─
g</code></pre>
</div>
</div>
<p>Mathematica uses the following next generation method (NGM) function provided in the article.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">NGM[mod_, inf_] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb3-2"> Module[{dyn, X, infc, M, V, F, F1, V1, K}, dyn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> mod[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]; </span>
<span id="cb3-3">  X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> mod[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]; infc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Complement[Range[Length[X]], inf]; </span>
<span id="cb3-4">  M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Grad[dyn[[inf]], X[[inf]]]</span>
<span id="cb3-5">  (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>The jacobian of the infectious equations<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>); </span>
<span id="cb3-6">  V1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. Thread[X[[infc]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb3-7">  (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V1 is a first guess <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> V,</span>
<span id="cb3-8">  retains all gradient terms which disappear when the non infectious <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-9">components are null<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>); F1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> V1</span>
<span id="cb3-10">  (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>F1 is a first guess <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> F,containing all other gradient terms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>); </span>
<span id="cb3-11">  F <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Replace[F1, _. _?Negative <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>}];</span>
<span id="cb3-12">  (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>all terms <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> F1 containing minuses are set to <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>); V <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> F <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> M;</span>
<span id="cb3-13">  K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> (F . Inverse[V]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. Thread[X[[inf]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">/</span> FullSimplify;</span>
<span id="cb3-14">  {M, V1, F1, F, V, K}]</span>
<span id="cb3-15"></span>
<span id="cb3-16">eqnsSEIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-17">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>b s i ,</span>
<span id="cb3-18">  b s i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> k e,</span>
<span id="cb3-19">  k e <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> g i, </span>
<span id="cb3-20">  g i }</span>
<span id="cb3-21"></span>
<span id="cb3-22">varsSEIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {s, e, i, r}</span>
<span id="cb3-23">modSEIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {eqnsSEIR, varsSEIR}</span>
<span id="cb3-24">NGM[modSEIR, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>}] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<p>As in the <a href="https://www.jonghoonk.com/posts/R0-sympy/">previous post</a>, I applied the method to the model used in <a href="https://journals.plos.org/plosntds/article?id=10.1371/journal.pntd.0002642">Pitzer <em>et al</em>.</a>, of which the model may be expressed in the following set of equations.</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS_1/%5Cmathrm%7Bd%7Dt%20&amp;=%20B%20+%20%5Cepsilon%20S_2%20-%20(%5Clambda_p+%5Clambda_w+%5Cmu)S_1%5C%5C%0A%5Cmathrm%7Bd%7DI_1/%5Cmathrm%7Bd%7Dt%20&amp;=%20(%5Clambda_p+%5Clambda_w)S_1%20-%20(%5Cdelta+%5Cmu)%20I_1%20%5C%5C%0A%5Cmathrm%7Bd%7DR/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cdelta(1-%5Ctheta-%5Calpha)(I_1+I_2)%20-%20(%5Comega%20+%5Cmu)R%20%5C%5C%0A%5Cmathrm%7Bd%7DC/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cdelta%5Ctheta(I_1+I_2)%20-%20%5Cmu%20C%20%5C%5C%0A%5Cmathrm%7Bd%7DS_2/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Comega%20R%20-%5Cepsilon%20S_2%20-%20(%5Clambda_p+%5Clambda_w+%5Cmu)%20S_2%5C%5C%0A%5Cmathrm%7Bd%7DI_2/%5Cmathrm%7Bd%7Dt%20&amp;=%20(%5Clambda_p+%5Clambda_w)%20S_2%20-%20(%5Cdelta+%5Cmu)%20I_2%20%5C%5C%0A%5Cmathrm%7Bd%7DW/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cgamma(I_1+rI_2+rC)%20-%20%5Cxi%20W%0A%5Cend%7Balign%7D">
<p>Following Python and Mathematica codes generates that</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathcal%7BR%7D_0%20=%20%5Cfrac%7B1%7D%7B%5Cmu+%5Cdelta%7D%20%5Cleft(%5Cbeta_p%20+%5Cfrac%7B%5Cgamma%20%5Cbeta_w%7D%7B%5Cxi%7D%5Cright)%20%5Cleft(1%20+%5Cfrac%7B%5Cdelta%5Ctheta%20r%7D%7B%5Cmu%7D%5Cright)%0A%5Cend%7Balign%7D">
<p>In the following Python codes <img src="https://latex.codecogs.com/png.latex?p,%20r,%20w,%20d,%20m,%20t,%20g,%20x"> represent <img src="https://latex.codecogs.com/png.latex?%5Cbeta_p,%20r,%20%5Cbeta_w,%20%5Cdelta,%20%5Cmu,%20%5Ctheta,%20%5Cgamma,%20%5Cxi"> in the equation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">p, r, w, d, m, t, g, x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p r w d m t g x'</span>)</span>
<span id="cb4-2">F <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[p, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p, w], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb4-3">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t, m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g, x]])</span>
<span id="cb4-4">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-5">eigval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> M.eigenvals(simplify<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true)</span>
<span id="cb4-6">init_printing(use_unicode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-7">eigval </span>
<span id="cb4-8">lst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(eigval.keys())</span>
<span id="cb4-9">R0_eig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lst[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-10">R0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>x)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>r)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>m) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0 from the Pitzer (2014)</span></span>
<span id="cb4-11">simplify(R0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R0_eig) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0 for the same expression (symbolic assessment)</span></span>
<span id="cb4-12">R0.equals(R0_eig) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True for the same expression (numerical assessment)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">eqnsSIRW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb5-2">  B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Epsilon] Subscript[s, </span>
<span id="cb5-3">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (Subscript[\[Beta], </span>
<span id="cb5-4">       P] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-5">      Subscript[\[Beta], W] w <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) Subscript[s, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb5-6">  \[Omega] R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> \[Epsilon] Subscript[s, </span>
<span id="cb5-7">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (Subscript[\[Beta], </span>
<span id="cb5-8">       P] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-9">      Subscript[\[Beta], W]  w <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) Subscript[s, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb5-10">  (Subscript[\[Beta], P] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-11">       Subscript[\[Beta], W]  w) Subscript[s, </span>
<span id="cb5-12">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] \[Minus] (\[Delta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb5-13">  (Subscript[\[Beta], P] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">       Subscript[\[Beta], W]  w) Subscript[s, </span>
<span id="cb5-15">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Delta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb5-16">  \[Delta] \[Theta] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> \[Mu] c,</span>
<span id="cb5-17">  \[Gamma] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> \[Xi] w,</span>
<span id="cb5-18">  \[Delta] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> \[Theta]) (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Subscript[i, </span>
<span id="cb5-19">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) R}</span>
<span id="cb5-20"></span>
<span id="cb5-21">varsSIRW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {Subscript[s, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], Subscript[s, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb5-22">  Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], c, w, R }</span>
<span id="cb5-23">  </span>
<span id="cb5-24">modSIRW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {eqnsSIRW, varsSIRW}</span>
<span id="cb5-25">NGM[modSIRW, Range[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]]</span></code></pre></div>
</div>
<p>Again, manually defining <img src="https://latex.codecogs.com/png.latex?F,V"> as follows leads to the same answer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">F <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {{Subscript[\[Beta], P], r Subscript[\[Beta], P], </span>
<span id="cb6-2">   r Subscript[\[Beta], P], Subscript[\[Beta], W] }, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-3">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}}</span>
<span id="cb6-4">V <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {{\[Delta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Delta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-5">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>\[Delta] \[Theta], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>\[Delta] \[Theta], \[Mu], </span>
<span id="cb6-6">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>\[Gamma], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r \[Gamma], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r \[Gamma], \[Xi]}}</span>
<span id="cb6-7">Eigenvalues[Dot[F, Inverse[V]]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">/</span> FullSimplify</span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0%20=%20%5Cfrac%7B(%5Cmu%20+%5Cdelta%20%20%5Ctheta%20%20r)%20%5Cleft(%5Cxi%20%20%5Cbeta_P+%5Cgamma%20%20%5Cbeta_W%20%5Cright)%7D%7B%5Cmu%20%20%5Cxi%20%20(%5Cdelta%20+%5Cmu%20)%7D."></p>



 ]]></description>
  <category>Basic reproduction number</category>
  <category>Mathematica</category>
  <category>algorithmic approach</category>
  <category>next generation matrix</category>
  <guid>https://www.jonghoonk.com/blog/posts/R0_mathematica/index.html</guid>
  <pubDate>Sat, 01 Jun 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/R0_mathematica/intro-spikey.png" medium="image" type="image/png" height="147" width="144"/>
</item>
<item>
  <title>Claude 3</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/claude_api/index.html</link>
  <description><![CDATA[ 




<p>Testing Claude 3 with R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(jsonlite)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to make API request</span></span>
<span id="cb1-5">prompt_claude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prompt =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb1-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_key =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb1-7">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opus"</span>,</span>
<span id="cb1-8">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_tokens =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) {</span>
<span id="cb1-9">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.null</span>(api_key)) {</span>
<span id="cb1-10">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"api_key must provided"</span>)</span>
<span id="cb1-11">  }</span>
<span id="cb1-12">  model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(model, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude-3-haiku-20240307"</span>,</span>
<span id="cb1-13">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude-3-sonnet-20240229"</span>,</span>
<span id="cb1-14">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude-3-opus-20240229"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-15">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(model) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb1-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The model name is wrong. It must be one of the haiku, sonnet, and opus"</span>)</span>
<span id="cb1-17">  }</span>
<span id="cb1-18">  </span>
<span id="cb1-19">  response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">POST</span>(</span>
<span id="cb1-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.anthropic.com/v1/messages"</span>,</span>
<span id="cb1-21">    httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_headers</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x-api-key</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> api_key, </span>
<span id="cb1-22">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">anthropic-version</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-06-01"</span>,</span>
<span id="cb1-23">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content-type</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application/json"</span>),</span>
<span id="cb1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json"</span>,</span>
<span id="cb1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span> jsonlite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toJSON</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-26">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> model,</span>
<span id="cb1-27">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_tokens =</span> max_tokens,</span>
<span id="cb1-28">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">messages =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">role =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content =</span> prompt))</span>
<span id="cb1-29">    ), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">auto_unbox =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-30"> )</span>
<span id="cb1-31"> content <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content</span>(response, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb1-32"> json_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> jsonlite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fromJSON</span>(content, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flatten =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-33"> response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> json_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text</span>
<span id="cb1-34"> </span>
<span id="cb1-35"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(response)</span>
<span id="cb1-36">}</span>
<span id="cb1-37"></span>
<span id="cb1-38">api_key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CLAUDE_API_KEY"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># api key was stored in the .Renviron file</span></span>
<span id="cb1-39">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prompt_claude</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prompt=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The cat sat on the"</span>, api_key, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"haiku"</span>)</span>
<span id="cb1-40"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(res)</span></code></pre></div>
</div>



 ]]></description>
  <category>LLM</category>
  <category>Claude</category>
  <guid>https://www.jonghoonk.com/blog/posts/claude_api/index.html</guid>
  <pubDate>Wed, 29 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/claude_api/anthropic.png" medium="image" type="image/png" height="136" width="144"/>
</item>
<item>
  <title>Learning ChatGPT 2: Approximating a tower function using a neural net</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index.html</link>
  <description><![CDATA[ 




<p>The <a href="https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/">blog post by Stephen Wolfram</a> discusses a neural network for approximating some sort of a step function. This post is my attempt to reproduce it. A <a href="https://www.youtube.com/watch?v=Ijqkc7OLenI">YouTube video</a> and a <a href="http://neuralnetworksanddeeplearning.com/chap4.html">book chapter</a> by Michael Nielsen beautifully explain how a neural network can approximate a tower function while explaining the <a href="https://en.wikipedia.org/wiki/Universal_approximation_theorem">Universal Approximation Theorem</a>.</p>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(torch)</span>
<span id="cb1-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb1-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>))</span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># input and output are turned into a 1-column tensor  </span></span>
<span id="cb1-5">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-6">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="neural-network" class="level3">
<h3 class="anchored" data-anchor-id="neural-network">Neural network</h3>
<p>One simple way to create a neural network is to use <code>nn_sequential</code> function of the <code>torch</code> package. <a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">Rectified linear unit (ReLU)</a> is used for an activation function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dim_in <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-2">dim_out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-3">dim_hidden <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span></span>
<span id="cb2-4"></span>
<span id="cb2-5">net <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_sequential</span>(</span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_in, dim_hidden),</span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_out)</span>
<span id="cb2-9">)</span></code></pre></div>
</div>
</section>
<section id="traing-a-neural-network" class="level3">
<h3 class="anchored" data-anchor-id="traing-a-neural-network">Traing a neural network</h3>
<p>The <a href="https://arxiv.org/abs/1412.6980">Adam optimizer</a>, which a popular choice, is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim_adam</span>(net<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>parameters)</span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># opt &lt;- optim_sgd(net$parameters, lr=0.001)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">num_epochs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb4-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (epoch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_epochs) {</span>
<span id="cb4-3">  y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># forward pass</span></span>
<span id="cb4-4">  loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_mse_loss</span>(y_pred, y)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute loss </span></span>
<span id="cb4-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (epoch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) { </span>
<span id="cb4-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Epoch: "</span>, epoch, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", Loss: "</span>, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-7">  }</span>
<span id="cb4-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># back propagation </span></span>
<span id="cb4-9">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_grad</span>()</span>
<span id="cb4-10">  loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb4-11">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update weights</span></span>
<span id="cb4-12">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  100 , Loss:  0.04152938 
Epoch:  200 , Loss:  0.03192386 
Epoch:  300 , Loss:  0.02484774 
Epoch:  400 , Loss:  0.0200139 
Epoch:  500 , Loss:  0.01669441 
Epoch:  600 , Loss:  0.01426002 
Epoch:  700 , Loss:  0.01251788 
Epoch:  800 , Loss:  0.01132387 
Epoch:  900 , Loss:  0.01052936 
Epoch:  1000 , Loss:  0.009975741 </code></pre>
</div>
</div>
<p>Compare the data and the model predictions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">ypred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L2 loss: %.4f"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ypred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "L2 loss: 3.0013"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, ypred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb8-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"neural net"</span>), </span>
<span id="cb8-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>), </span>
<span id="cb8-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>),</span>
<span id="cb8-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb8-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb8-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb8-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb8-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb8-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="enlarge-the-neural-network" class="level3">
<h3 class="anchored" data-anchor-id="enlarge-the-neural-network">Enlarge the neural network</h3>
<p>Let’s repeat an experiment using a larger network - more nodes and layers</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">dim_hidden <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span></span>
<span id="cb9-2"></span>
<span id="cb9-3">net <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_sequential</span>(</span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_in, dim_hidden),</span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_hidden),</span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_hidden),</span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_out)</span>
<span id="cb9-11">)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim_adam</span>(net<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>parameters)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">num_epochs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb11-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (epoch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_epochs) {</span>
<span id="cb11-3">  y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># forward pass</span></span>
<span id="cb11-4">  loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_mse_loss</span>(y_pred, y)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute loss </span></span>
<span id="cb11-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (epoch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) { </span>
<span id="cb11-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Epoch: "</span>, epoch, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", Loss: "</span>, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-7">  }</span>
<span id="cb11-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># back propagation </span></span>
<span id="cb11-9">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_grad</span>()</span>
<span id="cb11-10">  loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb11-11">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update weights</span></span>
<span id="cb11-12">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  100 , Loss:  0.01547206 
Epoch:  200 , Loss:  0.00574969 
Epoch:  300 , Loss:  0.002934352 
Epoch:  400 , Loss:  0.001993524 
Epoch:  500 , Loss:  0.001559232 
Epoch:  600 , Loss:  0.001286777 
Epoch:  700 , Loss:  0.001089336 
Epoch:  800 , Loss:  0.0009590647 
Epoch:  900 , Loss:  0.0008538744 
Epoch:  1000 , Loss:  0.0007692588 </code></pre>
</div>
</div>
<p>Compare the data and the model predictions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">ypred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L2 loss: %.4f"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ypred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "L2 loss: 0.2315"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png("stepfunc_nn.png")</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb15-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, ypred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb15-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"neural net"</span>), </span>
<span id="cb15-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>), </span>
<span id="cb15-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>),</span>
<span id="cb15-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb15-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb15-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb15-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb15-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb15-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Neural network</category>
  <category>Adam</category>
  <category>matrix</category>
  <guid>https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index.html</guid>
  <pubDate>Mon, 27 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/stepfunc_nn.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>A very basic implementation of a neural network</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/neural_network_basic/index.html</link>
  <description><![CDATA[ 




<p>I am documenting my learning of a neural network. The contents are mostly based on the <a href="https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/">e-book</a>.</p>
<p>Load the <code>torch</code> library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(torch)</span></code></pre></div>
</div>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># input dimensionality (number of input features)</span></span>
<span id="cb2-2">dim_in <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of observations in training set</span></span>
<span id="cb2-4">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb2-5"></span>
<span id="cb2-6">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_randn</span>(n, dim_in)</span>
<span id="cb2-7">coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb2-8">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matmul</span>(coefs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unsqueeze</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_randn</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># column matrix</span></span></code></pre></div>
</div>
<p>Weights and biases</p>
<p><img src="https://latex.codecogs.com/png.latex?f(%5Cbf%7BX%7D)=%5Cbf%7BXW%7D+b"></p>
<p>Using two layers with corresponding parameters, <code>w1, b1, w2</code> and <code>b2</code>.</p>
<p><img src="https://latex.codecogs.com/png.latex?f(%5Cbf%7BX%7D)=(%5Cbf%7BXW_1%7D+b_1)%5Cbf%7BW_2%7D+b_2"></p>
<p><code>y_pred &lt;- x$mm(w1)$add(b1)$relu()$mm(w2)$add(b2)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dimensionality of hidden layer</span></span>
<span id="cb3-2">dim_hidden <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># output dimensionality (number of predicted features)</span></span>
<span id="cb3-4">dim_out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># weights connecting input to hidden layer</span></span>
<span id="cb3-7">w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_randn</span>(dim_in, dim_hidden, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">requires_grad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># weights connecting hidden to output layer</span></span>
<span id="cb3-9">w2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_randn</span>(dim_hidden, dim_out, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">requires_grad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hidden layer bias</span></span>
<span id="cb3-12">b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_zeros</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dim_hidden, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">requires_grad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># output layer bias</span></span>
<span id="cb3-14">b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_zeros</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dim_out, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">requires_grad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<p>Predicted values from the above network is computed as follows and using Rectified Linear Unit (ReLU) as the activation function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relu</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w2)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b2)</span></code></pre></div>
</div>
<p>Then the loss function can be created as follows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (y_pred <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pow</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">learning_rate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span></span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### training loop ----------------------------------------</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (epoch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) {</span>
<span id="cb6-6">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### -------- Forward pass --------</span></span>
<span id="cb6-7">  y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relu</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w2)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b2)</span>
<span id="cb6-8">  </span>
<span id="cb6-9">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### -------- Compute loss -------- </span></span>
<span id="cb6-10">  loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (y_pred <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pow</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()</span>
<span id="cb6-11">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (epoch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Epoch: "</span>, epoch, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"   Loss: "</span>, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-13">  </span>
<span id="cb6-14">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### -------- Backpropagation --------</span></span>
<span id="cb6-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute gradient of loss w.r.t. all tensors with</span></span>
<span id="cb6-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># requires_grad = TRUE</span></span>
<span id="cb6-17">  loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb6-18">  </span>
<span id="cb6-19">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### -------- Update weights -------- </span></span>
<span id="cb6-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Wrap in with_no_grad() because this is a part we don't </span></span>
<span id="cb6-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># want to record for automatic gradient computation</span></span>
<span id="cb6-22">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with_no_grad</span>({</span>
<span id="cb6-23">     w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_</span>(learning_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad)</span>
<span id="cb6-24">     w2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_</span>(learning_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> w2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad)</span>
<span id="cb6-25">     b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> b1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_</span>(learning_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad)</span>
<span id="cb6-26">     b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> b2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_</span>(learning_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad)  </span>
<span id="cb6-27">     </span>
<span id="cb6-28">     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Zero gradients after every pass, as they'd</span></span>
<span id="cb6-29">     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># accumulate otherwise</span></span>
<span id="cb6-30">     w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_</span>()</span>
<span id="cb6-31">     w2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_</span>()</span>
<span id="cb6-32">     b1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_</span>()</span>
<span id="cb6-33">     b2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_</span>()  </span>
<span id="cb6-34">   })</span>
<span id="cb6-35">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  10    Loss:  2.882544 
Epoch:  20    Loss:  1.62601 
Epoch:  30    Loss:  1.32421 
Epoch:  40    Loss:  1.188169 
Epoch:  50    Loss:  1.109344 
Epoch:  60    Loss:  1.057001 
Epoch:  70    Loss:  1.020362 
Epoch:  80    Loss:  0.9936801 
Epoch:  90    Loss:  0.9728129 
Epoch:  100    Loss:  0.9572353 
Epoch:  110    Loss:  0.9437702 
Epoch:  120    Loss:  0.9327099 
Epoch:  130    Loss:  0.9237313 
Epoch:  140    Loss:  0.916046 
Epoch:  150    Loss:  0.9092934 
Epoch:  160    Loss:  0.9033768 
Epoch:  170    Loss:  0.8979584 
Epoch:  180    Loss:  0.8926775 
Epoch:  190    Loss:  0.8877957 
Epoch:  200    Loss:  0.8834692 </code></pre>
</div>
</div>
<p>Evaluate the model visually</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png("obs_pred.png")</span></span>
<span id="cb8-2">y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relu</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w2)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b2)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(y, y_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span>, </span>
<span id="cb8-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Neural network from scratch"</span>)</span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/neural_network_basic/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_pred))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 176.6086</code></pre>
</div>
</div>
<p>The same model can be created in a more compactly way using a sequential module and using the activation function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">net <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_sequential</span>(</span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_in, dim_hidden),</span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_out)</span>
<span id="cb11-5">)</span></code></pre></div>
</div>
<p>Train using the <code>Adam</code> optimizer, a popular choice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim_adam</span>(net<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>parameters)</span>
<span id="cb12-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># opt &lt;- optim_sgd(net$parameters, lr=0.001)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### training loop --------------------------------------</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (epoch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) {</span>
<span id="cb13-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># forward pass</span></span>
<span id="cb13-5">  y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)</span>
<span id="cb13-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute loss </span></span>
<span id="cb13-7">  loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_mse_loss</span>(y_pred, y)</span>
<span id="cb13-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (epoch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) { </span>
<span id="cb13-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Epoch: "</span>, epoch, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", Loss: "</span>, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-10">  }</span>
<span id="cb13-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># back propagation </span></span>
<span id="cb13-12">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_grad</span>()</span>
<span id="cb13-13">  loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb13-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update weights</span></span>
<span id="cb13-15">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>()</span>
<span id="cb13-16">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  10 , Loss:  2.9349 
Epoch:  20 , Loss:  2.746983 
Epoch:  30 , Loss:  2.571736 
Epoch:  40 , Loss:  2.407329 
Epoch:  50 , Loss:  2.250772 
Epoch:  60 , Loss:  2.100186 
Epoch:  70 , Loss:  1.955103 
Epoch:  80 , Loss:  1.814764 
Epoch:  90 , Loss:  1.680777 
Epoch:  100 , Loss:  1.554698 
Epoch:  110 , Loss:  1.438442 
Epoch:  120 , Loss:  1.333506 
Epoch:  130 , Loss:  1.24129 
Epoch:  140 , Loss:  1.162575 
Epoch:  150 , Loss:  1.098303 
Epoch:  160 , Loss:  1.048342 
Epoch:  170 , Loss:  1.010677 
Epoch:  180 , Loss:  0.983175 
Epoch:  190 , Loss:  0.9634223 
Epoch:  200 , Loss:  0.9497179 </code></pre>
</div>
</div>
<p>Compare the prediction and observation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">y_pred_s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)</span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(y, y_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span>, </span>
<span id="cb15-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Neural network: A sequential module"</span>)</span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/neural_network_basic/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mean squared error, L2 loss</span></span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_pred))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 189.9436</code></pre>
</div>
</div>
<p>Compared with the linear model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">xdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(x))</span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(xdf) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x3"</span>)</span>
<span id="cb18-3">ydf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(y))</span>
<span id="cb18-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ydf) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>)</span>
<span id="cb18-5">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(xdf, ydf)</span>
<span id="cb18-6">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>x1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>x2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>x3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat)</span>
<span id="cb18-7">y_pred_lm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, xdf)</span>
<span id="cb18-8">ydf2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(ydf, y_pred_lm)</span>
<span id="cb18-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(ydf2[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], ydf2[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span>, </span>
<span id="cb18-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linear regresssion"</span>)</span>
<span id="cb18-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/neural_network_basic/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mean squared error, L2 loss</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ydf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y_pred_lm)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 193.0855</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>GPT-2</category>
  <category>ChatGPT</category>
  <category>Wolfram</category>
  <guid>https://www.jonghoonk.com/blog/posts/neural_network_basic/index.html</guid>
  <pubDate>Sun, 26 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/neural_network_basic/obs_pred.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Variables selection in statistical models</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/variable_selection/index.html</link>
  <description><![CDATA[ 




<p>When building statistical models, one of the most critical steps is variable selection. This process involves choosing the appropriate predictors or features that will be included in your model. The goal is to create a model that is both accurate and interpretable, avoiding overfitting and underfitting. I’ll explore what I am learning regarding issues related to variable selection, the common methods used, and best practices to ensure robust model performance.</p>
<p>The following contents are mainly based on <a href="https://diagnprognres.biomedcentral.com/articles/10.1186/s41512-020-00074-3">the work by Sauebrei et al</a>, which I am learning. As such, the following contents should not be used as a definitive guide to variable selection.</p>
<p>Variable selection should start by defining what kind of model one is developing. The work by Shumeli, <a href="https://www.stat.berkeley.edu/~aldous/157/Papers/shmueli.pdf">To explain or to predict?</a>, discusses that there may be three kinds of statistical models: descriptive, explanatory, and predictive models. The first sentence of its abstract reads, “Statistical modeling is a powerful tool for developing and testing theories by way of causal explanation, prediction, and description.”</p>
<p>Then we can list the variables based on the prior information. In this stage, drawing a directed acyclic graph (DAG) may help.</p>
<p>Once the list is made, one can employ a</p>
<ol type="1">
<li>Forward selection (FS)</li>
<li>Backward elimination (BE)</li>
<li>Stepwise method that combines FS with additional BE. BE method is preferred because we already starts with a plausible model</li>
<li>Best subset selection</li>
</ol>
<p>Different information criteria have been proposed, among which Akaike’s information criterion (AIC) is in principle preferable for predictive models and Schwartz’s Bayesian information criterion (BIC) for descriptive models.</p>
<ol start="19" type="1">
<li>Burnham KP, Anderson DR. Model selection and multimodel inference: a practical information-theoretic approach. New York: Springer; 2002.</li>
</ol>
<p>true data generating model??</p>
<ol type="1">
<li>Filter Methods: These methods apply statistical measures to assign a score to each feature. Features are ranked by their scores, and the top-ranked ones are selected.</li>
</ol>
<p>Correlation Coefficient: Measures the linear relationship between each feature and the target variable. Features with high correlation (positive or negative) are preferred.</p>
<p>Chi-Square Test: Used for categorical variables, this test assesses whether there is a significant association between the feature and the target variable.</p>
<p>ANOVA F-Value: For continuous variables, the ANOVA F-value tests the null hypothesis that all means are equal.</p>
<ol start="2" type="1">
<li>Wrapper Methods: These methods evaluate feature subsets based on model performance. The main types of wrapper methods include:</li>
</ol>
<p>Forward Selection: Starts with no variables and adds one variable at a time based on model performance improvement.</p>
<p>Backward Elimination: Starts with all variables and removes the least significant variable at each step.</p>
<p>Recursive Feature Elimination (RFE): Builds the model and eliminates the least important feature iteratively until the optimal number of features is reached.</p>
<ol start="3" type="1">
<li>Embedded Methods: These methods perform variable selection during the model training process and are typically specific to certain types of models.</li>
</ol>
<p>LASSO (Least Absolute Shrinkage and Selection Operator): Adds a penalty equal to the absolute value of the magnitude of coefficients. This penalty can shrink some coefficients to zero, effectively performing variable selection.</p>
<p>Ridge Regression: Adds a penalty equal to the square of the magnitude of coefficients. While it doesn’t perform variable selection outright, it can reduce the impact of less important variables.</p>
<p>Tree-Based Methods: Models like Random Forests or Gradient Boosting Trees inherently perform variable selection by considering the importance of variables based on their contribution to reducing impurity or error.</p>
<p>Best Practices for Variable Selection 1. Understand Your Data: Before diving into variable selection techniques, it’s crucial to have a deep understanding of your data. Perform exploratory data analysis (EDA) to identify potential relationships and understand the context of each variable.</p>
<ol start="2" type="1">
<li><p>Use Domain Knowledge: Leverage domain expertise to inform your variable selection process. Certain variables might be inherently more important based on the context of the problem.</p></li>
<li><p>Cross-Validation: Always use cross-validation to assess the performance of your model with the selected variables. This ensures that your model’s performance is consistent across different subsets of the data.</p></li>
<li><p>Combine Methods: Often, the best approach is to combine multiple methods. For instance, you might start with filter methods to narrow down the field and then use wrapper methods to fine-tune the selection.</p></li>
<li><p>Regularly Re-Evaluate: As new data becomes available or the problem context changes, re-evaluate your variable selection. What was relevant at one time may no longer be the best choice.</p></li>
</ol>
<p>Conclusion Variable selection is a pivotal step in building effective statistical models. By carefully choosing the right variables, you can improve model accuracy, interpretability, and efficiency. Whether using filter methods, wrapper methods, or embedded methods, the key is to balance model complexity with performance. Combining these methods with domain knowledge and cross-validation will ensure that your model is robust and reliable. As data science continues to evolve, so too will the strategies for variable selection, making it an exciting area of ongoing research and application.</p>
<p>Use prior information. Try to draw a directed acyclic graph (DAG)</p>
<ol type="1">
<li>Forward selection (FS)</li>
<li>Backward elimination (BE)</li>
<li>Stepwise method that combines FS with additional BE. BE method is preferred because we already starts with a plausible model</li>
<li>Best subset selection</li>
</ol>
<p>Different information criteria have been proposed, among which Akaike’s information criterion (AIC) is in principle preferable for predictive models and Schwartz’s Bayesian information criterion (BIC) for descriptive models.</p>
<ol start="19" type="1">
<li>Burnham KP, Anderson DR. Model selection and multimodel inference: a practical information-theoretic approach. New York: Springer; 2002.</li>
</ol>
<p>true data generating model??</p>
<ol start="5" type="1">
<li>Change-in-estimate</li>
<li>Lasso</li>
<li>Elastic net</li>
<li>Boosting - Component-wise boosting is a forward stagewise regression procedure applicable to generalised linear models</li>
<li>Resampling-based: 9.1: bootstrap inclusion frequencies (BIF) 9.2: stability selection</li>
</ol>
<p>Post-selection inference</p>
<p>Since the main aim of descriptive models is the interpretation of the estimated regression coefficients, point estimates should be accompanied by confidence intervals and sometimes also by <img src="https://latex.codecogs.com/png.latex?p"> values.</p>
<p>Generalised additive model (GAM) <a href="https://diagnprognres.biomedcentral.com/articles/10.1186/s41512-020-00074-3">State-of-the-art</a></p>
<p><a href="https://www.stat.berkeley.edu/~aldous/157/Papers/shmueli.pdf">To explain or to predict?</a></p>
<p>Clssic guide to the generalized linear mixed model is <a href="https://www.cell.com/trends/ecology-evolution/abstract/S0169-5347(09)00019-6?mobileUi\u003d0\u0026code\u003dcell-site=">Bolker et al.</a></p>
<p><a href="https://www.frontiersin.org/journals/psychology/articles/10.3389/fpsyg.2021.666182/full">Reporting guidelines for the GLIMM</a></p>
<section id="data-fields" class="level3">
<h3 class="anchored" data-anchor-id="data-fields">Data Fields</h3>
<p>age: Age of the subject age_grp: sex: household size: Number of people living together excluding oneself school/occupation</p>


</section>

 ]]></description>
  <category>R</category>
  <category>variable selection</category>
  <category>generalized linear model</category>
  <guid>https://www.jonghoonk.com/blog/posts/variable_selection/index.html</guid>
  <pubDate>Fri, 17 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/variable_selection/chatgpt.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Learning ChatGPT 1: Probabilities for the next word</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/learning_ChatGPT_1/index.html</link>
  <description><![CDATA[ 




<p>Inspired by the <a href="https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/">blog post by Stephen Wolfram</a> about the workings of the GPT-2 system, I decided to learn a bit about ChatGPT myself. Luckily, <a href="https://github.com/AGPatriota/GPT-2-for-R">GPT-2</a> is now available for R. My first task is simply to learn to run the model and generate the probability table for the words that can follow the text, “The best thing about AI is to be able to”. The following contents are mainly based on <a href="https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/">the blog post by Stephen Wolfram</a>. Additional resources include OpenAI Github page for <a href="https://github.com/openai/gpt-2">gpt-2</a> and <a href="https://d4mucfpksywv.cloudfront.net/better-language-models/language-models.pdf">the paper</a> describing GPT-2 paper.</p>
<p>Load the libraries and R implementation of GPT-2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(tok)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(torch)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GPT.R'</span>)</span></code></pre></div>
</div>
<p>Create a tokenizer to process inputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">tok <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tok<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>tokenizer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">from_pretrained</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt2"</span>)</span></code></pre></div>
</div>
<p>Load a GPT-2 model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with_device</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"meta"</span>,{</span>
<span id="cb3-2">  Model0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GPT</span>(</span>
<span id="cb3-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">block_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,</span>
<span id="cb3-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_embd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">768</span>,</span>
<span id="cb3-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N_Layers =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nvoc =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50257</span>,</span>
<span id="cb3-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Head =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb3-8">  )</span>
<span id="cb3-9">})</span></code></pre></div>
</div>
<p>Apply the model weights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">Model0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load_state_dict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">state_dict =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_load</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model-weights.pt"</span>),</span>
<span id="cb4-2">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.refer_to_state_dict =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<p>Create a function to list up <code>top_k</code> words with their probabilities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">top_k_words <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb5-2">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb5-3">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">raw_text =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb5-4">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb5-5">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">top_k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>){</span>
<span id="cb5-6">  </span>
<span id="cb5-7">  idx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> tok<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">encode</span>(raw_text)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids</span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input text is "</span>, raw_text)</span>
<span id="cb5-9">  idx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(idx<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dtype=</span>torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_int</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device=</span>device0)</span>
<span id="cb5-10">  idx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_unsqueeze</span>(idx, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-11">  idx_cond <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> idx    </span>
<span id="cb5-12">  logits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>()(idx_cond)</span>
<span id="cb5-13">  logits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> logits[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(idx<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">size</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>), ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> temperature</span>
<span id="cb5-14">  </span>
<span id="cb5-15">  logits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> logits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">topk</span>(top_k)</span>
<span id="cb5-16">  probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_softmax</span>(logits[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-17">  df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">token =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb5-18">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probability=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(probs))</span>
<span id="cb5-19">  </span>
<span id="cb5-20">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>top_k) {</span>
<span id="cb5-21">    idx_next <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> logits[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]][,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(i)]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unsqueeze</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-22">    token <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tok<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">decode</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(idx_next<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb5-23">    df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>token[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> token</span>
<span id="cb5-24">  }</span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(df)</span>
<span id="cb5-26">}</span></code></pre></div>
</div>
<p>Have the model run on GPU</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">Model0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cuda_is_available</span>()) Model0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cuda</span>() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> Model0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span>()</span>
<span id="cb6-2">device0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cuda_is_available</span>()) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cuda"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cpu"</span></span></code></pre></div>
</div>
<p>Generate the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for reproducibility, GPT-2 output is random.</span></span>
<span id="cb7-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_k_words</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> Model0,</span>
<span id="cb7-3">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device0,</span>
<span id="cb7-4">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">raw_text =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The best thing about AI is its ability to"</span>, </span>
<span id="cb7-5">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb7-6">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">top_k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Token"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability"</span>)</span>
<span id="cb7-9">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(df)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Token</th>
<th style="text-align: right;">Probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">learn</td>
<td style="text-align: right;">0.2770396</td>
</tr>
<tr class="even">
<td style="text-align: left;">predict</td>
<td style="text-align: right;">0.2047849</td>
</tr>
<tr class="odd">
<td style="text-align: left;">make</td>
<td style="text-align: right;">0.1826125</td>
</tr>
<tr class="even">
<td style="text-align: left;">understand</td>
<td style="text-align: right;">0.1745481</td>
</tr>
<tr class="odd">
<td style="text-align: left;">do</td>
<td style="text-align: right;">0.1610149</td>
</tr>
</tbody>
</table>
</div>
</div>



 ]]></description>
  <category>GPT-2</category>
  <category>ChatGPT</category>
  <category>Wolfram</category>
  <guid>https://www.jonghoonk.com/blog/posts/learning_ChatGPT_1/index.html</guid>
  <pubDate>Tue, 30 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_1/top5_prob.png" medium="image" type="image/png" height="44" width="144"/>
</item>
<item>
  <title>Logistic function in R</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/index.html</link>
  <description><![CDATA[ 




<section id="logistic-function" class="level3">
<h3 class="anchored" data-anchor-id="logistic-function">Logistic function</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Logistic_function">logistic function</a>, represented as: <img src="https://latex.codecogs.com/png.latex?%0Af(x)%20=%20%5Cfrac%7BL%7D%7B1+e%5E%7B-k(x-x_0)%7D%7D%0A"> , where <img src="https://latex.codecogs.com/png.latex?x_%7B0%7D,%20L">, and <img src="https://latex.codecogs.com/png.latex?k"> represent tht value of the function’s midpoint, the supremum of the values of the function, and the logistic growth rate or steepness of the curve. For values of <img src="https://latex.codecogs.com/png.latex?x"> in the domain of real numbers from <img src="https://latex.codecogs.com/png.latex?-%5Cinfty"> to <img src="https://latex.codecogs.com/png.latex?+%5Cinfty">, the S-shaped curve approaching <img src="https://latex.codecogs.com/png.latex?L"> as <img src="https://latex.codecogs.com/png.latex?x"> approaches <img src="https://latex.codecogs.com/png.latex?+%5Cinfty"> and approaching zero as <img src="https://latex.codecogs.com/png.latex?x"> approaches <img src="https://latex.codecogs.com/png.latex?-%5Cinfty">.</p>
<p>This function was originally devised as a model of <a href="https://en.wikipedia.org/wiki/Logistic_function">population growth</a> and is a versatile tool used in various fields, including epidemiology. In epidemiological contexts, it serves as a mathematical model to describe the growth or decline of infectious diseases within a population over time. See this <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7444956/">study</a>, for example, in which the logistic equation was used to decribe the growth of COVID-19 in a population.</p>
<p>The standard logistic function, where <img src="https://latex.codecogs.com/png.latex?x_%7B0%7D=0,%20L=1,%20k=1">, is sometimes called sigmoid or expit.</p>
<p>In the logistic function, the initial stage of growth is approximately exponential (geometric); then, as saturation begins, the growth slows to linear (arithmetic), and at maturity, growth stops. This function may be also used to describe other phenomena and <a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.1003003">was recently used</a> to model the shape of indirect vaccine efficacy (IVE) in response to the vaccine coverage levels. We are going to explore the use of the logistic function to model the IVE.</p>
</section>
<section id="indirect-effect-effectiveness" class="level3">
<h3 class="anchored" data-anchor-id="indirect-effect-effectiveness">Indirect effect effectiveness</h3>
<p><a href="https://www.jonghoonk.com/posts/vaccine_effectiveness/">Indirect vaccine effectiveness (IVE)</a> is a crucial metric in assessing the impact of vaccination on both vaccinated and unvaccinated individuals within a population. It refers to the protection unvaccinated individuals receive due to the presence of vaccinated individuals in the community.</p>
<p>To delve into the dynamics of IVE, we examine data from clinical trials of oral cholera vaccine conducted in Bangladesh and India. These studies provide insights into how varying levels of vaccination coverage affect the incidence rates among unvaccinated individuals residing in the same cluster.</p>
<p>In particular, we use the IVE analyzed based on clinical trials of oral cholera vaccines in <a href="https://pubmed.ncbi.nlm.nih.gov/15993232/">Bangladesh</a> and in <a href="https://pubmed.ncbi.nlm.nih.gov/23362293/">India</a>. In Table 1 below, we analyze the relationship between “Level of vaccine coverage” and the incidence rates among placebo recipients. The presence of IVE is evident as the risk of illness among placebo recipients diminishes with increasing vaccine coverage levels.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/ali2005_table1_ive.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Table 1</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">vc_cut <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>)</span>
<span id="cb1-2">vc_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vc_cut[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(vc_cut)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the data coming from the first year of vaccination</span></span>
<span id="cb1-4">ve_first_year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span></span>
<span id="cb1-5">eff_vc_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ve_first_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> vc_matlab </span>
<span id="cb1-6">ir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.87</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.72</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.65</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.47</span>)</span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lowest vaccine coverage group has no indirect effect</span></span>
<span id="cb1-8">ive_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ir)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ali (2013) Kolkata, India</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data from 3-year follow-up. Total protective efficacy remained high (66%)</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># therefore, effective vaccine coverage still calculated as we did for</span></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matlab, Bangladesh data</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Out of 107,347 eligible residents, 66,990 received 2 doses</span></span>
<span id="cb1-14">vc_cut <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">66990</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">107347</span>)</span>
<span id="cb1-15">vc_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vc_cut[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(vc_cut)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-16">ve_first_year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the data coming from the first year of vaccination</span></span>
<span id="cb1-17">eff_vc_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ve_first_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> vc_kolkata</span>
<span id="cb1-18">ir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.54</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.64</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.48</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.93</span>)</span>
<span id="cb1-19">ive_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ir)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-20"></span>
<span id="cb1-21">ive_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(eff_vc_kolkata, eff_vc_matlab), </span>
<span id="cb1-22">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ive_kolkata, ive_matlab))</span>
<span id="cb1-23">ive_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ive_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-24">ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span></span>
<span id="cb1-25">ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>location <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kolkata"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(eff_vc_kolkata)), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Matlab"</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(eff_vc_matlab)))</span></code></pre></div>
</div>
<p>Here, we assumed that the incidence rate among in the unvaccinated population, (i.e., no one was vaccinated) would be the same as the incidence rate observed in the lowest level of vaccine coverage rate, which would be 14% for Matlab and 12.5% for Kolkata. Because of this assumption, we may be underestimating the IVE. While it may be possible to reduce effective vaccine coverage rates by taking the difference between the effective vaccine coverage rates presented here and the lowest vaccine coverage rates (i.e., 14% or 12.5%), I wanted to be rather conservative than overestimating the impact.</p>
<p>Now we develop the logistic equation and fit the equation to the data. Since we know that the IVE has to be between <img src="https://latex.codecogs.com/png.latex?0"> and <img src="https://latex.codecogs.com/png.latex?1">, we set <img src="https://latex.codecogs.com/png.latex?L"> at 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">fm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> indirect_vacc_eff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(eff_vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x0)))</span>
<span id="cb2-2">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>fm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ive_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.27</span>))</span>
<span id="cb2-3">predict_logis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb2-4">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])))</span>
<span id="cb2-5">}</span>
<span id="cb2-6">newx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb2-7">newy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict_logis</span>(newx)</span>
<span id="cb2-8">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(ive_dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov=</span>newx, </span>
<span id="cb2-9">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff=</span>newy,</span>
<span id="cb2-10">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model1"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
</div>
<p>R has a self-starting logistic function, which can be helpful in case <code>nls</code> function is not successful for finding the parameter values with the given staring values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">fit_SSlogis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(indirect_vacc_eff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SSlogis</span>(eff_vacc_cov, Asym, xmid, scal), </span>
<span id="cb3-2">                   ive_dat)</span>
<span id="cb3-3">Asym <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asym"</span>]</span>
<span id="cb3-4">xmid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xmid"</span>]</span>
<span id="cb3-5">scal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scal"</span>]</span>
<span id="cb3-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## SSlogis has a different convention for the terms</span></span>
<span id="cb3-7">pred_SSlogis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb3-8">  Asym <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>((xmid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>scal))</span>
<span id="cb3-9">}</span>
<span id="cb3-10">newx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb3-11">newy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pred_SSlogis</span>(newx)</span>
<span id="cb3-12">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(d, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov=</span>newx, </span>
<span id="cb3-13">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff=</span>newy,</span>
<span id="cb3-14">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SSmodel"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
</div>
<p>Finally, we can force the logistic function to converge to 1 when the effective vaccine coverage reaches 1 and to 0 when the effective vaccine coverage is 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>eff_vacc_cov, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>indirect_vacc_eff)</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fm &lt;- indirect_vacc_eff ~ 1 / (1 + exp(-k*(eff_vacc_cov-x0)))</span></span>
<span id="cb4-3">fm2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x0)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>k)</span>
<span id="cb4-4">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>fm2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))</span>
<span id="cb4-5">predict_logis2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb4-6">  k <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit2)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>]]</span>
<span id="cb4-7">  x0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit2)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x0"</span>]]</span>
<span id="cb4-8">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x0)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>k)</span>
<span id="cb4-9">}</span>
<span id="cb4-10"></span>
<span id="cb4-11">newx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb4-12">newy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict_logis2</span>(newx)</span>
<span id="cb4-13">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(d, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov=</span>newx, </span>
<span id="cb4-14">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff=</span>newy,</span>
<span id="cb4-15">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model2"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb5-2">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>),</span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>location))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model1"</span>), </span>
<span id="cb5-9">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model2"</span>), </span>
<span id="cb5-11">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SSmodel"</span>), </span>
<span id="cb5-13">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forestgreen"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Indirect vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effective vaccine coverage"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("ive_vacc_cov.png")</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Logistic function</category>
  <category>indirect vaccine effectiveness</category>
  <category>oral cholera vaccine</category>
  <guid>https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/index.html</guid>
  <pubDate>Thu, 18 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/ali2005_table1_ive.png" medium="image" type="image/png" height="33" width="144"/>
</item>
<item>
  <title>Waning vaccine efficacy on susceptibility</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/vacc_eff_waining_multiple_stages/index.html</link>
  <description><![CDATA[ 




<p>In this article, I examined the process of modifying the disease transmission model (for instance, the <img src="https://latex.codecogs.com/png.latex?SEIR"> model) to include vaccination and the waning of vaccine-induced immunity as it might happen in a clinical trial. A straightforward method to represent this involves assuming vaccinated individuals (i.e., those in the vaccinated, <img src="https://latex.codecogs.com/png.latex?V">, compartment) possess partial immunity and subsequently transition back to the susceptible, <img src="https://latex.codecogs.com/png.latex?S">, compartment. This approach effectively simulates the diminishing effectiveness of vaccines using two parameters. I focus on determining these parameters through the analysis of existing vaccine efficacy data, utilizing the typhoid vaccine clinical trial as a case study. The adaptation of the model to account for the progressive reduction in vaccine-derived immunity across various compartments was conducted <a href="https://www.jonghoonk.com/posts/seir_varying_number_compartments/">prior post</a>.</p>
<section id="vaccine-efficacy-data" class="level3">
<h3 class="anchored" data-anchor-id="vaccine-efficacy-data">Vaccine efficacy data</h3>
<p>Vaccine efficacy data come from a clinical trial conducted in Malawi from 2018 through 2023, for which the detailed information is available in the <a href="https://pubmed.ncbi.nlm.nih.gov/38281499/">study</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># df &lt;- data.frame(year=c(1,2), efficacy=c(83.4,73.0)) # Shakya (2021) Lancet Glob Health</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy cumulative over the four years</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Patel (2024) Lancet</span></span>
<span id="cb1-5">tab2_vitt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,</span>
<span id="cb1-6">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;2yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2-4yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=5yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_ITT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_PP"</span>),</span>
<span id="cb1-7">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">person_years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6586</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15007</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38907</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60500</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59942</span>), </span>
<span id="cb1-8">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typhoid_culture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>),</span>
<span id="cb1-9">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IR_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">38.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">36.7</span>),</span>
<span id="cb1-10">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">70.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">79.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">79.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">78.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">80.0</span>))</span>
<span id="cb1-11"></span>
<span id="cb1-12">tab2_mena <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MenA"</span>,</span>
<span id="cb1-13">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;2yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2-4yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=5yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_ITT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_PP"</span>),</span>
<span id="cb1-14">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">person_years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6773</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15297</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38151</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60220</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59662</span>), </span>
<span id="cb1-15">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typhoid_culture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">71</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">109</span>),</span>
<span id="cb1-16">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IR_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">206.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">163.4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">186.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.7</span>),</span>
<span id="cb1-17">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE_obs =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19">tab2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(tab2_vitt, tab2_mena)</span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check the sanity of the data</span></span>
<span id="cb1-21">tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>typhoid_culture<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>person_years<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-22">tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb3-2">tab2[tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tab2[tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb3-4">               tab2[tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MenA"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb3-5">tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE  TRUE  TRUE  TRUE FALSE    NA    NA    NA    NA    NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">tab3_vitt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,</span>
<span id="cb5-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_ITT"</span>,</span>
<span id="cb5-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">person_years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14058</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28104</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42135</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">56121</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60500</span>),</span>
<span id="cb5-4">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year_since_vacc =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.61</span>),</span>
<span id="cb5-5">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typhoid_culture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>),</span>
<span id="cb5-6">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IR_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">42.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">42.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">35.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41.0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.7</span>),</span>
<span id="cb5-7">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE_obs=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">83.4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">80.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">80.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">77.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">78.3</span>))</span>
<span id="cb5-8">tab3_mena <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MenA"</span>,</span>
<span id="cb5-9">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_ITT"</span>,</span>
<span id="cb5-10">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">person_years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14036</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28021</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41983</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55889</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60220</span>),</span>
<span id="cb5-11">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year_since_vacc =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.61</span>),</span>
<span id="cb5-12">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typhoid_culture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">62</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>),</span>
<span id="cb5-13">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IR_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">256.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">221.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">178.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">178.9</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.7</span>),</span>
<span id="cb5-14">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE_obs =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb5-15">tab3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(tab3_vitt, tab3_mena)</span>
<span id="cb5-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check the sanity of the data</span></span>
<span id="cb5-17">tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>typhoid_culture<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>person_years<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-18">tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-19">tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb5-21">               tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MenA"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb5-22">tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] TRUE TRUE TRUE TRUE TRUE   NA   NA   NA   NA   NA</code></pre>
</div>
</div>
</section>
<section id="model-of-typhoid-transmission-for-a-clinical-trial" class="level3">
<h3 class="anchored" data-anchor-id="model-of-typhoid-transmission-for-a-clinical-trial">Model of typhoid transmission for a clinical trial</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">seirv_nstg_trial <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb7-2">  </span>
<span id="cb7-3">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]; I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]; R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]; C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb7-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # vaccinated cohort</span></span>
<span id="cb7-5">  nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb7-6">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg) {</span>
<span id="cb7-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;- "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u[5+"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"]"</span>)));</span>
<span id="cb7-8">  }<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and partially protected</span></span>
<span id="cb7-9"> </span>
<span id="cb7-10">  VS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated but immunity waned and fully susceptible</span></span>
<span id="cb7-11">  VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] </span>
<span id="cb7-12">  VI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] </span>
<span id="cb7-13">  VR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] </span>
<span id="cb7-14">  VC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb7-15">  </span>
<span id="cb7-16">  pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R</span>
<span id="cb7-17">  </span>
<span id="cb7-18">  v_sum <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,x)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>)</span>
<span id="cb7-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"popV &lt;- VS+VE+VI+VR+"</span>, v_sum)))</span>
<span id="cb7-20">  </span>
<span id="cb7-21">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/latent period</span></span>
<span id="cb7-22">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/duration of infectiousness</span></span>
<span id="cb7-23">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transmission rate</span></span>
<span id="cb7-24">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># death rate is applied and population size decreases over time</span></span>
<span id="cb7-25">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 / duration of natural immunity</span></span>
<span id="cb7-26">  omega_v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 / duration of partial vaccine-derived immunity</span></span>
<span id="cb7-27">  ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy</span></span>
<span id="cb7-28">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and unvaccinated population mix randomly</span></span>
<span id="cb7-29">  foi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>VI)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>popV) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># force of infection</span></span>
<span id="cb7-30">  </span>
<span id="cb7-31">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb7-32">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb7-33">  muRS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega</span>
<span id="cb7-34">  muVS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nstg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega_v</span>
<span id="cb7-35">  </span>
<span id="cb7-36">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># differential equations</span></span>
<span id="cb7-37">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(pop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>popV)</span>
<span id="cb7-38">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb7-39">  dI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb7-40">  dR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R</span>
<span id="cb7-41">  dC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb7-42"></span>
<span id="cb7-43">  dV1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muVS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V1</span>
<span id="cb7-44">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb7-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg) {</span>
<span id="cb7-46">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dV"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;- - foi*(1-ve)*V"</span>, i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" + muVS*V"</span>,</span>
<span id="cb7-47">                           i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span> , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - muVS*V"</span>, i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - mu*V"</span>, i)))</span>
<span id="cb7-48">    }</span>
<span id="cb7-49">  }</span>
<span id="cb7-50"></span>
<span id="cb7-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dVS &lt;- - foi*VS + muVS*V"</span>, </span>
<span id="cb7-52">                       nstg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" + muRS*VR - mu*VS"</span>))) </span>
<span id="cb7-53">  </span>
<span id="cb7-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dVE &lt;- foi*((1-ve)*("</span>, </span>
<span id="cb7-55">                       v_sum, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")+VS) - muEI*VE - mu*VE"</span>)))</span>
<span id="cb7-56">  </span>
<span id="cb7-57">  dVI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI</span>
<span id="cb7-58">  dVR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR</span>
<span id="cb7-59">  dVC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE</span>
<span id="cb7-60">  </span>
<span id="cb7-61">  dvstr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dV"</span>, x)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb7-62">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c(dS,dE,dI,dR,dC,"</span>, </span>
<span id="cb7-63">                              dvstr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",dVS,dVE,dVI,dVR,dVC)"</span>))))</span>
<span id="cb7-64">}</span></code></pre></div>
</div>
</section>
<section id="simulation-of-the-variable-compartment-seirv-model" class="level3">
<h3 class="anchored" data-anchor-id="simulation-of-the-variable-compartment-seirv-model">Simulation of the variable-compartment <img src="https://latex.codecogs.com/png.latex?SEIRV"> model</h3>
<p>Solutions for the steady states of the <img src="https://latex.codecogs.com/png.latex?SEIR"> model. These are used to set the initial conditions as we assume that the disease transmission reached a <a href="https://www.jonghoonk.com/posts/cholera_seir_eqn/">steady state</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">Ss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"((gamma + mu) * (epsilon + mu)) / (beta * epsilon)"</span></span>
<span id="cb8-2">Es <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"- ((gamma + mu) * (mu + omega) * ((gamma + mu) * (epsilon + mu) - beta * epsilon)) / (beta * epsilon * (gamma * (epsilon + mu + omega) + (epsilon + mu) * (mu + omega)))"</span></span>
<span id="cb8-3"></span>
<span id="cb8-4">Is <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"((mu + omega) * (beta * epsilon - (gamma + mu) * (epsilon + mu))) / (beta * omega * (gamma + epsilon + mu) + beta * (gamma + mu) * (epsilon + mu))"</span></span>
<span id="cb8-5">Rs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(beta * gamma * epsilon - gamma * (gamma + mu) * (epsilon + mu)) / (beta * omega * (gamma + epsilon + mu) + beta * (gamma + mu) * (epsilon + mu))"</span></span></code></pre></div>
</div>
<p>Common parameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># basic reproduction number</span></span>
<span id="cb9-2">epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/epsilon = incubation period</span></span>
<span id="cb9-3">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.8</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/gamma = duration of infectiousness</span></span>
<span id="cb9-4">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instantaneous transmission rate</span></span>
<span id="cb9-5">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural death rate</span></span>
<span id="cb9-6">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># re-infection is not counted in the clinical trial</span></span>
<span id="cb9-7">omega_v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural immunity waning rate</span></span>
<span id="cb9-8">ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.834</span></span>
<span id="cb9-9">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of stages</span></span>
<span id="cb9-10">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e6</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># population size</span></span>
<span id="cb9-11">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fraction of vaccinated population</span></span>
<span id="cb9-12">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span>
<span id="cb9-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb9-14">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, </span>
<span id="cb9-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span>omega, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega_v=</span>omega_v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ve=</span>ve,</span>
<span id="cb9-16">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N=</span>N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">f=</span>f, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tend=</span>tend)</span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># steady states for given parameters</span></span>
<span id="cb9-19">states0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>Ss, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E=</span>Es, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span>Is, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span>Rs)</span>
<span id="cb9-20">steadys0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(states0, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> x)))</span></code></pre></div>
</div>
<p>Function to run the model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">run_seirv_nstg_trial <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(params) {</span>
<span id="cb10-2">  de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to use Julia's DifferentialEquations.jl</span></span>
<span id="cb10-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial distribution of the population across the states</span></span>
<span id="cb10-4">  nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]]</span>
<span id="cb10-5">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N"</span>]]</span>
<span id="cb10-6">  f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>]]</span>
<span id="cb10-7">  V0s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>, x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"=0"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u0 &lt;- c(steadys0*N,C=0,"</span>, </span>
<span id="cb10-9">                       V0s, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",VS=0,VE=0,VI=0,VR=0,VC=0)"</span>)))</span>
<span id="cb10-10">  u0[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f))</span>
<span id="cb10-11">  tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tend"</span>]]</span>
<span id="cb10-12">  tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, tend)</span>
<span id="cb10-13">  </span>
<span id="cb10-14">  prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seirv_nstg_trial, u0, tspan, params)</span>
<span id="cb10-15">  sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-16">  mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb10-17">  udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb10-18">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb10-19"></span>
<span id="cb10-20">  Vn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"V'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb10-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c("t","S","E","I","R","C",'</span>, Vn, </span>
<span id="cb10-22">                                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"VS","VE","VI","VR","VC")'</span>))) </span>
<span id="cb10-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb10-24">}</span></code></pre></div>
</div>
<p>Direct vaccine effectiveness in case vaccine-derived immunity does not wane over time</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]]</span>
<span id="cb11-2">params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega_v"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb11-3">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seirv_nstg_trial</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params)</span>
<span id="cb11-4">novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb11-5">Vn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"V'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb11-6">vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c('</span>, Vn, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"VS","VE","VI","VR")'</span>))) </span>
<span id="cb11-7">  </span>
<span id="cb11-8">dve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># direct vaccine effectiveness measured daily</span></span>
<span id="cb11-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)){</span>
<span id="cb11-10">  dve[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,vacc]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,novacc]))</span>
<span id="cb11-11">}</span>
<span id="cb11-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, dve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct VE"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vacc_eff_waining_multiple_stages/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Direct vaccine efficacy in case vaccine-derived immunity wanes over time with the average waiting time of 10 years</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]]</span>
<span id="cb12-2">params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega_v"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># average waiting time = 10 years</span></span>
<span id="cb12-3">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seirv_nstg_trial</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params)</span>
<span id="cb12-4">novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb12-5">Vn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"V'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb12-6">vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c('</span>, Vn, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"VS","VE","VI","VR")'</span>))) </span>
<span id="cb12-7">  </span>
<span id="cb12-8">dve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># direct vaccine effectiveness measured daily</span></span>
<span id="cb12-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)){</span>
<span id="cb12-10">  dve[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,vacc]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,novacc]))</span>
<span id="cb12-11">}</span>
<span id="cb12-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, dve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct VE"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vacc_eff_waining_multiple_stages/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Function to measure vaccine effectiveness over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">measure_vacc_eff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p, params, times){</span>
<span id="cb13-2">  de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span>
<span id="cb13-3">  params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ve"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb13-4">  params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega_v"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb13-5">  nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]]</span>
<span id="cb13-6">  </span>
<span id="cb13-7">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seirv_nstg_trial</span>(params)</span>
<span id="cb13-8">  novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb13-9">  Vn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"V'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb13-10">  vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c('</span>, Vn, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"VS","VE","VI","VR")'</span>))) </span>
<span id="cb13-11">  </span>
<span id="cb13-12">  ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(times))</span>
<span id="cb13-13">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(times)) {</span>
<span id="cb13-14">    ve_sim[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> </span>
<span id="cb13-15">      ((out[times[i],<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[times[i],vacc])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> </span>
<span id="cb13-16">      ((out[times[i],<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[times[i],novacc]))</span>
<span id="cb13-17">  }</span>
<span id="cb13-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(ve_sim)</span>
<span id="cb13-19">}</span></code></pre></div>
</div>
<p>Define sum of squared difference (ssq) between the model and the data to evaluate the performance of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the initial VE is not measured from the model</span></span>
<span id="cb14-2">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>year_since_vacc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># times to measure VE</span></span>
<span id="cb14-3">ve_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb14-4">ssq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p){</span>
<span id="cb14-5">  ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times)</span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ve_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ve_sim)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)  </span>
<span id="cb14-7">}</span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check for some predetermined ve and omega</span></span>
<span id="cb14-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ssq(p=c(0.8,1/3650)) must be smaller than ssq(p=c(0.4,1/365))</span></span>
<span id="cb14-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3650</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05994089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3650</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.005789</code></pre>
</div>
</div>
<p>Estimate parameters by minimizing the ssq using the <code>nlminb</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb18-2">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlminb</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">objective=</span>ssq, </span>
<span id="cb18-3">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)),</span>
<span id="cb18-4">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>))</span>
<span id="cb18-5">fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8589978</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22.14073</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>objective</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0003437906</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">ve_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.834 0.807 0.801 0.771 0.783</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">(ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.828 0.815 0.799 0.782 0.772</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb28-2">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlminb</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">objective=</span>ssq, </span>
<span id="cb28-3">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)),</span>
<span id="cb28-4">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>))</span>
<span id="cb28-5">fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb28-6"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span>
<span id="cb28-7">fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>objective</span>
<span id="cb28-8">ve_obs</span>
<span id="cb28-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
</div>
<p>Plot data and simulation results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png("vacc_eff_obs_sim.png")</span></span>
<span id="cb29-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(times<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, ve_obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>, </span>
<span id="cb29-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year since vaccination"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct vaccine effectiveness"</span>,</span>
<span id="cb29-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb29-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(times<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, ve_sim, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb29-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb29-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), </span>
<span id="cb29-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>), </span>
<span id="cb29-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb29-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb29-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb29-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb29-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb29-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb29-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vacc_eff_waining_multiple_stages/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Vaccine</category>
  <category>waning</category>
  <category>SEIR</category>
  <category>Erlang distribution</category>
  <guid>https://www.jonghoonk.com/blog/posts/vacc_eff_waining_multiple_stages/index.html</guid>
  <pubDate>Sun, 07 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/vacc_eff_waining_multiple_stages/vacc_eff_obs_sim.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>SEIR model with varying number of compartments</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/seir_varying_number_compartments/index.html</link>
  <description><![CDATA[ 




<p>The <img src="https://latex.codecogs.com/png.latex?SEIR"> model structures each stage as a distinct compartment, with transitions between compartments dictated by specific rate constants, except for the transition between <img src="https://latex.codecogs.com/png.latex?S"> and <img src="https://latex.codecogs.com/png.latex?E"> that involve force of infection which is also a function of <img src="https://latex.codecogs.com/png.latex?t">. Waiting times in the <img src="https://latex.codecogs.com/png.latex?E"> and <img src="https://latex.codecogs.com/png.latex?I"> compartments are assumed to follow an exponential distribution. However, to better reflect reality, it might be necessary to consider alternative distributions. For instance, the waiting time in the <img src="https://latex.codecogs.com/png.latex?E"> compartment, i.e., incubation period, could be represented by a lognormal or Weibull distribution. Within the framework of ordinary differential equations (ODEs), incorporating these distributions directly poses challenges. Nevertheless, by dividing a single compartment into multiple sub-compartments, waiting times follow the Erlang distribution, effectively capturing the essence of both lognormal and Weibull distributions.</p>
<p>The process of adding multiple sub-compartments is relatively straightforward. The challenge arises when one wishes to dynamically adjust the number of sub-compartments within a single model framework. This post discusses a method to achieve such adaptability in model construction. To enhance model flexibility, I extensively employ strings, specifically utilizing the <code>eval(str2lang("some text"))</code> function.</p>
<section id="diffeqr-package" class="level3">
<h3 class="anchored" data-anchor-id="diffeqr-package"><code>diffeqr</code> package</h3>
<p><code>diffeqr</code> package is used use Julia’s <code>DifferentialEquations</code> library</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(diffeqr)</span>
<span id="cb1-2">de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span></code></pre></div>
</div>
<p>First, let’s construct the classic SEIR model for comparison. This model is equivalent to a variant with variable compartments for the <img src="https://latex.codecogs.com/png.latex?I"> stage when considering only a single compartment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">seir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb2-2">  </span>
<span id="cb2-3">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; </span>
<span id="cb2-4">  E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>];</span>
<span id="cb2-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the number of compartments to model the duration of infectiousness</span></span>
<span id="cb2-6">  I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>];</span>
<span id="cb2-7">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]; </span>
<span id="cb2-8">  C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>];</span>
<span id="cb2-9"></span>
<span id="cb2-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># population size</span></span>
<span id="cb2-11">  pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>E<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>R</span>
<span id="cb2-12">  </span>
<span id="cb2-13">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/latent period</span></span>
<span id="cb2-14">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/duration of infectiousness</span></span>
<span id="cb2-15">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transmission rate</span></span>
<span id="cb2-16">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/omega = duration of natural immunity</span></span>
<span id="cb2-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># force of infection</span></span>
<span id="cb2-18">  foi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop </span>
<span id="cb2-19">  </span>
<span id="cb2-20">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb2-21">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb2-22">  muRS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega</span>
<span id="cb2-23">  </span>
<span id="cb2-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># differential equations</span></span>
<span id="cb2-25">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R </span>
<span id="cb2-26">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb2-27">  dI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb2-28">  dR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R</span>
<span id="cb2-29">  </span>
<span id="cb2-30">  dC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb2-31"></span>
<span id="cb2-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dS,dE,dI,dR,dC))</span>
<span id="cb2-33">}</span>
<span id="cb2-34"></span>
<span id="cb2-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># simulation</span></span>
<span id="cb2-36">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># basic reproduction number</span></span>
<span id="cb2-37">epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/epsilon = incubation period</span></span>
<span id="cb2-38">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/gamma = duration of infectiousness</span></span>
<span id="cb2-39">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instantaneous transmission rate</span></span>
<span id="cb2-40">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural immunity waning rate</span></span>
<span id="cb2-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb2-42">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span>omega)</span>
<span id="cb2-43">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-44">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  </span></span>
<span id="cb2-45">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, tend)</span>
<span id="cb2-46">  </span>
<span id="cb2-47">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir, u0, tspan, params)</span>
<span id="cb2-48">sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-49">mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb2-50">udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb2-51">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb2-52"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>) </span></code></pre></div>
</div>
</section>
<section id="seir-model-with-str2lang" class="level3">
<h3 class="anchored" data-anchor-id="seir-model-with-str2lang"><img src="https://latex.codecogs.com/png.latex?SEIR"> model with <code>str2lang</code></h3>
<p>The model with variable compartments for the <img src="https://latex.codecogs.com/png.latex?I"> stage. A part of the model is written using strings using <code>paste</code>, which are later evaluated using <code>eval(str2lang("some string"))</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">seir_nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb3-2">  </span>
<span id="cb3-3">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; </span>
<span id="cb3-4">  E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>];</span>
<span id="cb3-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the number of compartments to model the duration of infectiousness</span></span>
<span id="cb3-6">  nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] </span>
<span id="cb3-7">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg) {</span>
<span id="cb3-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;- "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u[2+"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"]"</span>)));</span>
<span id="cb3-9">  } </span>
<span id="cb3-10">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; </span>
<span id="cb3-11">  C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>];</span>
<span id="cb3-12"></span>
<span id="cb3-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># population size</span></span>
<span id="cb3-14">  istr_sum <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,x)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>)</span>
<span id="cb3-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pop &lt;- S+E+R+"</span>, istr_sum)))</span>
<span id="cb3-16">  </span>
<span id="cb3-17">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/latent period</span></span>
<span id="cb3-18">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/duration of infectiousness</span></span>
<span id="cb3-19">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transmission rate</span></span>
<span id="cb3-20">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/omega = duration of natural immunity</span></span>
<span id="cb3-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># force of infection</span></span>
<span id="cb3-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foi &lt;- beta*("</span>, istr_sum, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")/pop"</span>))) </span>
<span id="cb3-23">  </span>
<span id="cb3-24">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb3-25">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb3-26">  muRS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega</span>
<span id="cb3-27">  </span>
<span id="cb3-28">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># differential equations</span></span>
<span id="cb3-29">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R </span>
<span id="cb3-30">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb3-31">  dI1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> nstg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1</span>
<span id="cb3-32"></span>
<span id="cb3-33">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#dI2, ...</span></span>
<span id="cb3-34">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb3-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg) {</span>
<span id="cb3-36">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dI"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;- "</span>, </span>
<span id="cb3-37">                           nstg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*muIR*(I"</span>, i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-I"</span>, i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>)))</span>
<span id="cb3-38">    }</span>
<span id="cb3-39">  }</span>
<span id="cb3-40">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dR</span></span>
<span id="cb3-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dR &lt;- muIR*I"</span>, nstg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-muRS*R"</span>)))</span>
<span id="cb3-42">  </span>
<span id="cb3-43">  dC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb3-44"></span>
<span id="cb3-45">  distr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dI"</span>, x)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb3-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c(dS,dE,"</span>, distr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",dR,dC)"</span>))))</span>
<span id="cb3-47">}</span></code></pre></div>
</div>
<p>Simulation of the variable-compartment model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">run_seir_nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(nstg) {</span>
<span id="cb4-2">  R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># basic reproduction number</span></span>
<span id="cb4-3">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/epsilon = incubation period</span></span>
<span id="cb4-4">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/gamma = duration of infectiousness</span></span>
<span id="cb4-5">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instantaneous transmission rate</span></span>
<span id="cb4-6">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural immunity waning rate</span></span>
<span id="cb4-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb4-8">  params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span>omega)</span>
<span id="cb4-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial distribution of the population across the states</span></span>
<span id="cb4-10">  I0s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>, x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"=0"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u0 &lt;- c(S=0,E=0,"</span>, I0s,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",R=0,C=0)"</span>)))</span>
<span id="cb4-12">  u0[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb4-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># all I in the first compartment of the nstg I compartments</span></span>
<span id="cb4-14">  tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  </span></span>
<span id="cb4-15">  tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, tend)</span>
<span id="cb4-16">  </span>
<span id="cb4-17">  prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir_nstg, u0, tspan, params)</span>
<span id="cb4-18">  sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-19">  </span>
<span id="cb4-20">  mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb4-21">  udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb4-22">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb4-23">  In <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"I'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c("t","S","E",'</span>, In, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"R","C")'</span>))) </span>
<span id="cb4-25">  </span>
<span id="cb4-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb4-27">}</span>
<span id="cb4-28"></span>
<span id="cb4-29">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-30">In <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"I'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-31">out1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seir_nstg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg)</span>
<span id="cb4-32">It1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> out1[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I1"</span>]</span>
<span id="cb4-33"></span>
<span id="cb4-34">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-35">In <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"I'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-36">out2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seir_nstg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg)</span>
<span id="cb4-37"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'It2 &lt;- rowSums(out2[,c('</span>, In, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">')])'</span>)))</span>
<span id="cb4-38">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb4-39">In <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"I'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-40">out5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seir_nstg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg)</span>
<span id="cb4-41"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'It5 &lt;- rowSums(out5[,c('</span>, In, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">')])'</span>)))</span></code></pre></div>
</div>
<p>Plot the simulation results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png(filename="seir_multi_comp.png")</span></span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out), out<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>I, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb5-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fraction infectious"</span>,</span>
<span id="cb5-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out), It1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>)</span>
<span id="cb5-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out), It2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out), It5, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magenta"</span>)</span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb5-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEIR"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 compartment"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2 compartments"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5 compartments"</span>), </span>
<span id="cb5-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magenta"</span>), </span>
<span id="cb5-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb5-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb5-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb5-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb5-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb5-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/seir_varying_number_compartments/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>SEIR</category>
  <category>Erlang distribution</category>
  <guid>https://www.jonghoonk.com/blog/posts/seir_varying_number_compartments/index.html</guid>
  <pubDate>Thu, 04 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/seir_varying_number_compartments/seir_multi_comp.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Waning of vaccine effectiveness</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/vaccine_effectiveness_waning/index.html</link>
  <description><![CDATA[ 




<p>The protection derived from vaccination often wanes over time and require the second or the third doses (so-called booster doses). For example, the <a href="https://pubmed.ncbi.nlm.nih.gov/8852414/">study</a> showed the efficacy of cholera vaccines over five years. The vaccine efficacy (VE) over the period seems to indicate that the VE wanes over time. In this post, we will develop a <img src="https://latex.codecogs.com/png.latex?SEIR"> model to illustrate the waning of vaccine-derived immunity.</p>
<section id="seir-model-with-vaccination" class="level4">
<h4 class="anchored" data-anchor-id="seir-model-with-vaccination"><img src="https://latex.codecogs.com/png.latex?SEIR"> model with vaccination</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">seir_vacc_trial_jl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb1-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine recipients lose partial immunity over time.</span></span>
<span id="cb1-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this is implemented in a way that individuals in the V state</span></span>
<span id="cb1-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># decreases and transitions to the S state</span></span>
<span id="cb1-5">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]; I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]; R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]; C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb1-6"> </span>
<span id="cb1-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated cohort</span></span>
<span id="cb1-8">  V <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]; <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and partially protected</span></span>
<span id="cb1-9">  VS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]; <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated but immunity waned and fully susceptible</span></span>
<span id="cb1-10">  VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>]; VI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>]; VR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]; VC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>]</span>
<span id="cb1-11">  </span>
<span id="cb1-12">  pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R</span>
<span id="cb1-13">  popV <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VS <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VR</span>
<span id="cb1-14"></span>
<span id="cb1-15">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/latent period</span></span>
<span id="cb1-16">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/duration of infectiousness</span></span>
<span id="cb1-17">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transmission rate</span></span>
<span id="cb1-18">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># death rate is applied and population size decreases over time</span></span>
<span id="cb1-19">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 / duration of natural immunity</span></span>
<span id="cb1-20">  omega_v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 / duration of partial vaccine-derived immunity</span></span>
<span id="cb1-21">  ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy</span></span>
<span id="cb1-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and unvaccinated population mix randomly</span></span>
<span id="cb1-23">  foi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>VI) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> popV) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># force of infection</span></span>
<span id="cb1-24">  </span>
<span id="cb1-25">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb1-26">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb1-27">  muRS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega</span>
<span id="cb1-28">  muVS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega_v</span>
<span id="cb1-29">  </span>
<span id="cb1-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># differential equations</span></span>
<span id="cb1-31">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S</span>
<span id="cb1-32">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb1-33">  dI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb1-34">  dR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R</span>
<span id="cb1-35">  dC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb1-36">  </span>
<span id="cb1-37">  dV <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muVS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V</span>
<span id="cb1-38">  dVS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VS <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muVS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VS </span>
<span id="cb1-39">  dVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VS) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE</span>
<span id="cb1-40">  dVI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI</span>
<span id="cb1-41">  dVR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR</span>
<span id="cb1-42">  dVC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE</span>
<span id="cb1-43">  </span>
<span id="cb1-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dS,dE,dI,dR,dC,dV,dVS,dVE,dVI,dVR,dVC))</span>
<span id="cb1-45">}</span></code></pre></div>
</div>
<p><code>diffeqr</code> package is used use Julia’s <code>DifferentialEquations</code> library</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(diffeqr)</span>
<span id="cb2-2">de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span></code></pre></div>
</div>
<p>We assume that cholera transmission is in the steady state in the setting where the vaccine efficacy trial is examined. Algebraic <a href="https://www.jonghoonk.com/posts/cholera_seir_eqn/">solutions</a> to the steady states (shown below) are used as initial conditions to generate initial conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">Ss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"((gamma + mu) * (epsilon + mu)) / (beta * epsilon)"</span></span>
<span id="cb3-2">Es <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"- ((gamma + mu) * (mu + omega) * ((gamma + mu) * (epsilon + mu) - beta * epsilon)) / (beta * epsilon * (gamma * (epsilon + mu + omega) + (epsilon + mu) * (mu + omega)))"</span></span>
<span id="cb3-3"></span>
<span id="cb3-4">Is <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"((mu + omega) * (beta * epsilon - (gamma + mu) * (epsilon + mu))) / (beta * omega * (gamma + epsilon + mu) + beta * (gamma + mu) * (epsilon + mu))"</span></span>
<span id="cb3-5">Rs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(beta * gamma * epsilon - gamma * (gamma + mu) * (epsilon + mu)) / (beta * omega * (gamma + epsilon + mu) + beta * (gamma + mu) * (epsilon + mu))"</span></span></code></pre></div>
</div>
</section>
<section id="simulation-of-a-clinical-trial" class="level4">
<h4 class="anchored" data-anchor-id="simulation-of-a-clinical-trial">Simulation of a clinical trial</h4>
<p>The basic idea is to use the steady states as initial conditions and therefore, cholera transmission is sustained as new susceptibles are supplied through birth and waning of vaccine-derived and natural immunity. In this setting, a clinical trial is implemented by moving some portion of the population to the vaccinated cohort. Note that the proportion of the vaccinated population, <img src="https://latex.codecogs.com/png.latex?f">, is important in the subsequent dynamics. For example, we <a href="https://www.jonghoonk.com/posts/critical_vacc_threshold/index.html">know</a> that if <img src="https://latex.codecogs.com/png.latex?f%3E%201-%20%5Cfrac%7B1%7D%7BR_0%7D">, cholera infections will die out. In this case, we can not measure the relative risk of cholera among vaccinated and unvaccinated population over a period based on the cumulative incidence. Even if <img src="https://latex.codecogs.com/png.latex?f%20%3C%201-%20%5Cfrac%7B1%7D%7BR_0%7D">, moving some portion of the population into vaccinated states will perturb the steady states that were determined based on and a series of outbreaks may follow before the system reaches new steady states eventually.</p>
<p>Since our objective is to vaccine efficacy in this dynamic population based on cumulative incidence among vaccinated and unvaccinated people, and we used the steady states without the vaccinated population, we can set the proportion of the vaccinated population small that the system more or less maintains the states without vaccination. Wh</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># unvaccinated population</span></span>
<span id="cb4-2">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a very small proportion of the population is vaccinated</span></span>
<span id="cb4-3">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-4">epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.4</span></span>
<span id="cb4-5">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-6">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma</span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mu &lt;- 1/(65*365) # natural death rate</span></span>
<span id="cb4-8">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural death rate</span></span>
<span id="cb4-9">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural immunity waning rate</span></span>
<span id="cb4-10">omega_v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine-derived immunity waning rate</span></span>
<span id="cb4-11">ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy (instantaneous hazard ratio)</span></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy based on CI will differ and we will eventually estimate</span></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this parameter along with omega_v</span></span>
<span id="cb4-14">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, </span>
<span id="cb4-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span>omega, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega_v=</span>omega_v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ve=</span>ve)</span>
<span id="cb4-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># steady states for given parameters</span></span>
<span id="cb4-17">states0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>Ss, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E=</span>Es, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span>Is, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span>Rs)</span>
<span id="cb4-18">steadys0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(states0, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> x)))</span>
<span id="cb4-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial distribution of the population across the states</span></span>
<span id="cb4-20">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VS=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VI=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VR=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VC=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-21">u0[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f))</span>
<span id="cb4-22"></span>
<span id="cb4-23">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20.0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># measure vaccin</span></span>
<span id="cb4-24">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, tend)</span>
<span id="cb4-25"></span>
<span id="cb4-26">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir_vacc_trial_jl, u0, tspan, params)</span>
<span id="cb4-27">sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-28"></span>
<span id="cb4-29">mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb4-30">udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb4-31">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb4-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>)</span>
<span id="cb4-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cumulative incidence</span></span>
<span id="cb4-34"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative incidence"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb4-35"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>,out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span>
<span id="cb4-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, </span>
<span id="cb4-37">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No vaccine"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine"</span>), </span>
<span id="cb4-38">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>), </span>
<span id="cb4-39">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-40">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb4-41">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb4-42">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb4-43">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb4-44">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness_waning/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Measure vaccine impact</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb5-2">vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)</span>
<span id="cb5-3">dve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># direct vaccine effectiveness measured daily</span></span>
<span id="cb5-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)){</span>
<span id="cb5-5">  dve[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,vacc]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,novacc]))</span>
<span id="cb5-6">}</span>
<span id="cb5-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>,dve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct VE"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness_waning/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="estimating-ve-and-omega_v" class="level3">
<h3 class="anchored" data-anchor-id="estimating-ve-and-omega_v">Estimating VE and <img src="https://latex.codecogs.com/png.latex?%5Comega_V"></h3>
<p>Let’s suppose we want to the following dataset showing the vaccine effec</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">ve_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">76</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span></code></pre></div>
</div>
<p>Create a function to measure vaccine efficacy from the model based on cumulative incidence</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">measure_vacc_eff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p, times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">f=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span>){</span>
<span id="cb7-2">  params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ve"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb7-3">  params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega_v"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb7-4">  u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V=</span>N,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VS=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VI=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VR=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VC=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-5">  u0[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f))</span>
<span id="cb7-6">  prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir_vacc_trial_jl, u0, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(times)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), params)</span>
<span id="cb7-7">  sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-8">  mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb7-9">  udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb7-10">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb7-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>,</span>
<span id="cb7-12">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>)</span>
<span id="cb7-13">  novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb7-14">  vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)</span>
<span id="cb7-15">  </span>
<span id="cb7-16">  ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(times))</span>
<span id="cb7-17">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(times)) {</span>
<span id="cb7-18">    ve_sim[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> </span>
<span id="cb7-19">      ((out[times[i],<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[times[i],vacc])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> </span>
<span id="cb7-20">      ((out[times[i],<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[times[i],novacc]))</span>
<span id="cb7-21">  }</span>
<span id="cb7-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(ve_sim)</span>
<span id="cb7-23">}</span></code></pre></div>
</div>
<p>Define sum of squared difference to evaluate the difference between the model and the observation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the initial VE is not measured from the model</span></span>
<span id="cb8-2">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># times to measure VE</span></span>
<span id="cb8-3">ssq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p){</span>
<span id="cb8-4">  ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times)</span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ve_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],ve_sim))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)  </span>
<span id="cb8-6">}</span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check for some predetermined ve and omega</span></span>
<span id="cb8-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ssq(p=c(0.8,1/3650)) must be smaller than ssq(p=c(0.4,1/365))</span></span>
<span id="cb8-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3650</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5765074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.260319</code></pre>
</div>
</div>
<p>Use the <code>nlminb</code> to identify the parameter values that minimize the ssq.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlminb</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">objective=</span>ssq, </span>
<span id="cb12-2">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)),</span>
<span id="cb12-3">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>))</span>
<span id="cb12-4">ve_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.76 0.72 0.68 0.63 0.58 0.52 0.46 0.39 0.32 0.24 0.15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par, times)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.83 0.73 0.65 0.58 0.52 0.46 0.42 0.38 0.34 0.31 0.29</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png("vacc_eff_waning.png")</span></span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ve_obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>, </span>
<span id="cb16-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct VE"</span>,</span>
<span id="cb16-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb16-5"></span>
<span id="cb16-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par, times)),</span>
<span id="cb16-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb16-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb16-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), </span>
<span id="cb16-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>), </span>
<span id="cb16-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb16-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb16-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb16-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb16-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb16-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb16-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness_waning/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>vaccine efficacy</category>
  <category>clinical trial</category>
  <category>SEIR</category>
  <guid>https://www.jonghoonk.com/blog/posts/vaccine_effectiveness_waning/index.html</guid>
  <pubDate>Wed, 03 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness_waning/vacc_eff_waning.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Solutions for the steady states of the SEIR model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/cholera_seir_eqn/index.html</link>
  <description><![CDATA[ 




<p>In this post, I compared the numerical solutions obtained using <code>deSolve::ode</code> with the algebraic solutions derived from Mathematica for the steady states of a SEIR model. The model considers the waning of natural immunity over time in a dynamically changing population.</p>
<section id="seir-model-with-waning-immunity-and-vital-dynamics" class="level3">
<h3 class="anchored" data-anchor-id="seir-model-with-waning-immunity-and-vital-dynamics"><img src="https://latex.codecogs.com/png.latex?SEIR"> model with waning immunity and vital dynamics</h3>
<p><img src="https://latex.codecogs.com/png.latex?%0AdS/dt%20=%20%5Cmu%20(S+E+I+R)%20-%20%5Cbeta%20SI%20-%20%5Cmu%20S%20+%20%5Comega%20R%5C%5C%0AdE/dt%20=%20%5Cbeta%20SI%20-%20(%5Cmu+%5Ckappa)E%5C%5C%0AdI/dt%20=%20%5Ckappa%20E%20-%20(%5Cmu+%5Cgamma)I%5C%5C%0AdR/dt%20=%20%5Cgamma%20I%20-%20(%5Cmu+%5Comega)%20R%0A"> Following Mathematica command produces the solutions for the steady states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">FullSimplify[</span>
<span id="cb1-2"> Solve[{\[Mu]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Beta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Omega]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-3">      R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Beta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Kappa])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> </span>
<span id="cb1-4">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Kappa]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Gamma])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> </span>
<span id="cb1-5">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Gamma]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb1-6">   S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, \[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Beta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Kappa] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb1-7">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Gamma] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb1-8">   S \[Element] Reals, E1 \[Element] Reals, I1 \[Element] Reals, </span>
<span id="cb1-9">   R \[Element] Reals}, {S, E1, I1, R}]]</span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?s%20=%20%5Cfrac%7B(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)%7D%7B%5Cbeta%20%20%5Ckappa%20%7D%20%5C%5C%0Ae%20=%20-%5Cfrac%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)%20((%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)-%5Cbeta%20%20%5Ckappa%20)%7D%7B%5Cbeta%20%20%5Ckappa%20%20(%5Cgamma%20%20(%5Ckappa%20+%5Cmu%20+%5Comega%20)+(%5Ckappa%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20))%7D%20%5C%5C%0Ai%20=%20%5Cfrac%7B(%5Cmu%20+%5Comega%20)%20(%5Cbeta%20%20%5Ckappa%20-(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20))%7D%7B%5Cbeta%20%20%5Comega%20%20(%5Cgamma%20+%5Ckappa%20+%5Cmu%20)+%5Cbeta%20%20(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)%7D%20%5C%5C%0Ar%20=%20%5Cfrac%7B%5Cbeta%20%20%5Cgamma%20%20%5Ckappa%20-%5Cgamma%20%20(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)%7D%7B%5Cbeta%20%20%5Comega%20%20(%5Cgamma%20+%5Ckappa%20+%5Cmu%20)+%5Cbeta%20%20(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)%7D%0A"> I used <code>latex2r</code> package to convert the LaTex expressions from the Mathematica to R codes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(latex2r)</span>
<span id="cb2-2">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa }"</span>)</span>
<span id="cb2-3">e <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) ((</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa )}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))}"</span>)</span>
<span id="cb2-4">i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa -(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ))}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}"</span>)</span>
<span id="cb2-5">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa -</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}"</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7">kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.115044</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mean late period is still around 1.4 days, </span></span>
<span id="cb2-8">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb2-9">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb2-10">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb2-11">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span></span>
<span id="cb2-12"></span>
<span id="cb2-13">states <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s=</span>s, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">e=</span>e, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span>i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span>r)</span>
<span id="cb2-14">val <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(states, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> x)))</span>
<span id="cb2-15">val[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(val[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"i"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>val[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4728244</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>kappa)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4728034</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">(gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>mu)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>mu)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4728244</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>kappa)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>kappa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>gamma) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4728034</code></pre>
</div>
</div>
<p>Numerical solutions based on <code>deSolve::ode</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">seir_vital <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb10-2">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb10-3">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]</span>
<span id="cb10-4">  kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kappa"</span>]</span>
<span id="cb10-5">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]</span>
<span id="cb10-6">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega"</span>]</span>
<span id="cb10-7">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>]</span>
<span id="cb10-8">  </span>
<span id="cb10-9">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb10-10">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb10-11">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb10-12">  du4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb10-13">  </span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3,du4))) </span>
<span id="cb10-15">}</span>
<span id="cb10-16"></span>
<span id="cb10-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb10-18">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb10-19">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.115044</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>), </span>
<span id="cb10-20">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span>
<span id="cb10-21">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb10-22">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_vital, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb10-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(outdf) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"i"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb10-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(outdf, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        day         s            e            i         r
30001 30000 0.8334656 0.0002166031 0.0002415018 0.1660763</code></pre>
</div>
</div>
</section>
<section id="se_1e_2i_1i_2r_1r_2-model" class="level3">
<h3 class="anchored" data-anchor-id="se_1e_2i_1i_2r_1r_2-model"><img src="https://latex.codecogs.com/png.latex?SE_1E_2I_1I_2R_1R_2"> model</h3>
<p>This model incorporates two consecutive compartments for the Exposed (E), Infectious (I), and Recovered (R) states, effectively changing the distribution of waiting times in each states from an exponential to an Erlang distribution with a shape parameter of 2, offering a more realistic representation.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AdS/dt%20=%20%5Cmu%20(S+E_1+I_1+R_1+E_2+I_2+R_2)%20-%20%5Cbeta%20S(I_1+I_2)%20-%20%5Cmu%20S%20+%202%20%5Comega%20R_2%5C%5C%0AdE_1/dt%20=%20%5Cbeta%20S(I_1+I_2)%20-%20(%5Cmu+2%5Ckappa)E1%5C%5C%0AdE_2/dt%20=%202%5Ckappa%20E_1%20-%20(%5Cmu+2%5Ckappa)E2%5C%5C%0AdI_1/dt%20=%202%20%5Ckappa%20E_2%20-%20(%5Cmu+2%5Cgamma)I_1%5C%5C%0AdI_2/dt%20=%202%5Cgamma%20I_1%20-%20(%5Cmu+2%5Cgamma)I_2%5C%5C%0AdR_1/dt%20=%202%20%5Cgamma%20I_2%20-%20(%5Cmu+2%5Comega)%20R_1%5C%5C%0AdR_2/dt%20=%202%20%5Comega%20R_1%20-%20(%5Cmu+2%5Comega)%20R_2%0A"></p>
<p>The following Mathematica command produces the solutions for the steady states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">FullSimplify[</span>
<span id="cb12-2"> Solve[{\[Mu]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-3">        R2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Beta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Omega]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> </span>
<span id="cb12-4">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Beta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I2)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Kappa])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb12-5">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Kappa]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Kappa] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb12-6">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Kappa]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Gamma])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb12-7">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Gamma]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Gamma] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb12-8">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Gamma]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb12-9">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Omega]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Omega])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb12-10">   S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, \[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Beta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb12-11">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Kappa] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Gamma] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb12-12">   E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S \[Element] Reals, </span>
<span id="cb12-13">   E1 \[Element] Reals, E2 \[Element] Reals, I1 \[Element] Reals, </span>
<span id="cb12-14">   I2 \[Element] Reals, R1 \[Element] Reals, R2 \[Element] Reals}, {S,</span>
<span id="cb12-15">    E1, E2, I1, I2, R1, R2}]]</span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%0As=%20%5Cfrac%7B(2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%7D%7B4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ae_1%20=%20-%20%5Cfrac%7B(2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%20(%5Cmu%20+2%20%5Comega%20)%5E2%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ae_2%20=%20-%5Cfrac%7B(2%20%5Cgamma%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B2%20%5Cbeta%20%20%5Ckappa%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ai_1%20=%20-%20%5Cfrac%7B(2%20%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+2%20%5Comega%20)%5E2%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B%5Cbeta%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ai_2%20=%20-%5Cfrac%7B2%20%5Cgamma%20%20(%5Cmu%20+2%20%5Comega%20)%5E2%20%5Cleft(4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)-(2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%5Cright)%7D%7B%5Cbeta%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ar_1%20=%20-%5Cfrac%7B4%20%5Cgamma%20%5E2%20(%5Cmu%20+2%20%5Comega%20)%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B%5Cbeta%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ar_2%20=%20-%5Cfrac%7B8%20%5Cgamma%20%5E2%20%5Comega%20%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B%5Cbeta%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%0A"></p>
<p>Again, LaTex expressions were converted to R codes using the <code>latex2r</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2}{4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}"</span>)</span>
<span id="cb13-2">e1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb13-3"></span>
<span id="cb13-4">e2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb13-5"></span>
<span id="cb13-6">i1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb13-7"></span>
<span id="cb13-8">i2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )-(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb13-9"></span>
<span id="cb13-10">r1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb13-11"></span>
<span id="cb13-12">r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{8 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb13-13"></span>
<span id="cb13-14">kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.115044</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mean late period is still around 1.4 days, </span></span>
<span id="cb13-15">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> </span>
<span id="cb13-16">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb13-17">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb13-18">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span></span>
<span id="cb13-19"></span>
<span id="cb13-20">states <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s=</span>s, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">e1=</span>e1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">e2=</span>e2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i1=</span>i1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i2=</span>i2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r1=</span>r1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r2=</span>r2)</span>
<span id="cb13-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(states, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> x)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           s           e1           e2           i1           i2           r1 
0.8334490274 0.0001067747 0.0001067707 0.0001190490 0.0001190440 0.0843079955 
          r2 
0.0817913389 </code></pre>
</div>
</div>
<p>Numerical solutions are based on <code>deSolve::ode</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">seir_2stg_vital <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb15-2">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb15-3">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]</span>
<span id="cb15-4">  kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kappa"</span>]</span>
<span id="cb15-5">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]</span>
<span id="cb15-6">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega"</span>]</span>
<span id="cb15-7">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>]</span>
<span id="cb15-8">  </span>
<span id="cb15-9">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb15-10">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb15-11">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb15-12">  du4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb15-13">  du5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb15-14">  du6 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]</span>
<span id="cb15-15">  du7 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]</span>
<span id="cb15-16">  </span>
<span id="cb15-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3,du4,du5,du6,du7))) </span>
<span id="cb15-18">}</span>
<span id="cb15-19"></span>
<span id="cb15-20">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb15-21">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.115044</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>), </span>
<span id="cb15-22">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span>
<span id="cb15-23">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb15-24">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_2stg_vital, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb15-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(outdf) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"i1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"i2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r2"</span>)</span>
<span id="cb15-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(outdf, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          day         s           e1           e2           i1           i2
109501 109500 0.8334488 0.0001067726 0.0001067686 0.0001190467 0.0001190417
               r1         r2
109501 0.08430817 0.08179142</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>SEIR model</category>
  <category>steady states</category>
  <category>ODE</category>
  <category>deSolve</category>
  <category>Mathematica</category>
  <guid>https://www.jonghoonk.com/blog/posts/cholera_seir_eqn/index.html</guid>
  <pubDate>Wed, 27 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/cholera_seir_eqn/sample_figure.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Vaccine effectiveness</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/vaccine_effectiveness/index.html</link>
  <description><![CDATA[ 




<section id="vaccine-efficacy-and-effectiveness" class="level3">
<h3 class="anchored" data-anchor-id="vaccine-efficacy-and-effectiveness">Vaccine efficacy and effectiveness</h3>
<p>Vaccine efficacy and effectiveness (VE) is generally estimated as one minus some measure of relative risk (RR) in the vaccinated group compared with the unvaccinated group <a href="https://pubmed.ncbi.nlm.nih.gov/10520474/">Halloran <em>et al</em>.</a>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVE%7D%20=%201%20-%20%5Ctext%7BRR%7D%0A"></p>
<p>RR measures may relative infection probability given exposure, hazard ratio, or the ratio of cumulative incidence (or attack rate). I will explain different effects of the vaccine using the cumulative incidence (<img src="https://latex.codecogs.com/png.latex?C">) measure based on the notations from the <a href="https://pubmed.ncbi.nlm.nih.gov/1742381/">Study design for dependent happenings</a>.</p>
<p><img src="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness/study_design.png" class="img-fluid"></p>
<p>In population <img src="https://latex.codecogs.com/png.latex?A">, a fraction, <img src="https://latex.codecogs.com/png.latex?f">, of the population was vaccinated (denoted with <img src="https://latex.codecogs.com/png.latex?1">) and the rest, <img src="https://latex.codecogs.com/png.latex?1-f">, of the Population A remains unvaccinated (denoted with <img src="https://latex.codecogs.com/png.latex?0">). In Population <img src="https://latex.codecogs.com/png.latex?B">, no one was vaccinated. I can now use <img src="https://latex.codecogs.com/png.latex?C_%7BA0%7D"> and <img src="https://latex.codecogs.com/png.latex?C_%7BA1%7D"> to denote cumulative incidence, <img src="https://latex.codecogs.com/png.latex?C">, in the unvaccinated and vaccinated individuals of Population <img src="https://latex.codecogs.com/png.latex?A">. Similarly, I can use <img src="https://latex.codecogs.com/png.latex?C_%7BB0%7D"> to denote the cumulative incidence in the (unvaccinated) population <img src="https://latex.codecogs.com/png.latex?B">.</p>
<p>The VE can be divided into four different measures and they are direct, indirect, total, and overall VE, which are noted as DVE, IVE, TVE, and OVE, respectively.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BDVE%7D%20=%201%20-%20%5Cfrac%7BC_%7BA1%7D%7D%7BC_%7BA0%7D%7D,~%0A%5Ctext%7BIVE%7D%20=%201%20-%20%5Cfrac%7BC_%7BA0%7D%7D%7BC_%7BB0%7D%7D,~%0A%5Ctext%7BTVE%7D%20=%201%20-%20%5Cfrac%7BC_%7BA1%7D%7D%7BC_%7BB0%7D%7D,~%0A%5Ctext%7BOVE%7D%20=%201%20-%20%5Cfrac%7Bf%20C_%7BA1%7D+(1-f)%20C_%7BA0%7D%7D%7BC_%7BB0%7D%7D.%0A"></p>
<p>Using the above equation we can see the following is true</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BIVE%7D%20=%201-%5Cfrac%7B1-%5Ctext%7BTVE%7D%7D%7B1-%5Ctext%7BDVE%7D%7D,~%20%5Ctext%7BOVE%7D%20=%201-%5Cleft(f%5Cleft(1-%5Ctext%7BTVE%7D%5Cright)+(1-f)%5Cleft(1-%5Ctext%7BIVE%7D%5Cright)%5Cright)%0A"></p>
<p>Let’s construct a simple <img src="https://latex.codecogs.com/png.latex?SEIR"> model to illustrate the different metrics of VE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">seir_2grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, y, params) {</span>
<span id="cb1-2">  S0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S0"</span>]; E0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E0"</span>]; I0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I0"</span>]; R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R0"</span>]; C0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]</span>
<span id="cb1-3">  S1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S1"</span>]; E1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E1"</span>]; I1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I1"</span>]; R1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R1"</span>]; C1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]</span>
<span id="cb1-4"> </span>
<span id="cb1-5">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]</span>
<span id="cb1-6">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsilon"</span>]</span>
<span id="cb1-7">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]</span>
<span id="cb1-8">  </span>
<span id="cb1-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and unvaccinated population are well mixed</span></span>
<span id="cb1-10">  muSE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (I1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>I0) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (S1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> S0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R0)</span>
<span id="cb1-11">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb1-12">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb1-13">  </span>
<span id="cb1-14">  dS0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muSE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S0</span>
<span id="cb1-15">  dE0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muSE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E0</span>
<span id="cb1-16">  dI0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I0</span>
<span id="cb1-17">  dR0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I0</span>
<span id="cb1-18">  dC0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E0 <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## cumulative symtom onset</span></span>
<span id="cb1-19">  </span>
<span id="cb1-20">  dS1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muSE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S1</span>
<span id="cb1-21">  dE1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muSE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1</span>
<span id="cb1-22">  dI1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1</span>
<span id="cb1-23">  dR1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1</span>
<span id="cb1-24">  dC1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## cumulative symtom onset</span></span>
<span id="cb1-25">  </span>
<span id="cb1-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dS0,dE0,dI0,dR0,dC0,dS1,dE1,dI1,dR1,dC1)))</span>
<span id="cb1-27">}</span></code></pre></div>
</div>
</section>
<section id="population-b" class="level3">
<h3 class="anchored" data-anchor-id="population-b">Population B</h3>
<p>No one in the population is vaccinated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-2">pop_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N0=</span>N)</span>
<span id="cb2-3">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb2-4">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span></span>
<span id="cb2-5">epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.2</span></span>
<span id="cb2-6">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># no need for the vaccinated group</span></span>
<span id="cb2-8">y0_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0=</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb2-9">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-10">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span>tend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-11">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma)</span>
<span id="cb2-12"></span>
<span id="cb2-13">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> deSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y0_B, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_2grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>params)</span>
<span id="cb2-14">pop_B_out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(out) </span></code></pre></div>
</div>
</section>
<section id="population-a" class="level3">
<h3 class="anchored" data-anchor-id="population-a">Population A</h3>
<p>A fraction <img src="https://latex.codecogs.com/png.latex?f"> of the population A received the vaccine. Vaccine efficacy is VE. Vaccination can be implemented by assuming all-or-nothing vaccine. That is, the a fraction of vaccine recipients, <img src="https://latex.codecogs.com/png.latex?N*f*%5Ctext%7BVE%7D">, are completely protected from infection. Here, <img src="https://latex.codecogs.com/png.latex?N,%20f">, and VE represent population size, the fraction of the population that is vaccinated, and vaccine efficacy, respectively. In the SEIR model, by setting the initial population size for the <img src="https://latex.codecogs.com/png.latex?R"> compartment as <img src="https://latex.codecogs.com/png.latex?N*f*%5Ctext%7BVE%7D">, we can mimic the vaccination scenario.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy on susceptibility</span></span>
<span id="cb3-2">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb3-3">N0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f)</span>
<span id="cb3-4">N1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>f</span>
<span id="cb3-5">pop_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N0=</span>N0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N1=</span>N1)</span>
<span id="cb3-6">y0_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0=</span>N0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb3-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S1=</span>N1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>VE), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R1=</span>N1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb3-8"></span>
<span id="cb3-9">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> deSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y0_A, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_2grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>params)</span>
<span id="cb3-10">pop_A_out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(out)</span></code></pre></div>
</div>
<p>Let’s compute the four VE measures at the end of the simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">(DVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">(IVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_B_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1118712</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">(OVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (pop_B_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2983782</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">(TVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_B_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7335613</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">(IVE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>TVE)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>DVE))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">(OVE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>TVE)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>IVE)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">(IVE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> OVE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>TVE))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">(TVE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>DVE)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>IVE))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Dynamics of four VE measures</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">dve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_A_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]])</span>
<span id="cb20-2">ive <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_B_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]])</span>
<span id="cb20-3">ove <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pop_A_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pop_A_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (pop_B_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]])</span>
<span id="cb20-4">tve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_B_out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]])</span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(ive)</span>
<span id="cb20-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>dve), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb20-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ove <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tve))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(ove)</span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ive)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness/index_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot(ive, type="l")</span></span>
<span id="cb22-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lines(1 - (1 - ove - f*(1-tve))/(1-f), col=2, lty=2)</span></span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(tve)</span>
<span id="cb22-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>dve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ive), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness/index_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>SEIR</category>
  <category>vaccine efficacy</category>
  <category>direct</category>
  <category>indirect</category>
  <category>total</category>
  <category>overall</category>
  <guid>https://www.jonghoonk.com/blog/posts/vaccine_effectiveness/index.html</guid>
  <pubDate>Mon, 25 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/vaccine_effectiveness/study_design.png" medium="image" type="image/png" height="130" width="144"/>
</item>
<item>
  <title>Counterintuitive effects in disease transmission dynamics</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/counterintuitive/index.html</link>
  <description><![CDATA[ 




<section id="r_0-and-the-prevalence-of-infection" class="level3">
<h3 class="anchored" data-anchor-id="r_0-and-the-prevalence-of-infection"><img src="https://latex.codecogs.com/png.latex?R_0"> and the prevalence of infection</h3>
<p><a href="https://www.science.org/doi/10.1126/science.aaa4339">An article by Heesterbeek <em>et al</em>.</a> provides a few examples on the counterintuitive behavior of a dynamical system of disease transmission. The first example was about the relationship between the intensity of transmission and the prevalence of infection, citing <a href="https://pubmed.ncbi.nlm.nih.gov/3892436/">the work by Anderson <em>et al</em>.</a>. One message from the study by Anderson <em>et al</em>. is that the effect of intervention should not be measured by the prevalence of infection. A similar message can be drawn from a simple relationship between <img src="https://latex.codecogs.com/png.latex?R_0"> and the prevalence of infection. As shown in the figure below, reducing <img src="https://latex.codecogs.com/png.latex?R_0"> from 15 to 10 may require a lot of efforts and its effect on prevalence of infection may be small.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0*s = 1 is assumed, i.e., endemic steady state</span></span>
<span id="cb1-3">prev <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R0</span>
<span id="cb1-4"></span>
<span id="cb1-5">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>R0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Prev=</span>prev)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-8">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>R0))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prev))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prevalence of infection vs."</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">italic</span>(R)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">italic</span>(R)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prevalence"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/counterintuitive/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("R0_prevalence.png", units="in", width=3.4*2, height=2.7*2)</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Infectious diseases</category>
  <category>nonlinearity</category>
  <category>transmission dynamics</category>
  <guid>https://www.jonghoonk.com/blog/posts/counterintuitive/index.html</guid>
  <pubDate>Tue, 19 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/counterintuitive/R0_prevalence.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Prevalence vs. incidence for the SIR model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/prevalence_incidence_sirmodel/index.html</link>
  <description><![CDATA[ 




<section id="sir-model-with-constant-incidence-rate" class="level3">
<h3 class="anchored" data-anchor-id="sir-model-with-constant-incidence-rate">SIR model with constant incidence rate</h3>
<p>In the following, I implemented a simple model of disease incidence and recovery. Susceptibles are infected at a constant rate, go through the natural history of infection, and finally recover at a constant rate. Infection and recovery follow the exponential decay. This is to explore the relationship between the incidence and prevalence. If the prevalence of a disease is less than 10%, the relationship is often described as follows (e.g., see the <a href="https://sphweb.bumc.bu.edu/otlt/MPH-Modules/PH717-QuantCore/PH717-Module3-Frequency-Association/PH717-Module3-Frequency-Association5.html">link</a>): <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPrevalence%7D%20=%20%5Ctext%7BIR%7D%20%5Ctimes%20%5Ctext%7BAverage%20Duration%20of%20a%20Disease%7D%0A"> I have computed the prevalence in three ways. In particular, I assumed a short-lived infection (e.g., 2 weeks) of infectious diseases but with a long-lasting immunity. Therefore, prevalence may mean the proportion of the population immune to infection in this context. First, I use the above method. Second, I developed a simple set of differential equations to model disease incidence and recovery. Finally, I derived analytical solutions to the differential equations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prevalence according to the above equation</span></span>
<span id="cb1-2">ir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># incidence rate per 100,000 person-years</span></span>
<span id="cb1-3">dur_R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># duration of infection-derived immunity (20 years).</span></span>
<span id="cb1-4">prev <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ir <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dur_R </span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prevalence according to the differential equation</span></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note that the incidence rate (or force of infection) remains constant in this model unlike the classic SIR model.</span></span>
<span id="cb1-8">sir_beta_const <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb1-9">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb1-10">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb1-11">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-12">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb1-13">    </span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3))) </span>
<span id="cb1-15">}</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb1-17">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-18">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb1-19">dur_I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span>
<span id="cb1-20">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ir) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instantaneous rate for the yearly incidence rate, ir</span></span>
<span id="cb1-21">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(r, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dur_I, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dur_R)</span>
<span id="cb1-22">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir_beta_const, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb1-23"></span>
<span id="cb1-24"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## to explore visually as well</span></span>
<span id="cb1-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-26">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-28"></span>
<span id="cb1-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(outdf,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>time))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb1-34">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/prevalence_incidence_sirmodel/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prevalence according to analytic solutions for the ODE model</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Refer to the equations below</span></span>
<span id="cb2-3">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dur_I</span>
<span id="cb2-4">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural death rate, which was not implemented in the ODE model</span></span>
<span id="cb2-5">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dur_R</span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># according the following equations</span></span>
<span id="cb2-7">r_eq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>((gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega))</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compare three values</span></span>
<span id="cb2-10">r_eq</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01961672</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(outdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01961672</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">prev</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02</code></pre>
</div>
</div>
<p>The following Mathematica commands produce the steady state for S, I (written as Y below), R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># FullSimplify[Solve[{\[Mu]*(S+Y+R)-(r +\[Mu]) *S + \[Omega]* R==0, r *S-(\[Mu]+\[Gamma]) *Y == 0, \[Gamma]* Y-(\[Omega]+\[Mu])*R==0,S+Y+R==1, \[Mu]&gt;0,r&gt;0,\[Gamma]&gt;0,\[Omega]&gt;0, S&gt;0,Y&gt;0,R&gt;0,S\[Element]Reals,Y\[Element]Reals,R\[Element]Reals}, {S,Y,R}]]</span></span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?S%20=%20%5Cfrac%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)%7D%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)+r%20(%5Cgamma%20+%5Cmu%20+%5Comega%20)%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?I%20=%5Cfrac%7Br%20(%5Cmu%20+%5Comega%20)%7D%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)+r%20(%5Cgamma%20+%5Cmu%20+%5Comega%20)%7D"> <img src="https://latex.codecogs.com/png.latex?R%20=%20%5Cfrac%7B%5Cgamma%20%20r%7D%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)+r%20(%5Cgamma%20+%5Cmu%20+%5Comega%20)%7D"></p>


</section>

 ]]></description>
  <category>R</category>
  <category>prevalence</category>
  <category>incidence</category>
  <category>deSolve</category>
  <guid>https://www.jonghoonk.com/blog/posts/prevalence_incidence_sirmodel/index.html</guid>
  <pubDate>Mon, 11 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/prevalence_incidence_sirmodel/diffeqr_sir.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>감염병의 대유행 가능성</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/Probabily_outbreak/index.html</link>
  <description><![CDATA[ 




<p><a href="https://www.yes24.com/Product/Goods/99051113?ReviewYn=Y">감염병 인류</a> 라는 책을 재미있게 읽는 중이다. 136페이지에는 기초감염재생산지수와 대유행의 가능성에 대한 간단한 수식이 나온다. <img src="https://latex.codecogs.com/png.latex?%5Ctext%7B%EB%8C%80%EC%9C%A0%ED%96%89%EC%9D%98%20%EA%B0%80%EB%8A%A5%EC%84%B1%7D%20=%201%20-%20%5Cfrac%7B1%7D%7BR_0%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?R_0">는 기초감염재생산지수, 즉 한 사람의 감염자가 다른 모든 사람이 감수성자 (susceptible) 일때 감염시키는 평균 감염자수를 나타낸다. 위 수식은 제한적인 경우에만 적용된다. 감염병 유입 시 대유행의 가능성에 대해 좀 더 일반적으로 적용될 수 있는 방법에 대해 적어보려고 한다. 물론 아래 내용도 상당히 이상적인 상황에 대한 기술일 뿐이고 현실은 그 보다 훨씬 더 복잡할 것이다. 감염병 유입 시 대유행의 가능성에 대한 내용은 Niels G. Becker가 저술한 <a href="https://www.amazon.com/Modeling-Infectious-Disease-Control-Biostatistics/dp/1498731066/ref=sr_1_3?crid=Q6E8KCGFJHES&amp;dib=eyJ2IjoiMSJ9.UCQn7lL_fhp-8cr31i1yvNkFiM8031ZLJrQd3oLch4MLiIGfVd7xSHYK8DxJcl2irN6hOSKXvwIBltRHfSRsMnCEZE09qU6Hj_BrGkMf45Q7EvhtR8q1EEZnjJP4ZrU8ow-Z6gIW1vhne7qQp5LiGeJsnbWorvZjpvfWu0Q-YbgfYopAUnSl95IUf0nlTDbvxm-rYGyOawJEC5BHEBXi3wsYCfLfM-F7eZW2vwT_9n8.DIMrBAhp9UdkHqkC9_69y7tViatvCC44j3phlaCTrA4&amp;dib_tag=se&amp;keywords=niels+becker&amp;qid=1709912228&amp;sprefix=niels+becker%2Caps%2C239&amp;sr=8-3">Modeling to Inform Infectious Disease Control</a>의 제 2장에 자세하게 기술되어 있다.</p>
<p>동일한 사람들로 이루어진 인구 집단에서 감염병이 퍼져나가는 현상을 생각해 보자. 한 사람이 평균적으로 <img src="https://latex.codecogs.com/png.latex?R_0"> 명을 감염시킨다고 할 때 <img src="https://latex.codecogs.com/png.latex?R_0">은 평균일뿐 후속 감염자수는 어떤 확률 분포를 가진다고 생각해볼 수 있다. 한 명의 감염자가 총 <img src="https://latex.codecogs.com/png.latex?j"> 명의 후속 감염자를 만들어 내는 확률을 <img src="https://latex.codecogs.com/png.latex?P(X=j)%20=%20p_j">라고 할 때 <img src="https://latex.codecogs.com/png.latex?R_0">는 아래와 같이 표현할 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?R_0%20=%20%5Csum_%7Bk=0%7D%5E%5Cinfty%20j%20p_j."></p>
<p>대유행의 가능성은 역으로 생각하는 것이 유리하다. 즉 대유행이 아닌 소규모의 감염으로 막을 내리는 확률, <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, 을 구한 후 대유행의 확률은 <img src="https://latex.codecogs.com/png.latex?1-%5Ctheta">로 구하는 것이다. 소규모의 감염이 일어나기 위해서는 유입된 초기 환자 (index patient)가 아무도 감염시키지 않거나 혹은 몇 명을 감염시켰다고 할지라도 후속 감염자들이 추가적으로 일으키는 감염이 소규모일때만 가능할 것이다. 즉 소규모 감염의 확률, <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, 는 아래의 식을 만족한다.</p>
<p><span id="eq-theta"><img src="https://latex.codecogs.com/png.latex?%0A%5Ctheta%20=%20%20p_0%20+%20p_1%20%5Ctheta%20+%20p_2%20%5Ctheta%5E2%20+%20...%0A%5Ctag%7B1%7D"></span></p>
<p>위 식을 보면 <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> 는 후속 감염자수가 어떠한 분포를 따르느냐에 따라 달라질 것이라 예상할 수 있다. 가장 흔히 쓰이는 분포 중의 하나인 푸아송 분포 (Poisson distribution)를 생각해보자. 화률 분포 함수는 아래와 같다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BProb%7D(X=j)%20=%20%5Cfrac%7BR%5Ej%20e%5ER%7D%7Bj!%7D%5Ctext%7B%20for%20%7D%20j=0,1,2,..."></p>
<p>이 경우 Equation&nbsp;1 의 우변은 아래와 같이 나타내어질 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bj=0%7D%5E%5Cinfty%20p_j%20%5Ctheta%5E%7Bj%7D%20=%20e%5E%7B(1-%5Ctheta)R_0%7D."></p>
<p>따라서 <img src="https://latex.codecogs.com/png.latex?%5Ctheta">는 아래의 식을 계산하면 된다. 다만 해를 직접 구할 수는 없고 수치해석방법을 이용 해서 답을 구해야 한다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20e%5E%7B(1-%5Ctheta)R_0%7D."></p>
<p>위에서 언급한 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7B%EB%8C%80%EC%9C%A0%ED%96%89%EC%9D%98%20%EA%B0%80%EB%8A%A5%EC%84%B1%7D%20=%201%20-%20%5Cfrac%7B1%7D%7BR_0%7D">는 후속 감염자수의 분포가 기하분포 (geometric distribution)를 따를때 성립한다. 기하분포는 아래와 같이 표현되 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BProb%7D(X=j)%20=%20(1-p)%5Ej%20p"></p>
<p>평균과 성공확률의 관게, <img src="https://latex.codecogs.com/png.latex?R%20=%20%5Cfrac%7B1-p%7D%7Bp%7D">, 이용하여 다시 표현하면 아래와 같다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BProb%7D(X=j)%20=%20(%5Cfrac%7BR_0%7D%7B1+R_0%7D)%5Ej%20%5Cfrac%7B1%7D%7B1+R_0%7D"> 위에서와 동일하게 계산하면 아래와 같다. <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bj=0%7D%5E%5Cinfty%20p_j%20%5Ctheta%5E%7Bj%7D%20=%20%5Cfrac%7B1%7D%7B1%20+%20(1-%5Ctheta)R_0%7D"> 따라서 아래의 식을 풀면 <img src="https://latex.codecogs.com/png.latex?%5Ctheta">를 구할 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20%5Cfrac%7B1%7D%7B1%20+%20(1-%5Ctheta)R_0%7D."></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20%5Cfrac%7B1%7D%7BR_0%7D."></p>
<p>따라서 <a href="https://www.yes24.com/Product/Goods/99051113?ReviewYn=Y">감염병 인류</a> 책에서 언급된 것처럼 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7B%EB%8C%80%EC%9C%A0%ED%96%89%EC%9D%98%20%EA%B0%80%EB%8A%A5%EC%84%B1%7D%20=%201%20-%20%5Cfrac%7B1%7D%7BR_0%7D."> 마지막으로 후속 감염자수가 이항분포 (negative binomial distribution)을 따른다고 가정해보자. 최근 연구들에서 빈번하게 언급되고 가장 현실에 가까운 가정인 듯 하다.</p>
<p>다양한 모수를 사용하여 표현할 수 있고 평균 <img src="https://latex.codecogs.com/png.latex?R_0">과 확산(dispersion; <img src="https://latex.codecogs.com/png.latex?k">)를 이용하여 나타내면 아래와 같다. 이항 분포는 <img src="https://latex.codecogs.com/png.latex?k=1">일 때는 기하분포와 동일하고 <img src="https://latex.codecogs.com/png.latex?k=%5Cinfty"> 일때는 푸아송분포와 동일하다. 코로나 19의 경우 <img src="https://latex.codecogs.com/png.latex?k"> 값이 약 <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9349569/">0.55</a>이다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BProb%7D(X=j)%20=%20%5Cfrac%7B%5CGamma(k+j)%7D%7Bj!%5CGamma(k)%7D%5Cleft(%5Cfrac%7Bk%7D%7Bk+R_0%7D%5Cright)%5Ek%5Cleft(%5Cfrac%7BR_0%7D%7Bk+R_0%7D%5Cright)%5Ej%20%5Ctext%7B%20for%20%7D%20k=0,1,2,..."> The probability of a minor outbreak, 위와 동일한 방법으로 계산하면 우변은 아래와 같다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bj=0%7D%5E%5Cinfty%20p_j%20%5Ctheta%5E%7Bj%7D%20=%20%5Cleft(%5Cfrac%7Bk%7D%7Bk%20+%20(1-%5Ctheta)R_0%7D%5Cright)%5Ek"> 따라서 <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20%5Cleft(%5Cfrac%7Bk%7D%7Bk%20+%20(1-%5Ctheta)R_0%7D%5Cright)%5Ek">를 계산하여 소규모감염의 확률을 계산하고 <img src="https://latex.codecogs.com/png.latex?1-%5Ctheta">를 계산하여 대규모유행 확률을 계산하면 된다.</p>
<p>R 시물레이션을 통해서 세방법이 어떻게 다른 결과를 나타내는지 살펴보자</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">prob_outbreak_pois <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(theta, R0){</span>
<span id="cb1-2">  theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>theta) </span>
<span id="cb1-3">}</span>
<span id="cb1-4">prob_outbreak_geo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(R0){</span>
<span id="cb1-5">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R0 </span>
<span id="cb1-6">}</span>
<span id="cb1-7">prob_outbreak_nb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(theta, R0, k){</span>
<span id="cb1-8">  theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>theta))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>k </span>
<span id="cb1-9">}</span>
<span id="cb1-10"></span>
<span id="cb1-11">Rs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb1-12">theta1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(Rs, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(rootSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">multiroot</span>(prob_outbreak_pois, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>root))</span>
<span id="cb1-14">theta2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(Rs, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prob_outbreak_geo</span>(x))</span>
<span id="cb1-15">theta3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(Rs, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) </span>
<span id="cb1-16">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(rootSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">multiroot</span>(prob_outbreak_nb, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.55</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>root))</span>
<span id="cb1-17">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(Rs,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), </span>
<span id="cb1-18">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dist=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pois"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Geom"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NB(k=0.55)"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb1-19">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob_outbreak=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>theta1,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>theta2,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>theta3))</span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-22">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, </span>
<span id="cb1-24">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(R0, prob_outbreak, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>dist))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability of a large outbreak vs."</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">italic</span>(R)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability of a large outbreak"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">italic</span>(R)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Probabily_outbreak/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("outbreak_prob.png", units="in", width=3.4*2, height=2.7*2)  </span></span></code></pre></div>
</div>
<p>각 분포에 대한 무한 수열의 합과 <img src="https://latex.codecogs.com/png.latex?%5Ctheta">에 대한 해는 아래 Mathematica 명령어를 사용하여 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">Sum[PDF[PoissonDistribution[R],j]\[Theta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>j, {j, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, Infinity}]</span>
<span id="cb3-2">FindRoot[\[Theta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> E<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">R</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Theta])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, {\[Theta], <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>}] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. </span>
<span id="cb3-3"> R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-4">Sum[PDF[GeometricDistribution[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>R)],j]\[Theta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>j, {j, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, Infinity}]</span>
<span id="cb3-5">FindRoot[\[Theta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Theta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R \[Theta]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, {\[Theta], </span>
<span id="cb3-6">   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>}] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-7"></span>
<span id="cb3-8">FullSimplify[Sum[PDF[NegativeBinomialDistribution[k,k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>k)],i]\[Theta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>i, {i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, Infinity}],{ k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>\[Theta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>}ㅑ</span>
<span id="cb3-9">FindRoot[\[Theta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R \[Theta]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, {\[Theta], <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>}] </span></code></pre></div>
</div>



 ]]></description>
  <category>probability of a large outbreak</category>
  <category>reproduction number</category>
  <guid>https://www.jonghoonk.com/blog/posts/Probabily_outbreak/index.html</guid>
  <pubDate>Sun, 03 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/Probabily_outbreak/outbreak_prob.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Modeling the waning of the vaccine-derived immunity in the ODE model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/vacc_waning_nls_erlang/index.html</link>
  <description><![CDATA[ 




<section id="modeling-the-waning-of-the-vaccine-derived-immunity-in-the-ode-model" class="level2">
<h2 class="anchored" data-anchor-id="modeling-the-waning-of-the-vaccine-derived-immunity-in-the-ode-model">Modeling the waning of the vaccine-derived immunity in the ODE model</h2>
<p>The use of ordinary differential equation (ODE) models to simulate disease spread and evaluate vaccine impact is growing. Waning of vaccine-derived immunity often follows an exponential distribution in these models. However, as with the case with incubation period <a href="https://pubmed.ncbi.nlm.nih.gov/19393959/">incubation period</a> that we examined in the <a href="https://www.jonghoonk.com/posts/exp_erlang_lognormal/">previous post</a>, exponential distribution may not accurately depict the waning of vaccine-derived immunity.</p>
<p>In this post, I explore how to model the waning of vaccine efficacy over time using an ODE framework, utilizing the data from a <a href="https://www.thelancet.com/journals/langlo/article/PIIS2214-109X(20)30310-7/fulltext">study by Lee <em>et al</em>.</a> Specifically, I examine how various cumulative distributions can be applied to acurately represent the diminishing percentage of of the vaccine protection over time, through the use of R code examples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data from Table S4, Lee et al. (2020) Lancet Glob Health</span></span>
<span id="cb1-2">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb1-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb1-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb1-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb1-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">76</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb1-7">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">76</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb1-8">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb1-9">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-12"></span>
<span id="cb1-13">ds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"list"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb1-14">ds[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>)</span>
<span id="cb1-15">ds[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>)</span>
<span id="cb1-16">ds[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>)</span>
<span id="cb1-17">ds[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19">fits_gamma_shape_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-22"> fits_gamma_shape_2[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-23">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-24">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-25">}</span>
<span id="cb1-26"></span>
<span id="cb1-27">fits_gamma_shape_3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-28"></span>
<span id="cb1-29"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-30"> fits_gamma_shape_3[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-31">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-32">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-33">}</span>
<span id="cb1-34"></span>
<span id="cb1-35">fits_gamma_shape_4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-36"></span>
<span id="cb1-37"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-38"> fits_gamma_shape_4[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-39">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-40">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-41">}</span>
<span id="cb1-42"></span>
<span id="cb1-43">fits_gamma_shape_5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-44"></span>
<span id="cb1-45"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-46"> fits_gamma_shape_5[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-47">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-48">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-49">}</span>
<span id="cb1-50"></span>
<span id="cb1-51">fits_gamma_shape_8 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-52"></span>
<span id="cb1-53"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-54"> fits_gamma_shape_8[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-55">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-56">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-57">}</span>
<span id="cb1-58"></span>
<span id="cb1-59">fits_exp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-60"></span>
<span id="cb1-61"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-62"> fits_exp[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-63">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pexp</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-64">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-65">}</span></code></pre></div>
</div>
<section id="gammaa-with-shape2" class="level3">
<h3 class="anchored" data-anchor-id="gammaa-with-shape2">Gammaa with shape=2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction</span></span>
<span id="cb2-2">months <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-3">newd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> months)</span>
<span id="cb2-4">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(months, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb2-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb2-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb2-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb2-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb2-9">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb2-10">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb2-11">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd)))</span>
<span id="cb2-12">                 </span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb2-14">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb2-16"></span>
<span id="cb2-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma decay with shape=2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vacc_waning_nls_erlang/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="gammaa-with-shape3" class="level3">
<h3 class="anchored" data-anchor-id="gammaa-with-shape3">Gammaa with shape=3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction</span></span>
<span id="cb3-2">months <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-3">newd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> months)</span>
<span id="cb3-4">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(months, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb3-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb3-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb3-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb3-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb3-9">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb3-10">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb3-11">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd)))</span>
<span id="cb3-12">                 </span>
<span id="cb3-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma decay with shape=3"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vacc_waning_nls_erlang/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="exponential-decay" class="level3">
<h3 class="anchored" data-anchor-id="exponential-decay">Exponential decay</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction</span></span>
<span id="cb4-2">months <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb4-3">newd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> months)</span>
<span id="cb4-4">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(months, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb4-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb4-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb4-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb4-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb4-9">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb4-10">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb4-11">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd)))</span>
<span id="cb4-12">                 </span>
<span id="cb4-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential decay"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vacc_waning_nls_erlang/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Given that the data for adults following a two-dose regimen seem to be the most reliable, we evaluated the model’s residual errors in comparison to this data. The analysis of residual errors indicates that a gamma distribution with a shape parameter of 3 presents the optimal fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pexp(month, rate = exp(lograte), lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -4.09710    0.09047  -45.29 6.63e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.0643 on 10 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 6.629e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pgamma(month, shape = 2, rate = exp(lograte), 
    lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -3.18619    0.02946  -108.2   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03005 on 10 degrees of freedom

Number of iterations to convergence: 5 
Achieved convergence tolerance: 6.246e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pgamma(month, shape = 3, rate = exp(lograte), 
    lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -2.72304    0.02375  -114.7   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.02893 on 10 degrees of freedom

Number of iterations to convergence: 4 
Achieved convergence tolerance: 1.595e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_gamma_shape_4[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pgamma(month, shape = 4, rate = exp(lograte), 
    lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -2.41214    0.02884  -83.64 1.46e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.0394 on 10 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 7.874e-07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_gamma_shape_5[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pgamma(month, shape = 5, rate = exp(lograte), 
    lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -2.17801    0.03374  -64.56 1.94e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.05009 on 10 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 9.615e-06</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction</span></span>
<span id="cb15-2">months <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb15-3">newd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> months)</span>
<span id="cb15-4">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(months, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb15-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb15-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>),</span>
<span id="cb15-7">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=2"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>),</span>
<span id="cb15-8">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=3"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>),</span>
<span id="cb15-9">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=4"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)),</span>
<span id="cb15-10">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb15-11">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb15-12">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb15-13">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb15-14">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_4[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd)))</span>
<span id="cb15-15"></span>
<span id="cb15-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>), </span>
<span id="cb15-18">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>type)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two-dose vaccine efficacy for adults"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(</span>
<span id="cb15-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb15-24">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=2"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=3"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#6A3D9A"</span>,</span>
<span id="cb15-25">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=4"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FF7F00"</span>),</span>
<span id="cb15-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb15-27">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blank"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>,</span>
<span id="cb15-28">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=2"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>,</span>
<span id="cb15-29">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=3"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>,</span>
<span id="cb15-30">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=4"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>),</span>
<span id="cb15-31">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb15-32">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=2"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb15-33">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=3"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb15-34">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=4"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/vacc_waning_nls_erlang/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>vaccine-derived immunity</category>
  <category>waning</category>
  <category>cholera</category>
  <category>ODE</category>
  <category>exponential</category>
  <category>Gamma</category>
  <guid>https://www.jonghoonk.com/blog/posts/vacc_waning_nls_erlang/index.html</guid>
  <pubDate>Mon, 26 Feb 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/vacc_waning_nls_erlang/vacc_wane_exp_erlang.png" medium="image" type="image/png" height="114" width="144"/>
</item>
</channel>
</rss>
