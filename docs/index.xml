<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Disease modeling for public health</title>
<link>https://kimfinale.github.io/myblog/index.html</link>
<atom:link href="https://kimfinale.github.io/myblog/index.xml" rel="self" type="application/rss+xml"/>
<description>Disease modeling for public health</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Thu, 18 Apr 2024 15:00:00 GMT</lastBuildDate>
<item>
  <title>Logistic function in R</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/logistic_indirect_ve/index.html</link>
  <description><![CDATA[ 




<section id="logistic-function" class="level3">
<h3 class="anchored" data-anchor-id="logistic-function">Logistic function</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Logistic_function">logistic function</a>, represented as: <img src="https://latex.codecogs.com/png.latex?%0Af(x)%20=%20%5Cfrac%7BL%7D%7B1+e%5E%7B-k(x-x_0)%7D%7D%0A"> , where <img src="https://latex.codecogs.com/png.latex?x_%7B0%7D,%20L">, and <img src="https://latex.codecogs.com/png.latex?k"> represent tht value of the function’s midpoint, the supremum of the values of the function, and the logistic growth rate or steepness of the curve. For values of <img src="https://latex.codecogs.com/png.latex?x"> in the domain of real numbers from <img src="https://latex.codecogs.com/png.latex?-%5Cinfty"> to <img src="https://latex.codecogs.com/png.latex?+%5Cinfty">, the S-shaped curve approaching <img src="https://latex.codecogs.com/png.latex?L"> as <img src="https://latex.codecogs.com/png.latex?x"> approaches <img src="https://latex.codecogs.com/png.latex?+%5Cinfty"> and approaching zero as <img src="https://latex.codecogs.com/png.latex?x"> approaches <img src="https://latex.codecogs.com/png.latex?-%5Cinfty">.</p>
<p>This function was originally devised as a model of <a href="https://en.wikipedia.org/wiki/Logistic_function">population growth</a> and is a versatile tool used in various fields, including epidemiology. In epidemiological contexts, it serves as a mathematical model to describe the growth or decline of infectious diseases within a population over time. See this <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7444956/">study</a>, for example, in which the logistic equation was used to decribe the growth of COVID-19 in a population.</p>
<p>The standard logistic function, where <img src="https://latex.codecogs.com/png.latex?x_%7B0%7D=0,%20L=1,%20k=1">, is sometimes called sigmoid or expit.</p>
<p>In the logistic function, the initial stage of growth is approximately exponential (geometric); then, as saturation begins, the growth slows to linear (arithmetic), and at maturity, growth stops. This function may be also used to describe other phenomena and <a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.1003003">was recently used</a> to model the shape of indirect vaccine efficacy (IVE) in response to the vaccine coverage levels. We are going to explore the use of the logistic function to model the IVE.</p>
</section>
<section id="indirect-effect-effectiveness" class="level3">
<h3 class="anchored" data-anchor-id="indirect-effect-effectiveness">Indirect effect effectiveness</h3>
<p><a href="https://www.jonghoonk.com/posts/vaccine_effectiveness/">Indirect vaccine effectiveness (IVE)</a> is a crucial metric in assessing the impact of vaccination on both vaccinated and unvaccinated individuals within a population. It refers to the protection unvaccinated individuals receive due to the presence of vaccinated individuals in the community.</p>
<p>To delve into the dynamics of IVE, we examine data from clinical trials of oral cholera vaccine conducted in Bangladesh and India. These studies provide insights into how varying levels of vaccination coverage affect the incidence rates among unvaccinated individuals residing in the same cluster.</p>
<p>In particular, we use the IVE analyzed based on clinical trials of oral cholera vaccines in <a href="https://pubmed.ncbi.nlm.nih.gov/15993232/">Bangladesh</a> and in <a href="https://pubmed.ncbi.nlm.nih.gov/23362293/">India</a>. In Table 1 below, we analyze the relationship between “Level of vaccine coverage” and the incidence rates among placebo recipients. The presence of IVE is evident as the risk of illness among placebo recipients diminishes with increasing vaccine coverage levels.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://kimfinale.github.io/myblog/posts/logistic_indirect_ve/ali2005_table1_ive.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Table 1</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">vc_cut <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>)</span>
<span id="cb1-2">vc_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vc_cut[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(vc_cut)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the data coming from the first year of vaccination</span></span>
<span id="cb1-4">ve_first_year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span></span>
<span id="cb1-5">eff_vc_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ve_first_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> vc_matlab </span>
<span id="cb1-6">ir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.87</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.72</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.65</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.47</span>)</span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lowest vaccine coverage group has no indirect effect</span></span>
<span id="cb1-8">ive_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ir)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ali (2013) Kolkata, India</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data from 3-year follow-up. Total protective efficacy remained high (66%)</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># therefore, effective vaccine coverage still calculated as we did for</span></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matlab, Bangladesh data</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Out of 107,347 eligible residents, 66,990 received 2 doses</span></span>
<span id="cb1-14">vc_cut <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">66990</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">107347</span>)</span>
<span id="cb1-15">vc_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vc_cut[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(vc_cut)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-16">ve_first_year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the data coming from the first year of vaccination</span></span>
<span id="cb1-17">eff_vc_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ve_first_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> vc_kolkata</span>
<span id="cb1-18">ir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.54</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.64</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.48</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.93</span>)</span>
<span id="cb1-19">ive_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ir)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-20"></span>
<span id="cb1-21">ive_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(eff_vc_kolkata, eff_vc_matlab), </span>
<span id="cb1-22">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ive_kolkata, ive_matlab))</span>
<span id="cb1-23">ive_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ive_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-24">ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span></span>
<span id="cb1-25">ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>location <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kolkata"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(eff_vc_kolkata)), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Matlab"</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(eff_vc_matlab)))</span></code></pre></div>
</div>
<p>Here, we assumed that the incidence rate among in the unvaccinated population, (i.e., no one was vaccinated) would be the same as the incidence rate observed in the lowest level of vaccine coverage rate, which would be 14% for Matlab and 12.5% for Kolkata. Because of this assumption, we may be underestimating the IVE. While it may be possible to reduce effective vaccine coverage rates by taking the difference between the effective vaccine coverage rates presented here and the lowest vaccine coverage rates (i.e., 14% or 12.5%), I wanted to be rather conservative than overestimating the impact.</p>
<p>Now we develop the logistic equation and fit the equation to the data. Since we know that the IVE has to be between <img src="https://latex.codecogs.com/png.latex?0"> and <img src="https://latex.codecogs.com/png.latex?1">, we set <img src="https://latex.codecogs.com/png.latex?L"> at 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">fm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> indirect_vacc_eff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(eff_vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x0)))</span>
<span id="cb2-2">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>fm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ive_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.27</span>))</span>
<span id="cb2-3">predict_logis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb2-4">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])))</span>
<span id="cb2-5">}</span>
<span id="cb2-6">newx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb2-7">newy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict_logis</span>(newx)</span>
<span id="cb2-8">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(ive_dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov=</span>newx, </span>
<span id="cb2-9">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff=</span>newy,</span>
<span id="cb2-10">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
</div>
<p>R has a self-starting logistic function, which can be helpful in case <code>nls</code> function is not successful for finding the parameter values with the given staring values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">fit_SSlogis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(indirect_vacc_eff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SSlogis</span>(eff_vacc_cov, Asym, xmid, scal), </span>
<span id="cb3-2">                   ive_dat)</span>
<span id="cb3-3">Asym <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asym"</span>]</span>
<span id="cb3-4">xmid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xmid"</span>]</span>
<span id="cb3-5">scal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scal"</span>]</span>
<span id="cb3-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## SSlogis has a different convention for the terms</span></span>
<span id="cb3-7">pred_SSlogis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb3-8">  Asym <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>((xmid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>scal))</span>
<span id="cb3-9">}</span>
<span id="cb3-10">newx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb3-11">newy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pred_SSlogis</span>(newx)</span>
<span id="cb3-12">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(d, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov=</span>newx, </span>
<span id="cb3-13">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff=</span>newy,</span>
<span id="cb3-14">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SSmodel"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-17">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb3-19"></span>
<span id="cb3-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>),</span>
<span id="cb3-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>location))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model"</span>), </span>
<span id="cb3-24">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SSmodel"</span>), </span>
<span id="cb3-26">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forestgreen"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Indirect vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effective vaccine coverage"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/logistic_indirect_ve/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("ive_vacc_cov.png")</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Logistic function</category>
  <category>indirect vaccine effectiveness</category>
  <category>oral cholera vaccine</category>
  <guid>https://kimfinale.github.io/myblog/posts/logistic_indirect_ve/index.html</guid>
  <pubDate>Thu, 18 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/logistic_indirect_ve/ali2005_table1_ive.png" medium="image" type="image/png" height="33" width="144"/>
</item>
<item>
  <title>Waning vaccine efficacy on susceptibility</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/vacc_eff_waining_multiple_stages/index.html</link>
  <description><![CDATA[ 




<p>In this article, I examined the process of modifying the disease transmission model (for instance, the <img src="https://latex.codecogs.com/png.latex?SEIR"> model) to include vaccination and the waning of vaccine-induced immunity as it might happen in a clinical trial. A straightforward method to represent this involves assuming vaccinated individuals (i.e., those in the vaccinated, <img src="https://latex.codecogs.com/png.latex?V">, compartment) possess partial immunity and subsequently transition back to the susceptible, <img src="https://latex.codecogs.com/png.latex?S">, compartment. This approach effectively simulates the diminishing effectiveness of vaccines using two parameters. I focus on determining these parameters through the analysis of existing vaccine efficacy data, utilizing the typhoid vaccine clinical trial as a case study. The adaptation of the model to account for the progressive reduction in vaccine-derived immunity across various compartments was conducted <a href="https://www.jonghoonk.com/posts/seir_varying_number_compartments/">prior post</a>.</p>
<section id="vaccine-efficacy-data" class="level3">
<h3 class="anchored" data-anchor-id="vaccine-efficacy-data">Vaccine efficacy data</h3>
<p>Vaccine efficacy data come from a clinical trial conducted in Malawi from 2018 through 2023, for which the detailed information is available in the <a href="https://pubmed.ncbi.nlm.nih.gov/38281499/">study</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># df &lt;- data.frame(year=c(1,2), efficacy=c(83.4,73.0)) # Shakya (2021) Lancet Glob Health</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy cumulative over the four years</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Patel (2024) Lancet</span></span>
<span id="cb1-5">tab2_vitt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,</span>
<span id="cb1-6">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;2yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2-4yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=5yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_ITT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_PP"</span>),</span>
<span id="cb1-7">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">person_years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6586</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15007</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38907</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60500</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59942</span>), </span>
<span id="cb1-8">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typhoid_culture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>),</span>
<span id="cb1-9">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IR_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">38.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">36.7</span>),</span>
<span id="cb1-10">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">70.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">79.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">79.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">78.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">80.0</span>))</span>
<span id="cb1-11"></span>
<span id="cb1-12">tab2_mena <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MenA"</span>,</span>
<span id="cb1-13">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;2yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2-4yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=5yo"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_ITT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_PP"</span>),</span>
<span id="cb1-14">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">person_years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6773</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15297</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38151</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60220</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59662</span>), </span>
<span id="cb1-15">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typhoid_culture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">71</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">109</span>),</span>
<span id="cb1-16">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IR_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">206.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">163.4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">186.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.7</span>),</span>
<span id="cb1-17">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE_obs =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19">tab2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(tab2_vitt, tab2_mena)</span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check the sanity of the data</span></span>
<span id="cb1-21">tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>typhoid_culture<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>person_years<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-22">tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb3-2">tab2[tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tab2[tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb3-4">               tab2[tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MenA"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb3-5">tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> tab2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE  TRUE  TRUE  TRUE FALSE    NA    NA    NA    NA    NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">tab3_vitt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,</span>
<span id="cb5-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_ITT"</span>,</span>
<span id="cb5-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">person_years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14058</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28104</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42135</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">56121</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60500</span>),</span>
<span id="cb5-4">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year_since_vacc =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.61</span>),</span>
<span id="cb5-5">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typhoid_culture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>),</span>
<span id="cb5-6">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IR_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">42.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">42.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">35.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41.0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.7</span>),</span>
<span id="cb5-7">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE_obs=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">83.4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">80.7</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">80.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">77.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">78.3</span>))</span>
<span id="cb5-8">tab3_mena <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MenA"</span>,</span>
<span id="cb5-9">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_ITT"</span>,</span>
<span id="cb5-10">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">person_years =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14036</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28021</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41983</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55889</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60220</span>),</span>
<span id="cb5-11">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year_since_vacc =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.61</span>),</span>
<span id="cb5-12">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typhoid_culture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">62</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>),</span>
<span id="cb5-13">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">IR_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">256.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">221.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">178.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">178.9</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.7</span>),</span>
<span id="cb5-14">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE_obs =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb5-15">tab3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(tab3_vitt, tab3_mena)</span>
<span id="cb5-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check the sanity of the data</span></span>
<span id="cb5-17">tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>typhoid_culture<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>person_years<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-18">tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-19">tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb5-21">               tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MenA"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IR_cal),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb5-22">tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_cal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] TRUE TRUE TRUE TRUE TRUE   NA   NA   NA   NA   NA</code></pre>
</div>
</div>
</section>
<section id="model-of-typhoid-transmission-for-a-clinical-trial" class="level3">
<h3 class="anchored" data-anchor-id="model-of-typhoid-transmission-for-a-clinical-trial">Model of typhoid transmission for a clinical trial</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">seirv_nstg_trial <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb7-2">  </span>
<span id="cb7-3">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]; I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]; R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]; C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb7-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # vaccinated cohort</span></span>
<span id="cb7-5">  nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb7-6">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg) {</span>
<span id="cb7-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;- "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u[5+"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"]"</span>)));</span>
<span id="cb7-8">  }<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and partially protected</span></span>
<span id="cb7-9"> </span>
<span id="cb7-10">  VS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated but immunity waned and fully susceptible</span></span>
<span id="cb7-11">  VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] </span>
<span id="cb7-12">  VI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] </span>
<span id="cb7-13">  VR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] </span>
<span id="cb7-14">  VC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb7-15">  </span>
<span id="cb7-16">  pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R</span>
<span id="cb7-17">  </span>
<span id="cb7-18">  v_sum <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,x)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>)</span>
<span id="cb7-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"popV &lt;- VS+VE+VI+VR+"</span>, v_sum)))</span>
<span id="cb7-20">  </span>
<span id="cb7-21">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/latent period</span></span>
<span id="cb7-22">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/duration of infectiousness</span></span>
<span id="cb7-23">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transmission rate</span></span>
<span id="cb7-24">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># death rate is applied and population size decreases over time</span></span>
<span id="cb7-25">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 / duration of natural immunity</span></span>
<span id="cb7-26">  omega_v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 / duration of partial vaccine-derived immunity</span></span>
<span id="cb7-27">  ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy</span></span>
<span id="cb7-28">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and unvaccinated population mix randomly</span></span>
<span id="cb7-29">  foi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>VI)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>popV) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># force of infection</span></span>
<span id="cb7-30">  </span>
<span id="cb7-31">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb7-32">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb7-33">  muRS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega</span>
<span id="cb7-34">  muVS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nstg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega_v</span>
<span id="cb7-35">  </span>
<span id="cb7-36">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># differential equations</span></span>
<span id="cb7-37">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(pop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>popV)</span>
<span id="cb7-38">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb7-39">  dI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb7-40">  dR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R</span>
<span id="cb7-41">  dC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb7-42"></span>
<span id="cb7-43">  dV1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muVS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V1</span>
<span id="cb7-44">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb7-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg) {</span>
<span id="cb7-46">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dV"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;- - foi*(1-ve)*V"</span>, i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" + muVS*V"</span>,</span>
<span id="cb7-47">                           i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span> , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - muVS*V"</span>, i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - mu*V"</span>, i)))</span>
<span id="cb7-48">    }</span>
<span id="cb7-49">  }</span>
<span id="cb7-50"></span>
<span id="cb7-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dVS &lt;- - foi*VS + muVS*V"</span>, </span>
<span id="cb7-52">                       nstg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" + muRS*VR - mu*VS"</span>))) </span>
<span id="cb7-53">  </span>
<span id="cb7-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dVE &lt;- foi*((1-ve)*("</span>, </span>
<span id="cb7-55">                       v_sum, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")+VS) - muEI*VE - mu*VE"</span>)))</span>
<span id="cb7-56">  </span>
<span id="cb7-57">  dVI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI</span>
<span id="cb7-58">  dVR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR</span>
<span id="cb7-59">  dVC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE</span>
<span id="cb7-60">  </span>
<span id="cb7-61">  dvstr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dV"</span>, x)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb7-62">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c(dS,dE,dI,dR,dC,"</span>, </span>
<span id="cb7-63">                              dvstr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",dVS,dVE,dVI,dVR,dVC)"</span>))))</span>
<span id="cb7-64">}</span></code></pre></div>
</div>
</section>
<section id="simulation-of-the-variable-compartment-seirv-model" class="level3">
<h3 class="anchored" data-anchor-id="simulation-of-the-variable-compartment-seirv-model">Simulation of the variable-compartment <img src="https://latex.codecogs.com/png.latex?SEIRV"> model</h3>
<p>Solutions for the steady states of the <img src="https://latex.codecogs.com/png.latex?SEIR"> model. These are used to set the initial conditions as we assume that the disease transmission reached a <a href="https://www.jonghoonk.com/posts/cholera_seir_eqn/">steady state</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">Ss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"((gamma + mu) * (epsilon + mu)) / (beta * epsilon)"</span></span>
<span id="cb8-2">Es <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"- ((gamma + mu) * (mu + omega) * ((gamma + mu) * (epsilon + mu) - beta * epsilon)) / (beta * epsilon * (gamma * (epsilon + mu + omega) + (epsilon + mu) * (mu + omega)))"</span></span>
<span id="cb8-3"></span>
<span id="cb8-4">Is <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"((mu + omega) * (beta * epsilon - (gamma + mu) * (epsilon + mu))) / (beta * omega * (gamma + epsilon + mu) + beta * (gamma + mu) * (epsilon + mu))"</span></span>
<span id="cb8-5">Rs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(beta * gamma * epsilon - gamma * (gamma + mu) * (epsilon + mu)) / (beta * omega * (gamma + epsilon + mu) + beta * (gamma + mu) * (epsilon + mu))"</span></span></code></pre></div>
</div>
<p>Common parameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># basic reproduction number</span></span>
<span id="cb9-2">epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/epsilon = incubation period</span></span>
<span id="cb9-3">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.8</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/gamma = duration of infectiousness</span></span>
<span id="cb9-4">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instantaneous transmission rate</span></span>
<span id="cb9-5">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural death rate</span></span>
<span id="cb9-6">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># re-infection is not counted in the clinical trial</span></span>
<span id="cb9-7">omega_v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural immunity waning rate</span></span>
<span id="cb9-8">ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.834</span></span>
<span id="cb9-9">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of stages</span></span>
<span id="cb9-10">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e6</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># population size</span></span>
<span id="cb9-11">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fraction of vaccinated population</span></span>
<span id="cb9-12">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span>
<span id="cb9-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb9-14">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, </span>
<span id="cb9-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span>omega, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega_v=</span>omega_v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ve=</span>ve,</span>
<span id="cb9-16">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N=</span>N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">f=</span>f, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tend=</span>tend)</span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># steady states for given parameters</span></span>
<span id="cb9-19">states0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>Ss, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E=</span>Es, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span>Is, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span>Rs)</span>
<span id="cb9-20">steadys0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(states0, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> x)))</span></code></pre></div>
</div>
<p>Function to run the model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">run_seirv_nstg_trial <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(params) {</span>
<span id="cb10-2">  de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to use Julia's DifferentialEquations.jl</span></span>
<span id="cb10-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial distribution of the population across the states</span></span>
<span id="cb10-4">  nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]]</span>
<span id="cb10-5">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N"</span>]]</span>
<span id="cb10-6">  f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>]]</span>
<span id="cb10-7">  V0s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>, x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"=0"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u0 &lt;- c(steadys0*N,C=0,"</span>, </span>
<span id="cb10-9">                       V0s, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",VS=0,VE=0,VI=0,VR=0,VC=0)"</span>)))</span>
<span id="cb10-10">  u0[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f))</span>
<span id="cb10-11">  tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tend"</span>]]</span>
<span id="cb10-12">  tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, tend)</span>
<span id="cb10-13">  </span>
<span id="cb10-14">  prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seirv_nstg_trial, u0, tspan, params)</span>
<span id="cb10-15">  sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-16">  mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb10-17">  udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb10-18">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb10-19"></span>
<span id="cb10-20">  Vn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"V'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb10-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c("t","S","E","I","R","C",'</span>, Vn, </span>
<span id="cb10-22">                                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"VS","VE","VI","VR","VC")'</span>))) </span>
<span id="cb10-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb10-24">}</span></code></pre></div>
</div>
<p>Direct vaccine effectiveness in case vaccine-derived immunity does not wane over time</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]]</span>
<span id="cb11-2">params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega_v"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb11-3">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seirv_nstg_trial</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params)</span>
<span id="cb11-4">novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb11-5">Vn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"V'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb11-6">vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c('</span>, Vn, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"VS","VE","VI","VR")'</span>))) </span>
<span id="cb11-7">  </span>
<span id="cb11-8">dve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># direct vaccine effectiveness measured daily</span></span>
<span id="cb11-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)){</span>
<span id="cb11-10">  dve[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,vacc]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,novacc]))</span>
<span id="cb11-11">}</span>
<span id="cb11-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, dve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct VE"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vacc_eff_waining_multiple_stages/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Direct vaccine efficacy in case vaccine-derived immunity wanes over time with the average waiting time of 10 years</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]]</span>
<span id="cb12-2">params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega_v"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># average waiting time = 10 years</span></span>
<span id="cb12-3">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seirv_nstg_trial</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params)</span>
<span id="cb12-4">novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb12-5">Vn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"V'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb12-6">vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c('</span>, Vn, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"VS","VE","VI","VR")'</span>))) </span>
<span id="cb12-7">  </span>
<span id="cb12-8">dve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># direct vaccine effectiveness measured daily</span></span>
<span id="cb12-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)){</span>
<span id="cb12-10">  dve[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,vacc]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,novacc]))</span>
<span id="cb12-11">}</span>
<span id="cb12-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, dve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct VE"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vacc_eff_waining_multiple_stages/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Function to measure vaccine effectiveness over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">measure_vacc_eff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p, params, times){</span>
<span id="cb13-2">  de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span>
<span id="cb13-3">  params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ve"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb13-4">  params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega_v"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb13-5">  nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]]</span>
<span id="cb13-6">  </span>
<span id="cb13-7">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seirv_nstg_trial</span>(params)</span>
<span id="cb13-8">  novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb13-9">  Vn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"V'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb13-10">  vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c('</span>, Vn, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"VS","VE","VI","VR")'</span>))) </span>
<span id="cb13-11">  </span>
<span id="cb13-12">  ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(times))</span>
<span id="cb13-13">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(times)) {</span>
<span id="cb13-14">    ve_sim[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> </span>
<span id="cb13-15">      ((out[times[i],<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[times[i],vacc])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> </span>
<span id="cb13-16">      ((out[times[i],<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[times[i],novacc]))</span>
<span id="cb13-17">  }</span>
<span id="cb13-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(ve_sim)</span>
<span id="cb13-19">}</span></code></pre></div>
</div>
<p>Define sum of squared difference (ssq) between the model and the data to evaluate the performance of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the initial VE is not measured from the model</span></span>
<span id="cb14-2">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>year_since_vacc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># times to measure VE</span></span>
<span id="cb14-3">ve_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tab3[tab3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vi-TT"</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>VE_obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb14-4">ssq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p){</span>
<span id="cb14-5">  ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times)</span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ve_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ve_sim)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)  </span>
<span id="cb14-7">}</span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check for some predetermined ve and omega</span></span>
<span id="cb14-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ssq(p=c(0.8,1/3650)) must be smaller than ssq(p=c(0.4,1/365))</span></span>
<span id="cb14-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3650</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05994089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3650</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.005789</code></pre>
</div>
</div>
<p>Estimate parameters by minimizing the ssq using the <code>nlminb</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb18-2">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlminb</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">objective=</span>ssq, </span>
<span id="cb18-3">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)),</span>
<span id="cb18-4">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>))</span>
<span id="cb18-5">fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8589978</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22.14073</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>objective</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0003437906</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">ve_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.834 0.807 0.801 0.771 0.783</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">(ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.828 0.815 0.799 0.782 0.772</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nstg"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb28-2">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlminb</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">objective=</span>ssq, </span>
<span id="cb28-3">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)),</span>
<span id="cb28-4">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>))</span>
<span id="cb28-5">fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb28-6"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span>
<span id="cb28-7">fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>objective</span>
<span id="cb28-8">ve_obs</span>
<span id="cb28-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>params, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
</div>
<p>Plot data and simulation results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png("vacc_eff_obs_sim.png")</span></span>
<span id="cb29-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(times<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, ve_obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>, </span>
<span id="cb29-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year since vaccination"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct vaccine effectiveness"</span>,</span>
<span id="cb29-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb29-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(times<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, ve_sim, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb29-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb29-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), </span>
<span id="cb29-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>), </span>
<span id="cb29-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb29-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb29-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb29-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb29-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb29-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb29-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vacc_eff_waining_multiple_stages/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Vaccine</category>
  <category>waning</category>
  <category>SEIR</category>
  <category>Erlang distribution</category>
  <guid>https://kimfinale.github.io/myblog/posts/vacc_eff_waining_multiple_stages/index.html</guid>
  <pubDate>Sun, 07 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/vacc_eff_waining_multiple_stages/vacc_eff_obs_sim.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>SEIR model with varying number of compartments</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/seir_varying_number_compartments/index.html</link>
  <description><![CDATA[ 




<p>The <img src="https://latex.codecogs.com/png.latex?SEIR"> model structures each stage as a distinct compartment, with transitions between compartments dictated by specific rate constants, except for the transition between <img src="https://latex.codecogs.com/png.latex?S"> and <img src="https://latex.codecogs.com/png.latex?E"> that involve force of infection which is also a function of <img src="https://latex.codecogs.com/png.latex?t">. Waiting times in the <img src="https://latex.codecogs.com/png.latex?E"> and <img src="https://latex.codecogs.com/png.latex?I"> compartments are assumed to follow an exponential distribution. However, to better reflect reality, it might be necessary to consider alternative distributions. For instance, the waiting time in the <img src="https://latex.codecogs.com/png.latex?E"> compartment, i.e., incubation period, could be represented by a lognormal or Weibull distribution. Within the framework of ordinary differential equations (ODEs), incorporating these distributions directly poses challenges. Nevertheless, by dividing a single compartment into multiple sub-compartments, waiting times follow the Erlang distribution, effectively capturing the essence of both lognormal and Weibull distributions.</p>
<p>The process of adding multiple sub-compartments is relatively straightforward. The challenge arises when one wishes to dynamically adjust the number of sub-compartments within a single model framework. This post discusses a method to achieve such adaptability in model construction. To enhance model flexibility, I extensively employ strings, specifically utilizing the <code>eval(str2lang("some text"))</code> function.</p>
<section id="diffeqr-package" class="level3">
<h3 class="anchored" data-anchor-id="diffeqr-package"><code>diffeqr</code> package</h3>
<p><code>diffeqr</code> package is used use Julia’s <code>DifferentialEquations</code> library</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(diffeqr)</span>
<span id="cb1-2">de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span></code></pre></div>
</div>
<p>First, let’s construct the classic SEIR model for comparison. This model is equivalent to a variant with variable compartments for the <img src="https://latex.codecogs.com/png.latex?I"> stage when considering only a single compartment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">seir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb2-2">  </span>
<span id="cb2-3">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; </span>
<span id="cb2-4">  E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>];</span>
<span id="cb2-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the number of compartments to model the duration of infectiousness</span></span>
<span id="cb2-6">  I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>];</span>
<span id="cb2-7">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]; </span>
<span id="cb2-8">  C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>];</span>
<span id="cb2-9"></span>
<span id="cb2-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># population size</span></span>
<span id="cb2-11">  pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>E<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>R</span>
<span id="cb2-12">  </span>
<span id="cb2-13">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/latent period</span></span>
<span id="cb2-14">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/duration of infectiousness</span></span>
<span id="cb2-15">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transmission rate</span></span>
<span id="cb2-16">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/omega = duration of natural immunity</span></span>
<span id="cb2-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># force of infection</span></span>
<span id="cb2-18">  foi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop </span>
<span id="cb2-19">  </span>
<span id="cb2-20">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb2-21">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb2-22">  muRS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega</span>
<span id="cb2-23">  </span>
<span id="cb2-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># differential equations</span></span>
<span id="cb2-25">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R </span>
<span id="cb2-26">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb2-27">  dI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb2-28">  dR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R</span>
<span id="cb2-29">  </span>
<span id="cb2-30">  dC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb2-31"></span>
<span id="cb2-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dS,dE,dI,dR,dC))</span>
<span id="cb2-33">}</span>
<span id="cb2-34"></span>
<span id="cb2-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># simulation</span></span>
<span id="cb2-36">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># basic reproduction number</span></span>
<span id="cb2-37">epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/epsilon = incubation period</span></span>
<span id="cb2-38">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/gamma = duration of infectiousness</span></span>
<span id="cb2-39">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instantaneous transmission rate</span></span>
<span id="cb2-40">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural immunity waning rate</span></span>
<span id="cb2-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb2-42">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span>omega)</span>
<span id="cb2-43">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-44">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  </span></span>
<span id="cb2-45">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, tend)</span>
<span id="cb2-46">  </span>
<span id="cb2-47">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir, u0, tspan, params)</span>
<span id="cb2-48">sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-49">mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb2-50">udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb2-51">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb2-52"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>) </span></code></pre></div>
</div>
</section>
<section id="seir-model-with-str2lang" class="level3">
<h3 class="anchored" data-anchor-id="seir-model-with-str2lang"><img src="https://latex.codecogs.com/png.latex?SEIR"> model with <code>str2lang</code></h3>
<p>The model with variable compartments for the <img src="https://latex.codecogs.com/png.latex?I"> stage. A part of the model is written using strings using <code>paste</code>, which are later evaluated using <code>eval(str2lang("some string"))</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">seir_nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb3-2">  </span>
<span id="cb3-3">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; </span>
<span id="cb3-4">  E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>];</span>
<span id="cb3-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the number of compartments to model the duration of infectiousness</span></span>
<span id="cb3-6">  nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] </span>
<span id="cb3-7">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg) {</span>
<span id="cb3-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;- "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u[2+"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"]"</span>)));</span>
<span id="cb3-9">  } </span>
<span id="cb3-10">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; </span>
<span id="cb3-11">  C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>];</span>
<span id="cb3-12"></span>
<span id="cb3-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># population size</span></span>
<span id="cb3-14">  istr_sum <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,x)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>)</span>
<span id="cb3-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pop &lt;- S+E+R+"</span>, istr_sum)))</span>
<span id="cb3-16">  </span>
<span id="cb3-17">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/latent period</span></span>
<span id="cb3-18">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/duration of infectiousness</span></span>
<span id="cb3-19">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transmission rate</span></span>
<span id="cb3-20">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/omega = duration of natural immunity</span></span>
<span id="cb3-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># force of infection</span></span>
<span id="cb3-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foi &lt;- beta*("</span>, istr_sum, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")/pop"</span>))) </span>
<span id="cb3-23">  </span>
<span id="cb3-24">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb3-25">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb3-26">  muRS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega</span>
<span id="cb3-27">  </span>
<span id="cb3-28">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># differential equations</span></span>
<span id="cb3-29">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R </span>
<span id="cb3-30">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb3-31">  dI1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> nstg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1</span>
<span id="cb3-32"></span>
<span id="cb3-33">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#dI2, ...</span></span>
<span id="cb3-34">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (nstg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb3-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg) {</span>
<span id="cb3-36">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dI"</span>,i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;- "</span>, </span>
<span id="cb3-37">                           nstg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*muIR*(I"</span>, i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-I"</span>, i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>)))</span>
<span id="cb3-38">    }</span>
<span id="cb3-39">  }</span>
<span id="cb3-40">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dR</span></span>
<span id="cb3-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dR &lt;- muIR*I"</span>, nstg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-muRS*R"</span>)))</span>
<span id="cb3-42">  </span>
<span id="cb3-43">  dC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb3-44"></span>
<span id="cb3-45">  distr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dI"</span>, x)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb3-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c(dS,dE,"</span>, distr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",dR,dC)"</span>))))</span>
<span id="cb3-47">}</span></code></pre></div>
</div>
<p>Simulation of the variable-compartment model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">run_seir_nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(nstg) {</span>
<span id="cb4-2">  R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># basic reproduction number</span></span>
<span id="cb4-3">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/epsilon = incubation period</span></span>
<span id="cb4-4">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/gamma = duration of infectiousness</span></span>
<span id="cb4-5">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instantaneous transmission rate</span></span>
<span id="cb4-6">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural immunity waning rate</span></span>
<span id="cb4-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb4-8">  params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span>omega)</span>
<span id="cb4-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial distribution of the population across the states</span></span>
<span id="cb4-10">  I0s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>, x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"=0"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u0 &lt;- c(S=0,E=0,"</span>, I0s,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",R=0,C=0)"</span>)))</span>
<span id="cb4-12">  u0[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb4-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># all I in the first compartment of the nstg I compartments</span></span>
<span id="cb4-14">  tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  </span></span>
<span id="cb4-15">  tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, tend)</span>
<span id="cb4-16">  </span>
<span id="cb4-17">  prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir_nstg, u0, tspan, params)</span>
<span id="cb4-18">  sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-19">  </span>
<span id="cb4-20">  mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb4-21">  udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb4-22">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb4-23">  In <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"I'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c("t","S","E",'</span>, In, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">',"R","C")'</span>))) </span>
<span id="cb4-25">  </span>
<span id="cb4-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb4-27">}</span>
<span id="cb4-28"></span>
<span id="cb4-29">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-30">In <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"I'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-31">out1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seir_nstg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg)</span>
<span id="cb4-32">It1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> out1[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I1"</span>]</span>
<span id="cb4-33"></span>
<span id="cb4-34">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-35">In <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"I'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-36">out2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seir_nstg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg)</span>
<span id="cb4-37"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'It2 &lt;- rowSums(out2[,c('</span>, In, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">')])'</span>)))</span>
<span id="cb4-38">nstg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb4-39">In <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>nstg, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"I'</span>, x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)</span>
<span id="cb4-40">out5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_seir_nstg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nstg=</span>nstg)</span>
<span id="cb4-41"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str2lang</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'It5 &lt;- rowSums(out5[,c('</span>, In, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">')])'</span>)))</span></code></pre></div>
</div>
<p>Plot the simulation results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png(filename="seir_multi_comp.png")</span></span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out), out<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>I, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb5-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fraction infectious"</span>,</span>
<span id="cb5-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out), It1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>)</span>
<span id="cb5-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out), It2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out), It5, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magenta"</span>)</span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb5-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEIR"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 compartment"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2 compartments"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5 compartments"</span>), </span>
<span id="cb5-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magenta"</span>), </span>
<span id="cb5-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb5-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb5-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb5-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb5-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb5-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/seir_varying_number_compartments/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>SEIR</category>
  <category>Erlang distribution</category>
  <guid>https://kimfinale.github.io/myblog/posts/seir_varying_number_compartments/index.html</guid>
  <pubDate>Thu, 04 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/seir_varying_number_compartments/seir_multi_comp.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Waning of vaccine effectiveness</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/vaccine_effectiveness_waning/index.html</link>
  <description><![CDATA[ 




<p>The protection derived from vaccination often wanes over time and require the second or the third doses (so-called booster doses). For example, the <a href="https://pubmed.ncbi.nlm.nih.gov/8852414/">study</a> showed the efficacy of cholera vaccines over five years. The vaccine efficacy (VE) over the period seems to indicate that the VE wanes over time. In this post, we will develop a <img src="https://latex.codecogs.com/png.latex?SEIR"> model to illustrate the waning of vaccine-derived immunity.</p>
<section id="seir-model-with-vaccination" class="level4">
<h4 class="anchored" data-anchor-id="seir-model-with-vaccination"><img src="https://latex.codecogs.com/png.latex?SEIR"> model with vaccination</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">seir_vacc_trial_jl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb1-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine recipients lose partial immunity over time.</span></span>
<span id="cb1-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this is implemented in a way that individuals in the V state</span></span>
<span id="cb1-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># decreases and transitions to the S state</span></span>
<span id="cb1-5">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]; E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]; I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]; R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]; C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb1-6"> </span>
<span id="cb1-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated cohort</span></span>
<span id="cb1-8">  V <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]; <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and partially protected</span></span>
<span id="cb1-9">  VS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]; <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated but immunity waned and fully susceptible</span></span>
<span id="cb1-10">  VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>]; VI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>]; VR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]; VC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>]</span>
<span id="cb1-11">  </span>
<span id="cb1-12">  pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R</span>
<span id="cb1-13">  popV <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VS <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VR</span>
<span id="cb1-14"></span>
<span id="cb1-15">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/latent period</span></span>
<span id="cb1-16">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/duration of infectiousness</span></span>
<span id="cb1-17">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transmission rate</span></span>
<span id="cb1-18">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># death rate is applied and population size decreases over time</span></span>
<span id="cb1-19">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 / duration of natural immunity</span></span>
<span id="cb1-20">  omega_v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 / duration of partial vaccine-derived immunity</span></span>
<span id="cb1-21">  ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy</span></span>
<span id="cb1-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and unvaccinated population mix randomly</span></span>
<span id="cb1-23">  foi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>VI) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> popV) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># force of infection</span></span>
<span id="cb1-24">  </span>
<span id="cb1-25">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb1-26">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb1-27">  muRS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega</span>
<span id="cb1-28">  muVS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega_v</span>
<span id="cb1-29">  </span>
<span id="cb1-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># differential equations</span></span>
<span id="cb1-31">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S</span>
<span id="cb1-32">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb1-33">  dI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb1-34">  dR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R</span>
<span id="cb1-35">  dC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E</span>
<span id="cb1-36">  </span>
<span id="cb1-37">  dV <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muVS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V</span>
<span id="cb1-38">  dVS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VS <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muVS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VS </span>
<span id="cb1-39">  dVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> foi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> VS) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE</span>
<span id="cb1-40">  dVI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI</span>
<span id="cb1-41">  dVR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muRS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VR</span>
<span id="cb1-42">  dVC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE</span>
<span id="cb1-43">  </span>
<span id="cb1-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dS,dE,dI,dR,dC,dV,dVS,dVE,dVI,dVR,dVC))</span>
<span id="cb1-45">}</span></code></pre></div>
</div>
<p><code>diffeqr</code> package is used use Julia’s <code>DifferentialEquations</code> library</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(diffeqr)</span>
<span id="cb2-2">de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span></code></pre></div>
</div>
<p>We assume that cholera transmission is in the steady state in the setting where the vaccine efficacy trial is examined. Algebraic <a href="https://www.jonghoonk.com/posts/cholera_seir_eqn/">solutions</a> to the steady states (shown below) are used as initial conditions to generate initial conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">Ss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"((gamma + mu) * (epsilon + mu)) / (beta * epsilon)"</span></span>
<span id="cb3-2">Es <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"- ((gamma + mu) * (mu + omega) * ((gamma + mu) * (epsilon + mu) - beta * epsilon)) / (beta * epsilon * (gamma * (epsilon + mu + omega) + (epsilon + mu) * (mu + omega)))"</span></span>
<span id="cb3-3"></span>
<span id="cb3-4">Is <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"((mu + omega) * (beta * epsilon - (gamma + mu) * (epsilon + mu))) / (beta * omega * (gamma + epsilon + mu) + beta * (gamma + mu) * (epsilon + mu))"</span></span>
<span id="cb3-5">Rs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(beta * gamma * epsilon - gamma * (gamma + mu) * (epsilon + mu)) / (beta * omega * (gamma + epsilon + mu) + beta * (gamma + mu) * (epsilon + mu))"</span></span></code></pre></div>
</div>
</section>
<section id="simulation-of-a-clinical-trial" class="level4">
<h4 class="anchored" data-anchor-id="simulation-of-a-clinical-trial">Simulation of a clinical trial</h4>
<p>The basic idea is to use the steady states as initial conditions and therefore, cholera transmission is sustained as new susceptibles are supplied through birth and waning of vaccine-derived and natural immunity. In this setting, a clinical trial is implemented by moving some portion of the population to the vaccinated cohort. Note that the proportion of the vaccinated population, <img src="https://latex.codecogs.com/png.latex?f">, is important in the subsequent dynamics. For example, we <a href="https://www.jonghoonk.com/posts/critical_vacc_threshold/index.html">know</a> that if <img src="https://latex.codecogs.com/png.latex?f%3E%201-%20%5Cfrac%7B1%7D%7BR_0%7D">, cholera infections will die out. In this case, we can not measure the relative risk of cholera among vaccinated and unvaccinated population over a period based on the cumulative incidence. Even if <img src="https://latex.codecogs.com/png.latex?f%20%3C%201-%20%5Cfrac%7B1%7D%7BR_0%7D">, moving some portion of the population into vaccinated states will perturb the steady states that were determined based on and a series of outbreaks may follow before the system reaches new steady states eventually.</p>
<p>Since our objective is to vaccine efficacy in this dynamic population based on cumulative incidence among vaccinated and unvaccinated people, and we used the steady states without the vaccinated population, we can set the proportion of the vaccinated population small that the system more or less maintains the states without vaccination. Wh</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># unvaccinated population</span></span>
<span id="cb4-2">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a very small proportion of the population is vaccinated</span></span>
<span id="cb4-3">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-4">epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.4</span></span>
<span id="cb4-5">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-6">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma</span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mu &lt;- 1/(65*365) # natural death rate</span></span>
<span id="cb4-8">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural death rate</span></span>
<span id="cb4-9">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural immunity waning rate</span></span>
<span id="cb4-10">omega_v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine-derived immunity waning rate</span></span>
<span id="cb4-11">ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy (instantaneous hazard ratio)</span></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy based on CI will differ and we will eventually estimate</span></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this parameter along with omega_v</span></span>
<span id="cb4-14">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, </span>
<span id="cb4-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span>omega, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega_v=</span>omega_v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ve=</span>ve)</span>
<span id="cb4-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># steady states for given parameters</span></span>
<span id="cb4-17">states0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>Ss, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E=</span>Es, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span>Is, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span>Rs)</span>
<span id="cb4-18">steadys0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(states0, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> x)))</span>
<span id="cb4-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial distribution of the population across the states</span></span>
<span id="cb4-20">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VS=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VI=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VR=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VC=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-21">u0[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f))</span>
<span id="cb4-22"></span>
<span id="cb4-23">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20.0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># measure vaccin</span></span>
<span id="cb4-24">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, tend)</span>
<span id="cb4-25"></span>
<span id="cb4-26">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir_vacc_trial_jl, u0, tspan, params)</span>
<span id="cb4-27">sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-28"></span>
<span id="cb4-29">mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb4-30">udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb4-31">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb4-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>)</span>
<span id="cb4-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cumulative incidence</span></span>
<span id="cb4-34"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative incidence"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb4-35"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>,out[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span>
<span id="cb4-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, </span>
<span id="cb4-37">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No vaccine"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine"</span>), </span>
<span id="cb4-38">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>), </span>
<span id="cb4-39">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-40">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb4-41">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb4-42">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb4-43">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb4-44">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vaccine_effectiveness_waning/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Measure vaccine impact</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb5-2">vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)</span>
<span id="cb5-3">dve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># direct vaccine effectiveness measured daily</span></span>
<span id="cb5-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(out)){</span>
<span id="cb5-5">  dve[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,vacc]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(out[i,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[i,novacc]))</span>
<span id="cb5-6">}</span>
<span id="cb5-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dve)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>,dve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct VE"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vaccine_effectiveness_waning/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="estimating-ve-and-omega_v" class="level3">
<h3 class="anchored" data-anchor-id="estimating-ve-and-omega_v">Estimating VE and <img src="https://latex.codecogs.com/png.latex?%5Comega_V"></h3>
<p>Let’s suppose we want to the following dataset showing the vaccine effec</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">ve_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">76</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span></code></pre></div>
</div>
<p>Create a function to measure vaccine efficacy from the model based on cumulative incidence</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">measure_vacc_eff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p, times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">f=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span>){</span>
<span id="cb7-2">  params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ve"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb7-3">  params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega_v"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb7-4">  u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V=</span>N,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VS=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VE=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VI=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VR=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VC=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-5">  u0[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(steadys0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f))</span>
<span id="cb7-6">  prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir_vacc_trial_jl, u0, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(times)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), params)</span>
<span id="cb7-7">  sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-8">  mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb7-9">  udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb7-10">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb7-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(out) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>,</span>
<span id="cb7-12">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>)</span>
<span id="cb7-13">  novacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)</span>
<span id="cb7-14">  vacc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VR"</span>)</span>
<span id="cb7-15">  </span>
<span id="cb7-16">  ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(times))</span>
<span id="cb7-17">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(times)) {</span>
<span id="cb7-18">    ve_sim[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> </span>
<span id="cb7-19">      ((out[times[i],<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[times[i],vacc])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> </span>
<span id="cb7-20">      ((out[times[i],<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(out[times[i],novacc]))</span>
<span id="cb7-21">  }</span>
<span id="cb7-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(ve_sim)</span>
<span id="cb7-23">}</span></code></pre></div>
</div>
<p>Define sum of squared difference to evaluate the difference between the model and the observation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the initial VE is not measured from the model</span></span>
<span id="cb8-2">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># times to measure VE</span></span>
<span id="cb8-3">ssq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p){</span>
<span id="cb8-4">  ve_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times)</span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ve_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],ve_sim))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)  </span>
<span id="cb8-6">}</span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check for some predetermined ve and omega</span></span>
<span id="cb8-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ssq(p=c(0.8,1/3650)) must be smaller than ssq(p=c(0.4,1/365))</span></span>
<span id="cb8-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3650</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5765074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.260319</code></pre>
</div>
</div>
<p>Use the <code>nlminb</code> to identify the parameter values that minimize the ssq.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlminb</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">objective=</span>ssq, </span>
<span id="cb12-2">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)),</span>
<span id="cb12-3">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>))</span>
<span id="cb12-4">ve_obs</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.76 0.72 0.68 0.63 0.58 0.52 0.46 0.39 0.32 0.24 0.15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par, times)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.83 0.73 0.65 0.58 0.52 0.46 0.42 0.38 0.34 0.31 0.29</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png("vacc_eff_waning.png")</span></span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ve_obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>, </span>
<span id="cb16-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direct VE"</span>,</span>
<span id="cb16-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb16-5"></span>
<span id="cb16-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">measure_vacc_eff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par, times)),</span>
<span id="cb16-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb16-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb16-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), </span>
<span id="cb16-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>), </span>
<span id="cb16-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb16-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb16-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb16-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb16-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb16-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb16-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vaccine_effectiveness_waning/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>vaccine efficacy</category>
  <category>clinical trial</category>
  <category>SEIR</category>
  <guid>https://kimfinale.github.io/myblog/posts/vaccine_effectiveness_waning/index.html</guid>
  <pubDate>Wed, 03 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/vaccine_effectiveness_waning/vacc_eff_waning.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Solutions for the steady states of the SEIR model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/cholera_seir_eqn/index.html</link>
  <description><![CDATA[ 




<p>In this post, I compared the numerical solutions obtained using <code>deSolve::ode</code> with the algebraic solutions derived from Mathematica for the steady states of a SEIR model. The model considers the waning of natural immunity over time in a dynamically changing population.</p>
<section id="seir-model-with-waning-immunity-and-vital-dynamics" class="level3">
<h3 class="anchored" data-anchor-id="seir-model-with-waning-immunity-and-vital-dynamics"><img src="https://latex.codecogs.com/png.latex?SEIR"> model with waning immunity and vital dynamics</h3>
<p><img src="https://latex.codecogs.com/png.latex?%0AdS/dt%20=%20%5Cmu%20(S+E+I+R)%20-%20%5Cbeta%20SI%20-%20%5Cmu%20S%20+%20%5Comega%20R%5C%5C%0AdE/dt%20=%20%5Cbeta%20SI%20-%20(%5Cmu+%5Ckappa)E%5C%5C%0AdI/dt%20=%20%5Ckappa%20E%20-%20(%5Cmu+%5Cgamma)I%5C%5C%0AdR/dt%20=%20%5Cgamma%20I%20-%20(%5Cmu+%5Comega)%20R%0A"> Following Mathematica command produces the solutions for the steady states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">FullSimplify[</span>
<span id="cb1-2"> Solve[{\[Mu]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Beta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Omega]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-3">      R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Beta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Kappa])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> </span>
<span id="cb1-4">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Kappa]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Gamma])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> </span>
<span id="cb1-5">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Gamma]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb1-6">   S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, \[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Beta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Kappa] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb1-7">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Gamma] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb1-8">   S \[Element] Reals, E1 \[Element] Reals, I1 \[Element] Reals, </span>
<span id="cb1-9">   R \[Element] Reals}, {S, E1, I1, R}]]</span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?s%20=%20%5Cfrac%7B(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)%7D%7B%5Cbeta%20%20%5Ckappa%20%7D%20%5C%5C%0Ae%20=%20-%5Cfrac%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)%20((%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)-%5Cbeta%20%20%5Ckappa%20)%7D%7B%5Cbeta%20%20%5Ckappa%20%20(%5Cgamma%20%20(%5Ckappa%20+%5Cmu%20+%5Comega%20)+(%5Ckappa%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20))%7D%20%5C%5C%0Ai%20=%20%5Cfrac%7B(%5Cmu%20+%5Comega%20)%20(%5Cbeta%20%20%5Ckappa%20-(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20))%7D%7B%5Cbeta%20%20%5Comega%20%20(%5Cgamma%20+%5Ckappa%20+%5Cmu%20)+%5Cbeta%20%20(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)%7D%20%5C%5C%0Ar%20=%20%5Cfrac%7B%5Cbeta%20%20%5Cgamma%20%20%5Ckappa%20-%5Cgamma%20%20(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)%7D%7B%5Cbeta%20%20%5Comega%20%20(%5Cgamma%20+%5Ckappa%20+%5Cmu%20)+%5Cbeta%20%20(%5Cgamma%20+%5Cmu%20)%20(%5Ckappa%20+%5Cmu%20)%7D%0A"> I used <code>latex2r</code> package to convert the LaTex expressions from the Mathematica to R codes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(latex2r)</span>
<span id="cb2-2">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa }"</span>)</span>
<span id="cb2-3">e <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) ((</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa )}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))}"</span>)</span>
<span id="cb2-4">i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa -(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ))}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}"</span>)</span>
<span id="cb2-5">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa -</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}"</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7">kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.115044</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mean late period is still around 1.4 days, </span></span>
<span id="cb2-8">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> </span>
<span id="cb2-9">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb2-10">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb2-11">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span></span>
<span id="cb2-12"></span>
<span id="cb2-13">states <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s=</span>s, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">e=</span>e, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span>i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span>r)</span>
<span id="cb2-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(states, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> x)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           s            e            i            r 
0.8334665895 0.0002166020 0.0002415004 0.1660753080 </code></pre>
</div>
</div>
<p>Numerical solutions based on <code>deSolve::ode</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">seir_vital <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb4-2">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb4-3">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]</span>
<span id="cb4-4">  kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kappa"</span>]</span>
<span id="cb4-5">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]</span>
<span id="cb4-6">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega"</span>]</span>
<span id="cb4-7">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>]</span>
<span id="cb4-8">  </span>
<span id="cb4-9">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb4-10">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb4-11">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb4-12">  du4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb4-13">  </span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3,du4))) </span>
<span id="cb4-15">}</span>
<span id="cb4-16"></span>
<span id="cb4-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb4-18">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-19">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.115044</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>), </span>
<span id="cb4-20">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span>
<span id="cb4-21">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb4-22">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_vital, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb4-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(outdf) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"i"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb4-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(outdf, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        day         s            e            i         r
30001 30000 0.8334656 0.0002166031 0.0002415018 0.1660763</code></pre>
</div>
</div>
</section>
<section id="se_1e_2i_1i_2r_1r_2-model" class="level3">
<h3 class="anchored" data-anchor-id="se_1e_2i_1i_2r_1r_2-model"><img src="https://latex.codecogs.com/png.latex?SE_1E_2I_1I_2R_1R_2"> model</h3>
<p>This model incorporates two consecutive compartments for the Exposed (E), Infectious (I), and Recovered (R) states, effectively changing the distribution of waiting times in each states from an exponential to an Erlang distribution with a shape parameter of 2, offering a more realistic representation.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AdS/dt%20=%20%5Cmu%20(S+E_1+I_1+R_1+E_2+I_2+R_2)%20-%20%5Cbeta%20S(I_1+I_2)%20-%20%5Cmu%20S%20+%202%20%5Comega%20R_2%5C%5C%0AdE_1/dt%20=%20%5Cbeta%20S(I_1+I_2)%20-%20(%5Cmu+2%5Ckappa)E1%5C%5C%0AdE_2/dt%20=%202%5Ckappa%20E_1%20-%20(%5Cmu+2%5Ckappa)E2%5C%5C%0AdI_1/dt%20=%202%20%5Ckappa%20E_2%20-%20(%5Cmu+2%5Cgamma)I_1%5C%5C%0AdI_2/dt%20=%202%5Cgamma%20I_1%20-%20(%5Cmu+2%5Cgamma)I_2%5C%5C%0AdR_1/dt%20=%202%20%5Cgamma%20I_2%20-%20(%5Cmu+2%5Comega)%20R_1%5C%5C%0AdR_2/dt%20=%202%20%5Comega%20R_1%20-%20(%5Cmu+2%5Comega)%20R_2%0A"></p>
<p>The following Mathematica command produces the solutions for the steady states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">FullSimplify[</span>
<span id="cb6-2"> Solve[{\[Mu]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-3">        R2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Beta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Omega]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> </span>
<span id="cb6-4">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Beta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I2)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Kappa])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-5">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Kappa]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Kappa] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-6">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Kappa]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Gamma])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-7">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Gamma]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Gamma] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-8">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Gamma]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-9">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Omega]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>\[Omega])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-10">   S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, \[Mu] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Beta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb6-11">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Kappa] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Gamma] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-12">   E2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, I2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S \[Element] Reals, </span>
<span id="cb6-13">   E1 \[Element] Reals, E2 \[Element] Reals, I1 \[Element] Reals, </span>
<span id="cb6-14">   I2 \[Element] Reals, R1 \[Element] Reals, R2 \[Element] Reals}, {S,</span>
<span id="cb6-15">    E1, E2, I1, I2, R1, R2}]]</span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%0As=%20%5Cfrac%7B(2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%7D%7B4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ae_1%20=%20-%20%5Cfrac%7B(2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%20(%5Cmu%20+2%20%5Comega%20)%5E2%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ae_2%20=%20-%5Cfrac%7B(2%20%5Cgamma%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B2%20%5Cbeta%20%20%5Ckappa%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ai_1%20=%20-%20%5Cfrac%7B(2%20%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+2%20%5Comega%20)%5E2%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B%5Cbeta%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ai_2%20=%20-%5Cfrac%7B2%20%5Cgamma%20%20(%5Cmu%20+2%20%5Comega%20)%5E2%20%5Cleft(4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)-(2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%5Cright)%7D%7B%5Cbeta%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ar_1%20=%20-%5Cfrac%7B4%20%5Cgamma%20%5E2%20(%5Cmu%20+2%20%5Comega%20)%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B%5Cbeta%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%5C%5C%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ar_2%20=%20-%5Cfrac%7B8%20%5Cgamma%20%5E2%20%5Comega%20%20%5Cleft((2%20%5Cgamma%20+%5Cmu%20)%5E2%20(2%20%5Ckappa%20+%5Cmu%20)%5E2-4%20%5Cbeta%20%20%5Ckappa%20%5E2%20(4%20%5Cgamma%20+%5Cmu%20)%5Cright)%7D%7B%5Cbeta%20%20(4%20%5Cgamma%20+%5Cmu%20)%20%5Cleft(4%20%5Cgamma%20%5E2%20(2%20%5Ckappa%20+%5Cmu%20+2%20%5Comega%20)%20(2%20%5Ckappa%20%20(%5Cmu%20+4%20%5Comega%20)+%5Cmu%20%20(%5Cmu%20+2%20%5Comega%20))+4%20%5Cgamma%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2+%5Cmu%20%20(2%20%5Ckappa%20+%5Cmu%20)%5E2%20(%5Cmu%20+2%20%5Comega%20)%5E2%5Cright)%7D%0A"></p>
<p>Again, LaTex expressions were converted to R codes using the <code>latex2r</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2}{4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )}"</span>)</span>
<span id="cb7-2">e1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb7-3"></span>
<span id="cb7-4">e2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb7-5"></span>
<span id="cb7-6">i1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb7-7"></span>
<span id="cb7-8">i2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )-(2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb7-9"></span>
<span id="cb7-10">r1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb7-11"></span>
<span id="cb7-12">r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex2r</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">frac{8 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left((2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2-4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa ^2 (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">beta  (4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu ) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">left(4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma ^2 (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ) (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega ))+4 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">gamma  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2+</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu  (2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">kappa +</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu )^2 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">mu +2 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">omega )^2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">right)}"</span>)</span>
<span id="cb7-13"></span>
<span id="cb7-14">kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.115044</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mean late period is still around 1.4 days, </span></span>
<span id="cb7-15">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> </span>
<span id="cb7-16">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb7-17">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb7-18">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span></span>
<span id="cb7-19"></span>
<span id="cb7-20">states <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s=</span>s, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">e1=</span>e1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">e2=</span>e2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i1=</span>i1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i2=</span>i2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r1=</span>r1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r2=</span>r2)</span>
<span id="cb7-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(states, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> x)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           s           e1           e2           i1           i2           r1 
0.8334490274 0.0001067747 0.0001067707 0.0001190490 0.0001190440 0.0843079955 
          r2 
0.0817913389 </code></pre>
</div>
</div>
<p>Numerical solutions are based on <code>deSolve::ode</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">seir_2stg_vital <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb9-2">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb9-3">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]</span>
<span id="cb9-4">  kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kappa"</span>]</span>
<span id="cb9-5">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]</span>
<span id="cb9-6">  omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega"</span>]</span>
<span id="cb9-7">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>]</span>
<span id="cb9-8">  </span>
<span id="cb9-9">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb9-10">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb9-11">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb9-12">  du4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb9-13">  du5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb9-14">  du6 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]</span>
<span id="cb9-15">  du7 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]</span>
<span id="cb9-16">  </span>
<span id="cb9-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3,du4,du5,du6,du7))) </span>
<span id="cb9-18">}</span>
<span id="cb9-19"></span>
<span id="cb9-20">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb9-21">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.115044</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>), </span>
<span id="cb9-22">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span>
<span id="cb9-23">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb9-24">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_2stg_vital, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb9-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(outdf) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"i1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"i2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r2"</span>)</span>
<span id="cb9-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(outdf, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          day         s           e1           e2           i1           i2
109501 109500 0.8334488 0.0001067726 0.0001067686 0.0001190467 0.0001190417
               r1         r2
109501 0.08430817 0.08179142</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>SEIR model</category>
  <category>steady states</category>
  <category>ODE</category>
  <category>deSolve</category>
  <category>Mathematica</category>
  <guid>https://kimfinale.github.io/myblog/posts/cholera_seir_eqn/index.html</guid>
  <pubDate>Wed, 27 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/cholera_seir_eqn/sample_figure.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Vaccine effectiveness</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/vaccine_effectiveness/index.html</link>
  <description><![CDATA[ 




<section id="vaccine-efficacy-and-effectiveness" class="level3">
<h3 class="anchored" data-anchor-id="vaccine-efficacy-and-effectiveness">Vaccine efficacy and effectiveness</h3>
<p>Vaccine efficacy and effectiveness (VE) is generally estimated as one minus some measure of relative risk (RR) in the vaccinated group compared with the unvaccinated group <a href="https://pubmed.ncbi.nlm.nih.gov/10520474/">Halloran <em>et al</em>.</a>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVE%7D%20=%201%20-%20%5Ctext%7BRR%7D%0A"></p>
<p>RR measures may relative infection probability given exposure, hazard ratio, or the ratio of cumulative incidence (or attack rate). I will explain different effects of the vaccine using the cumulative incidence (<img src="https://latex.codecogs.com/png.latex?C">) measure based on the notations from the <a href="https://pubmed.ncbi.nlm.nih.gov/1742381/">Study design for dependent happenings</a>.</p>
<p><img src="https://kimfinale.github.io/myblog/posts/vaccine_effectiveness/study_design.png" class="img-fluid"></p>
<p>In population <img src="https://latex.codecogs.com/png.latex?A">, a fraction, <img src="https://latex.codecogs.com/png.latex?f">, of the population was vaccinated (denoted with <img src="https://latex.codecogs.com/png.latex?1">) and the rest, <img src="https://latex.codecogs.com/png.latex?1-f">, of the Population A remains unvaccinated (denoted with <img src="https://latex.codecogs.com/png.latex?0">). In Population <img src="https://latex.codecogs.com/png.latex?B">, no one was vaccinated. I can now use <img src="https://latex.codecogs.com/png.latex?C_%7BA0%7D"> and <img src="https://latex.codecogs.com/png.latex?C_%7BA1%7D"> to denote cumulative incidence, <img src="https://latex.codecogs.com/png.latex?C">, in the unvaccinated and vaccinated individuals of Population <img src="https://latex.codecogs.com/png.latex?A">. Similarly, I can use <img src="https://latex.codecogs.com/png.latex?C_%7BB0%7D"> to denote the cumulative incidence in the (unvaccinated) population <img src="https://latex.codecogs.com/png.latex?B">.</p>
<p>The VE can be divided into four different measures and they are direct, indirect, total, and overall VE, which are noted as DVE, IVE, TVE, and OVE, respectively.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BDVE%7D%20=%201%20-%20%5Cfrac%7BC_%7BA1%7D%7D%7BC_%7BA0%7D%7D,~%0A%5Ctext%7BIVE%7D%20=%201%20-%20%5Cfrac%7BC_%7BA0%7D%7D%7BC_%7BB0%7D%7D,~%0A%5Ctext%7BTVE%7D%20=%201%20-%20%5Cfrac%7BC_%7BA1%7D%7D%7BC_%7BB0%7D%7D,~%0A%5Ctext%7BOVE%7D%20=%201%20-%20%5Cfrac%7Bf%20C_%7BA1%7D+(1-f)%20C_%7BA0%7D%7D%7BC_%7BB0%7D%7D.%0A"></p>
<p>Using the above equation we can see the following is true</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BIVE%7D%20=%201-%5Cfrac%7B1-%5Ctext%7BTVE%7D%7D%7B1-%5Ctext%7BDVE%7D%7D,~%20%5Ctext%7BOVE%7D%20=%201-%5Cleft(f%5Cleft(1-%5Ctext%7BTVE%7D%5Cright)+(1-f)%5Cleft(1-%5Ctext%7BIVE%7D%5Cright)%5Cright)%0A"></p>
<p>Let’s construct a simple <img src="https://latex.codecogs.com/png.latex?SEIR"> model to illustrate the different metrics of VE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">seir_2grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, y, params) {</span>
<span id="cb1-2">  S0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S0"</span>]; E0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E0"</span>]; I0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I0"</span>]; R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R0"</span>]; C0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]</span>
<span id="cb1-3">  S1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S1"</span>]; E1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E1"</span>]; I1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I1"</span>]; R1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R1"</span>]; C1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]</span>
<span id="cb1-4"> </span>
<span id="cb1-5">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]</span>
<span id="cb1-6">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsilon"</span>]</span>
<span id="cb1-7">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]</span>
<span id="cb1-8">  </span>
<span id="cb1-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccinated and unvaccinated population are well mixed</span></span>
<span id="cb1-10">  muSE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (I1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>I0) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (S1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> S0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R0)</span>
<span id="cb1-11">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon</span>
<span id="cb1-12">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma</span>
<span id="cb1-13">  </span>
<span id="cb1-14">  dS0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muSE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S0</span>
<span id="cb1-15">  dE0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muSE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E0</span>
<span id="cb1-16">  dI0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I0</span>
<span id="cb1-17">  dR0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I0</span>
<span id="cb1-18">  dC0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E0 <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## cumulative symtom onset</span></span>
<span id="cb1-19">  </span>
<span id="cb1-20">  dS1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muSE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S1</span>
<span id="cb1-21">  dE1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muSE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1</span>
<span id="cb1-22">  dI1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1</span>
<span id="cb1-23">  dR1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muIR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I1</span>
<span id="cb1-24">  dC1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  muEI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>E1 <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## cumulative symtom onset</span></span>
<span id="cb1-25">  </span>
<span id="cb1-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dS0,dE0,dI0,dR0,dC0,dS1,dE1,dI1,dR1,dC1)))</span>
<span id="cb1-27">}</span></code></pre></div>
</div>
</section>
<section id="population-b" class="level3">
<h3 class="anchored" data-anchor-id="population-b">Population B</h3>
<p>No one in the population is vaccinated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-2">pop_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N0=</span>N)</span>
<span id="cb2-3">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb2-4">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span></span>
<span id="cb2-5">epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.2</span></span>
<span id="cb2-6">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># no need for the vaccinated group</span></span>
<span id="cb2-8">y0_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0=</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb2-9">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-10">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span>tend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-11">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>epsilon, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span>gamma)</span>
<span id="cb2-12"></span>
<span id="cb2-13">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> deSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y0_B, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_2grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>params)</span>
<span id="cb2-14">pop_B_out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(out) </span></code></pre></div>
</div>
</section>
<section id="population-a" class="level3">
<h3 class="anchored" data-anchor-id="population-a">Population A</h3>
<p>A fraction <img src="https://latex.codecogs.com/png.latex?f"> of the population A received the vaccine. Vaccine efficacy is VE. Vaccination can be implemented by assuming all-or-nothing vaccine. That is, the a fraction of vaccine recipients, <img src="https://latex.codecogs.com/png.latex?N*f*%5Ctext%7BVE%7D">, are completely protected from infection. Here, <img src="https://latex.codecogs.com/png.latex?N,%20f">, and VE represent population size, the fraction of the population that is vaccinated, and vaccine efficacy, respectively. In the SEIR model, by setting the initial population size for the <img src="https://latex.codecogs.com/png.latex?R"> compartment as <img src="https://latex.codecogs.com/png.latex?N*f*%5Ctext%7BVE%7D">, we can mimic the vaccination scenario.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy on susceptibility</span></span>
<span id="cb3-2">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb3-3">N0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f)</span>
<span id="cb3-4">N1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>f</span>
<span id="cb3-5">pop_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N0=</span>N0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N1=</span>N1)</span>
<span id="cb3-6">y0_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0=</span>N0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C0=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb3-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S1=</span>N1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>VE), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R1=</span>N1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>VE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C1=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb3-8"></span>
<span id="cb3-9">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> deSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y0_A, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_2grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>params)</span>
<span id="cb3-10">pop_A_out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(out)</span></code></pre></div>
</div>
<p>Let’s compute the four VE measures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">(DVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">(IVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_B_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1118712</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">(OVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (pop_B_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2983782</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">(TVE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (pop_A_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C1"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_A[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N1"</span>]])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(pop_B_out[tend,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C0"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>pop_B[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N0"</span>]]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7335613</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">IVE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>TVE)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>DVE)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">OVE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (f<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>TVE)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>IVE))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>SEIR</category>
  <category>vaccine efficacy</category>
  <category>direct</category>
  <category>indirect</category>
  <category>total</category>
  <category>overall</category>
  <guid>https://kimfinale.github.io/myblog/posts/vaccine_effectiveness/index.html</guid>
  <pubDate>Mon, 25 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/vaccine_effectiveness/study_design.png" medium="image" type="image/png" height="130" width="144"/>
</item>
<item>
  <title>Counterintuitive effects in disease transmission dynamics</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/counterintuitive/index.html</link>
  <description><![CDATA[ 




<section id="r_0-and-the-prevalence-of-infection" class="level3">
<h3 class="anchored" data-anchor-id="r_0-and-the-prevalence-of-infection"><img src="https://latex.codecogs.com/png.latex?R_0"> and the prevalence of infection</h3>
<p><a href="https://www.science.org/doi/10.1126/science.aaa4339">An article by Heesterbeek <em>et al</em>.</a> provides a few examples on the counterintuitive behavior of a dynamical system of disease transmission. The first example was about the relationship between the intensity of transmission and the prevalence of infection, citing <a href="https://pubmed.ncbi.nlm.nih.gov/3892436/">the work by Anderson <em>et al</em>.</a>. One message from the study by Anderson <em>et al</em>. is that the effect of intervention should not be measured by the prevalence of infection. A similar message can be drawn from a simple relationship between <img src="https://latex.codecogs.com/png.latex?R_0"> and the prevalence of infection. As shown in the figure below, reducing <img src="https://latex.codecogs.com/png.latex?R_0"> from 15 to 10 may require a lot of efforts and its effect on prevalence of infection may be small.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0*s = 1 is assumed, i.e., endemic steady state</span></span>
<span id="cb1-3">prev <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R0</span>
<span id="cb1-4"></span>
<span id="cb1-5">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>R0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Prev=</span>prev)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-8">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>R0))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>prev))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prevalence of infection vs."</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">italic</span>(R)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">italic</span>(R)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prevalence"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/counterintuitive/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("R0_prevalence.png")</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Infectious diseases</category>
  <category>nonlinearity</category>
  <category>transmission dynamics</category>
  <guid>https://kimfinale.github.io/myblog/posts/counterintuitive/index.html</guid>
  <pubDate>Tue, 19 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/counterintuitive/R0_prevalence.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Prevalence vs. incidence for the SIR model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/prevalence_incidence_sirmodel/index.html</link>
  <description><![CDATA[ 




<section id="sir-model-with-constant-incidence-rate" class="level3">
<h3 class="anchored" data-anchor-id="sir-model-with-constant-incidence-rate">SIR model with constant incidence rate</h3>
<p>In the following, I implemented a simple model of disease incidence and recovery. Susceptibles are infected at a constant rate, go through the natural history of infection, and finally recover at a constant rate. Infection and recovery follow the exponential decay. This is to explore the relationship between the incidence and prevalence. If the prevalence of a disease is less than 10%, the relationship is often described as follows (e.g., see the <a href="https://sphweb.bumc.bu.edu/otlt/MPH-Modules/PH717-QuantCore/PH717-Module3-Frequency-Association/PH717-Module3-Frequency-Association5.html">link</a>): <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPrevalence%7D%20=%20%5Ctext%7BIR%7D%20%5Ctimes%20%5Ctext%7BAverage%20Duration%20of%20a%20Disease%7D%0A"> I have computed the prevalence in three ways. In particular, I assumed a short-lived infection (e.g., 2 weeks) of infectious diseases but with a long-lasting immunity. Therefore, prevalence may mean the proportion of the population immune to infection in this context. First, I use the above method. Second, I developed a simple set of differential equations to model disease incidence and recovery. Finally, I derived analytical solutions to the differential equations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prevalence according to the above equation</span></span>
<span id="cb1-2">ir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># incidence rate per 100,000 person-years</span></span>
<span id="cb1-3">dur_R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># duration of infection-derived immunity (20 years).</span></span>
<span id="cb1-4">prev <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ir <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dur_R </span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prevalence according to the differential equation</span></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note that the incidence rate (or force of infection) remains constant in this model unlike the classic SIR model.</span></span>
<span id="cb1-8">sir_beta_const <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb1-9">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb1-10">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb1-11">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-12">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb1-13">    </span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3))) </span>
<span id="cb1-15">}</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb1-17">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-18">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb1-19">dur_I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span>
<span id="cb1-20">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ir) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instantaneous rate for the yearly incidence rate, ir</span></span>
<span id="cb1-21">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(r, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dur_I, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dur_R)</span>
<span id="cb1-22">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir_beta_const, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb1-23"></span>
<span id="cb1-24"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## to explore visually as well</span></span>
<span id="cb1-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-26">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-28"></span>
<span id="cb1-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(outdf,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>time))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb1-34">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/prevalence_incidence_sirmodel/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prevalence according to analytic solutions for the ODE model</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Refer to the equations below</span></span>
<span id="cb2-3">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dur_I</span>
<span id="cb2-4">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># natural death rate, which was not implemented in the ODE model</span></span>
<span id="cb2-5">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dur_R</span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># according the following equations</span></span>
<span id="cb2-7">r_eq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>gamma)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>((gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega))</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compare three values</span></span>
<span id="cb2-10">r_eq</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01961672</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(outdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01961672</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">prev</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02</code></pre>
</div>
</div>
<p>The following Mathematica commands produce the steady state for S, I (written as Y below), R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># FullSimplify[Solve[{\[Mu]*(S+Y+R)-(r +\[Mu]) *S + \[Omega]* R==0, r *S-(\[Mu]+\[Gamma]) *Y == 0, \[Gamma]* Y-(\[Omega]+\[Mu])*R==0,S+Y+R==1, \[Mu]&gt;0,r&gt;0,\[Gamma]&gt;0,\[Omega]&gt;0, S&gt;0,Y&gt;0,R&gt;0,S\[Element]Reals,Y\[Element]Reals,R\[Element]Reals}, {S,Y,R}]]</span></span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?S%20=%20%5Cfrac%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)%7D%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)+r%20(%5Cgamma%20+%5Cmu%20+%5Comega%20)%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?I%20=%5Cfrac%7Br%20(%5Cmu%20+%5Comega%20)%7D%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)+r%20(%5Cgamma%20+%5Cmu%20+%5Comega%20)%7D"> <img src="https://latex.codecogs.com/png.latex?R%20=%20%5Cfrac%7B%5Cgamma%20%20r%7D%7B(%5Cgamma%20+%5Cmu%20)%20(%5Cmu%20+%5Comega%20)+r%20(%5Cgamma%20+%5Cmu%20+%5Comega%20)%7D"></p>


</section>

 ]]></description>
  <category>R</category>
  <category>prevalence</category>
  <category>incidence</category>
  <category>deSolve</category>
  <guid>https://kimfinale.github.io/myblog/posts/prevalence_incidence_sirmodel/index.html</guid>
  <pubDate>Mon, 11 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/prevalence_incidence_sirmodel/diffeqr_sir.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>감염병의 대유행 가능성 계산하기</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/Probabily_outbreak/index.html</link>
  <description><![CDATA[ 




<p><a href="https://www.yes24.com/Product/Goods/99051113?ReviewYn=Y">감염병 인류</a> 라는 책을 재미있게 읽는 중이다. 136페이지에는 기초감염재생산지수와 대유행의 가능성에 대한 간단한 수식이 나온다. <img src="https://latex.codecogs.com/png.latex?%5Ctext%7B%EB%8C%80%EC%9C%A0%ED%96%89%EC%9D%98%20%EA%B0%80%EB%8A%A5%EC%84%B1%7D%20=%201%20-%20%5Cfrac%7B1%7D%7BR_0%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?R_0">는 기초감염재생산지수, 즉 한 사람의 감염자가 다른 모든 사람이 감수성자 (susceptible) 일때 감염시키는 평균 감염자수를 나타낸다. 위 수식은 제한적인 경우에만 적용된다. 감염병 유입 시 대유행의 가능성에 대해 좀 더 일반적으로 적용될 수 있는 방법에 대해 적어보려고 한다. 물론 아래 내용도 상당히 이상적인 상황에 대한 기술일 뿐이고 현실은 그 보다 훨씬 더 복잡할 것이다. 감염병 유입 시 대유행의 가능성에 대한 내용은 Niels G. Becker가 저술한 <a href="https://www.amazon.com/Modeling-Infectious-Disease-Control-Biostatistics/dp/1498731066/ref=sr_1_3?crid=Q6E8KCGFJHES&amp;dib=eyJ2IjoiMSJ9.UCQn7lL_fhp-8cr31i1yvNkFiM8031ZLJrQd3oLch4MLiIGfVd7xSHYK8DxJcl2irN6hOSKXvwIBltRHfSRsMnCEZE09qU6Hj_BrGkMf45Q7EvhtR8q1EEZnjJP4ZrU8ow-Z6gIW1vhne7qQp5LiGeJsnbWorvZjpvfWu0Q-YbgfYopAUnSl95IUf0nlTDbvxm-rYGyOawJEC5BHEBXi3wsYCfLfM-F7eZW2vwT_9n8.DIMrBAhp9UdkHqkC9_69y7tViatvCC44j3phlaCTrA4&amp;dib_tag=se&amp;keywords=niels+becker&amp;qid=1709912228&amp;sprefix=niels+becker%2Caps%2C239&amp;sr=8-3">Modeling to Inform Infectious Disease Control</a>의 제 2장에 자세하게 기술되어 있다.</p>
<p>동일한 사람들로 이루어진 인구 집단에서 감염병이 퍼져나가는 현상을 생각해 보자. 한 사람이 평균적으로 <img src="https://latex.codecogs.com/png.latex?R_0"> 명을 감염시킨다고 할 때 <img src="https://latex.codecogs.com/png.latex?R_0">은 평균일뿐 후속 감염자수는 어떤 확률 분포를 가진다고 생각해볼 수 있다. 한 명의 감염자가 총 <img src="https://latex.codecogs.com/png.latex?j"> 명의 후속 감염자를 만들어 내는 확률을 <img src="https://latex.codecogs.com/png.latex?P(X=j)%20=%20p_j">라고 할 때 <img src="https://latex.codecogs.com/png.latex?R_0">는 아래와 같이 표현할 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?R_0%20=%20%5Csum_%7Bk=0%7D%5E%5Cinfty%20j%20p_j."></p>
<p>대유행의 가능성은 역으로 생각하는 것이 유리하다. 즉 대유행이 아닌 소규모의 감염으로 막을 내리는 확률, <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, 을 구한 후 대유행의 확률은 <img src="https://latex.codecogs.com/png.latex?1-%5Ctheta">로 구하는 것이다. 소규모의 감염이 일어나기 위해서는 유입된 초기 환자 (index patient)가 아무도 감염시키지 않거나 혹은 몇 명을 감염시켰다고 할지라도 후속 감염자들이 추가적으로 일으키는 감염이 소규모일때만 가능할 것이다. 즉 소규모 감염의 확률, <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, 는 아래의 식을 만족한다.</p>
<p><span id="eq-theta"><img src="https://latex.codecogs.com/png.latex?%0A%5Ctheta%20=%20%20p_0%20+%20p_1%20%5Ctheta%20+%20p_2%20%5Ctheta%5E2%20+%20...%0A%5Ctag%7B1%7D"></span></p>
<p>위 식을 보면 <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> 는 후속 감염자수가 어떠한 분포를 따르느냐에 따라 달라질 것이라 예상할 수 있다. 가장 흔히 쓰이는 분포 중의 하나인 푸아송 분포 (Poisson distribution)를 생각해보자. 화률 분포 함수는 아래와 같다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BProb%7D(X=j)%20=%20%5Cfrac%7BR%5Ej%20e%5ER%7D%7Bj!%7D%5Ctext%7B%20for%20%7D%20j=0,1,2,..."></p>
<p>이 경우 Equation&nbsp;1 의 우변은 아래와 같이 나타내어질 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bj=0%7D%5E%5Cinfty%20p_j%20%5Ctheta%5E%7Bj%7D%20=%20e%5E%7B(1-%5Ctheta)R_0%7D."></p>
<p>따라서 <img src="https://latex.codecogs.com/png.latex?%5Ctheta">는 아래의 식을 계산하면 된다. 다만 해를 직접 구할 수는 없고 수치해석방법을 이용 해서 답을 구해야 한다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20e%5E%7B(1-%5Ctheta)R_0%7D."></p>
<p>위에서 언급한 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7B%EB%8C%80%EC%9C%A0%ED%96%89%EC%9D%98%20%EA%B0%80%EB%8A%A5%EC%84%B1%7D%20=%201%20-%20%5Cfrac%7B1%7D%7BR_0%7D">는 후속 감염자수의 분포가 기하분포 (geometric distribution)를 따를때 성립한다. 기하분포는 아래와 같이 표현되 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BProb%7D(X=j)%20=%20(1-p)%5Ej%20p"></p>
<p>평균과 성공확률의 관게, <img src="https://latex.codecogs.com/png.latex?R%20=%20%5Cfrac%7B1-p%7D%7Bp%7D">, 이용하여 다시 표현하면 아래와 같다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BProb%7D(X=j)%20=%20(%5Cfrac%7BR_0%7D%7B1+R_0%7D)%5Ej%20%5Cfrac%7B1%7D%7B1+R_0%7D"> 위에서와 동일하게 계산하면 아래와 같다. <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bj=0%7D%5E%5Cinfty%20p_j%20%5Ctheta%5E%7Bj%7D%20=%20%5Cfrac%7B1%7D%7B1%20+%20(1-%5Ctheta)R_0%7D"> 따라서 아래의 식을 풀면 <img src="https://latex.codecogs.com/png.latex?%5Ctheta">를 구할 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20%5Cfrac%7B1%7D%7B1%20+%20(1-%5Ctheta)R_0%7D."></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20%5Cfrac%7B1%7D%7BR_0%7D."></p>
<p>따라서 <a href="https://www.yes24.com/Product/Goods/99051113?ReviewYn=Y">감염병 인류</a> 책에서 언급된 것처럼 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7B%EB%8C%80%EC%9C%A0%ED%96%89%EC%9D%98%20%EA%B0%80%EB%8A%A5%EC%84%B1%7D%20=%201%20-%20%5Cfrac%7B1%7D%7BR_0%7D."> 마지막으로 후속 감염자수가 이항분포 (negative binomial distribution)을 따른다고 가정해보자. 최근 연구들에서 빈번하게 언급되고 가장 현실에 가까운 가정인 듯 하다.</p>
<p>다양한 모수를 사용하여 표현할 수 있고 평균 <img src="https://latex.codecogs.com/png.latex?R_0">과 확산(dispersion; <img src="https://latex.codecogs.com/png.latex?k">)를 이용하여 나타내면 아래와 같다. 이항 분포는 <img src="https://latex.codecogs.com/png.latex?k=1">일 때는 기하분포와 동일하고 <img src="https://latex.codecogs.com/png.latex?k=%5Cinfty"> 일때는 푸아송분포와 동일하다. 코로나 19의 경우 <img src="https://latex.codecogs.com/png.latex?k"> 값이 약 <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9349569/">0.55</a>이다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BProb%7D(X=j)%20=%20%5Cfrac%7B%5CGamma(k+j)%7D%7Bj!%5CGamma(k)%7D%5Cleft(%5Cfrac%7Bk%7D%7Bk+R_0%7D%5Cright)%5Ek%5Cleft(%5Cfrac%7BR_0%7D%7Bk+R_0%7D%5Cright)%5Ej%20%5Ctext%7B%20for%20%7D%20k=0,1,2,..."> The probability of a minor outbreak, 위와 동일한 방법으로 계산하면 우변은 아래와 같다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bj=0%7D%5E%5Cinfty%20p_j%20%5Ctheta%5E%7Bj%7D%20=%20%5Cleft(%5Cfrac%7Bk%7D%7Bk%20+%20(1-%5Ctheta)R_0%7D%5Cright)%5Ek"> 따라서 <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20%5Cleft(%5Cfrac%7Bk%7D%7Bk%20+%20(1-%5Ctheta)R_0%7D%5Cright)%5Ek">를 계산하여 소규모감염의 확률을 계산하고 <img src="https://latex.codecogs.com/png.latex?1-%5Ctheta">를 계산하여 대규모유행 확률을 계산하면 된다.</p>
<p>R 시물레이션을 통해서 세방법이 어떻게 다른 결과를 나타내는지 살펴보자</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">prob_outbreak_pois <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(theta, R0){</span>
<span id="cb1-2">  theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>theta) </span>
<span id="cb1-3">}</span>
<span id="cb1-4">prob_outbreak_geo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(R0){</span>
<span id="cb1-5">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R0 </span>
<span id="cb1-6">}</span>
<span id="cb1-7">prob_outbreak_nb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(theta, R0, k){</span>
<span id="cb1-8">  theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>theta))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>k </span>
<span id="cb1-9">}</span>
<span id="cb1-10"></span>
<span id="cb1-11">Rs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb1-12">theta1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(Rs, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(rootSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">multiroot</span>(prob_outbreak_pois, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>root))</span>
<span id="cb1-14">theta2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(Rs, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prob_outbreak_geo</span>(x))</span>
<span id="cb1-15">theta3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(Rs, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) </span>
<span id="cb1-16">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(rootSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">multiroot</span>(prob_outbreak_nb, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.55</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>root))</span>
<span id="cb1-17">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(Rs,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), </span>
<span id="cb1-18">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dist=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pois"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Geom"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NB(k=0.55)"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb1-19">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob_outbreak=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>theta1,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>theta2,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>theta3))</span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-22">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, </span>
<span id="cb1-24">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(R0, prob_outbreak, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>dist))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability of a large outbreak vs."</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">italic</span>(R)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability of a large outbreak"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">italic</span>(R)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/Probabily_outbreak/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("outbreak_prob.png", units="in", width=3.4*2, height=2.7*2)  </span></span></code></pre></div>
</div>
<p>각 분포에 대한 무한 수열의 합과 <img src="https://latex.codecogs.com/png.latex?%5Ctheta">에 대한 해는 아래 Mathematica 명령어를 사용하여 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">Sum[PDF[PoissonDistribution[R],j]\[Theta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>j, {j, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, Infinity}]</span>
<span id="cb3-2">FindRoot[\[Theta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> E<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">R</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Theta])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, {\[Theta], <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>}] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. </span>
<span id="cb3-3"> R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-4">Sum[PDF[GeometricDistribution[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>R)],j]\[Theta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>j, {j, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, Infinity}]</span>
<span id="cb3-5">FindRoot[\[Theta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Theta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R \[Theta]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, {\[Theta], </span>
<span id="cb3-6">   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>}] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-7"></span>
<span id="cb3-8">FullSimplify[Sum[PDF[NegativeBinomialDistribution[k,k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>k)],i]\[Theta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>i, {i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, Infinity}],{ k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>\[Theta]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>}ㅑ</span>
<span id="cb3-9">FindRoot[\[Theta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R \[Theta]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, {\[Theta], <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>}] </span></code></pre></div>
</div>



 ]]></description>
  <category>probability of a large outbreak</category>
  <category>reproduction number</category>
  <guid>https://kimfinale.github.io/myblog/posts/Probabily_outbreak/index.html</guid>
  <pubDate>Sun, 03 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/Probabily_outbreak/outbreak_prob.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Modeling the waning of the vaccine-derived immunity in the ODE model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/vacc_waning_nls_erlang/index.html</link>
  <description><![CDATA[ 




<section id="modeling-the-waning-of-the-vaccine-derived-immunity-in-the-ode-model" class="level2">
<h2 class="anchored" data-anchor-id="modeling-the-waning-of-the-vaccine-derived-immunity-in-the-ode-model">Modeling the waning of the vaccine-derived immunity in the ODE model</h2>
<p>The use of ordinary differential equation (ODE) models to simulate disease spread and evaluate vaccine impact is growing. Waning of vaccine-derived immunity often follows an exponential distribution in these models. However, as with the case with incubation period <a href="https://pubmed.ncbi.nlm.nih.gov/19393959/">incubation period</a> that we examined in the <a href="https://www.jonghoonk.com/posts/exp_erlang_lognormal/">previous post</a>, exponential distribution may not accurately depict the waning of vaccine-derived immunity.</p>
<p>In this post, I explore how to model the waning of vaccine efficacy over time using an ODE framework, utilizing the data from a <a href="https://www.thelancet.com/journals/langlo/article/PIIS2214-109X(20)30310-7/fulltext">study by Lee <em>et al</em>.</a> Specifically, I examine how various cumulative distributions can be applied to acurately represent the diminishing percentage of of the vaccine protection over time, through the use of R code examples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data from Table S4, Lee et al. (2020) Lancet Glob Health</span></span>
<span id="cb1-2">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb1-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb1-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb1-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb1-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">76</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb1-7">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">76</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb1-8">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb1-9">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-12"></span>
<span id="cb1-13">ds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"list"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb1-14">ds[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>)</span>
<span id="cb1-15">ds[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>)</span>
<span id="cb1-16">ds[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>)</span>
<span id="cb1-17">ds[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19">fits_gamma_shape_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-22"> fits_gamma_shape_2[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-23">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-24">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-25">}</span>
<span id="cb1-26"></span>
<span id="cb1-27">fits_gamma_shape_3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-28"></span>
<span id="cb1-29"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-30"> fits_gamma_shape_3[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-31">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-32">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-33">}</span>
<span id="cb1-34"></span>
<span id="cb1-35">fits_gamma_shape_4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-36"></span>
<span id="cb1-37"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-38"> fits_gamma_shape_4[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-39">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-40">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-41">}</span>
<span id="cb1-42"></span>
<span id="cb1-43">fits_gamma_shape_5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-44"></span>
<span id="cb1-45"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-46"> fits_gamma_shape_5[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-47">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-48">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-49">}</span>
<span id="cb1-50"></span>
<span id="cb1-51">fits_gamma_shape_8 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-52"></span>
<span id="cb1-53"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-54"> fits_gamma_shape_8[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-55">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pgamma</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-56">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-57">}</span>
<span id="cb1-58"></span>
<span id="cb1-59">fits_exp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb1-60"></span>
<span id="cb1-61"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb1-62"> fits_exp[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> </span>
<span id="cb1-63">        val[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pexp</span>(month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(lograte),</span>
<span id="cb1-64">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lograte=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ds[[i]])</span>
<span id="cb1-65">}</span></code></pre></div>
</div>
<section id="gammaa-with-shape2" class="level3">
<h3 class="anchored" data-anchor-id="gammaa-with-shape2">Gammaa with shape=2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction</span></span>
<span id="cb2-2">months <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-3">newd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> months)</span>
<span id="cb2-4">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(months, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb2-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb2-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb2-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb2-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb2-9">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb2-10">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb2-11">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd)))</span>
<span id="cb2-12">                 </span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb2-14">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb2-16"></span>
<span id="cb2-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma decay with shape=2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vacc_waning_nls_erlang/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="gammaa-with-shape3" class="level3">
<h3 class="anchored" data-anchor-id="gammaa-with-shape3">Gammaa with shape=3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction</span></span>
<span id="cb3-2">months <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-3">newd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> months)</span>
<span id="cb3-4">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(months, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb3-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb3-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb3-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb3-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb3-9">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb3-10">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb3-11">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd)))</span>
<span id="cb3-12">                 </span>
<span id="cb3-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma decay with shape=3"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vacc_waning_nls_erlang/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="exponential-decay" class="level3">
<h3 class="anchored" data-anchor-id="exponential-decay">Exponential decay</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction</span></span>
<span id="cb4-2">months <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb4-3">newd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> months)</span>
<span id="cb4-4">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(months, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb4-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kid"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb4-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb4-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one dose"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb4-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb4-9">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb4-10">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb4-11">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd)))</span>
<span id="cb4-12">                 </span>
<span id="cb4-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>regimen)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential decay"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vacc_waning_nls_erlang/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Given that the data for adults following a two-dose regimen seem to be the most reliable, we evaluated the model’s residual errors in comparison to this data. The analysis of residual errors indicates that a gamma distribution with a shape parameter of 3 presents the optimal fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pexp(month, rate = exp(lograte), lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -4.09710    0.09047  -45.29 6.63e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.0643 on 10 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 6.629e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pgamma(month, shape = 2, rate = exp(lograte), 
    lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -3.18619    0.02946  -108.2   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03005 on 10 degrees of freedom

Number of iterations to convergence: 5 
Achieved convergence tolerance: 6.246e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pgamma(month, shape = 3, rate = exp(lograte), 
    lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -2.72304    0.02375  -114.7   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.02893 on 10 degrees of freedom

Number of iterations to convergence: 4 
Achieved convergence tolerance: 1.595e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_gamma_shape_4[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pgamma(month, shape = 4, rate = exp(lograte), 
    lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -2.41214    0.02884  -83.64 1.46e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.0394 on 10 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 7.874e-07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fits_gamma_shape_5[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: val ~ val[1] * pgamma(month, shape = 5, rate = exp(lograte), 
    lower.tail = FALSE)

Parameters:
        Estimate Std. Error t value Pr(&gt;|t|)    
lograte -2.17801    0.03374  -64.56 1.94e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.05009 on 10 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 9.615e-06</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction</span></span>
<span id="cb15-2">months <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb15-3">newd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> months)</span>
<span id="cb15-4">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(months, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb15-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb15-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>),</span>
<span id="cb15-7">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=2"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>),</span>
<span id="cb15-8">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=3"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>),</span>
<span id="cb15-9">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=4"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)),</span>
<span id="cb15-10">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regimen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb15-11">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_exp[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb15-12">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_2[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb15-13">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_3[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd),</span>
<span id="cb15-14">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fits_gamma_shape_4[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> newd)))</span>
<span id="cb15-15"></span>
<span id="cb15-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(dat, age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adult"</span>, regimen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two doses"</span>), </span>
<span id="cb15-18">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(month, val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>type)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two-dose vaccine efficacy for adults"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(</span>
<span id="cb15-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb15-24">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=2"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=3"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#6A3D9A"</span>,</span>
<span id="cb15-25">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=4"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FF7F00"</span>),</span>
<span id="cb15-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb15-27">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blank"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>,</span>
<span id="cb15-28">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=2"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>,</span>
<span id="cb15-29">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=3"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>,</span>
<span id="cb15-30">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=4"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>),</span>
<span id="cb15-31">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb15-32">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=2"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb15-33">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=3"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb15-34">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma w/ shape=4"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/vacc_waning_nls_erlang/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>vaccine-derived immunity</category>
  <category>waning</category>
  <category>cholera</category>
  <category>ODE</category>
  <category>exponential</category>
  <category>Gamma</category>
  <guid>https://kimfinale.github.io/myblog/posts/vacc_waning_nls_erlang/index.html</guid>
  <pubDate>Mon, 26 Feb 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/vacc_waning_nls_erlang/vacc_wane_exp_erlang.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Incremental Cost-Effectiveness Ratio (ICER)</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/ICER/index.html</link>
  <description><![CDATA[ 




<section id="understanding-the-incremental-cost-effectiveness-ratio-icer-through-cholera-vaccination" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-incremental-cost-effectiveness-ratio-icer-through-cholera-vaccination">Understanding the Incremental Cost-Effectiveness Ratio (ICER) Through Cholera Vaccination</h3>
<p>The Incremental Cost-Effectiveness Ratio (ICER) is a crucial metric in health economics, offering insights into the value of medical interventions by comparing their costs and effectiveness. Essentially, ICER is used to evaluate the cost-effectiveness of a new healthcare intervention compared to an existing standard of care. It is calculated as the difference in costs between two options divided by the difference in their effectiveness, typically measured in quality-adjusted life years (QALYs). This ratio helps policymakers and healthcare providers make informed decisions on allocating limited resources to maximize health benefits.</p>
<p>Consider the example of cholera, a severe diarrhoeal disease caused by the _/<em>Vibrio cholerae</em> bacterium, and the use of the oral cholera vaccine (OCV). In regions where cholera is endemic, introducing or expanding the use of OCV can significantly reduce the incidence of the disease. To assess the cost-effectiveness of OCV, we can compare the ICER of vaccinating a population against cholera to the standard of care, which might include treatments like rehydration solutions or antibiotics for those already infected.</p>
<p>Let’s explore how to calculate the ICER for introducing OCV in a hypothetical scenario using R. Assume we have data on the cost of vaccinating individuals and the effectiveness of the vaccine in preventing cholera, as well as the cost and effectiveness of the current standard cholera treatment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the costs and effectiveness of the oral cholera vaccine (OCV) and standard treatment</span></span>
<span id="cb1-2">cost_OCV <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Total cost of vaccinating a population</span></span>
<span id="cb1-3">effectiveness_OCV <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reduction in cholera incidence due to vaccination</span></span>
<span id="cb1-4">cost_standard <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Total cost of treating cholera without vaccination</span></span>
<span id="cb1-5">effectiveness_standard <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reduction in cholera incidence with standard treatment</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the incremental cost and effectiveness</span></span>
<span id="cb1-8">incremental_cost <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cost_OCV <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cost_standard</span>
<span id="cb1-9">incremental_effectiveness <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> effectiveness_OCV <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> effectiveness_standard</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the ICER</span></span>
<span id="cb1-12">ICER <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> incremental_cost <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> incremental_effectiveness</span></code></pre></div>
</div>
<p>This R code snippet outlines the basic calculation for ICER, where cost_OCV and effectiveness_OCV represent the cost and effectiveness of the OCV intervention, respectively, and cost_standard and effectiveness_standard represent these metrics for the standard treatment. By comparing these values, the ICER provides a dollar amount per percentage point increase in effectiveness, offering a straightforward metric for evaluating the cost-effectiveness of implementing the oral cholera vaccine in a specific population.</p>
<p>In summary, the ICER is a valuable tool in health economics, helping to guide decisions on the allocation of resources for interventions like the oral cholera vaccine. By quantifying the trade-offs between cost and effectiveness, ICER facilitates more informed, evidence-based choices in healthcare policy and practice.</p>


</section>

 ]]></description>
  <category>cholera</category>
  <category>sub-Saharan Africa</category>
  <guid>https://kimfinale.github.io/myblog/posts/ICER/index.html</guid>
  <pubDate>Sat, 24 Feb 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/ICER/sample_figure.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Implementing incubation period of cholera in the ODE model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/exp_erlang_lognormal/index.html</link>
  <description><![CDATA[ 




<section id="modeling-incubation-period-in-the-ode-model" class="level3">
<h3 class="anchored" data-anchor-id="modeling-incubation-period-in-the-ode-model">Modeling incubation period in the ODE model</h3>
<p>In the realm of infectious disease modeling, accurately simulating the incubation period–the time between exposure to a pathogen and the onset of symptoms–is crucial for understanding and predicting the spread of diseases. Classic ordinary differential equation (ODE) models often employ the exponential distribution to represent this incubation period mostly for the sake of convenience. However, the exponential distribution is not an optimal distribution to model the waiting time for the incubation period, which is often modeled as a log-normal distribution as shown in the <a href="https://pubmed.ncbi.nlm.nih.gov/19393959/">study by Lessler <em>et al</em>.</a>. In this post, I show that waiting time may be modeled more realistically by adding an extra compartment (e.g., <img src="https://latex.codecogs.com/png.latex?SE_1E_2IR"> rather than <img src="https://latex.codecogs.com/png.latex?SEIR">) and thus making the waiting time Erlang-distributed.</p>
<p>In particular, in the following R codes, I explored the incubation period of cholera from the <a href="https://www.sciencedirect.com/science/article/abs/pii/S0163445312003477#:~:text=We%20estimate%20the%20median%20incubation,CI%2C%201.3%E2%80%931.6">study by Azman <em>et al</em>.</a>. Azman writes: We estimate the median incubation period of toxigenic cholera to be 1.4 days (95% Credible Interval (CI), 1.3-1.6) with a dispersion of 1.98 (95% CI 1.87-2.11). Five percent of cholera cases will develop symptoms by 0.5 days (95% CI 0.4-0.5), and 95% by 4.4 days (95% CI 3.9-5.0) after infection.</p>
<p>Based on the description, I set the parameters for the log-normal distribution as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.40</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># median</span></span>
<span id="cb1-2">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.98</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># disperson</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qlnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meanlog =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(a), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sdlog =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(b)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5 4.3</code></pre>
</div>
</div>
<p>There is a slight mismatch for the 95th percentile (4.3 vs 4.4 [reported]). This is, however, possible considering that the estimates are from Bayesian posterior samples and I can’t account for the correlation between the parameter estimates.</p>
<p>Using this log-normal distribution, I generate samples (<img src="https://latex.codecogs.com/png.latex?n=1000">), to which exponential and Erlang distributions are fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rlnorm</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meanlog =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(a), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sdlog =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(b))</span>
<span id="cb3-2"></span>
<span id="cb3-3">fit_exp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> fitdistrplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitdist</span>(dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distr=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exp"</span>)</span>
<span id="cb3-4">fit_gam <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> fitdistrplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitdist</span>(dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distr=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>)</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qexp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span>fit_exp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1 5.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qgamma</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>fit_gam<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span>fit_gam<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4 3.9</code></pre>
</div>
</div>
<p>By examining <img src="https://latex.codecogs.com/png.latex?5%5E%7Bth%7D"> and <img src="https://latex.codecogs.com/png.latex?95%5E%7Bth%7D"> percentiles, we realize that the best-fit exponential distribution is too wide compared with the log-normal distribution whereas the Gamma distribution looks better.</p>
<p>However, in the context of ODE models, Gamma distribution is not easy to implement except for a subset in which the shape parameter is an integer (i.e., Erlang distribution). Therefore, I fit the rate parameter of the Gamma distribution while the shape parameter is set to an integer. Based on the previous fitting results (shape parameter = 2.348677), I only test the cases where the shape parameter is 2 or 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">erlang_nll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>){</span>
<span id="cb7-2">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dgamma</span>(dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>shp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span>p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb7-3">}</span>
<span id="cb7-4">er_shp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optimize</span>(erlang_nll, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-5">er_shp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optimize</span>(erlang_nll, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shp=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
</div>
<p>Considering the negative log likelihood values, we realize that the Gamma distribution with shape of 2 provides a better fit than the one with shape of 3.</p>
<p>We plot the results as a visual summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the number of</span></span>
<span id="cb8-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span>n)</span>
<span id="cb8-3">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb8-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">val =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb8-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dist =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-normal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Erlang (shape=2)"</span>), </span>
<span id="cb8-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each=</span>n), </span>
<span id="cb8-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> </span>
<span id="cb8-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dlnorm</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meanlog=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.4</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sdlog=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.98</span>)), </span>
<span id="cb8-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span>fit_exp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]), </span>
<span id="cb8-10">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dgamma</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>fit_gam<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], </span>
<span id="cb8-11">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span>fit_gam<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]), </span>
<span id="cb8-12">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dgamma</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate=</span>er_shp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>minimum)))</span>
<span id="cb8-13"></span>
<span id="cb8-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb8-15">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb8-17"></span>
<span id="cb8-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>val, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>density, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>dist))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/exp_erlang_lognormal/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The above figure clearly shows that the Erlang distribution has a better representation of reality (in this case, the log-normal distributed incubation period) than the commonly used exponential distribution.</p>


</section>

 ]]></description>
  <category>incubation period</category>
  <category>ODE</category>
  <category>cholera</category>
  <category>exponential</category>
  <category>Erlang</category>
  <guid>https://kimfinale.github.io/myblog/posts/exp_erlang_lognormal/index.html</guid>
  <pubDate>Wed, 21 Feb 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/exp_erlang_lognormal/lnorm_exp_erlang.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Mass-action assumption: density- vs. frequency-dependent transmission</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/density_frequency/index.html</link>
  <description><![CDATA[ 




<section id="density-dependent-vs.-frequency-dependent-transmission" class="level3">
<h3 class="anchored" data-anchor-id="density-dependent-vs.-frequency-dependent-transmission">Density-dependent vs.&nbsp;frequency-dependent transmission</h3>
<p>In models of transmission of directly transmitted pathogens, e.g., COVID-19, the transmission is assumed to occur via so-called <em>mass action</em> principle. It means the rate of newly infected people per unit area, per unit of time is proportional to the product between the numbers (or densities) of susceptible and infectious individuals. The term appears to be first coined by Hamer in 1906 in his <a href="https://www.sciencedirect.com/science/article/abs/pii/S0140673601801872">paper</a>. However, as indicated by <a href="https://www.sciencedirect.com/science/article/abs/pii/S0169534701021449">McCallum</a>, there have been some confusion over using the term, <em>mass action</em>. The confusion is around that mass action principle may be implemented in the manner of <em>frequency-dependent</em> or <em>density-dependent</em> transmission.</p>
<p>In the <em>density-dependent</em> transmission scenario, the rate of change in the number or density of infected individual can be implemented as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Bd%7DI%20=%20%5Cbeta%5E*%20SI%20-%20%5Cgamma%20I">.</p>
<p>In the <em>frequency-dependent</em> scenario, arguably more widely adopted one, the rate of change in the number or density of infected individual can be implemented as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Bd%7DI%20=%20%5Cbeta%20SI/N%20-%20%5Cgamma%20I"> Two formulations have different implications. The most notable difference is that there is a threshold density, <img src="https://latex.codecogs.com/png.latex?N_T"> in the <em>density-dependent</em> formulation whereas the second model leads to the basic reproduction ratio, <img src="https://latex.codecogs.com/png.latex?R_0">, is derived from <em>frequency-dependent</em>. Of course, it is straightforward to interchange between the two types of models.</p>
<p>Both <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E*"> and <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> are transmission coefficients but their unit are different. In the frequency-dependent formulation, <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> can mean the number of transmissions per unit of time for an infected individual when it contacts with susceptible individuals. Therefore, the whole term, <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20I%20S/N">, could mean that the number of newly infected individuals per unit of time. For density-dependent formulation, <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E*"> can mean the number of transmissions per unit of density per unit of time for an infected individual. The whole term <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E*%20I%20S"> can then mean the density of newly infected individuals per unit of time.</p>
<p>Now let’s implement a simple SIR model in two different formulations.</p>
<section id="density-dependent-transmission" class="level4">
<h4 class="anchored" data-anchor-id="density-dependent-transmission">Density-dependent transmission</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">sir_den <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb1-2">  new_Istar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta_star"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-3">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> new_Istar</span>
<span id="cb1-4">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> new_Istar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-5">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-6">    </span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3))) </span>
<span id="cb1-8">}</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb1-11">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb1-12">I0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb1-13">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> I0, I0, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-14">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb1-15">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta_star=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0006</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb1-16"></span>
<span id="cb1-17">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir_den, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-20">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-22"></span>
<span id="cb1-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(outdf,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>time))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb1-28">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/density_frequency/index_files/figure-html/sir_den-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># threshold host population size</span></span>
<span id="cb2-2">Nt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta_star"</span>]</span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0 can be computed through N/Nt</span></span>
<span id="cb2-4">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> pop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>Nt</span>
<span id="cb2-5"></span>
<span id="cb2-6">final_epidemic_size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb2-7">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x)</span>
<span id="cb2-8">  final_size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uniroot</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1e-6</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>root</span>
<span id="cb2-9"></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(final_size)</span>
<span id="cb2-11"></span>
<span id="cb2-12">}</span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(pop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">final_epidemic_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>R0), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 940.48</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(outdf, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 939.32</code></pre>
</div>
</div>
</section>
<section id="frequency-dependent-formulation" class="level4">
<h4 class="anchored" data-anchor-id="frequency-dependent-formulation">Frequency-dependent formulation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">sir_freq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb6-2">  new_I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb6-3">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> new_I</span>
<span id="cb6-4">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> new_I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb6-5">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb6-6">    </span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3))) </span>
<span id="cb6-8">}</span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb6-11">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb6-12">I0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb6-13">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> I0, I0, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-14">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb6-15">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb6-16"></span>
<span id="cb6-17">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir_freq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb6-18"></span>
<span id="cb6-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(outdf,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>time))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb6-24">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/density_frequency/index_files/figure-html/sir_freq-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0 threshold</span></span>
<span id="cb7-2">(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0 =</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(pop<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">final_epidemic_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>R0), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 940.48</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(outdf, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 939.32</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>mass action</category>
  <category>frequency-dependent</category>
  <category>density-dependent</category>
  <guid>https://kimfinale.github.io/myblog/posts/density_frequency/index.html</guid>
  <pubDate>Sun, 18 Feb 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/density_frequency/interval_censor.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>LabelledArrays and NamedTupleTools make it easy to use the ODE model in Julia</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/julia_labelledarrays_namedtupletools/index.html</link>
  <description><![CDATA[ 




<section id="seir-model-using-labelledarrays" class="level3">
<h3 class="anchored" data-anchor-id="seir-model-using-labelledarrays">SEIR model using LabelledArrays</h3>
<p>The <a href="https://github.com/SciML/LabelledArrays.jl">LabelledArrays</a> package makes it easy to use the ODE model in Julia. It offers a method to manage variables via keys instead of indices. Variables can be constructed using the <code>@LArray</code> macro or <code>LVector</code>.</p>
<p>However, using arrays to store a mix of information types is not optimal for performance. I frequently need to store different variable types within a single parameter, which prompts a warning, highlighting that combining variable types in an array could reduce performance and suggesting tuples as a more efficient alternative.</p>
<blockquote class="blockquote">
<p>┌ Warning: Utilizing arrays or dictionaries to store parameters of diverse types can compromise performance. │ Using tuples is advised for better efficiency. └ @ SciMLBase C:.kim.julia_warnings.jl:32</p>
</blockquote>
<p>Tuples, being essentially immutable, presents a challenge since some of model parameters that must be adjustible or estimated. The <a href="https://github.com/JeffreySarnoff/NamedTupleTools.jl">NamedTupleTools</a> package offers a convenient solution with its <code>merge</code> function, enabling easy updates to the values within a Tuple.</p>
<p>In conclusion, the best approach seems to be leveraging LabelledArrays for state variables and NamedTupleTools for parameters. Let’s delve into this approach using the SEIR model as a case study.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">using</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">LabelledArrays</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">OrdinaryDiffEq</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Plots</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">NamedTupleTools</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">BenchmarkTools</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seir</span>(du, u, p, t)</span>
<span id="cb1-4">    N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb1-5">    du.S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p.β <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> u.S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> u.I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> N</span>
<span id="cb1-6">    du.E <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p.β <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> u.S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> u.I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p.ϵ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> u.E</span>
<span id="cb1-7">    du.I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p.ϵ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> u.E <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p.γ<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> u.I</span>
<span id="cb1-8">    du.R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p.γ<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> u.I </span>
<span id="cb1-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>seir (generic function with 1 method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"></span>
<span id="cb3-2">u0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">@LArray</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>] (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>S, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>E, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>I, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>R);</span>
<span id="cb3-3">p_la <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">@LArray</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>β, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>ϵ, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>γ);</span>
<span id="cb3-4">p_la <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">LVector</span>(p_la, β<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, str<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span>, int<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, la<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">LVector</span>(a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), tp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>));</span>
<span id="cb3-5">tspan <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">100.0</span>);</span>
<span id="cb3-6">prob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir, u0, tspan, p_la);</span>
<span id="cb3-7">sol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), saveat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>);</span>
<span id="cb3-8"></span>
<span id="cb3-9">s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [sol[i].S for i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>];</span>
<span id="cb3-10"><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">e</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [sol[i].E for i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>];</span>
<span id="cb3-11">i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [sol[i].I for i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>];</span>
<span id="cb3-12">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [sol[i].R for i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>];</span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(sol.t, [s <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">e</span> i r])</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/julia_labelledarrays_namedtupletools/index_files/figure-html/unnamed-chunk-1-J1.png" class="img-fluid" width="300"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># NamedTupleTools approach</span></span>
<span id="cb4-3">p_nt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (β<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, ϵ<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, γ<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>);</span>
<span id="cb4-4">p_nt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(p_nt, (β<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, str<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span>, int<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, la<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">LVector</span>(a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), tp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)));</span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">using</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">BenchmarkTools</span></span>
<span id="cb4-7">time_la <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">@benchmark</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir, u0, tspan, p_la), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), saveat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>);</span>
<span id="cb4-8">time_nt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">@benchmark</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(seir, u0, tspan, p_nt), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), saveat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>);</span>
<span id="cb4-9">time_la</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range (min … max):  118.300 μs …  1.065 ms  ┊ GC (min … max): 0.00% … 85.42%
 Time  (median):     123.800 μs              ┊ GC (median):    0.00%
 Time  (mean ± σ):   127.737 μs ± 39.266 μs  ┊ GC (mean ± σ):  1.42% ±  4.10%

  ▁▃▂▄██▇▄▃▂▂▁            ▁▂▁                                  ▂
  █████████████▇█▇▆▆▇▇▆▅▆█████▇▇▆▄▅▅▅▄▄▅▅▆▅▄▅▆▅▅▄▄▅▄▁▅▄▆▅▄▅▆▅▆ █
  118 μs        Histogram: log(frequency) by time       180 μs &lt;

 Memory estimate: 106.75 KiB, allocs estimate: 5727.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1">time_nt</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range (min … max):  37.400 μs …  1.306 ms  ┊ GC (min … max): 0.00% … 94.58%
 Time  (median):     39.700 μs              ┊ GC (median):    0.00%
 Time  (mean ± σ):   41.141 μs ± 28.101 μs  ┊ GC (mean ± σ):  1.49% ±  2.13%

   ▁▄▆██▇▆▄▃▂▁▁▁▁▁▁▁▁▁                                        ▂
  ▅██████████████████████▇▇▆▆▆▆▆▆▅▆▇▆▆▆▆▅▅▅▁▄▃▃▅▄▁▅▃▄▃▁▁▄▄▄▃▅ █
  37.4 μs      Histogram: log(frequency) by time      62.3 μs &lt;

 Memory estimate: 28.64 KiB, allocs estimate: 685.</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>julia</category>
  <category>ODE</category>
  <category>LabelledArrays</category>
  <category>NamedTupleTools</category>
  <category>SEIR</category>
  <guid>https://kimfinale.github.io/myblog/posts/julia_labelledarrays_namedtupletools/index.html</guid>
  <pubDate>Thu, 25 Jan 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/julia_labelledarrays_namedtupletools/sciml.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>SIR model benchmarks: deSolve, odin, and diffeqr</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/sir_deSolve_odin_diffeqr/index.html</link>
  <description><![CDATA[ 




<section id="desolve-package" class="level3">
<h3 class="anchored" data-anchor-id="desolve-package">deSolve package</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">sir_deSolve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb1-2">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb1-3">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N</span>
<span id="cb1-4">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-5">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-6">    </span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3))) </span>
<span id="cb1-8">}</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb1-11">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-12">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb1-13">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb1-14"></span>
<span id="cb1-15">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir_deSolve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-18">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(outdf,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>time))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb1-26">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/sir_deSolve_odin_diffeqr/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="manual-c" class="level3">
<h3 class="anchored" data-anchor-id="manual-c">Manual C++</h3>
<p>Euler method was implemented</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">sir_cpp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb2-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">#include &lt;Rcpp.h&gt;</span></span>
<span id="cb2-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">using namespace Rcpp;</span></span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">// [[Rcpp::export]]</span></span>
<span id="cb2-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">List sir_cpp(List params) {</span></span>
<span id="cb2-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  double tau = params["tau"]; // time step size</span></span>
<span id="cb2-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  double ndays = params["ndays"]; // number of days for output</span></span>
<span id="cb2-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int nsubsteps = ceil(1/tau);</span></span>
<span id="cb2-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb2-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  NumericVector S(ndays+1);</span></span>
<span id="cb2-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  NumericVector I(ndays+1);</span></span>
<span id="cb2-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  NumericVector R(ndays+1); </span></span>
<span id="cb2-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  NumericVector time(ndays+1);</span></span>
<span id="cb2-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb2-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  S(0) = params["susceptible"];</span></span>
<span id="cb2-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  I(0) = params["infectious"];</span></span>
<span id="cb2-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  R(0) = params["recovered"];</span></span>
<span id="cb2-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb2-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  double b = params["b"]; // transmission rate per unit of time</span></span>
<span id="cb2-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  double g = params["g"]; // recovery rate</span></span>
<span id="cb2-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb2-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (int day = 0; day &lt; ndays; day++) {</span></span>
<span id="cb2-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    double St = S[day];</span></span>
<span id="cb2-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    double It = I[day];</span></span>
<span id="cb2-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    double Rt = R[day];</span></span>
<span id="cb2-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb2-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    for (int substep = 0; substep &lt; nsubsteps; substep++){</span></span>
<span id="cb2-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      double N = St + It + Rt;</span></span>
<span id="cb2-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      double foi = b * It / N;</span></span>
<span id="cb2-31"></span>
<span id="cb2-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      double StoI = St * foi * tau;</span></span>
<span id="cb2-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      double ItoR = It * g * tau;</span></span>
<span id="cb2-34"></span>
<span id="cb2-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      double dS = - StoI;</span></span>
<span id="cb2-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      double dI = + StoI - ItoR;</span></span>
<span id="cb2-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      double dR = + ItoR;</span></span>
<span id="cb2-38"></span>
<span id="cb2-39"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      St = St + dS;</span></span>
<span id="cb2-40"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      It = It + dI;</span></span>
<span id="cb2-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      Rt = Rt + dR;</span></span>
<span id="cb2-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb2-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    // Update next timestep</span></span>
<span id="cb2-44"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    S[day + 1] = St;</span></span>
<span id="cb2-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    I[day + 1] = It;</span></span>
<span id="cb2-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    R[day + 1] = Rt;</span></span>
<span id="cb2-47"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    time[day + 1] = day+1;</span></span>
<span id="cb2-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb2-49"></span>
<span id="cb2-50"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  DataFrame result = DataFrame::create(</span></span>
<span id="cb2-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Named("time") = time,</span></span>
<span id="cb2-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Named("S") = S,</span></span>
<span id="cb2-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Named("I") = I,</span></span>
<span id="cb2-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Named("R") = R);</span></span>
<span id="cb2-55"></span>
<span id="cb2-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return result;</span></span>
<span id="cb2-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}'</span></span>
<span id="cb2-58"></span>
<span id="cb2-59"></span>
<span id="cb2-60">Rcpp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cppFunction</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code=</span>sir_cpp)</span>
<span id="cb2-61"></span>
<span id="cb2-62">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb2-63">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">within</span>(params, {</span>
<span id="cb2-64">  tau <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># in days</span></span>
<span id="cb2-65">  ndays <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb2-66"></span>
<span id="cb2-67">  b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb2-68">  g <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb2-69">  </span>
<span id="cb2-70">  susceptible <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb2-71">  infectious <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb2-72">  recovered <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb2-73">})</span>
<span id="cb2-74"></span>
<span id="cb2-75">out_cpp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sir_cpp</span>(params)</span>
<span id="cb2-76"></span>
<span id="cb2-77"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(out_cpp, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>time))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-79">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-80">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-81">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb2-82">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-83">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/sir_deSolve_odin_diffeqr/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="odin-package" class="level3">
<h3 class="anchored" data-anchor-id="odin-package">odin package</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(odin)</span>
<span id="cb3-2">sir_odin <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> odin<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odin</span>({</span>
<span id="cb3-3">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Derivatives</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deriv</span>(S) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>b<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>R)</span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deriv</span>(I) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> b<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>R)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>g<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deriv</span>(R) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> g<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb3-7"></span>
<span id="cb3-8">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Initial conditions</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial</span>(S) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial</span>(I) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial</span>(R) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span></span>
<span id="cb3-12"></span>
<span id="cb3-13">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## parameters</span></span>
<span id="cb3-14">  b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">user</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)</span>
<span id="cb3-15">  g <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">user</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb3-16">})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>── R CMD INSTALL ───────────────────────────────────────────────────────────────
* installing *source* package 'odin3fe5a09e' ...
** using staged installation
** libs
using C compiler: 'gcc.exe (GCC) 12.2.0'
gcc  -I"C:/PROGRA~1/R/R-43~1.1/include" -DNDEBUG     -I"C:/rtools43/x86_64-w64-mingw32.static.posix/include"     -O2 -Wall -gdwarf-2 -mfpmath=sse -msse2 -mstackrealign  -UNDEBUG -Wall -pedantic -g -O0 -c odin.c -o odin.o
odin.c: In function 'odin_metadata':
odin.c:106:18: warning: unused variable 'internal' [-Wunused-variable]
  106 |   odin_internal *internal = odin_get_internal(internal_p, 1);
      |                  ^~~~~~~~
gcc  -I"C:/PROGRA~1/R/R-43~1.1/include" -DNDEBUG     -I"C:/rtools43/x86_64-w64-mingw32.static.posix/include"     -O2 -Wall -gdwarf-2 -mfpmath=sse -msse2 -mstackrealign  -UNDEBUG -Wall -pedantic -g -O0 -c registration.c -o registration.o
gcc -shared -static-libgcc -o odin3fe5a09e.dll tmp.def odin.o registration.o -LC:/rtools43/x86_64-w64-mingw32.static.posix/lib/x64 -LC:/rtools43/x86_64-w64-mingw32.static.posix/lib -LC:/PROGRA~1/R/R-43~1.1/bin/x64 -lR
installing to C:/Users/jonghoon.kim/AppData/Local/Temp/RtmpoVtDRD/devtools_install_60e45cff70a/00LOCK-file60e443e27d60/00new/odin3fe5a09e/libs/x64
* DONE (odin3fe5a09e)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">sir_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sir_odin<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">g=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb5-2">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb5-3">out_odin <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(sir_mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span>(tspan))</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(out_odin, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>t))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb5-10">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/sir_deSolve_odin_diffeqr/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="diffeqr-package" class="level3">
<h3 class="anchored" data-anchor-id="diffeqr-package">diffeqr package</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(diffeqr)</span>
<span id="cb6-2">de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span>
<span id="cb6-3"></span>
<span id="cb6-4">sir_julia <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb6-5">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb6-6">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N</span>
<span id="cb6-7">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb6-8">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb6-9">    </span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3))</span>
<span id="cb6-11">}</span>
<span id="cb6-12"></span>
<span id="cb6-13">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>)</span>
<span id="cb6-14">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.0</span>)</span>
<span id="cb6-15">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb6-16">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(sir_julia, u0, tspan, p)</span>
<span id="cb6-17">prob_jit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jitoptimize_ode</span>(de, prob)</span>
<span id="cb6-18"></span>
<span id="cb6-19">sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob_jit, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-20"></span>
<span id="cb6-21">mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb6-22">udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb6-23">tudf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb6-24"></span>
<span id="cb6-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(tudf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>t))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb6-30">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/sir_deSolve_odin_diffeqr/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("diffeqr_sir.png", gg, units="in", width=3.4*2, height=2.7*2)  </span></span></code></pre></div>
</div>
</section>
<section id="benchmarks" class="level3">
<h3 class="anchored" data-anchor-id="benchmarks">Benchmarks</h3>
<p>The <code>diffeqr</code> is the most efficient tool for running the SIR model in its ODE form.</p>
<p>As a side note, the test gave an unfair advantage to the <code>sir_cpp</code> due to the use of the Euler method with 0.1 day step size. In fact, <code>deSolve::ode</code> outperformed <code>sir_cpp</code> when it was used with <code>"method="euler"</code>. Therefore there is no need to write manually CPP models if an ODE solver is what you need. The situation might differ when implementing a stochastic model, which will be discussed in a later post.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(microbenchmark)</span>
<span id="cb8-2"></span>
<span id="cb8-3">benchmark <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb8-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">deSolve =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir_deSolve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p),</span>
<span id="cb8-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cpp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sir_cpp</span>(params),</span>
<span id="cb8-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">odin =</span> sir_mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span>(tspan),</span>
<span id="cb8-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">julia =</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob_jit, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb8-9">)</span>
<span id="cb8-10"></span>
<span id="cb8-11">benchmark</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: microseconds
    expr   min     lq     mean median     uq     max neval cld
 deSolve 401.2 428.35 465.7012 442.35 458.05  2894.6  1000 a  
     cpp 169.8 206.90 239.4003 234.40 251.50  2599.0  1000  b 
    odin 127.6 184.90 227.0216 208.90 253.00  4004.9  1000  b 
   julia  71.9 109.60 148.7960 130.65 144.00 15164.4  1000   c</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>ODE</category>
  <category>R</category>
  <category>deSolve</category>
  <category>odin</category>
  <category>diffeqr</category>
  <category>C++</category>
  <category>Julia</category>
  <guid>https://kimfinale.github.io/myblog/posts/sir_deSolve_odin_diffeqr/index.html</guid>
  <pubDate>Thu, 18 Jan 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/sir_deSolve_odin_diffeqr/diffeqr_sir.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>diffeqr: R interface to the Julia’s DifferentialEquations.jl</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/diffeqr/index.html</link>
  <description><![CDATA[ 




<p>Julia <a href="https://docs.sciml.ai/DiffEqDocs/stable/">DifferentialEquations.jl</a> provides an impressive collection of differential equation solvers. The DE solvers available in the package are reliable and a lot faster than what’s avaiable in R. It’s now possible to access the solvers in R thanks to the <code>diffeqr</code> package. The following codes were adapted from the <code>diffeqr</code> GitHub <a href="https://github.com/SciML/diffeqr">page</a>.</p>
<section id="desolve-package" class="level3">
<h3 class="anchored" data-anchor-id="desolve-package">deSolve package</h3>
<p>I am using the SIR model as an example and for speed comparison, first solving equations using the <a href="https://desolve.r-forge.r-project.org/">deSolve</a> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">sir_deSolve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, u, p){</span>
<span id="cb1-2">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb1-3">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N</span>
<span id="cb1-4">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-5">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-6">    </span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1, du2, du3))) </span>
<span id="cb1-8">}</span></code></pre></div>
</div>
<p>Let’s sovel the model using the <code>deSolve::ode</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb2-2">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-3">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-4">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb2-5"></span>
<span id="cb2-6">outdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>tspan, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir_deSolve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>p))</span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb2-9">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(outdf,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>time))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb2-17">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/diffeqr/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="diffeqr-package" class="level3">
<h3 class="anchored" data-anchor-id="diffeqr-package">diffeqr package</h3>
<p>Now let’s use the <code>diffeqr</code> package. Once the <code>de &lt;- diffeqr::diffeq_setup</code> is executed, the functions for DifferentialEquations.jl are available through <code>de$</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(diffeqr)</span>
<span id="cb3-2">de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span></code></pre></div>
</div>
<p>diffeqr has slightly different convention.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">sir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb4-2">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb4-3">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N</span>
<span id="cb4-4">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb4-5">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb4-6">    </span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3))</span>
<span id="cb4-8">}</span>
<span id="cb4-9"></span>
<span id="cb4-10">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>)</span>
<span id="cb4-11">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.0</span>)</span>
<span id="cb4-12">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb4-13">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(sir, u0, tspan, p)</span>
<span id="cb4-14">sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-15"></span>
<span id="cb4-16">mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u,identity)</span>
<span id="cb4-17">udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb4-18">tudf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb4-19"></span>
<span id="cb4-20">tudflong <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(tudf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb4-21">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"var"</span>, </span>
<span id="cb4-22">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>)</span>
<span id="cb4-23"></span>
<span id="cb4-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(tudf,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>t))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb4-29">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/diffeqr/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The ODE model can be sped up after compiling usng the just-in-time (JIT) compiler.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">prob_jit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jitoptimize_ode</span>(de, prob)</span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sol &lt;- de$solve(prob_jit, de$Tsit5(), saveat=1);</span></span></code></pre></div>
</div>
<p>The ODE model can be sped up even further by running it on the GPU. The <a href="https://github.com/SciML/diffeqr">GitHub page</a> is more geared toward the case in which runing the model multiple times over different initial conditions, which is called ensemble solve. This is why the term ensemble is used below. However, we use the same initial conditions as our sole purpose is to run the model multiple times and compare the elapsed time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">prob_func <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (prob, i, rep){</span>
<span id="cb6-2">  de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remake</span>(prob, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">u0=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>p)</span>
<span id="cb6-3">}</span>
<span id="cb6-4">prob_ens <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">EnsembleProblem</span>(prob_jit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob_func=</span>prob_func, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">safetycopy=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sol &lt;- de$solve(prob_ens, de$Tsit5(), de$EnsembleSerial(), trajectories=1, saveat=1);</span></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to take the full advantage we need the following.</span></span>
<span id="cb6-7">degpu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeqgpu_setup</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CUDA"</span>)</span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># de$solve(prob_ens, degpu$GPUTsit5(), degpu$EnsembleGPUKernel(degpu$CUDABackend()), trajectories=niter, saveat=1);</span></span></code></pre></div>
</div>
<p>I stop here but further performance enhancements are possible if your problem can make use of parallel computing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(microbenchmark)</span>
<span id="cb7-2">niter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span></span>
<span id="cb7-3"></span>
<span id="cb7-4">benchmark <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb7-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">deSolve =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>u0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir_deSolve, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)), </span>
<span id="cb7-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diffeqr =</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diffeqr_jit =</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob_jit, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diffeqr_ens =</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob_ens, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">EnsembleSerial</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trajectories=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>niter</span>
<span id="cb7-10">)</span>
<span id="cb7-11"></span>
<span id="cb7-12">benchmark</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: microseconds
        expr     min       lq      mean   median       uq       max neval cld
     deSolve 604.601 660.6515  735.1354 682.3505 707.7515    3790.8  1000   a
     diffeqr 769.601 799.1505  903.3603 831.7010 871.6505    5971.4  1000   a
 diffeqr_jit  84.501  99.2010  177.8533 112.8010 136.6005   46489.0  1000   a
 diffeqr_ens 185.601 216.7010 2667.6595 242.2505 277.0510 2389143.8  1000   a</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GPU version requires a different framework to test the speed</span></span>
<span id="cb9-2">telapsed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.time</span>(de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob_ens, degpu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GPUTsit5</span>(), degpu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">EnsembleGPUKernel</span>(degpu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CUDABackend</span>()), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trajectories=</span>niter, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb9-3"></span>
<span id="cb9-4">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">routine=</span>benchmark<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>expr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time=</span>benchmark<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time)</span>
<span id="cb9-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_violin</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>routine,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>time))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_log10</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e8</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept=</span>telapsed[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>telapsed[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb9-11">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diffeqr"</span>,</span>
<span id="cb9-12">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPU diffeqr"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/diffeqr/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("diffeqr_benchmark.png", gg, units="in", width=3.4*2, height=2.7*2)  </span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>differential equation</category>
  <category>julia</category>
  <category>DifferentialEquations.jl</category>
  <category>diffeqr</category>
  <guid>https://kimfinale.github.io/myblog/posts/diffeqr/index.html</guid>
  <pubDate>Sun, 14 Jan 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/diffeqr/diffeqr_benchmark.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Universal differential equation using Julia</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index.html</link>
  <description><![CDATA[ 




<section id="universal-differential-equation-ude" class="level3">
<h3 class="anchored" data-anchor-id="universal-differential-equation-ude">Universal differential equation (UDE)</h3>
<p>The <a href="https://docs.sciml.ai/Overview/stable/showcase/missing_physics/">UDE</a> refers to an approach to embed the machine learning into differential equations. The resulting UDE has some parts of the equation replaced by <strong>universal approximators</strong> i.e., neural network (NN). The UDE model approach allows us to approximate a wide, if not infinite, variety of functional relationships. As an example, I will test how well the UDE model approach will approximate a <a href="https://www.jonghoonk.com/posts/sub-exponential-growth/index.html">sub-exponential growth model</a>, which is challenging to fit if we use an exponential growth model.</p>
<p>I am using Julia for the UDE approach as it appeared that the Julia is the most advanced in this regard.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SciML (Scientific Machine Learning) Tools</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">using</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">OrdinaryDiffEq</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">SciMLSensitivity</span></span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">using</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Optimization</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">OptimizationOptimisers</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">OptimizationOptimJL</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard Libraries</span></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">using</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">LinearAlgebra</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Statistics</span></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># External Libraries</span></span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">using</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ComponentArrays</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Lux</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Zygote</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Plots</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">StableRNGs</span></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gr</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Plots.GRBackend()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set a random seed for reproducible behaviour</span></span>
<span id="cb3-3">rng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">StableRNG</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1111</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>StableRNGs.LehmerRNG(state=0x000000000000000000000000000008af)</code></pre>
</div>
</div>
</section>
<section id="data-generation" class="level3">
<h3 class="anchored" data-anchor-id="data-generation">Data generation</h3>
<p>The SIR model with a sub-exponential growth is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sir_subexp!</span>(du, u, p, t)</span>
<span id="cb5-2">    α, β, γ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p </span>
<span id="cb5-3">    du[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> β<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>α</span>
<span id="cb5-4">    du[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> β<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>α <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> γ<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb5-5">    du[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> γ<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb5-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sir_subexp! (generic function with 1 method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the experimental parameter</span></span>
<span id="cb7-3">tspan <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20.0</span>);</span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># u0 = 5.0f0 * rand(rng, 2)</span></span>
<span id="cb7-5">u0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>];</span>
<span id="cb7-6">p_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>];</span>
<span id="cb7-7">prob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(sir_subexp!, u0, tspan, p_);</span>
<span id="cb7-8">solution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), abstol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-12</span>, reltol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-12</span>, saveat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>);</span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add noise in terms of the mean</span></span>
<span id="cb7-11">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Array</span>(solution);</span>
<span id="cb7-12">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> solution.t;</span>
<span id="cb7-13"></span>
<span id="cb7-14">xbar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(X, dims<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>);   </span>
<span id="cb7-15">noise_magnitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5e-2</span>;</span>
<span id="cb7-16">Xn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.+</span> (noise_magnitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> xbar) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">randn</span>(rng, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eltype</span>(X), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">size</span>(X));</span>
<span id="cb7-17"></span>
<span id="cb7-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(solution, alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>black, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True Data"</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">nothing</span>]);</span>
<span id="cb7-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scatter!</span>(t, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>(Xn), color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>red, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Noisy Data"</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">nothing</span>])</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index_files/figure-html/unnamed-chunk-2-J1.png" class="img-fluid" width="300"></p>
</div>
</div>
</section>
<section id="ude-model" class="level3">
<h3 class="anchored" data-anchor-id="ude-model">UDE model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Let's define our Universal Differential eqution</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbf</span>(x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>.(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">-</span>(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.^</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>));</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multilayer FeedForward</span></span>
<span id="cb8-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">const</span> U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Lux.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Chain</span>(Lux.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dense</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, rbf), Lux.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dense</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, rbf), </span>
<span id="cb8-6">Lux.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dense</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, rbf), Lux.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dense</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain(
    layer_1 = Dense(3 =&gt; 5, rbf),       # 20 parameters
    layer_2 = Dense(5 =&gt; 5, rbf),       # 30 parameters
    layer_3 = Dense(5 =&gt; 5, rbf),       # 30 parameters
    layer_4 = Dense(5 =&gt; 1),            # 6 parameters
)         # Total: 86 parameters,
          #        plus 0 states.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the initial parameters and state variables of the model</span></span>
<span id="cb10-2">p, st <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Lux.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setup</span>(rng, U)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>((layer_1 = (weight = Float32[-0.11597705 -0.5499123 0.10071843; -0.20088743 0.5602648 0.2718303; … ; -0.22440201 -0.57859105 0.7904316; -0.4619576 -0.62989676 0.18545352], bias = Float32[0.0; 0.0; … ; 0.0; 0.0;;]), layer_2 = (weight = Float32[-0.043933477 -0.21508422 … 0.55779475 0.5849693; 0.0011237671 0.006483868 … 0.27549765 -0.2874395; … ; 0.5079049 -0.36002874 … 0.41297784 -0.5777891; -0.5179172 -0.60432595 … -0.18625909 0.06577149], bias = Float32[0.0; 0.0; … ; 0.0; 0.0;;]), layer_3 = (weight = Float32[0.21934992 0.20916325 … -0.357856 -0.27426103; 0.59777355 -0.04514681 … 0.22668682 0.73459923; … ; 0.36797842 0.13955377 … 0.28912562 0.20840885; -0.33154675 0.035615936 … 0.011346816 -0.13401343], bias = Float32[0.0; 0.0; … ; 0.0; 0.0;;]), layer_4 = (weight = Float32[-0.49593353 -0.68478346 … -0.4632702 -0.1476636], bias = Float32[0.0;;])), (layer_1 = NamedTuple(), layer_2 = NamedTuple(), layer_3 = NamedTuple(), layer_4 = NamedTuple()))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">const</span> _st <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(layer_1 = NamedTuple(), layer_2 = NamedTuple(), layer_3 = NamedTuple(), layer_4 = NamedTuple())</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"></span>
<span id="cb14-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the hybrid model</span></span>
<span id="cb14-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ude_dynamics!</span>(du, u, p, t, p_true)</span>
<span id="cb14-4">    û <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">U</span>(u, p, _st)[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Network prediction</span></span>
<span id="cb14-5">    du[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> û[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb14-6">    du[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dI <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> û[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p_true[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] </span>
<span id="cb14-7">    du[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p_true[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] </span>
<span id="cb14-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ude_dynamics! (generic function with 1 method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"></span>
<span id="cb16-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Closure with the known parameter</span></span>
<span id="cb16-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_dynamics!</span>(du, u, p, t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ude_dynamics!</span>(du, u, p, t, p_)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>nn_dynamics! (generic function with 1 method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the problem</span></span>
<span id="cb18-2">prob_nn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(nn_dynamics!, Xn[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], tspan, p)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ODEProblem with uType Vector{Float64} and tType Float64. In-place: true
timespan: (0.0, 20.0)
u0: 3-element Vector{Float64}:
 1.0239505612968622
 0.0034985090690380412
 0.00031492340046744696</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"></span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I don't understand the details of the algorithm</span></span>
<span id="cb20-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sensealg=QuadratureAdjoint(autojacvec=ReverseDiffVJP(true))</span></span>
<span id="cb20-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I just adopted what's provided in the web page: </span></span>
<span id="cb20-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https://docs.sciml.ai/Overview/stable/showcase/missing_physics/</span></span>
<span id="cb20-6">    </span>
<span id="cb20-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(θ, X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Xn[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t)</span>
<span id="cb20-8">    _prob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remake</span>(prob_nn, u0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X, tspan <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (T[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], T[<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span>]), p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> θ)</span>
<span id="cb20-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Array</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(_prob, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), saveat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T,</span>
<span id="cb20-10">                abstol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>, reltol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>,</span>
<span id="cb20-11">                sensealg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">QuadratureAdjoint</span>(autojacvec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ReverseDiffVJP</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">true</span>))))</span>
<span id="cb20-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>predict (generic function with 3 methods)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"></span>
<span id="cb22-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loss</span>(θ)</span>
<span id="cb22-3">    Xhat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(θ)</span>
<span id="cb22-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(abs2, Xn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.-</span> Xhat)</span>
<span id="cb22-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>loss (generic function with 1 method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"></span>
<span id="cb24-2">losses <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Float64</span>[];</span>
<span id="cb24-3"></span>
<span id="cb24-4">callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (p, l)</span>
<span id="cb24-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push!</span>(losses, l)</span>
<span id="cb24-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(losses) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb24-7">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Current loss after </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(losses))<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> iterations: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>(losses[<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span>])<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb24-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span>
<span id="cb24-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb24-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#125 (generic function with 1 method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"></span>
<span id="cb26-2">adtype <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Optimization.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AutoZygote</span>();</span>
<span id="cb26-3">optf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Optimization.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">OptimizationFunction</span>((x, p) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loss</span>(x), adtype);</span>
<span id="cb26-4">optprob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Optimization.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">OptimizationProblem</span>(optf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ComponentVector</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{Float64}</span>(p));</span>
<span id="cb26-5"></span>
<span id="cb26-6">mxiter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1">res1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Optimization.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(optprob, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ADAM</span>(), callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> callback, maxiters <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mxiter);</span>
<span id="cb28-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Training loss after </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(losses))<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> iterations: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>(losses[<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span>])<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training loss after 2001 iterations: 0.0015564208688977953</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"></span>
<span id="cb30-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># You can optimize further by using LBFGS</span></span>
<span id="cb30-3">optprob2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Optimization.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">OptimizationProblem</span>(optf, res1.u)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OptimizationProblem. In-place: true
u0: ComponentVector{Float64}(layer_1 = (weight = [-0.05170182389781148 -0.6044817578829536 0.030221881765418415; -0.3212356181883164 0.6510350091355674 0.44802414727952533; … ; -0.2971002151491799 -0.5198718000300768 0.8494439396527995; -0.5240838499404261 -0.5805885464635301 0.2207764494806622], bias = [0.07034258756546354; -0.1248750018555649; … ; -0.10460911230309018; -0.09231330051973555;;]), layer_2 = (weight = [-0.16444552836939919 -0.3914934840987012 … 0.4595876886814785 0.48596336484236335; 0.061104866379551544 0.09809356182285524 … 0.3325709332030265 -0.23929486434292638; … ; 0.44222617028560024 -0.07489082174986872 … 0.38613240122330794 -0.609809451956525; -0.42554673750885325 -0.3912678259711914 … -0.0705070098211834 0.1835005315863163], bias = [-0.1024237112798211; 0.05522672749980388; … ; -0.06460784045513147; 0.08515934187060795;;]), layer_3 = (weight = [0.30753421402720227 0.29471143354807966 … -0.26966507778103693 -0.19068344291262843; 0.6803575575882911 0.035025314411197044 … 0.3095389929940732 0.8122600471132518; … ; 0.4338542747330682 0.20165221719458867 … 0.3525999208278827 0.27010233878411616; -0.20708092822357524 0.1890743367618981 … 0.16598038476857452 -0.0012012794517766243], bias = [0.0853924513699166; 0.08006728472122455; … ; 0.061942487865868964; 0.1530663635694471;;]), layer_4 = (weight = [-0.4208452558700493 -0.6144846254336126 … -0.40340199958423073 -0.06553529479079494], bias = [0.09174711461758511;;]))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1">res2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Optimization.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(optprob2, Optim.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">LBFGS</span>(), callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> callback, maxiters <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>);</span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Final training loss after </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(losses))<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> iterations: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>(losses[<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span>])<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Final training loss after 3002 iterations: 0.0003723725121765437</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"></span>
<span id="cb34-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename the best candidate</span></span>
<span id="cb34-3">p_trained <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> res2.u</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ComponentVector{Float64}(layer_1 = (weight = [0.1316220200349473 -0.6520282050791907 0.008318466489230203; -0.4557052571206415 0.852778797405868 0.6422456105470944; … ; -0.3017967416294747 -0.3539416097805037 0.9435890641280813; -0.6208672577811719 -0.8250782773685028 0.463368746591991], bias = [0.1811403798125198; 0.1295565740621664; … ; 0.14387087901155535; -0.1883283800836187;;]), layer_2 = (weight = [-0.5224273510619183 -0.7851736034397837 … 0.13246567539583712 0.28492163069656595; 0.2121727337798046 0.2580716617374057 … 0.46828242306889367 -0.18639886649813667; … ; 0.31182369287889583 -0.13443324204943075 … 0.18614501798809488 -0.9123175434094871; -0.5023288426177288 -0.4943627237480249 … -0.05984671314326837 0.14167837142544432], bias = [-0.4580492880391406; 0.2156300092628208; … ; -0.18292941364366094; 0.014071394516324979;;]), layer_3 = (weight = [0.17533364576159247 0.2053893580840498 … -0.3080681971901958 -0.3356279391033146; 0.7087531824294593 0.0960694141143031 … 0.3481334453513509 0.8277491605925765; … ; 0.4365583552750147 0.20075642462931304 … 0.37058208065336945 0.2762370994412038; -0.18955475880245964 0.23766428666711154 … 0.23703263569676214 0.011769794045616492], bias = [-0.11836077082556237; 0.07082483083187767; … ; 0.058396858004157386; 0.15828264366434497;;]), layer_4 = (weight = [-0.39882746395912166 -0.6321529793894407 … -0.38424206982191056 -0.18894617437931902], bias = [0.4328709022831265;;]))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"></span>
<span id="cb36-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the losses</span></span>
<span id="cb36-3">pl_losses <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>mxiter, losses[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>mxiter], yaxis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>log10, xaxis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>log10,</span>
<span id="cb36-4">                 xlabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Iterations"</span>, ylabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loss"</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ADAM"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>blue)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index_files/figure-html/unnamed-chunk-3-J1.png" class="img-fluid" width="300"></p>
</div>
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot!</span>((mxiter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(losses), losses[(mxiter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span>], yaxis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>log10, xaxis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>log10,</span>
<span id="cb37-2">      xlabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Iterations"</span>, ylabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loss"</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BFGS"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>red)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index_files/figure-html/unnamed-chunk-3-J2.png" class="img-fluid" width="300"></p>
</div>
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"></span>
<span id="cb38-2"></span>
<span id="cb38-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Analysis of the trained network</span></span>
<span id="cb38-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the data and the approximation</span></span>
<span id="cb38-5">ts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">first</span>(solution.t)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(solution.t)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">last</span>(solution.t)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0:0.5:20.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1">Xhat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(p_trained, Xn[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], ts)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3×41 Matrix{Float64}:
 1.02395      1.0072      0.991471    …  0.150335  0.140635  0.13015
 0.00349851   0.0190933   0.0322405      0.163083  0.156799  0.151863
 0.000314923  0.00146965  0.00405242     0.714346  0.73033   0.745751</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb42-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Trained on noisy data vs real solution</span></span>
<span id="cb42-2">pl_trajectory <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(ts, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>(Xhat), xlabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>, </span>
<span id="cb42-3">                     ylabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S(t), I(t), R(t)"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>red,</span>
<span id="cb42-4">                     label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UDE Approximation"</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">nothing</span>])</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index_files/figure-html/unnamed-chunk-3-J3.png" class="img-fluid" width="300"></p>
</div>
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scatter!</span>(solution.t, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>(Xn), color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>black, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Measurements"</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">nothing</span>])</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index_files/figure-html/unnamed-chunk-3-J4.png" class="img-fluid" width="300"></p>
</div>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb44-1"></span>
<span id="cb44-2"></span>
<span id="cb44-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ideal unknown interactions of the predictor</span></span>
<span id="cb44-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ybar = [-p_[2] * (Xhat[1, :] .* Xhat[2, :])'; p_[3] * (Xhat[1, :] .* Xhat[2, :])']</span></span>
<span id="cb44-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ybar = [p_[2] .* Xhat[1,:] .* (Xhat[2,:].^p_[1])]</span></span>
<span id="cb44-6">Ybar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>([p_[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Xhat[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (Xhat[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,i]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.^</span>p_[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) for i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">∈</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span>, j <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">∈</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1×41 transpose(::Matrix{Float64}) with eltype Float64:
 0.00444064  0.0169778  0.0254133  …  0.0140944  0.012777  0.0115257</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Neural network guess</span></span>
<span id="cb46-2">Yhat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">U</span>(Xhat, p_trained, st)[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1×41 Matrix{Float64}:
 0.0351306  0.0321994  0.0309596  …  0.018876  0.0200484  0.0220433</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb48-1"></span>
<span id="cb48-2">pl_reconstruction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(ts, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>(Yhat), xlabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>, </span>
<span id="cb48-3">                         ylabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"U(S,I,R)"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>red,</span>
<span id="cb48-4">                         label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UDE Approximation"</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">nothing</span>]);</span>
<span id="cb48-5"></span>
<span id="cb48-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot!</span>(ts, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>(Ybar), color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>black, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True Interaction"</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">nothing</span>])</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index_files/figure-html/unnamed-chunk-3-J5.png" class="img-fluid" width="300"></p>
</div>
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb49-1"></span>
<span id="cb49-2"></span>
<span id="cb49-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the error</span></span>
<span id="cb49-4">pl_reconstruction_error <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(ts, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">norm</span>.(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eachcol</span>(Ybar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Yhat)), yaxis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>log, xlabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>,</span>
<span id="cb49-5">                               ylabel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L2-Error"</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">nothing</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>red);</span>
<span id="cb49-6">pl_missing <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pl_reconstruction, pl_reconstruction_error, layout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>));</span>
<span id="cb49-7"></span>
<span id="cb49-8">pl_overall <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pl_trajectory, pl_missing)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index_files/figure-html/unnamed-chunk-3-J6.png" class="img-fluid" width="300"></p>
</div>
</div>


</section>

 ]]></description>
  <category>universal differential equation</category>
  <category>julia</category>
  <category>sub-exponential growth</category>
  <guid>https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/index.html</guid>
  <pubDate>Thu, 11 Jan 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/universal_differential_eqn_julia/ude_obs.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Template</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/oral_cholera_vacc_cov/index.html</link>
  <description><![CDATA[ 




<section id="oral-cholera-vaccine" class="level3">
<h3 class="anchored" data-anchor-id="oral-cholera-vaccine">Oral cholera vaccine</h3>
<p>Assumption - Vaccination is implemented in a all-or-nothing fashion - Two-dose efficacy is <img src="https://latex.codecogs.com/png.latex?VE"> - The first-dose efficacy is <img src="https://latex.codecogs.com/png.latex?ve_1"></p>
<p>What the efficacy of the second vaccine dose, <img src="https://latex.codecogs.com/png.latex?ve_2">, has to be if the want the same number of people is averted,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to make it reproducible</span></span>
<span id="cb1-2">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb1-3">VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy under two dose regimen</span></span>
<span id="cb1-4">vacc_cov <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine coverage</span></span>
<span id="cb1-5">ve1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># efficacy of the first dose</span></span>
<span id="cb1-6"></span>
<span id="cb1-7">vacc_protected_VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> VE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb1-8">vacc_protected_ve1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> ve1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb1-9">vacc_protected_ve_ve2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> vacc_protected_ve1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (VE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ve1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span></code></pre></div>
</div>
</section>
<section id="implementing-the-first-and-the-seocond-dose-separately" class="level3">
<h3 class="anchored" data-anchor-id="implementing-the-first-and-the-seocond-dose-separately">Implementing the first and the seocond dose separately</h3>
<p>Suppose that a population size is <img src="https://latex.codecogs.com/png.latex?N"> and the vaccine coverage, <img src="https://latex.codecogs.com/png.latex?0%3C=v%3C=1">. We introduce a parameter, <img src="https://latex.codecogs.com/png.latex?%5Cpi">, to represent the proportion of the first-dose recipients who receive the second dose. If <img src="https://latex.codecogs.com/png.latex?%5Cpi=1">, the number of vaccine recipients is <img src="https://latex.codecogs.com/png.latex?Nv"> and the number of two-dose recipients is also <img src="https://latex.codecogs.com/png.latex?Nv"> and the number of vaccinees who only received a single dose is zero. More generally, however, if <img src="https://latex.codecogs.com/png.latex?%5Cpi%20%3C%201">, the number of complete two-dose recipients is <img src="https://latex.codecogs.com/png.latex?Nv%5Cpi"> and those who have only received one dose is <img src="https://latex.codecogs.com/png.latex?2Nv(1-%5Cpi)">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to make it reproducible</span></span>
<span id="cb2-2">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb2-3">ve2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine efficacy under two dose regimen</span></span>
<span id="cb2-4">ve1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># efficacy of the first dose</span></span>
<span id="cb2-5">vacc_cov <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine coverage</span></span>
<span id="cb2-6">pi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># proportion of the first-dose recipients who again received the second dose</span></span>
<span id="cb2-7">vacc_protected_ve2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> ve2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb2-8">vacc_protected_ve1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> ve1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb2-9">vacc_protected_ve1_ve2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb2-10">  pi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(vacc_protected_ve1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (ve2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ve1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pi)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>ve1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N</span>
<span id="cb2-11"></span>
<span id="cb2-12">vacc_protected_ve1</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 240</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">vacc_protected_ve1_ve2</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 480</code></pre>
</div>
</div>
<p>These are estimates and algebraic relationship wouldn’t hold. $$ <img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0Ac_2%20&amp;=%20v_1%20%5Cpi%20%5C%5C%0Ac_%7B1+%7D%20&amp;=%20v_1%20%5Cpi%20+%20v_1(1-%5Cpi)%20+%20v_2(1-%5Cpi%20v_1/v_2)%0A%0A%5Cend%7Balign%7D"> $$ <img src="https://latex.codecogs.com/png.latex?c_2"> and <img src="https://latex.codecogs.com/png.latex?c_%7B1+%7D"> represent coverage for complete two-dose regiment and at least one dose, respectively. <img src="https://latex.codecogs.com/png.latex?%5Cpi"> represents the proportion of the vaccinees who received the first dose and went on to receive the second dose.</p>
<p>Estimates from Pezzolli et al.&nbsp;(2020)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">cov_first <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">90.3</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># v_1</span></span>
<span id="cb6-2">cov_second <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">88.2</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># v_2</span></span>
<span id="cb6-3">cov_two <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">69.9</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#c_2</span></span>
<span id="cb6-4">cov_one_plus <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">84.6</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#c_1+</span></span></code></pre></div>
</div>
<p>Boundary conditions for the pi for the vr1plus must not be bigger than 1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create a function that calculates </span></span>
<span id="cb7-2">ocv_round_cov_calc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vc1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vc2=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vr1plus=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vr2=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>){</span>
<span id="cb7-3">  </span>
<span id="cb7-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (pi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (vc1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>vc2<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>vc1) {</span>
<span id="cb7-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pi must be larger than (vc1+vc2-1)/vc1, "</span>, (vc1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>vc2<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>vc1))</span>
<span id="cb7-6">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (pi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> (vc2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>vc1)) {</span>
<span id="cb7-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pi must be smaller than vc2/vc1, "</span>, vc2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>vc1))</span>
<span id="cb7-8">  }</span>
<span id="cb7-9">  vr2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> vc1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pi  </span>
<span id="cb7-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vr1plus = vc1*pi + vc1*(1-pi) + vc2*(1-pi*vc1/vc2)</span></span>
<span id="cb7-11">  vr1plus <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> vr2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> vc1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> vc2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>vc1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>vc2) </span>
<span id="cb7-12">  vr1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> vr1plus <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> vr2</span>
<span id="cb7-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TODO</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> there are several limiting conditions</span></span>
<span id="cb7-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vaccine coverage is </span></span>
<span id="cb7-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vr1plus=</span>vr1plus, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vr2=</span>vr2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vr1=</span>vr1))</span>
<span id="cb7-16">}</span>
<span id="cb7-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ocv_round_cov_calc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vc1=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.56</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vc2=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.46</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vr1plus=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vr2=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$vr1plus
[1] 0.572

$vr2
[1] 0.448

$vr1
[1] 0.124</code></pre>
</div>
</div>
<p>When the first dose is distributed, apply the When the second dose is distributed, identify the number of two-dose and one-dose recipients and compare that number with the previous round</p>
</section>
<section id="summarize-results" class="level3">
<h3 class="anchored" data-anchor-id="summarize-results">Summarize results</h3>


</section>

 ]]></description>
  <category>oral cholera vaccine</category>
  <category>all-or-nothing</category>
  <category>vaccine efficacy</category>
  <guid>https://kimfinale.github.io/myblog/posts/oral_cholera_vacc_cov/index.html</guid>
  <pubDate>Mon, 08 Jan 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/oral_cholera_vacc_cov/sample_figure.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Fitting a straight line in Julia: Flux machine learning</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/fit_a_straight_line_julia/index.html</link>
  <description><![CDATA[ 




<section id="fitting-a-straight-line-in-julia" class="level3">
<h3 class="anchored" data-anchor-id="fitting-a-straight-line-in-julia">Fitting a straight line in Julia</h3>
<p>This post is my attempt to learn machine learning in Julia. The contents of this page came from the <a href="https://fluxml.ai/Flux.jl/stable/models/overview/">Flux</a>. <code>Flux</code> is a machine learning package written in Julia.</p>
</section>
<section id="create-training-and-test-data" class="level3">
<h3 class="anchored" data-anchor-id="create-training-and-test-data">Create training and test data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">using</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Flux</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Distributions</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Random</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Statistics</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create the data</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true parameter values are 4 and 2</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linear_model</span>(x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rand</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Normal</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>linear_model (generic function with 1 method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"></span>
<span id="cb3-2">x_train, x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hcat</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hcat</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>([0 1 … 4 5], [6 7 … 9 10])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1">y_train, y_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linear_model</span>.(x_train), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linear_model</span>.(x_test)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>([1.552234290757838 5.997621972031162 … 17.799006293669162 21.987462504032138], [26.82759499486528 28.113859596390927 … 38.71844108675521 43.89937704938766])</code></pre>
</div>
</div>
</section>
<section id="create-a-neural-network-model-with-a-single-layer" class="level3">
<h3 class="anchored" data-anchor-id="create-a-neural-network-model-with-a-single-layer">Create a neural network model with a single layer</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># y = σ.(W * x .+ bias) </span></span>
<span id="cb7-2">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Flux.<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dense</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2 parameters</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dense(1 =&gt; 1)       # 2 parameters</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction based on the untrained baseline model </span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model</span>(x_train)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1×6 Matrix{Float32}:
 0.0  -0.230685  -0.461369  -0.692054  -0.922739  -1.15342</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"></span>
<span id="cb11-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define the loss function to use it for training</span></span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loss</span>(m, x, y) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs2</span>.(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m</span>(x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.-</span> y))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>loss (generic function with 1 method)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loss</span>(model, x_train, y_train)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>214.52561035758617</code></pre>
</div>
</div>
</section>
<section id="train-the-model" class="level3">
<h3 class="anchored" data-anchor-id="train-the-model">Train the model</h3>
<p><code>Flux</code> package has the <code>Flux.train!</code> function for model training. The function requires an optimizer, which can be, for example, created using <code>Descent</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">using</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Flux</span>: train!</span>
<span id="cb15-2"></span>
<span id="cb15-3">opt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Descent</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gradient descent algorithm </span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Descent(0.1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Descent</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Descent(0.1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"></span>
<span id="cb19-2">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(x_train, y_train)]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1-element Vector{Tuple{Matrix{Int64}, Matrix{Float64}}}:
 ([0 1 … 4 5], [1.552234290757838 5.997621972031162 … 17.799006293669162 21.987462504032138])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"></span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train!</span>(loss, model, data, opt)</span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loss</span>(model, x_train, y_train)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>203.61293290763626</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"></span>
<span id="cb23-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check model parameters after going through the data once</span></span>
<span id="cb23-3">model.weight, model.bias</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Float32[8.607251;;], Float32[2.5395057])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"></span>
<span id="cb25-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># iteratively train the model</span></span>
<span id="cb25-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> epoch <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb25-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train!</span>(loss, model, data, opt)</span>
<span id="cb25-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
</div>
</section>
<section id="examine-the-trained-model" class="level3">
<h3 class="anchored" data-anchor-id="examine-the-trained-model">Examine the trained model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check the loss</span></span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loss</span>(model, x_train, y_train)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.19602860021782811</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check the model parameters</span></span>
<span id="cb28-2">model.weight, model.bias</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Float32[4.0600896;;], Float32[2.0363088])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check the model against the test data set</span></span>
<span id="cb30-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model</span>(x_test)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1×5 Matrix{Float32}:
 26.3968  30.4569  34.517  38.5771  42.6372</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1">y_test</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1×5 Matrix{Float64}:
 26.8276  28.1139  33.7393  38.7184  43.8994</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>julia</category>
  <category>Flux</category>
  <category>linear model</category>
  <guid>https://kimfinale.github.io/myblog/posts/fit_a_straight_line_julia/index.html</guid>
  <pubDate>Wed, 03 Jan 2024 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/fit_a_straight_line_julia/flux_logo.png" medium="image" type="image/png" height="49" width="144"/>
</item>
<item>
  <title>Critical vaccination threshold</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/critical_vacc_threshold/index.html</link>
  <description><![CDATA[ 




<p>The following <a href="https://academic.oup.com/cid/article/52/7/911/299077">article by Fine</a> provides a great introduction to the critical vaccination threshold.</p>
<section id="critical-vaccination-threshold" class="level4">
<h4 class="anchored" data-anchor-id="critical-vaccination-threshold">Critical vaccination threshold</h4>
<p>The simplest scenario would be to assume that individuals are well-mixed and vaccine recipients are completely protected from infection. For this scenario, the critical threshold for random vaccination, <img src="https://latex.codecogs.com/png.latex?V_c">, is as follows: <img src="https://latex.codecogs.com/png.latex?%0AV_c%20=%201-1/R_0%0A"> If vaccines are only partially protective and <img src="https://latex.codecogs.com/png.latex?E"> fraction of the vaccine recipients are completely protected, <img src="https://latex.codecogs.com/png.latex?V_c"> becomes as follows: <img src="https://latex.codecogs.com/png.latex?%0AV_c%20=%20%5Cfrac%7B1-1/R_0%7D%7BE%7D%0A"></p>
<p>I used the population <a href="https://population.un.org/wpp/Download/Standard/MostUsed/">World Population Prospects 2022</a>.</p>
</section>
<section id="plot-the-results" class="level4">
<h4 class="anchored" data-anchor-id="plot-the-results">Plot the results</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-2">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-4">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb1-5">VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb1-6">Vc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(VE, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1-1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R0)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1-1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R0)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>x, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span>
<span id="cb1-7"></span>
<span id="cb1-8">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R0=</span>R0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Vc1=</span>Vc[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Vc2=</span>Vc[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Vc3=</span>Vc[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]])</span>
<span id="cb1-9"></span>
<span id="cb1-10">gg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> R0)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_rect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.15</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.78</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Vc3)),</span>
<span id="cb1-12">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Vc3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80%"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Vc2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60%"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Vc1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40%"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_linetype_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80%"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>,</span>
<span id="cb1-17">                                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60%"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, </span>
<span id="cb1-18">                                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40%"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># labs(y="Critical vaccination threshold", x=expression(R[0])) +</span></span>
<span id="cb1-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Critical vaccination threshold (%), "</span>, V[C])), </span>
<span id="cb1-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Basic reproduction number, "</span>, R[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb1-23">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb1-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb1-25">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span>
<span id="cb1-26"></span>
<span id="cb1-27">gg</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/critical_vacc_threshold/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("Vc_R0.png", gg, units="in", width=3.4*2, height=2.7*2)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.15</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.78</span>)</span>
<span id="cb3-2">(Vc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1-1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R0)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1304348 0.6402878</code></pre>
</div>
</div>
</section>
<section id="india-simulation" class="level3">
<h3 class="anchored" data-anchor-id="india-simulation">India simulation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readxl)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d &lt;- read_xlsx("C:/Users/jonghoon.kim/Documents/myblog/posts/critical_vacc_threshold/WPP2022_POP_F01_1_POPULATION_SINGLE_AGE_BOTH_SEXES.xlsx", sheet= "Medium variant")</span></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d2 &lt;- d[-(1:11),]</span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># india &lt;- d2[(d2$...3 == "India" &amp; d2$...11 &gt; 2023),]</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># names(india) &lt;- c(1:2, "country", 4:10 ,"year", paste0("age_", 0:100))</span></span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># saveRDS(india, "C:/Users/jonghoon.kim/Documents/myblog/posts/critical_vacc_threshold/WPP2022_India.rds")</span></span>
<span id="cb5-10"></span>
<span id="cb5-11">india <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/critical_vacc_threshold/WPP2022_India.rds"</span>)</span>
<span id="cb5-12">india<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(india<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>year)</span>
<span id="cb5-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># india[,paste0("age_", 0:100)] &lt;- as.numeric(india[,paste0("age_", 0:100)])</span></span>
<span id="cb5-14">india <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> india <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), as.numeric)</span>
<span id="cb5-15"></span>
<span id="cb5-16">yrs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2024</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2100</span></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># simulate</span></span>
<span id="cb5-18">VE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb5-19">prop_immune <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(yrs))</span>
<span id="cb5-20"></span>
<span id="cb5-21"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(yrs)) {</span>
<span id="cb5-22">  numerator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(india[india<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> yrs[i], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>))])</span>
<span id="cb5-23">  denominator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(india[india<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> yrs[i], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)])</span>
<span id="cb5-24">  prop_immune[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> numerator <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> denominator</span>
<span id="cb5-25">} </span>
<span id="cb5-26"></span>
<span id="cb5-27">existing_immune <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb5-28">pop_immune_ve <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(VE, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(z) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>z<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>prop_immune)</span>
<span id="cb5-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the existing immunity, assumed to be 15%</span></span>
<span id="cb5-30">pop_immune_ve_added <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(VE, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(z) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>z<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>prop_immune <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> existing_immune)</span>
<span id="cb5-31"></span>
<span id="cb5-32">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">years=</span>yrs<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-2024</span>, </span>
<span id="cb5-33">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi1=</span>pop_immune_ve[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], </span>
<span id="cb5-34">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi2=</span>pop_immune_ve[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], </span>
<span id="cb5-35">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi3=</span>pop_immune_ve[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]], </span>
<span id="cb5-36">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi4=</span>pop_immune_ve_added[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], </span>
<span id="cb5-37">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi5=</span>pop_immune_ve_added[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]], </span>
<span id="cb5-38">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi6=</span>pop_immune_ve_added[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]])</span>
<span id="cb5-39"></span>
<span id="cb5-40">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-41"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb5-42"></span>
<span id="cb5-43"></span>
<span id="cb5-44">gg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> years)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_rect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>),</span>
<span id="cb5-46">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pi3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80%"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pi2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60%"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-49">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pi1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40%"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pi6, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80%"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pi5, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60%"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pi4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40%"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_linetype_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccine efficacy"</span>, </span>
<span id="cb5-55">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80%"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>,</span>
<span id="cb5-56">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60%"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, </span>
<span id="cb5-57">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40%"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-58">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># labs(y="Critical vaccination threshold", x=expression(R[0])) +</span></span>
<span id="cb5-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population immune (%)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Years since vaccination"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb5-61">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb5-62">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb5-63">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span>
<span id="cb5-64">gg</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/critical_vacc_threshold/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("immune_time.png", gg, units="in", width=3.4*2, height=2.7*2)</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>vaccine</category>
  <category>population immunity</category>
  <category>critical vaccination threshold</category>
  <guid>https://kimfinale.github.io/myblog/posts/critical_vacc_threshold/index.html</guid>
  <pubDate>Wed, 13 Dec 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/critical_vacc_threshold/Vc_R0.png" medium="image" type="image/png" height="114" width="144"/>
</item>
</channel>
</rss>
