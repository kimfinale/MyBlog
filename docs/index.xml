<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Jong-Hoon Kim&#39;s Blog</title>
<link>https://kimfinale.github.io/myblog/index.html</link>
<atom:link href="https://kimfinale.github.io/myblog/index.xml" rel="self" type="application/rss+xml"/>
<description>Jong-Hoon Kim&#39;s Blog</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Wed, 11 Oct 2023 15:00:00 GMT</lastBuildDate>
<item>
  <title>Regression with censorted data: POLYMOD data</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/nb-censored-regression/index.html</link>
  <description><![CDATA[ 




<section id="data-prep" class="level3">
<h3 class="anchored" data-anchor-id="data-prep">Data prep</h3>
<p>This post describes the process to analyze the POLYMOD data set, which can be downloaded from <a href="http://www.socialcontactdata.org/">Social Contact Data</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-3">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/nb-censored-regression/2008_Mossong_POLYMOD_participant_common.csv"</span>)</span>
<span id="cb1-4">d2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/nb-censored-regression/2008_Mossong_POLYMOD_contact_common.csv"</span>)</span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># count the number of contacts for each participant using part_id variable</span></span>
<span id="cb1-6">d2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-7">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(part_id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">contacts =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> d_contacts</span>
<span id="cb1-9">  </span>
<span id="cb1-10">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d, d_contacts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"part_id"</span>)</span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add household information</span></span>
<span id="cb1-12">d3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/nb-stan/2008_Mossong_POLYMOD_hh_common.csv"</span>)</span>
<span id="cb1-13">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d, d3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hh_id"</span>)</span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add day of week information</span></span>
<span id="cb1-15">d4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/nb-stan/2008_Mossong_POLYMOD_sday.csv"</span>)</span>
<span id="cb1-16">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d, d4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"part_id"</span>)</span></code></pre></div>
</div>
</section>
<section id="age-group" class="level3">
<h3 class="anchored" data-anchor-id="age-group">Age group</h3>
<p>Categorize the age group into different 10 age groups: 0-4, 5-9, 10-14, 15-19, 20 to 70 by 10 years and 70 and above</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat</span>
<span id="cb2-2">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span></span>
<span id="cb2-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb2-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i])){</span>
<span id="cb2-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>){</span>
<span id="cb2-6">      d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb2-7">    }</span>
<span id="cb2-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>){</span>
<span id="cb2-9">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>){</span>
<span id="cb2-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>j<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)){</span>
<span id="cb2-11">          d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> j</span>
<span id="cb2-12">        }</span>
<span id="cb2-13">      }</span>
<span id="cb2-14">    }</span>
<span id="cb2-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>){</span>
<span id="cb2-16">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (k <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>){</span>
<span id="cb2-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k)){</span>
<span id="cb2-18">          d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb2-19">        }</span>
<span id="cb2-20">      }</span>
<span id="cb2-21">    } </span>
<span id="cb2-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb2-23">      d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span></span>
<span id="cb2-24">    }</span>
<span id="cb2-25">  } </span>
<span id="cb2-26">}</span>
<span id="cb2-27"></span>
<span id="cb2-28">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size), d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span>
<span id="cb2-29"></span>
<span id="cb2-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d$gender_grp &lt;- ifelse(d$part_gender == "F", "F", </span></span>
<span id="cb2-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                        ifelse(d$part_gender == "M", "M", NA))</span></span>
<span id="cb2-32"></span>
<span id="cb2-33">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d</span>
<span id="cb2-34"></span>
<span id="cb2-35">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp)</span>
<span id="cb2-36">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp)</span>
<span id="cb2-37">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_gender)</span>
<span id="cb2-38">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek)</span></code></pre></div>
</div>
</section>
<section id="weighting" class="level3">
<h3 class="anchored" data-anchor-id="weighting">Weighting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hh &lt;- fread("posts/nb-stan/2008_Mossong_POLYMOD_hh_common.csv")</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d3 &lt;- left_join(d2, hh, by="hh_id") </span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # match by country, household size, age group</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(readxl)</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Determining a row and a column is simply based on the way it is imported  rio::import_list("posts/nb-stan/sampling_weight.xlsx")</span></span>
<span id="cb3-7">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat</span>
<span id="cb3-8">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_row <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb3-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb3-10">  ag <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i]</span>
<span id="cb3-11">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(ag)){</span>
<span id="cb3-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>) {</span>
<span id="cb3-13">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (ag <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> (j<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> ag <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (j<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) {</span>
<span id="cb3-14">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_row[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> j</span>
<span id="cb3-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb3-16">      }</span>
<span id="cb3-17">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (ag <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>) {</span>
<span id="cb3-18">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_row[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span></span>
<span id="cb3-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb3-20">      }</span>
<span id="cb3-21">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>{}</span>
<span id="cb3-22">    }</span>
<span id="cb3-23">  }</span>
<span id="cb3-24">}</span>
<span id="cb3-25"></span>
<span id="cb3-26">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_col <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb3-27"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb3-28">  hs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size[i]</span>
<span id="cb3-29">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(hs)){</span>
<span id="cb3-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb3-31">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (hs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> j) {</span>
<span id="cb3-32">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_col[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> j</span>
<span id="cb3-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb3-34">      }</span>
<span id="cb3-35">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (hs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb3-36">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_col[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb3-37">      }</span>
<span id="cb3-38">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>{}</span>
<span id="cb3-39">    }</span>
<span id="cb3-40">  }</span>
<span id="cb3-41">}</span>
<span id="cb3-42"></span>
<span id="cb3-43">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb3-44">wlist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rio<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">import_list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/nb-stan/sampling_weight.xlsx"</span>)</span>
<span id="cb3-45">cnames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(wlist)</span>
<span id="cb3-46"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(cnames)) {</span>
<span id="cb3-47">  wtable <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wlist[[i]]</span>
<span id="cb3-48">  w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wtable[wtable<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Household size</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ratio C/S"</span>,] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sampling weight</span></span>
<span id="cb3-49">  W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w1[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Household size</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>),] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove the first row</span></span>
<span id="cb3-50">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View(W)</span></span>
<span id="cb3-51">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)){</span>
<span id="cb3-52">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>country[j] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> cnames[i]) {</span>
<span id="cb3-53">      d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt[j] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> W[d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_row[j], d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_col[j]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb3-54">    }</span>
<span id="cb3-55">  }</span>
<span id="cb3-56">}</span>
<span id="cb3-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># grep("-", as.character(d$wt), value = T)</span></span>
<span id="cb3-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hist(as.numeric(d$wt))</span></span>
<span id="cb3-59">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d</span>
<span id="cb3-60">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt)</span></code></pre></div>
</div>
</section>
<section id="data-for-fitting-only-complete-cases" class="level3">
<h3 class="anchored" data-anchor-id="data-for-fitting-only-complete-cases">data for fitting only complete cases</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat</span>
<span id="cb4-2">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(dat),]</span></code></pre></div>
</div>
</section>
<section id="negbin-regression-no-censoring-and-no-weighting" class="level3">
<h3 class="anchored" data-anchor-id="negbin-regression-no-censoring-and-no-weighting">NegBin regression: no censoring and no weighting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MASS)</span>
<span id="cb5-2"></span>
<span id="cb5-3">m1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm.nb</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age_grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = contacts ~ age_grp, data = dat, init.theta = 2.349538851, 
    link = log)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.33297    0.02847  81.959  &lt; 2e-16 ***
age_grp1     0.34973    0.03963   8.826  &lt; 2e-16 ***
age_grp2     0.57379    0.03861  14.862  &lt; 2e-16 ***
age_grp3     0.53545    0.03908  13.702  &lt; 2e-16 ***
age_grp4     0.28592    0.03733   7.660 1.86e-14 ***
age_grp5     0.31980    0.03780   8.460  &lt; 2e-16 ***
age_grp6     0.29453    0.03707   7.946 1.93e-15 ***
age_grp7     0.18429    0.03716   4.959 7.09e-07 ***
age_grp8    -0.09048    0.03958  -2.286   0.0223 *  
age_grp9    -0.38437    0.05435  -7.072 1.53e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(2.3495) family taken to be 1)

    Null deviance: 8082.4  on 7068  degrees of freedom
Residual deviance: 7381.8  on 7059  degrees of freedom
AIC: 49343

Number of Fisher Scoring iterations: 1

              Theta:  2.3495 
          Std. Err.:  0.0452 

 2 x log-likelihood:  -49321.1310 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(m1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 
 10.3085271   1.4186911   1.7749820   1.7082181   1.3309824   1.3768472 
   age_grp6    age_grp7    age_grp8    age_grp9 
  1.3424987   1.2023627   0.9134947   0.6808798 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">m2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm.nb</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gender, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = contacts ~ age_grp + gender, data = dat, init.theta = 2.349707617, 
    link = log)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.17344    0.22777   9.542  &lt; 2e-16 ***
age_grp1     0.34959    0.03963   8.822  &lt; 2e-16 ***
age_grp2     0.57371    0.03861  14.858  &lt; 2e-16 ***
age_grp3     0.53633    0.03908  13.724  &lt; 2e-16 ***
age_grp4     0.28630    0.03733   7.670 1.72e-14 ***
age_grp5     0.32009    0.03781   8.466  &lt; 2e-16 ***
age_grp6     0.29474    0.03708   7.949 1.88e-15 ***
age_grp7     0.18458    0.03717   4.966 6.83e-07 ***
age_grp8    -0.09034    0.03958  -2.282   0.0225 *  
age_grp9    -0.38435    0.05436  -7.071 1.54e-12 ***
genderF      0.15734    0.22647   0.695   0.4872    
genderM      0.16193    0.22650   0.715   0.4746    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(2.3497) family taken to be 1)

    Null deviance: 8082.9  on 7068  degrees of freedom
Residual deviance: 7381.7  on 7057  degrees of freedom
AIC: 49347

Number of Fisher Scoring iterations: 1

              Theta:  2.3497 
          Std. Err.:  0.0452 

 2 x log-likelihood:  -49320.5770 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(m2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 
  8.7884482   1.4184916   1.7748444   1.7097191   1.3314962   1.3772500 
   age_grp6    age_grp7    age_grp8    age_grp9     genderF     genderM 
  1.3427729   1.2027150   0.9136204   0.6808923   1.1703919   1.1757819 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">m3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm.nb</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hh_size_grp , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = contacts ~ age_grp + gender, data = dat, init.theta = 2.349707617, 
    link = log)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.17344    0.22777   9.542  &lt; 2e-16 ***
age_grp1     0.34959    0.03963   8.822  &lt; 2e-16 ***
age_grp2     0.57371    0.03861  14.858  &lt; 2e-16 ***
age_grp3     0.53633    0.03908  13.724  &lt; 2e-16 ***
age_grp4     0.28630    0.03733   7.670 1.72e-14 ***
age_grp5     0.32009    0.03781   8.466  &lt; 2e-16 ***
age_grp6     0.29474    0.03708   7.949 1.88e-15 ***
age_grp7     0.18458    0.03717   4.966 6.83e-07 ***
age_grp8    -0.09034    0.03958  -2.282   0.0225 *  
age_grp9    -0.38435    0.05436  -7.071 1.54e-12 ***
genderF      0.15734    0.22647   0.695   0.4872    
genderM      0.16193    0.22650   0.715   0.4746    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(2.3497) family taken to be 1)

    Null deviance: 8082.9  on 7068  degrees of freedom
Residual deviance: 7381.7  on 7057  degrees of freedom
AIC: 49347

Number of Fisher Scoring iterations: 1

              Theta:  2.3497 
          Std. Err.:  0.0452 

 2 x log-likelihood:  -49320.5770 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(m2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 
  8.7884482   1.4184916   1.7748444   1.7097191   1.3314962   1.3772500 
   age_grp6    age_grp7    age_grp8    age_grp9     genderF     genderM 
  1.3427729   1.2027150   0.9136204   0.6808923   1.1703919   1.1757819 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">m4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm.nb</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hh_size_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb17-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># summary(m4)</span></span>
<span id="cb17-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(m4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)     age_grp1     age_grp2     age_grp3     age_grp4     age_grp5 
   7.9783529    1.3826990    1.6788360    1.6795779    1.4291836    1.4218836 
    age_grp6     age_grp7     age_grp8     age_grp9      genderF      genderM 
   1.3794212    1.2970777    1.0517192    0.8024462    0.9246153    0.9178280 
hh_size_grp2 hh_size_grp3 hh_size_grp4 hh_size_grp5    countryDE    countryFI 
   1.1028791    1.1305982    1.2716075    1.3868936    0.7150799    0.9508057 
   countryGB    countryIT    countryLU    countryNL    countryPL 
   0.9813781    1.6313411    1.4373405    1.2477011    1.3254063 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">m5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm.nb</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hh_size_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> dayofweek, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb19-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># summary(m4)</span></span>
<span id="cb19-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(m5<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)     age_grp1     age_grp2     age_grp3     age_grp4     age_grp5 
   6.1164006    1.3774273    1.6712925    1.6697736    1.4329588    1.4093123 
    age_grp6     age_grp7     age_grp8     age_grp9      genderF      genderM 
   1.3686718    1.2879141    1.0492799    0.8092407    0.9324001    0.9251257 
hh_size_grp2 hh_size_grp3 hh_size_grp4 hh_size_grp5    countryDE    countryFI 
   1.1033402    1.1244116    1.2651689    1.3816597    0.7081939    0.9473682 
   countryGB    countryIT    countryLU    countryNL    countryPL   dayofweek1 
   0.9772421    1.6303023    1.4052212    1.2451789    1.3256406    1.3211173 
  dayofweek2   dayofweek3   dayofweek4   dayofweek5   dayofweek6 
   1.3993730    1.3886852    1.3856028    1.4418376    1.1546267 </code></pre>
</div>
</div>
</section>
<section id="take-censoring-into-account" class="level3">
<h3 class="anchored" data-anchor-id="take-censoring-into-account">Take censoring into account</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> m5</span>
<span id="cb21-2">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model.matrix</span>(m)</span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ini = c(coef(m1), log_theta = log(summary(m1)$theta))</span></span>
<span id="cb21-4">init <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>theta)</span>
<span id="cb21-5"></span>
<span id="cb21-6">negll_censor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(par, y, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>) {</span>
<span id="cb21-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb21-8">  size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)] </span>
<span id="cb21-9">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb21-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create indicator depending on chosen limit</span></span>
<span id="cb21-11">  indicator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ul</span>
<span id="cb21-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># linear predictor</span></span>
<span id="cb21-13">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta)</span>
<span id="cb21-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log likelihood</span></span>
<span id="cb21-15">  ll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(indicator <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnbinom</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-16">             (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>indicator) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnbinom</span>(ul, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb21-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ll)</span>
<span id="cb21-18">}</span>
<span id="cb21-19"></span>
<span id="cb21-20">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init, </span>
<span id="cb21-21">            negll_censor,</span>
<span id="cb21-22">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts,</span>
<span id="cb21-23">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb21-24">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb21-25">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>,</span>
<span id="cb21-26">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxit=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-10</span>))</span>
<span id="cb21-27"></span>
<span id="cb21-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)     age_grp1     age_grp2     age_grp3     age_grp4     age_grp5 
   6.1164006    1.3774273    1.6712925    1.6697736    1.4329588    1.4093123 
    age_grp6     age_grp7     age_grp8     age_grp9      genderF      genderM 
   1.3686718    1.2879141    1.0492799    0.8092407    0.9324001    0.9251257 
hh_size_grp2 hh_size_grp3 hh_size_grp4 hh_size_grp5    countryDE    countryFI 
   1.1033402    1.1244116    1.2651689    1.3816597    0.7081939    0.9473682 
   countryGB    countryIT    countryLU    countryNL    countryPL   dayofweek1 
   0.9772421    1.6303023    1.4052212    1.2451789    1.3256406    1.3211173 
  dayofweek2   dayofweek3   dayofweek4   dayofweek5   dayofweek6 
   1.3993730    1.3886852    1.3856028    1.4418376    1.1546267 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)     age_grp1     age_grp2     age_grp3     age_grp4     age_grp5 
   6.1164006    1.3774273    1.6712925    1.6697736    1.4329588    1.4093123 
    age_grp6     age_grp7     age_grp8     age_grp9      genderF      genderM 
   1.3686718    1.2879141    1.0492799    0.8092407    0.9324001    0.9251257 
hh_size_grp2 hh_size_grp3 hh_size_grp4 hh_size_grp5    countryDE    countryFI 
   1.1033402    1.1244116    1.2651689    1.3816597    0.7081939    0.9473682 
   countryGB    countryIT    countryLU    countryNL    countryPL   dayofweek1 
   0.9772421    1.6303023    1.4052212    1.2451789    1.3256406    1.3211173 
  dayofweek2   dayofweek3   dayofweek4   dayofweek5   dayofweek6         size 
   1.3993730    1.3886852    1.3856028    1.4418376    1.1546267   20.7585935 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init, </span>
<span id="cb25-2">            negll_censor,</span>
<span id="cb25-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts,</span>
<span id="cb25-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb25-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>,</span>
<span id="cb25-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>,</span>
<span id="cb25-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxit=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-10</span>))</span>
<span id="cb25-8">fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)     age_grp1     age_grp2     age_grp3     age_grp4     age_grp5 
  1.55650171   0.26327129   0.35056064   0.40212335   0.29412063   0.29883071 
    age_grp6     age_grp7     age_grp8     age_grp9      genderF      genderM 
  0.26734320   0.25083388   0.07239037  -0.10357844  -0.01523367  -0.01901654 
hh_size_grp2 hh_size_grp3 hh_size_grp4 hh_size_grp5    countryDE    countryFI 
  0.16833922   0.21734592   0.32287273   0.35571366  -0.24600748   0.05530841 
   countryGB    countryIT    countryLU    countryNL    countryPL   dayofweek1 
  0.06276664   0.33895987   0.22789886   0.18352321   0.20689205   0.28371164 
  dayofweek2   dayofweek3   dayofweek4   dayofweek5   dayofweek6         size 
  0.33680996   0.30048954   0.32608935   0.33103190   0.20037492   4.44495113 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)     age_grp1     age_grp2     age_grp3     age_grp4     age_grp5 
   6.1164006    1.3774273    1.6712925    1.6697736    1.4329588    1.4093123 
    age_grp6     age_grp7     age_grp8     age_grp9      genderF      genderM 
   1.3686718    1.2879141    1.0492799    0.8092407    0.9324001    0.9251257 
hh_size_grp2 hh_size_grp3 hh_size_grp4 hh_size_grp5    countryDE    countryFI 
   1.1033402    1.1244116    1.2651689    1.3816597    0.7081939    0.9473682 
   countryGB    countryIT    countryLU    countryNL    countryPL   dayofweek1 
   0.9772421    1.6303023    1.4052212    1.2451789    1.3256406    1.3211173 
  dayofweek2   dayofweek3   dayofweek4   dayofweek5   dayofweek6 
   1.3993730    1.3886852    1.3856028    1.4418376    1.1546267 </code></pre>
</div>
</div>
<p>Censoring &amp; Weighting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> m2</span>
<span id="cb29-2">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model.matrix</span>(m)</span>
<span id="cb29-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ini = c(coef(m1), log_theta = log(summary(m1)$theta))</span></span>
<span id="cb29-4">init <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>theta)</span>
<span id="cb29-5"></span>
<span id="cb29-6">negll_censor_weight <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(par, y, X, wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>) {</span>
<span id="cb29-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb29-8">  size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)] </span>
<span id="cb29-9">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb29-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create indicator depending on chosen limit</span></span>
<span id="cb29-11">  indicator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ul</span>
<span id="cb29-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># linear predictor</span></span>
<span id="cb29-13">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta)</span>
<span id="cb29-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log likelihood</span></span>
<span id="cb29-15">  ll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(wt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(indicator <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnbinom</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T)</span>
<span id="cb29-16">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>indicator) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnbinom</span>(ul, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb29-17">  </span>
<span id="cb29-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ll)</span>
<span id="cb29-19">}</span>
<span id="cb29-20"></span>
<span id="cb29-21">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init, </span>
<span id="cb29-22">            negll_censor_weight,</span>
<span id="cb29-23">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts,</span>
<span id="cb29-24">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb29-25">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wt =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb29-26">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb29-27">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>,</span>
<span id="cb29-28">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxit=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-10</span>))</span>
<span id="cb29-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 
  8.7884482   1.4184916   1.7748444   1.7097191   1.3314962   1.3772500 
   age_grp6    age_grp7    age_grp8    age_grp9     genderF     genderM 
  1.3427729   1.2027150   0.9136204   0.6808923   1.1703919   1.1757819 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 
  8.7884482   1.4184916   1.7748444   1.7097191   1.3314962   1.3772500 
   age_grp6    age_grp7    age_grp8    age_grp9     genderF     genderM 
  1.3427729   1.2027150   0.9136204   0.6808923   1.1703919   1.1757819 
       size 
 10.4825044 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init, </span>
<span id="cb33-2">            negll_censor_weight,</span>
<span id="cb33-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts,</span>
<span id="cb33-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb33-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wt =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt,</span>
<span id="cb33-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb33-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>,</span>
<span id="cb33-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxit=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-10</span>))</span>
<span id="cb33-9"></span>
<span id="cb33-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 
  8.5527535   1.4173855   1.7640880   1.7215878   1.3900556   1.4072774 
   age_grp6    age_grp7    age_grp8    age_grp9     genderF     genderM 
  1.3571761   1.2292570   0.9496953   0.6885751   1.1954926   1.2172033 
       size 
 10.0819778 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init, </span>
<span id="cb35-2">            negll_censor_weight,</span>
<span id="cb35-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts,</span>
<span id="cb35-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb35-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wt =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt,</span>
<span id="cb35-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>,</span>
<span id="cb35-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>,</span>
<span id="cb35-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxit=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-10</span>))</span>
<span id="cb35-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 
 10.4571277   1.2726430   1.3611041   1.3721239   1.1848953   1.2582844 
   age_grp6    age_grp7    age_grp8    age_grp9     genderF     genderM 
  1.1844952   1.1156677   0.9145495   0.7512633   0.8753061   0.8994316 
       size 
 32.7962833 </code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>regression</category>
  <category>contact</category>
  <category>censor</category>
  <guid>https://kimfinale.github.io/myblog/posts/nb-censored-regression/index.html</guid>
  <pubDate>Wed, 11 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/nb-censored-regression/unnamed-chunk-5-1.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Regression using optim</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/nb-regression-optim/index.html</link>
  <description><![CDATA[ 




<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>I will use the <code>cars</code> data with give the speed of cars and the distances taken to stop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> datasets<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>cars</span>
<span id="cb1-2">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(dist <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> speed, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>d)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = dist ~ speed, data = d)

Residuals:
    Min      1Q  Median      3Q     Max 
-29.069  -9.525  -2.272   9.215  43.201 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -17.5791     6.7584  -2.601   0.0123 *  
speed         3.9324     0.4155   9.464 1.49e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.38 on 48 degrees of freedom
Multiple R-squared:  0.6511,    Adjusted R-squared:  0.6438 
F-statistic: 89.57 on 1 and 48 DF,  p-value: 1.49e-12</code></pre>
</div>
</div>
</section>
<section id="plot" class="level3">
<h3 class="anchored" data-anchor-id="plot">Plot</h3>
<p>Plot estimates with confidence and prediction intervals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prediction"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction interval</span></span>
<span id="cb3-2">conf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># confidence interval</span></span>
<span id="cb3-3"></span>
<span id="cb3-4">mdat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> m<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model</span>
<span id="cb3-5">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pred_estimate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb3-6">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pred_lb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb3-7">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pred_ub <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb3-8">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>conf_estimate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conf[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb3-9">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>conf_lb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conf[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb3-10">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>conf_ub <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conf[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb3-11"></span>
<span id="cb3-12">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>residuals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(m)</span>
<span id="cb3-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb3-17"></span>
<span id="cb3-18">pltcar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mdat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(speed, dist))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_point(aes(size = abs(m$residuals)))+</span></span>
<span id="cb3-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pred_estimate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>pred_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>pred_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_line(aes(y=conf_estimate), color="steelblue")+</span></span>
<span id="cb3-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>conf_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>conf_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Speed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distance"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Speed and Stopping Distances of Cars"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span>
<span id="cb3-30"></span>
<span id="cb3-31">pltcar</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/nb-regression-optim/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="optim-function" class="level3">
<h3 class="anchored" data-anchor-id="optim-function">optim function</h3>
<p>Now lets take an alternative approach to write down the likelihood function and maximize it using the <code>optim</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define our likelihood function we like to optimize</span></span>
<span id="cb4-2">negloglik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(par, y, X){</span>
<span id="cb4-3">  sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-4">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> par[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb4-5">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta </span>
<span id="cb4-6">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb4-7">}</span>
<span id="cb4-8"></span>
<span id="cb4-9">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model.matrix</span>(m)</span>
<span id="cb4-10">init <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sigma)</span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check</span></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># negloglik(par=init, y=d$y, X=X)</span></span>
<span id="cb4-13">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init, </span>
<span id="cb4-14">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn=</span>negloglik, </span>
<span id="cb4-15">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dist, </span>
<span id="cb4-16">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span>X, </span>
<span id="cb4-17">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>))</span></code></pre></div>
</div>
<p>Lets compare the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       speed       sigma 
 -17.579095    3.932409   15.379587 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       speed 
 -17.579095    3.932409 </code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>optim</category>
  <category>regression</category>
  <guid>https://kimfinale.github.io/myblog/posts/nb-regression-optim/index.html</guid>
  <pubDate>Tue, 10 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/nb-regression-optim/unnamed-chunk-5-1.png" medium="image" type="image/png"/>
</item>
<item>
  <title>SIR model using SymPy</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/SIR-sympy/index.html</link>
  <description><![CDATA[ 




<p>Mathematical Epidemiology by Brauer <em>et al</em>.</p>
<p><span id="eq-R0"><img src="https://latex.codecogs.com/png.latex?%20%5Cmathcal%7BR%7D_0%20=%20%5Cbeta%20c%20D%20%20%5Ctag%7B1%7D"></span></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta">            , <img src="https://latex.codecogs.com/png.latex?c">       , <img src="https://latex.codecogs.com/png.latex?D">      . <img src="https://latex.codecogs.com/png.latex?%5Cbeta">  <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20c">     .   <img src="https://latex.codecogs.com/png.latex?%5Cbeta">            .      <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">  ?   SIR   .</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS/%5Cmathrm%7Bd%7Dt%20&amp;=%20-%5Cbeta%20I%20S%20%5C%5C%0A%5Cmathrm%7Bd%7DI/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cbeta%20I%20S%20-%20%5Cgamma%20I%5C%5C%0A%5Cend%7Balign%7D%7B#eq-sir%7D">
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sympy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-2">R0, dSdt, dIdt, S, I, b, g <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R0 dSdt dIdt S I b g'</span>)</span>
<span id="cb1-3">dSdt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb1-4">dIdt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb1-5">dSdI <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dIdt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dSdt <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#-(I*S*b - I*g)/(I*S*b)</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># b &lt;- R0*g</span></span>
<span id="cb1-8">simplify(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g)) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-1 + 1/(R0*S)</code></pre>
</div>
</div>



 ]]></description>
  <category>SIR</category>
  <category>SymPy</category>
  <guid>https://kimfinale.github.io/myblog/posts/SIR-sympy/index.html</guid>
  <pubDate>Fri, 06 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/SIR-sympy/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Extract raster based on a polygon</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/crop-raster-polygon/index.html</link>
  <description><![CDATA[ 




<p>raster   . , <code>shapefile</code>   polygon  raster  . <code>raster</code>  <code>crop</code>  <code>mask</code>    .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create some data using meuse </span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(raster)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(meuse)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coordinates</span>(meuse) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">~</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>y</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">proj4string</span>(meuse) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:28992"</span>)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(meuse.grid)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coordinates</span>(meuse.grid) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">~</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>y</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">proj4string</span>(meuse.grid) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:28992"</span>)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gridded</span>(meuse.grid) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>    </span>
<span id="cb1-10">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">raster</span>(meuse.grid) </span>
<span id="cb1-11">r[] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncell</span>(r))</span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a polygon</span></span>
<span id="cb1-14">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rgeos<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gBuffer</span>(meuse[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byid=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, </span>
<span id="cb1-15">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">joinStyle=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ROUND"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quadsegs=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)   </span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot full raster and polygon                       </span></span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r)</span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(f,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/crop-raster-polygon/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Crop using extent, rasterize polygon and finally, create poly-raster</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#          **** This is the code that you are after ****  </span></span>
<span id="cb2-3">cr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crop</span>(r, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extent</span>(f), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">snap=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"out"</span>)                    </span>
<span id="cb2-4">fr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rasterize</span>(f, cr)   </span>
<span id="cb2-5">lr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mask</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>cr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mask=</span>fr)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot results</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(lr)</span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(f,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/crop-raster-polygon/index_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>R</category>
  <category>raster</category>
  <category>shapefile</category>
  <category>crop</category>
  <category>mask</category>
  <category>sf</category>
  <guid>https://kimfinale.github.io/myblog/posts/crop-raster-polygon/index.html</guid>
  <pubDate>Fri, 22 Sep 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/crop-raster-polygon/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>odin package</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/odin/index.html</link>
  <description><![CDATA[ 




<p> <a href="https://www.vaccineimpact.org/">Vaccine Impact Modeling Consoritum (VIMC)</a>  <code>odin</code>    . <code>deSolve</code>    ? R  C      .       (  MCMC)  . <code>pomp</code>           .  C++   <code>odin</code>      .           SIR   .</p>
<section id="deterministic-sir-model" class="level3">
<h3 class="anchored" data-anchor-id="deterministic-sir-model">Deterministic SIR model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">path_sir_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/odin/sir.R"</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(path_sir_model))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Core equations for transitions between compartments:
update(S) &lt;- S - beta * S * I / N
update(I) &lt;- I + beta * S * I / N - gamma * I
update(R) &lt;- R + gamma * I

## Total population size (odin will recompute this at each timestep:
## automatically)
N &lt;- S + I + R

## Initial states:
initial(S) &lt;- S_ini # will be user-defined
initial(I) &lt;- I_ini # will be user-defined
initial(R) &lt;- 0

## User defined parameters - default in parentheses:
S_ini &lt;- user(1000)
I_ini &lt;- user(1)
beta &lt;- user(0.2)
gamma &lt;- user(0.1)</code></pre>
</div>
</div>
<p>Run the model and plot the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(odin)</span>
<span id="cb3-2">sir_generator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> odin<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odin</span>(path_sir_model)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sir_generator<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># see what the object is like</span></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x</span></span>
<span id="cb4-4">sir_col <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#8c8cd9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#cc0044"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#999966"</span>)</span>
<span id="cb4-5">x_res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">las =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matplot</span>(x_res[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], x_res[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>,</span>
<span id="cb4-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> sir_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> sir_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/odin/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="stochastic-sir-model" class="level3">
<h3 class="anchored" data-anchor-id="stochastic-sir-model">Stochastic SIR model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">path_sir_stoch_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/odin/sir_stoch.R"</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(path_sir_stoch_model))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Core equations for transitions between compartments:
update(S) &lt;- S - n_SI
update(I) &lt;- I + n_SI - n_IR
update(R) &lt;- R + n_IR

## Individual probabilities of transition:
p_SI &lt;- 1 - exp(-beta * I / N) # S to I
p_IR &lt;- 1 - exp(-gamma) # I to R

## Draws from binomial distributions for numbers changing between
## compartments:
n_SI &lt;- rbinom(S, p_SI)
n_IR &lt;- rbinom(I, p_IR)

## Total population size
N &lt;- S + I + R

## Initial states:
initial(S) &lt;- S_ini
initial(I) &lt;- I_ini
initial(R) &lt;- 0

## User defined parameters - default in parentheses:
S_ini &lt;- user(1000)
I_ini &lt;- user(1)
beta &lt;- user(0.2)
gamma &lt;- user(0.1)</code></pre>
</div>
</div>
<p>Run the model and plot the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">sir_generator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> odin<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odin</span>(path_sir_stoch_model)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb8-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sir_generator<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb8-3">x_res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">las =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matplot</span>(x_res[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], x_res[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>,</span>
<span id="cb8-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> sir_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> sir_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/odin/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>ODE</category>
  <category>R</category>
  <category>odin</category>
  <guid>https://kimfinale.github.io/myblog/posts/odin/index.html</guid>
  <pubDate>Thu, 14 Sep 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/odin/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>PubMed search, ChatGPT summary, and sending an email in Python</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/pubmed-chatgpt-summary-python/index.html</link>
  <description><![CDATA[ 







 ]]></description>
  <category>ChatGPT</category>
  <category>R</category>
  <category>xml</category>
  <category>httr</category>
  <guid>https://kimfinale.github.io/myblog/posts/pubmed-chatgpt-summary-python/index.html</guid>
  <pubDate>Thu, 31 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/pubmed-chatgpt-summary-python/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>PubMed search, ChatGPT summary, and sending an email in R</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/pubmed-chatgpt_summary/index.html</link>
  <description><![CDATA[ 




<p>      ChatGPT  . PubMed   ChatGPT           .    R    .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">chatgpt_api_token <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G:/My Drive/Personal/chatGPT_api_key.rds"</span>)</span></code></pre></div>
</div>
<ol type="1">
<li>Search the PubMed database Use the entrez_search function from the rentrez package to search the PubMed database</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rentrez)</span>
<span id="cb2-2"></span>
<span id="cb2-3">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"typhoid"</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the search query</span></span>
<span id="cb2-4">search_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entrez_search</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">db=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pubmed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">term=</span>query, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">datetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pdat"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reldate=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># any other useful parameters?</span></span></code></pre></div>
</div>
<ol start="2" type="1">
<li>Fetch the details of the article in xml format</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the IDs of the articles</span></span>
<span id="cb3-2">ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> search_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids</span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retrieve the details of the data in xml format</span></span>
<span id="cb3-4">article_details <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entrez_fetch</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">db=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pubmed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span>ids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rettype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xml"</span>)</span></code></pre></div>
</div>
<ol start="3" type="1">
<li>Parse the XML using the xml2 package</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(xml2)</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parse the XML data</span></span>
<span id="cb4-3">doc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xml</span>(article_details)</span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the titles and abstracts</span></span>
<span id="cb4-5">titles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//ArticleTitle"</span>))</span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># abstracts &lt;- xml_text(xml_find_all(doc, "//AbstractText"))</span></span>
<span id="cb4-7">abstracts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//Abstract"</span>))</span>
<span id="cb4-8">dois <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".//PubmedData/ArticleIdList/ArticleId[@IdType='doi']"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to get the doi's</span></span></code></pre></div>
</div>
<ol start="4" type="1">
<li>Call ChatGPT to summarize the abstract in 1-2 sentences This is a subscription-based service. You must have a ChatGPT API key and must have signed up for their paid service.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">get_completion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(prompt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-3.5-turbo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb5-2">  response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">POST</span>(</span>
<span id="cb5-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.openai.com/v1/chat/completions"</span>, </span>
<span id="cb5-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_headers</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Authorization =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bearer"</span>, chatgpt_api_token)),</span>
<span id="cb5-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content_type_json</span>(),</span>
<span id="cb5-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json"</span>,</span>
<span id="cb5-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> model,</span>
<span id="cb5-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature =</span> temperature, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this is the degree of randomness of the model's output</span></span>
<span id="cb5-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">messages =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">role =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, </span>
<span id="cb5-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content =</span> prompt</span>
<span id="cb5-13">     ))</span>
<span id="cb5-14">   )</span>
<span id="cb5-15">  )</span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content</span>(response)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>choices[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>content)</span>
<span id="cb5-17">}</span>
<span id="cb5-18"></span>
<span id="cb5-19"></span>
<span id="cb5-20"></span>
<span id="cb5-21">abstract_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstracts))</span>
<span id="cb5-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># You may want to try various prompts to suit your needs</span></span>
<span id="cb5-23"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstracts)) {</span>
<span id="cb5-24">  prompt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your task is to generate a short summary of a scientific article based on its title and abstract. Summarize the text delimited by triple backticks into one sentence. ``` Title: "</span>, titles[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">". Abstract: "</span>, abstracts[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"```"</span>)</span>
<span id="cb5-25">  abstract_summary[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_completion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prompt=</span>prompt)</span>
<span id="cb5-26">}</span></code></pre></div>
</div>
<ol start="5" type="1">
<li>Make R send you an email everyday Use simple HTML syntaxes (<code>&lt;p&gt;&lt;/p&gt;</code> or <code>&lt;b&gt;&lt;/b&gt;</code>) to compose an email message using <code>blastula</code> package</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(blastula)</span>
<span id="cb6-2"></span>
<span id="cb6-3">create_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(titles, abstract_summary, ids, dois){</span>
<span id="cb6-4">  summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstract_summary), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;b&gt; "</span>, titles[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;/b&gt; "</span>, abstract_summary[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" PMID="</span>, ids[i] , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" DOI="</span>, dois[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;/p&gt;"</span>))</span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(summary)</span>
<span id="cb6-6">}</span>
<span id="cb6-7"></span>
<span id="cb6-8">email <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compose_email</span>(</span>
<span id="cb6-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Test Email"</span>,</span>
<span id="cb6-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_summary</span>(titles, abstract_summary, ids, dois)))</span>
<span id="cb6-11"></span>
<span id="cb6-12">email <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">smtp_send</span>( </span>
<span id="cb6-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kimfinale@gmail.com"</span>,</span>
<span id="cb6-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jonghoon.kim@ivi.int"</span>,</span>
<span id="cb6-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subject =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily summary of PubMed search"</span>,</span>
<span id="cb6-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># credentials = creds_key(id = "gmail"),</span></span>
<span id="cb6-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">credentials =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">creds_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gmail_cred"</span>)</span>
<span id="cb6-19">  )</span>
<span id="cb6-20"></span>
<span id="cb6-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># email %&gt;%</span></span>
<span id="cb6-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   smtp_send(</span></span>
<span id="cb6-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     from = "jonghoon.kim@ivi.int",</span></span>
<span id="cb6-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     to = "jonghoon.kim@ivi.int",</span></span>
<span id="cb6-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     subject = "Testing the `smtp_send()` function",</span></span>
<span id="cb6-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     credentials = creds_key(id = "outlook")</span></span>
<span id="cb6-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   )</span></span></code></pre></div>
</div>
<section id="make-it-into-a-single-function" class="level2">
<h2 class="anchored" data-anchor-id="make-it-into-a-single-function">Make it into a single function</h2>
<p>Make the above functions into a single function and register it for Windows task scheduler such that it can happen every day.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">pubmed_search_chatgpt_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb7-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">query=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"typhoid"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reldate=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_sentence=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-3.5-turbo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rentrez)</span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr)</span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(xml2)</span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(blastula)</span>
<span id="cb7-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># chatgpt_api_token &lt;- readRDS("chatGPT_api_key.rds")</span></span>
<span id="cb7-8">  chatgpt_api_token <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G:/My Drive/Personal/chatGPT_api_key.rds"</span>)</span>
<span id="cb7-9"></span>
<span id="cb7-10">  get_completion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(prompt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-3.5-turbo"</span>,</span>
<span id="cb7-11">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_token=</span>chatgpt_api_token){</span>
<span id="cb7-12">  response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">POST</span>(</span>
<span id="cb7-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.openai.com/v1/chat/completions"</span>, </span>
<span id="cb7-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_headers</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Authorization =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bearer"</span>, api_token)),</span>
<span id="cb7-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content_type_json</span>(),</span>
<span id="cb7-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json"</span>,</span>
<span id="cb7-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> model,</span>
<span id="cb7-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature =</span> temperature,</span>
<span id="cb7-20">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">messages =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">role =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, </span>
<span id="cb7-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content =</span> prompt))</span>
<span id="cb7-23">    )</span>
<span id="cb7-24">  )</span>
<span id="cb7-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content</span>(response)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>choices[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>content)</span>
<span id="cb7-26">}</span>
<span id="cb7-27">  </span>
<span id="cb7-28">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entrez_search</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">db=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pubmed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">term=</span>query, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">datetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pdat"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reldate=</span>reldate)</span>
<span id="cb7-29">  </span>
<span id="cb7-30">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># one or more hits</span></span>
<span id="cb7-31">    ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids</span>
<span id="cb7-32">    details <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entrez_fetch</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">db=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pubmed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span>ids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rettype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xml"</span>)</span>
<span id="cb7-33">    doc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xml</span>(details)</span>
<span id="cb7-34">    titles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//ArticleTitle"</span>))</span>
<span id="cb7-35">    abstracts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//Abstract"</span>))</span>
<span id="cb7-36">    dois <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//PubmedData/ArticleIdList/ArticleId[@IdType='doi']"</span>))</span>
<span id="cb7-37">    </span>
<span id="cb7-38">    abstract_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstracts))</span>
<span id="cb7-39"></span>
<span id="cb7-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstracts)) {</span>
<span id="cb7-41">      prompt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your task is to generate a short summary of a scientific article based on its title and abstract. Summarize the text delimited by triple backticks into "</span>, num_sentence , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" sentence. ``` Title: "</span>, titles[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">". Abstract: "</span>, abstracts[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"```"</span>)</span>
<span id="cb7-42">      abstract_summary[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_completion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prompt=</span>prompt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span>model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature=</span>temperature)</span>
<span id="cb7-43">    }</span>
<span id="cb7-44">  summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstract_summary), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;b&gt; "</span>, titles[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;/b&gt; "</span>, abstract_summary[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" PMID="</span>, ids[i] , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" DOI="</span>, dois[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;/p&gt;"</span>))</span>
<span id="cb7-45"></span>
<span id="cb7-46">  email <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compose_email</span>(</span>
<span id="cb7-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weekly summary of PubMed search"</span>,</span>
<span id="cb7-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md</span>(summary))</span>
<span id="cb7-49">  </span>
<span id="cb7-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">smtp_send</span>(</span>
<span id="cb7-51">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">email =</span> email,</span>
<span id="cb7-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jonghoon.kim@ivi.int"</span>,</span>
<span id="cb7-53">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kimfinale@gmail.com"</span>,</span>
<span id="cb7-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subject =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily summary of PubMed search"</span>,</span>
<span id="cb7-55">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># credentials = creds_key(id = "gmail")</span></span>
<span id="cb7-56">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">credentials =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">creds_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gmail_cred"</span>)</span>
<span id="cb7-57">  )</span>
<span id="cb7-58">  }</span>
<span id="cb7-59">}</span>
<span id="cb7-60"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pubmed_search_chatgpt_summary</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(taskscheduleR)</span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Schedule the script to run daily at a specific time</span></span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">taskscheduler_create</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">taskname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PubMed ChatGPT Summary"</span>,</span>
<span id="cb8-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rscript =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G:/My Drive/Personal/pubmed_search_chatgpt_summary.R"</span>),</span>
<span id="cb8-5">schedule <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAILY"</span>, starttime <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"08:00"</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>ChatGPT</category>
  <category>R</category>
  <category>xml</category>
  <category>httr</category>
  <guid>https://kimfinale.github.io/myblog/posts/pubmed-chatgpt_summary/index.html</guid>
  <pubDate>Thu, 31 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/pubmed-chatgpt_summary/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Polygon  : sf  raster </title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/area-polygon/index.html</link>
  <description><![CDATA[ 




<p><code>shapefile</code>   polygon   <code>raster</code>  <code>area</code>  <code>sf</code>  <code>st_area</code>    .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-2">kor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/area-polygon/gadm41_KOR_1.shp"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `gadm41_KOR_1' from data source 
  `C:\Users\jonghoon.kim\Documents\myblog\posts\area-polygon\gadm41_KOR_1.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 17 features and 11 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 124.6097 ymin: 33.11236 xmax: 131.8715 ymax: 38.61177
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># another way</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kor &lt;- read_sf(dsn="C:/Users/jonghoon.kim/Documents/myblog/posts/area-polygon", layer="gadm41_KOR_1")</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1e6 to get population density per 1 km^2</span></span>
<span id="cb3-5">kor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_sqkm1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_area</span>(kor))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e6</span></span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raster package way</span></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(raster)</span></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kor &lt;- shapefile("C:/Users/jonghoon.kim/Documents/myblog/posts/area-polygon/gadm41_KOR_1.shp")</span></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raster pkg works for the Spatial* object</span></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kor$area_sqkm2 &lt;- raster::area(as(kor, 'Spatial'))/1e6</span></span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot population density</span></span>
<span id="cb3-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-15">labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">atop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population density"</span>, per<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>km<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb3-16">plt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(kor)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>area_sqkm1))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span>labels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>)</span>
<span id="cb3-21">plt</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/area-polygon/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use RColorBrewer </span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RColorBrewer)</span>
<span id="cb4-3">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YlOrBr"</span>)</span>
<span id="cb4-4">plt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradientn</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span>labels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colors=</span>pal)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/area-polygon/index_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>R</category>
  <category>shapefile</category>
  <category>ggplot2</category>
  <category>sf</category>
  <category>raster</category>
  <category>RcolorBrewer</category>
  <guid>https://kimfinale.github.io/myblog/posts/area-polygon/index.html</guid>
  <pubDate>Tue, 29 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/area-polygon/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>ggplot2  </title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/drawing-map/index.html</link>
  <description><![CDATA[ 




<p><code>ggplot2</code>    .  shapefile   . shapefile       <code>sf</code>  <code>st_read</code>  <code>read_sf</code>    <code>ggplot2</code> <code>geom_sf</code>       .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-2">kor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/drawing-map/gadm41_KOR_1.shp"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `gadm41_KOR_1' from data source 
  `C:\Users\jonghoon.kim\Documents\myblog\posts\drawing-map\gadm41_KOR_1.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 17 features and 11 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 124.6097 ymin: 33.11236 xmax: 131.8715 ymax: 38.61177
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kor &lt;- read_sf(dsn="C:/Users/jonghoon.kim/Documents/myblog/posts/drawing-map", layer="gadm41_KOR_1")</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalized number of characters of the name of the admin unit (level 1)</span></span>
<span id="cb3-4">char_len <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(kor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>NAME_1, nchar)</span>
<span id="cb3-5">kor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>prop_char <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> char_len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(char_len)</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-8">plt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(kor)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>prop_char))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normalized</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">character length"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>)</span>
<span id="cb3-13"></span>
<span id="cb3-14">plt</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/drawing-map/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use color brewer </span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RColorBrewer)</span>
<span id="cb4-3">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YlOrBr"</span>)</span>
<span id="cb4-4">plt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> plt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradientn</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normalized</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">character length"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colors=</span>pal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb4-6">  </span>
<span id="cb4-7">plt</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/drawing-map/index_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clear some background stuff</span></span>
<span id="cb5-2">plt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> plt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bg of the panel</span></span>
<span id="cb5-4">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bg of the plot</span></span>
<span id="cb5-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get rid of legend bg</span></span>
<span id="cb5-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.box.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"null"</span>),</span>
<span id="cb5-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"null"</span>),</span>
<span id="cb5-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb5-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb5-20">plt</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/drawing-map/index_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>R</category>
  <category>map</category>
  <category>ggplot2</category>
  <category>sf</category>
  <category>RColorBrewer</category>
  <guid>https://kimfinale.github.io/myblog/posts/drawing-map/index.html</guid>
  <pubDate>Tue, 29 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/drawing-map/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Writing a paper: Start with an outline</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/how-to-write-a-paper/index.html</link>
  <description><![CDATA[ 




<p>       ,   .           .. <a href="https://onlinelibrary.wiley.com/doi/10.1002/adma.200400767">Writing a paper</a> by George M. Whitesides         .    outline ()  .         (  1 )        . , , ,           .          .</p>
<p>                  .                    .  , ,        , Whitesides          .     , ,                 .</p>



 ]]></description>
  <category>writing</category>
  <category>paper</category>
  <guid>https://kimfinale.github.io/myblog/posts/how-to-write-a-paper/index.html</guid>
  <pubDate>Tue, 29 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/how-to-write-a-paper/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Important figures from the book, How to avoid a climate diaster? by Bill Gates</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/climate-disaster/index.html</link>
  <description><![CDATA[ 




<p><a href="https://www.amazon.com/How-Avoid-Climate-Disaster-Breakthroughs/dp/059321577X">How to Avoid a Climate Disaster: The Solutions We Have and the Breakthroughs We Need</a> by Bill Gates is a comprehensive and accessible guide on how to tackle the urgent issue of climate change. Gates begins by laying out the scope of the problem, explaining that the world needs to reduce its greenhouse gas emissions to zero to avoid a catastrophe. Ive compiled important numbers from the book to understand the climate change issues.</p>
<ul>
<li><p>51 Billion Tonnes: This is the amount of greenhouse gases, measured in CO2 equivalent (<img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BCO_%7B2%7De%7D">), that humanity adds to the atmosphere every year.</p></li>
<li><p>Zero: According to Bill Gates, we need to bring this number down to zero to avoid a climate disaster. And he thinks it is possible through our technological advances. Watch his TED talk, <a href="https://www.youtube.com/watch?v=JaF-fq2Zn7I&amp;t=999s">Innovating to zero!</a>. He is a great speaker!</p></li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>Percentage</th>
<th>Item</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>27%</td>
<td>How we generate electricity</td>
</tr>
<tr class="even">
<td>31%</td>
<td>How we make things</td>
</tr>
<tr class="odd">
<td>18%</td>
<td>How we grow our food</td>
</tr>
<tr class="even">
<td>16%</td>
<td>How we move around</td>
</tr>
<tr class="odd">
<td>6%</td>
<td>How we keep warm or cool</td>
</tr>
</tbody>
</table>



 ]]></description>
  <category>parameter estimation</category>
  <category>R</category>
  <category>maximum likelihood</category>
  <category>profile likelihood</category>
  <guid>https://kimfinale.github.io/myblog/posts/climate-disaster/index.html</guid>
  <pubDate>Sun, 27 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/climate-disaster/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Regression toward the mean</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/regression-toward-mean/index.html</link>
  <description><![CDATA[ 




<p>In his <a href="https://www.youtube.com/watch?v=dzFf3r1yph8&amp;t=209s">lecture</a> Joseph Blitzstein talks about two basic statistical phenomena: Regression toward to the mean (RTTM) and survivor bias. The RTTM is todays topic. Topic was mainly written by GPT 4.</p>
<p>Regression toward the mean is a statistical phenomenon where extreme data points are likely to be followed by less extreme ones when measured again. In simpler terms, it means that if an extreme observation is observed, the next observation is likely to be closer to the mean or average.</p>
<section id="why-does-it-happen" class="level3">
<h3 class="anchored" data-anchor-id="why-does-it-happen">Why does it happen?</h3>
<p>Its primarily a matter of probability. Extreme values are, by definition, rare. So, when you take a second measurement, its simply more probable that the new value will be closer to the mean than the previous extreme value was.</p>
</section>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">Examples:</h3>
<p>Sports Performance: Imagine a basketball player who has an outstanding game, scoring well above their average number of points. If theyve played at such an exceptional level, its likely that in the next game they will score closer to their average (not necessarily because their skill has decreased, but simply due to the natural variability in performance).</p>
<p>Student Test Scores: If a student who typically scores around the average on exams gets an exceptionally high score on one test, they might score closer to their average on a subsequent test. Conversely, if they score exceptionally low on one test, they might score higher the next time.</p>
<p>Investment Returns: If a particular stock has an exceptionally good year with returns way above the market average, it might have more modest (or even below-average) returns the following year.</p>
<p>Height of Parents and their Children: This is a classic example by Sir Francis Galton. He found that very tall parents tend to have children who are shorter than them (but still above average), and very short parents tend to have children who are taller than them (but still below average). The childrens heights tend to regress towards the mean height.</p>
<p>Medical Treatments: If patients are selected for a clinical trial because they have exceptionally high blood pressure, some of them will probably show a reduction in blood pressure over time even without any treatment. This isnt because of any therapeutic effect, but simply because their initial measurements were unusually high and subsequent measurements tend to be closer to the mean.</p>
</section>
<section id="misunderstandings" class="level3">
<h3 class="anchored" data-anchor-id="misunderstandings">Misunderstandings:</h3>
<p>This concept is often misunderstood. For instance, if a student performs poorly on a test and then improves on the next one, it might be tempting to attribute this improvement to a particular intervention (like tutoring). While the intervention might have had an effect, its also possible that some of the improvement was due to regression toward the mean.</p>
<p>In research and experimental designs, this phenomenon needs to be taken into account, especially when making causal inferences from observed changes.</p>
<p>Toward the end of his talk, he mentions about the quote by Daniel Kahneman that very clearly explain the concept of RTTM.</p>
<p>I had the most satisfying Eureka experience of my career while attempting to teach flight instructors that praise is more effective than punishment for promoting skill-learning. . [A flight instructor objected:] On many occasions I have praised flight cadets for clean execution of some aerobatic maneuver, and in general when they try it again, they do worse. On the other hand, I have often screamed at cadets for bad execution, and in general they do better the next time. So please dont tell us that reinforcement works and punishment does not, because the opposite is the case. </p>
<p>This was a joyous moment, in which I understood an important truth about the world: because we tend to reward others when they do well and punish them when they do badly, and because there is regression to the mean, it is part of the human condition that we are statistically punished for rewarding others and rewarded for punishing them.</p>
<p>Full details of Kahnemans quote can be found from the following <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3292229/">article</a></p>


</section>

 ]]></description>
  <category>parameter estimation</category>
  <category>R</category>
  <category>maximum likelihood</category>
  <category>profile likelihood</category>
  <guid>https://kimfinale.github.io/myblog/posts/regression-toward-mean/index.html</guid>
  <pubDate>Thu, 24 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/regression-toward-mean/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Survivor bias</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/survivor-bias/index.html</link>
  <description><![CDATA[ 




<p>In his <a href="https://www.youtube.com/watch?v=dzFf3r1yph8&amp;t=209s">lecture</a> titled The Soul of statistics Joseph Blitzstein talks about a survivor bias (or conditioning more broadly) Dr.&nbsp;Derek Muller also talks about various examples of Korean houses in <a href="https://english.visitkorea.or.kr/svc/whereToGo/locIntrdn/locIntrdnList.do?vcontsId=97932&amp;menuSn=351">Bukchon Hanok Village</a> on his <a href="https://www.youtube.com/watch?v=_Qd3erAPI9w">YouTube</a></p>
<p>Survivor bias is todays topic and the following was written mostly by GPT 4.</p>
<p><strong>Survivor Bias: What Remains Tells Only Half the Story</strong></p>
<p>Imagine walking through a forest and noticing the tallest trees. You marvel at their height and strength, thinking that this is the natural order of things. But what about the saplings and smaller trees that didnt survive? This is the essence of survivor bias.</p>
<p><strong>What is Survivor Bias?</strong></p>
<p>Survivor bias, or survivorship bias, is a logical error of focusing on the people or things that made it past some selection process and overlooking those that did not, typically because of their lack of visibility. This can lead to false conclusions in numerous different ways.</p>
<p><strong>A Classic Example: WWII Airplanes</strong></p>
<p>During World War II, military officials examined planes returning from combat missions to determine where they were most frequently hit by enemy fire. The plan was simple: reinforce these areas to improve the aircrafts survival rate. The bullet holes were predominantly in the wings, body, and tail. So, it might seem logical to reinforce these parts.</p>
<p>However, a statistician named Abraham Wald pointed out a flaw in this reasoning. The planes they were inspecting had survived. The real question was: where were the bullet holes on the planes that didnt return? Wald hypothesized that the missing airplanes had been hit in the engine, a critical area absent of damage in the returning planes. By only looking at the survivors, the military had almost made a grave error.</p>
<p><strong>Why Does It Matter?</strong></p>
<p>Survivor bias can skew our understanding and lead to incorrect conclusions in various fields:</p>
<ul>
<li><p><strong>Business:</strong> When studying successful companies, we might conclude that their practices are best. But what about companies that followed the same practices and failed?</p></li>
<li><p><strong>Medicine:</strong> If we only focus on patients who return for follow-up after treatment, we might miss side effects or outcomes in those who didnt return.</p></li>
<li><p><strong>Culture:</strong> Celebrating only the top artists or authors might make us think that a particular style or theme is the key to success, overlooking other potential talents.</p></li>
</ul>
<p><strong>Overcoming Survivor Bias</strong></p>
<p>Awareness is the first step. Whenever youre examining successes, ask yourself: What am I not seeing? Seek out the failures, the unseen, the unreturned. By considering the whole picture, not just the apparent survivors, you get a clearer, more accurate view of reality.</p>
<p>In conclusion, while its natural to focus on winners and success stories, its crucial to remember the unseen and unspoken failures. They often hold the most valuable lessons.</p>



 ]]></description>
  <category>parameter estimation</category>
  <category>R</category>
  <category>maximum likelihood</category>
  <category>profile likelihood</category>
  <guid>https://kimfinale.github.io/myblog/posts/survivor-bias/index.html</guid>
  <pubDate>Thu, 24 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/survivor-bias/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Maximum Likelihood and Profile Likelihood for the SEIR model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/max-likelihood/index.html</link>
  <description><![CDATA[ 




<p>      (inferential statistics)        maximum likelihood (ML).   2014  Cole <em>et al</em>. <a href="https://academic.oup.com/aje/article/179/2/252/123902">Maximum Likelihood, Profile Likelihood, and Penalized Likelihood: A Primer</a>  maximum likelihood (ML)  profile likelihood    .</p>
<section id="--ml" class="level3">
<h3 class="anchored" data-anchor-id="--ml">  (ML)</h3>
<p>           . <img src="https://latex.codecogs.com/png.latex?n">   <img src="https://latex.codecogs.com/png.latex?n">   <img src="https://latex.codecogs.com/png.latex?y_1,%20y_2,%20...,%20y_n">   .     <img src="https://latex.codecogs.com/png.latex?f%20(y%7C%5Cboldsymbol%7B%5Ctheta%7D)">   <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D=(%5Ctheta_1,%20%5Ctheta_2,%20...,%20%5Ctheta_j)">  <img src="https://latex.codecogs.com/png.latex?Y=y">   .</p>
<p>        .   <img src="https://latex.codecogs.com/png.latex?f(y%7C%5Cboldsymbol%7B%5Ctheta%7D)">   <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D">  <img src="https://latex.codecogs.com/png.latex?Y">       <img src="https://latex.codecogs.com/png.latex?Y">    <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D">   .       <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;y_i)">  . ,      <img src="https://latex.codecogs.com/png.latex?f%20(y%7C%5Cboldsymbol%7B%5Ctheta%7D)"> <img src="https://latex.codecogs.com/png.latex?Y">   <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D">      . <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;y_i)">  <img src="https://latex.codecogs.com/png.latex?i">                  .</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;%5Cboldsymbol%7By%7D)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;y_i)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20f(y_i;%5Cboldsymbol%7B%5Ctheta%7D)"></p>
<p>  <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7By%7D=(y_1,%20y_2,%20...,%20y_n)"> .</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;%5Cboldsymbol%7By%7D)">  <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D">          ( )  . ML      <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D">    .</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Ctheta%7D%20=%20%5Ctextrm%7Bargmax%7D_%7B%5Ctheta%7D%5C%7B%7B%5Cmathrm%7Blog%7D%20%5Cmathcal%7BL%7D(%5Ctheta)%7D%5C%7D"></p>
<p>  <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Blog%7D">                (i.e., <a href="https://en.wikipedia.org/wiki/Arithmetic_underflow">arithmetic underflow</a>     )  <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Blog%7D%20%5Cmathcal%7BL%7D(%5Ctheta)">  .              <img src="https://latex.codecogs.com/png.latex?-%5Cmathrm%7Blog%7D%20%5Cmathcal%7BL%7D(%5Ctheta)">   .</p>
<p>        .</p>
</section>
<section id="---" class="level3">
<h3 class="anchored" data-anchor-id="---">   </h3>
<p>    .  Weibull, Gamma,  Lognormal                    .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1220</span>)</span>
<span id="cb1-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of observations</span></span>
<span id="cb1-3">lamb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true parameter value</span></span>
<span id="cb1-4">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>lamb) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># observations</span></span>
<span id="cb1-5">nll_theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(theta){</span>
<span id="cb1-6">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpois</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># negative log likelihood</span></span>
<span id="cb1-7">}</span>
<span id="cb1-8">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optimize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">f=</span>nll_theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e6</span>))</span>
<span id="cb1-9">res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>minimum <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#\hat{\theta} compare w/ lamb</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>minimum) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># likelihood</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.090828e-11</code></pre>
</div>
</div>
<p>   ML      .</p>


</section>

 ]]></description>
  <category>parameter estimation</category>
  <category>R</category>
  <category>maximum likelihood</category>
  <category>profile likelihood</category>
  <guid>https://kimfinale.github.io/myblog/posts/max-likelihood/index.html</guid>
  <pubDate>Sun, 13 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/max-likelihood/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Population Monte Carlo  </title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/R0-sympy/index.html</link>
  <description><![CDATA[ 




<p>        <a href="https://jonghoonkim.ghost.io/ghost/#/editor/post/63aae251d7d6b5003d2967d1"></a>,   (<img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">) .            19                 .         .</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Cmathcal%7BR%7D_0%20=%20%5Cbeta%20c%20D%20"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta">            , <img src="https://latex.codecogs.com/png.latex?c">       , <img src="https://latex.codecogs.com/png.latex?D">      . <img src="https://latex.codecogs.com/png.latex?%5Cbeta">  <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20c">     .   <img src="https://latex.codecogs.com/png.latex?%5Cbeta">            .      <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">  ?   SIR   .</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS/%5Cmathrm%7Bd%7Dt%20&amp;=%20-%5Cbeta%20I%20S/N%20%5C%5C%0A%5Cmathrm%7Bd%7DI/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cbeta%20I%20S/N%20-%20%5Cgamma%20I%5C%5C%0A%5Cmathrm%7Bd%7DR/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cgamma%20I%0A%5Cend%7Balign%7D"></p>
<p>     <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0%20=%20%5Cbeta/%5Cgamma">    .  <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">              . (i.e., <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Bd%7DI/%5Cmathrm%7Bd%7Dt%3E0">)</p>
<p>  <a href="https://link.springer.com/article/10.1007/BF00178324">Diekmann <em>et al.</em></a>    next generation       <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">   .   <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0"> next generation operator spectral radius  .    <a href="https://www.sciencedirect.com/science/article/pii/S0025556402001086">van den Driessche <em>et al.</em></a>           .    python SymPy    .    ( SEIR )   .</p>
<p>Next generation operator <img src="https://latex.codecogs.com/png.latex?G">           <img src="https://latex.codecogs.com/png.latex?F">      (V)     . <img src="https://latex.codecogs.com/png.latex?G=FV%5E%7B-1%7D">.  <img src="https://latex.codecogs.com/png.latex?R_0"> <img src="https://latex.codecogs.com/png.latex?G"> <a href="https://en.wikipedia.org/wiki/Spectral_radius">spectral radius</a> .    <img src="https://latex.codecogs.com/png.latex?%5Cbeta,%20%5Cgamma">  b, g .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sympy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-2">b, k, g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p k g'</span>)</span>
<span id="cb1-3">F <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, b],[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb1-4">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[k, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>k, g]])</span>
<span id="cb1-5">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-6">eigval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> M.eigenvals(simplify<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true)</span>
<span id="cb1-7">init_printing(use_unicode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-8">eigval</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      p   
0: 1, : 1
      g   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#      b   </span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0: 1, : 1</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#      g   </span></span>
<span id="cb3-4">lst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(eigval.keys())</span>
<span id="cb3-5">lst[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p

g</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#b</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#g</span></span></code></pre></div>
</div>
<p>  SEIR              . <a href="https://journals.plos.org/plosntds/article?id=10.1371/journal.pntd.0002642">Pitzer <em>et al</em>.</a>                   (<img src="https://latex.codecogs.com/png.latex?%5Clambda_p">  <img src="https://latex.codecogs.com/png.latex?%5Clambda_w">)   <img src="https://latex.codecogs.com/png.latex?S_1%20%5Crightarrow%20I_1">   <img src="https://latex.codecogs.com/png.latex?R%20%5Crightarrow%20S_2%20%5Crightarrow%20I_2">   .  (supplementary material)      .</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS_1/%5Cmathrm%7Bd%7Dt%20&amp;=%20B%20+%20%5Cepsilon%20S_2%20-%20(%5Clambda_p+%5Clambda_w-%5Cmu)S_1%5C%5C%0A%5Cmathrm%7Bd%7DI_1/%5Cmathrm%7Bd%7Dt%20&amp;=%20(%5Clambda_p+%5Clambda_w)S_1%20-%20(%5Cdelta+%5Cmu)%20I_1%20%5C%5C%0A%5Cmathrm%7Bd%7DR/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cdelta(1-%5Ctheta-%5Calpha)(I_1+I_2)%20-%20(%5Comega%20+%5Cmu)R%20%5C%5C%0A%5Cmathrm%7Bd%7DC/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cdelta%5Ctheta(I_1+I_2)%20-%20%5Cmu%20C%20%5C%5C%0A%5Cmathrm%7Bd%7DS_2/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Comega%20R%20-%5Cepsilon%20S_2%20-%20(%5Clambda_p+%5Clambda_w-%5Cmu)%20S_2%5C%5C%0A%5Cmathrm%7Bd%7DI_2/%5Cmathrm%7Bd%7Dt%20&amp;=%20(%5Clambda_p+%5Clambda_w)%20S_2%20-%20(%5Cdelta+%5Cmu)%20I_2%20%5C%5C%0A%5Cmathrm%7Bd%7DW/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cgamma(I_1+rI_2+rC)%20-%20%5Cxi%20W%0A%5Cend%7Balign%7D"></p>
<p>      . SymPy       .</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0AR_0%20=%20%5Cfrac%7B1%7D%7B%5Cmu+%5Cdelta%7D%20%5Cleft(%5Cbeta_p%20+%5Cfrac%7B%5Cgamma%20%5Cbeta_w%7D%7B%5Cxi%7D%5Cright)%20%5Cleft(1%20+%5Cfrac%7B%5Cdelta%5Ctheta%20r%7D%7B%5Cmu%7D%5Cright)%0A%5Cend%7Balign%7D"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">p, r, w, N, d, m, t, m, g, x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p r w N d m t m g x'</span>)</span>
<span id="cb6-2">F <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[p, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p, w<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb6-3">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t, m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g, x]])</span>
<span id="cb6-4">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-5">eigval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> M.eigenvals(simplify<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true)</span>
<span id="cb6-6">init_printing(use_unicode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-7">eigval </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      (Ngw + px)(drt + m)   
0: 3, : 1
             mx(d + m)          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">lst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(eigval.keys())</span>
<span id="cb8-2">R0_eig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lst[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb8-3">R0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>x)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>r)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>m) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0 from the Pitzer (2014)</span></span>
<span id="cb8-4">simplify(R0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R0_eig) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0 for the same expression (symbolic assessment)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0</span></span>
<span id="cb10-2">R0.equals(R0_eig) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True for the same expression (numerical assessment)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#True</span></span></code></pre></div>
</div>
<p>        <img src="https://latex.codecogs.com/png.latex?V_%7B3,3%7D">    . <img src="https://latex.codecogs.com/png.latex?%5Cdelta%20+%5Cmu">  <img src="https://latex.codecogs.com/png.latex?%5Cmu">   .    <img src="https://latex.codecogs.com/png.latex?C">             <img src="https://latex.codecogs.com/png.latex?%5Cdelta">   .         <img src="https://latex.codecogs.com/png.latex?R_0">     . ,    (18)       SymPy    .</p>



 ]]></description>
  <category>Monte Carlo</category>
  <category>R</category>
  <category>parameter estimation</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://kimfinale.github.io/myblog/posts/R0-sympy/index.html</guid>
  <pubDate>Thu, 10 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/R0-sympy/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Population Monte Carlo  </title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/pop-monte-carlo/index.html</link>
  <description><![CDATA[ 




<p>  (particle filtering; PF)   <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_t">     . ,    PF      <img src="https://latex.codecogs.com/png.latex?%5Cbeta=%5Cmathcal%7BR%7D_0%20%5Cgamma">   time-invariant       . <a href="https://www.tandfonline.com/doi/abs/10.1198/106186004X12803?journalCode=ucgs20">Population Monte Carlo (PMC)</a>   .</p>
<p>  SIR   <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> PMC   .  PMC   .   <a href="">particle filtering</a>  .    (importance sampling)        Markov Chain Monte Carlo   proposal            .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(truncnorm) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># draw or evaluate according to a truncated normal dist  </span></span>
<span id="cb1-2">pmc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb1-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial values</span></span>
<span id="cb1-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># observation</span></span>
<span id="cb1-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npart =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of particles </span></span>
<span id="cb1-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">niter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># iterations</span></span>
<span id="cb1-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to control the number of daily y to be fitted</span></span>
<span id="cb1-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dt for the ODE integration</span></span>
<span id="cb1-9">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior_mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb1-10">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior_sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-11">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior_lb =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-12">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior_ub =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb1-13">  </span>
<span id="cb1-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># makes it easy to use truncated normal distribution</span></span>
<span id="cb1-15">  nstate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x0) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of state variables (i.e., S, I, R, CI)</span></span>
<span id="cb1-16">  </span>
<span id="cb1-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial betas are sampled according to the prior distribution</span></span>
<span id="cb1-18">  beta0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rtruncnorm</span>(npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>prior_mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>prior_sd)</span>
<span id="cb1-19">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to store the samples for beta</span></span>
<span id="cb1-20">  beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta0 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the initial values for the first row</span></span>
<span id="cb1-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># proposal for the next iteration, which is then resampled according to the  weight</span></span>
<span id="cb1-22">  sd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale for the proposal is adapted according to the current sample </span></span>
<span id="cb1-23">  beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rtruncnorm</span>(npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sd)</span>
<span id="cb1-24">  </span>
<span id="cb1-25">  lik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># likelihood </span></span>
<span id="cb1-26">  proposal_prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter)</span>
<span id="cb1-27">  wt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># weight </span></span>
<span id="cb1-28">  W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalized weights</span></span>
<span id="cb1-29">  A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Resample according to the normalized weight</span></span>
<span id="cb1-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial value  </span></span>
<span id="cb1-31">  proposal_prob[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-32">  wt[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> npart  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial weights</span></span>
<span id="cb1-33">  W[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wt[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]</span>
<span id="cb1-34"> </span>
<span id="cb1-35">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>niter) {</span>
<span id="cb1-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cat("i =", i, "\n")</span></span>
<span id="cb1-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tend increases by 1 accounts for the initial values</span></span>
<span id="cb1-38">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(npart, tend<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nstate),</span>
<span id="cb1-39">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(x0)))</span>
<span id="cb1-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (nm <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(x0)) {<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># starting values for each particle</span></span>
<span id="cb1-41">      X[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nm] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x0[[nm]]</span>
<span id="cb1-42">    }</span>
<span id="cb1-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># run process model (i.e., SIR model) </span></span>
<span id="cb1-44">    x_1_tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-45">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">process_model</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params =</span> params,</span>
<span id="cb1-46">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> X,</span>
<span id="cb1-47">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt,</span>
<span id="cb1-48">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta =</span> beta[i,])</span>
<span id="cb1-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate weights (likelihood)</span></span>
<span id="cb1-50">    lik[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assign_weights</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x_1_tend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>tend])</span>
<span id="cb1-51">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalize particle weights</span></span>
<span id="cb1-52">    proposal_prob[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dtruncnorm</span>(beta[i,], beta[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sd)</span>
<span id="cb1-53">    prior_prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dtruncnorm</span>(beta[i,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>prior_mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>prior_sd)</span>
<span id="cb1-54">    wt[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lik[i,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> prior_prob <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> proposal_prob[i,]</span>
<span id="cb1-55">    </span>
<span id="cb1-56">    W[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wt[i,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(wt[i,])</span>
<span id="cb1-57">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># resample particles by sampling parent particles according to normalized weights</span></span>
<span id="cb1-58">    A[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob=</span>W[i,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span>T)</span>
<span id="cb1-59">    beta[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta[i, A[i,]] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># resampled beta according to the normalized weight</span></span>
<span id="cb1-60">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sd for the proposal can be adapted in various other ways, but we use the sd of the current sample</span></span>
<span id="cb1-61">    sd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(beta[i,]) </span>
<span id="cb1-62">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate proposals for the next iteration</span></span>
<span id="cb1-63">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> niter) {</span>
<span id="cb1-64">      beta[i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rtruncnorm</span>(npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>beta[i,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sd)</span>
<span id="cb1-65">    } </span>
<span id="cb1-66">  } <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># end iteration</span></span>
<span id="cb1-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lik=</span>lik, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W=</span>W, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A=</span>A))</span>
<span id="cb1-68">}</span></code></pre></div>
</div>
<p>    SIR  .    SIR  .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">process_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb2-2">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb2-3">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb2-4">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) {</span>
<span id="cb2-5">  </span>
<span id="cb2-6">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a vector of initial S across the particles</span></span>
<span id="cb2-7">  I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a vector of initial I across the particles</span></span>
<span id="cb2-8">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a vector of initial S across the particles</span></span>
<span id="cb2-9">  </span>
<span id="cb2-10">  len <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>]) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># length of model predictions (same as the data points) + 1 accounting for the initial values</span></span>
<span id="cb2-11">         </span>
<span id="cb2-12">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R</span>
<span id="cb2-13">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]]</span>
<span id="cb2-14">  </span>
<span id="cb2-15">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>len) {</span>
<span id="cb2-16">    daily_infected <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to track the daily infection</span></span>
<span id="cb2-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(dt, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dt)) { <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># steps per day</span></span>
<span id="cb2-18">      FOI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N</span>
<span id="cb2-19">      S_to_I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FOI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt</span>
<span id="cb2-20">      I_to_R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt</span>
<span id="cb2-21">  </span>
<span id="cb2-22">      S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> S_to_I</span>
<span id="cb2-23">      I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> S_to_I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> I_to_R</span>
<span id="cb2-24">      R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I_to_R</span>
<span id="cb2-25">      </span>
<span id="cb2-26">      daily_infected <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> daily_infected <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> S_to_I</span>
<span id="cb2-27">    }</span>
<span id="cb2-28">    </span>
<span id="cb2-29">    x[, j, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S</span>
<span id="cb2-30">    x[, j, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> I</span>
<span id="cb2-31">    x[, j, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R</span>
<span id="cb2-32">    x[, j, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inc"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> daily_infected</span>
<span id="cb2-33">  }</span>
<span id="cb2-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>len, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inc"</span>])</span>
<span id="cb2-35">}</span></code></pre></div>
</div>
<p>      .   process_model          .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">parm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb3-2">x0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9990</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Inc=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb3-3">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the number of observations</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tend + 1 to account for the initial values</span></span>
<span id="cb3-5">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, tend<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), </span>
<span id="cb3-6">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(x0)))</span>
<span id="cb3-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (nm <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(x0)) {<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># starting values for each particle</span></span>
<span id="cb3-8">  X[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nm] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x0[[nm]]</span>
<span id="cb3-9">}</span>
<span id="cb3-10">truebeta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true beta</span></span>
<span id="cb3-11">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">process_model</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>parm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>truebeta)</span>
<span id="cb3-12">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(tend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(pred))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span></code></pre></div>
</div>
<p>pmc      assign_weights  .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">assign_weights <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (x, y) {</span>
<span id="cb4-2">  di <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(x)</span>
<span id="cb4-3">  npart <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> di[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of particles</span></span>
<span id="cb4-4">  nobs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> di[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of observations</span></span>
<span id="cb4-5">  loglik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, npart)</span>
<span id="cb4-6">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>npart) {</span>
<span id="cb4-7">    mean_case <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x[i,] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for the ith particle</span></span>
<span id="cb4-8">    expected_case <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, mean_case)</span>
<span id="cb4-9">    obs_case <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(y)</span>
<span id="cb4-10">    loglik[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpois</span>(obs_case, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>expected_case, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb4-11">  }</span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(loglik)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert to normal probability</span></span>
<span id="cb4-13">}</span></code></pre></div>
</div>
<p>PMC       .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gamma and x0 are set to the same as the model used to generate the data</span></span>
<span id="cb5-3">parm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span>
<span id="cb5-4">x0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9990</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Inc=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial condition</span></span>
<span id="cb5-5">niter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># out = pmc(params = parm, x0 = x0, y=y, npart=10000, niter=niter, </span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#    tend = length(y), dt=0.1, prior_mean=0.5, prior_sd=0.1, prior_lb=0,</span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#    prior_ub=2)</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># saveRDS(out, "out_20230811.rds")</span></span>
<span id="cb5-10">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"out_20230811.rds"</span>)</span>
<span id="cb5-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(out<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>theta[niter,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(beta), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb5-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>truebeta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/pop-monte-carlo/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>Monte Carlo</category>
  <category>R</category>
  <category>parameter estimation</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://kimfinale.github.io/myblog/posts/pop-monte-carlo/index.html</guid>
  <pubDate>Wed, 09 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/pop-monte-carlo/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Simple mathematical models with very complicated dynamics</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index.html</link>
  <description><![CDATA[ 




<section id="simple-mathematical-models-with-very-complicated-dynamics" class="level3">
<h3 class="anchored" data-anchor-id="simple-mathematical-models-with-very-complicated-dynamics">Simple mathematical models with very complicated dynamics</h3>
<p>Robert M. May Nature Vol. 261 June 10, 1976</p>
<p>This article discusses a simple first order difference equations that can display very complicated dynamics.</p>
<p><img src="https://latex.codecogs.com/png.latex?X_%7Bt+1%7D%20=%20F(X_t)"></p>
<p>In biological population, the nonlinear function <img src="https://latex.codecogs.com/png.latex?F(x)"> often has the following properties. <img src="https://latex.codecogs.com/png.latex?F(0)=0">; <img src="https://latex.codecogs.com/png.latex?F(x)"> increases monotonically as <img src="https://latex.codecogs.com/png.latex?X"> increases through the range of <img src="https://latex.codecogs.com/png.latex?0%3CX%3CA"> (with <img src="https://latex.codecogs.com/png.latex?F(x)"> attaining its maximum value at <img src="https://latex.codecogs.com/png.latex?X=A">); <img src="https://latex.codecogs.com/png.latex?F(X)"> decreases monotonically as <img src="https://latex.codecogs.com/png.latex?X"> increases beyond <img src="https://latex.codecogs.com/png.latex?X=A"> <img src="https://latex.codecogs.com/png.latex?N_%7Bt+1%7D%20=%20N_t(a-bN_t)"></p>
<p><img src="https://latex.codecogs.com/png.latex?X_%7Bt+1%7D%20=%20a%20X_t%20(1-X_t)"></p>
<p>X must remain on the interval <img src="https://latex.codecogs.com/png.latex?0%3CX%3C1">; if <img src="https://latex.codecogs.com/png.latex?X"> ever exceeds unity, subsequent iterations diverge towards <img src="https://latex.codecogs.com/png.latex?-%5Cinfty">. Furthermore, <img src="https://latex.codecogs.com/png.latex?F(X)"> attains a maximum value of <img src="https://latex.codecogs.com/png.latex?a/4"> at <img src="https://latex.codecogs.com/png.latex?X=1/2">; the equation therefore possesses non-trivial dynamical behaviour only if <img src="https://latex.codecogs.com/png.latex?a%3C4">. On the other hand, all trajectories are attracted to <img src="https://latex.codecogs.com/png.latex?X=0"> if <img src="https://latex.codecogs.com/png.latex?a%3C1">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function to compute the value at the next time step</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0 &lt; x &lt; 1</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a &lt; 1 for x to go to zero</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a &gt; 4 leads to x &gt; 1 at one point, which then leads to - infinity</span></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 &lt; a &lt; 4 for x to exhibit non-trivial dynamics</span></span>
<span id="cb1-6">x_next <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a, x){</span>
<span id="cb1-7">  a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x)</span>
<span id="cb1-8">}</span>
<span id="cb1-9"></span>
<span id="cb1-10">x0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb1-11">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.707</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.414</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># values were adopted from the paper by May Nature Vol. 261 June 10, 1976</span></span>
<span id="cb1-12">xnext <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(x0, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">x_next</span>(a, x))</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x0, xnext[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'l'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb1-15">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(X[t]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(X[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x0, xnext[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,])</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># line y = x</span></span>
<span id="cb1-18"></span>
<span id="cb1-19">xstar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>a <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># points where X(t+1) = X(t)</span></span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># slope at the point x given a</span></span>
<span id="cb1-23">dx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a,x){</span>
<span id="cb1-24">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>a</span>
<span id="cb1-25">}</span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function to compute intercept at the given slope b and point x</span></span>
<span id="cb1-28">intcpt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(b,x){</span>
<span id="cb1-29">  x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> b<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x</span>
<span id="cb1-30">}</span>
<span id="cb1-31"></span>
<span id="cb1-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intcpt</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intcpt</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">x_iter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a, x, iter, func){</span>
<span id="cb2-2">  xvec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, iter)</span>
<span id="cb2-3">  xvec[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x</span>
<span id="cb2-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>iter){</span>
<span id="cb2-5">    xvec[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">func</span>(a, xvec[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>])  </span>
<span id="cb2-6">  }</span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(xvec)</span>
<span id="cb2-8">}</span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">x_iter</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, x_next), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?X_%7Bt+1%7D%20=%20X_t%20%5Ctextrm%7Bexp%7D%5Br(1-X_t)%5D"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">x_next_exp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r, x){</span>
<span id="cb3-2">  x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x))</span>
<span id="cb3-3">}</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">x_iter</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, x_next_exp), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">x_next2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r, x){</span>
<span id="cb4-2"> x1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x)</span>
<span id="cb4-3"> x2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x1)</span>
<span id="cb4-4"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(x2)</span>
<span id="cb4-5">}</span>
<span id="cb4-6"></span>
<span id="cb4-7">xnext <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(x0, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">x_next2</span>(a, x))</span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x0, xnext[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'l'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb4-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(X[t]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(X[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))</span>
<span id="cb4-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x0, xnext[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,])</span>
<span id="cb4-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># line y = x</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index.html</guid>
  <pubDate>Mon, 07 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Sub-exponential growth</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/ode-in-stan/index.html</link>
  <description><![CDATA[ 




<p>Stan     ODE      .        Stan  SIR     (<img src="https://latex.codecogs.com/png.latex?%5Cbeta,%20%5Cgamma">)   .  deSolve    SIR          (dayinc)       (yobs).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">sir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, state, parameters) {</span>
<span id="cb1-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(state, parameters)),{</span>
<span id="cb1-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate of change</span></span>
<span id="cb1-4">    N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R</span>
<span id="cb1-5">    dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N </span>
<span id="cb1-6">    dI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb1-7">    dR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb1-8">    dCI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> beta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N </span>
<span id="cb1-9">    </span>
<span id="cb1-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># return the rate of change</span></span>
<span id="cb1-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dS, dI, dR, dCI))</span>
<span id="cb1-12">  }) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># end with(as.list ...</span></span>
<span id="cb1-13">}</span>
<span id="cb1-14"></span>
<span id="cb1-15">y0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">CI=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-16">parms <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)</span>
<span id="cb1-17">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-20">deSolve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>sir, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>parms) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> out</span>
<span id="cb1-22"></span>
<span id="cb1-23">dayinc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(out<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CI)</span>
<span id="cb1-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb1-25">yobs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dayinc), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>dayinc)</span>
<span id="cb1-26"></span>
<span id="cb1-27">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dayinc), </span>
<span id="cb1-28">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span>dayinc,</span>
<span id="cb1-29">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs=</span>yobs)</span>
<span id="cb1-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the ggplot theme was adopted from the following website: https://mpopov.com/tutorials/ode-stan-r/</span></span>
<span id="cb1-32"></span>
<span id="cb1-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb1-34"></span>
<span id="cb1-35"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(time, model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(time, model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(time, obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observation"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(time, obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observation"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (day)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily incidence"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Incidence from the SIR model"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observation"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/ode-in-stan/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>  Stan  . Posterior predictive check    generated quantities  ypred  .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">stan_code <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions {</span></span>
<span id="cb2-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector sir(real t,        // time</span></span>
<span id="cb2-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">             vector y,      // state</span></span>
<span id="cb2-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">             vector theta  // parameters</span></span>
<span id="cb2-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">             ) {      </span></span>
<span id="cb2-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    vector[4] dydt;</span></span>
<span id="cb2-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb2-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    real S = y[1];</span></span>
<span id="cb2-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    real I = y[2];</span></span>
<span id="cb2-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    real R = y[3];</span></span>
<span id="cb2-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    real N = S + I + R;</span></span>
<span id="cb2-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb2-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    real beta = theta[1];</span></span>
<span id="cb2-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    real gamma = theta[2];</span></span>
<span id="cb2-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb2-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    dydt[1] = - beta * S * I / N;</span></span>
<span id="cb2-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    dydt[2] = beta * S * I / N - gamma * I;</span></span>
<span id="cb2-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    dydt[3] = gamma * I;</span></span>
<span id="cb2-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    dydt[4] = beta * S * I / N;</span></span>
<span id="cb2-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb2-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    return dydt;</span></span>
<span id="cb2-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb2-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-24"></span>
<span id="cb2-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data {</span></span>
<span id="cb2-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int&lt;lower=1&gt; T;</span></span>
<span id="cb2-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real t0;</span></span>
<span id="cb2-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  array[T] real ts; </span></span>
<span id="cb2-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[4] y0;</span></span>
<span id="cb2-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int y_obs[T];</span></span>
<span id="cb2-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-32"></span>
<span id="cb2-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">parameters {</span></span>
<span id="cb2-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector&lt;lower=0&gt;[2] theta; // [beta, gamma]</span></span>
<span id="cb2-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-36"></span>
<span id="cb2-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">model {</span></span>
<span id="cb2-38"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  array[T] vector[4] mu = ode_rk45(sir, y0, t0, ts, theta);</span></span>
<span id="cb2-39"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real dayinc[T]; // daily incidence</span></span>
<span id="cb2-40"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  dayinc[1] = mu[1, 4] + 1e-12;</span></span>
<span id="cb2-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (t in 2:T){</span></span>
<span id="cb2-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    dayinc[t] = mu[t, 4] - mu[t-1, 4] + 1e-12; </span></span>
<span id="cb2-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb2-44"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  theta ~ exponential(1); // both parameters are on the positive real line</span></span>
<span id="cb2-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  y_obs ~ poisson(dayinc); // likelihood</span></span>
<span id="cb2-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-47"></span>
<span id="cb2-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">generated quantities {</span></span>
<span id="cb2-49"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  array[T] vector[4] mu = ode_rk45(sir, y0, t0, ts, theta);</span></span>
<span id="cb2-50"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real dayinc[T];</span></span>
<span id="cb2-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  dayinc[1] = mu[1, 4] + 1e-12;</span></span>
<span id="cb2-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (t in 2:T){</span></span>
<span id="cb2-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    dayinc[t] = mu[t,4] - mu[t-1,4] + 1e-12;</span></span>
<span id="cb2-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb2-55"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int ypred[T]; // posterior predictive </span></span>
<span id="cb2-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (t in 1:T) {</span></span>
<span id="cb2-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ypred[t] = poisson_rng(dayinc[t]);</span></span>
<span id="cb2-58"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb2-59"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</div>
<p>  Stan    .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rstan)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mc.cores =</span> parallel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detectCores</span>())</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rstan_options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">auto_write =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this is for the stan model in a separate file</span></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mod &lt;- stan_model(file=paste0(getwd(),"/stan/sir_stan.stan"),</span></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                   verbose=TRUE)</span></span>
<span id="cb3-8">mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stan_model</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model_code=</span>stan_code, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-9">T <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># end time unit for the ODE model, also the number of data points</span></span>
<span id="cb3-10">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">T=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ts=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_obs=</span>yobs)</span>
<span id="cb3-11">smp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sampling</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object=</span>mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>)</span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># saveRDS(smp, "outputs/stan_smp_20230801.rds")</span></span></code></pre></div>
</div>
<p> posterior  .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># smp &lt;- readRDS("outputs/stan_smp_20230801.rds")</span></span>
<span id="cb4-2">smp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stan_smp_20230801.rds"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># file is under the content/post/the_relevant_post_name/index_files/figure_html</span></span>
<span id="cb4-3">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(smp)</span>
<span id="cb4-4">pr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>)</span>
<span id="cb4-5">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(df[,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^theta.*"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df))],</span>
<span id="cb4-6">                           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs=</span>pr)))</span>
<span id="cb4-7">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>)</span>
<span id="cb4-8">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)</span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(d)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2.5%</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">97.5%</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">50%</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimates"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>true, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True value"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimates"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True value"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Median estimates with 95% CrI"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>),</span>
<span id="cb4-17">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(beta),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(gamma)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/ode-in-stan/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p> posterior predictive check        .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pr &lt;- c(0.5,0.025,0.975)</span></span>
<span id="cb5-2">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(df[,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^ypred.*"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df))]))</span>
<span id="cb5-3">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span></span>
<span id="cb5-4">dlong <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(d, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>time)</span>
<span id="cb5-5">dayincdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inc=</span>dayinc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)</span>
<span id="cb5-6">yobsdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs=</span>yobs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)</span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dlong)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(time, value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span>name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior predictive"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dayincdf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(time, inc, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>yobsdf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(time, obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observation"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>yobsdf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(time, obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observation"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (day)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily incidence"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior predictive check"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior predictive"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observation"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/ode-in-stan/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>news</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://kimfinale.github.io/myblog/posts/ode-in-stan/index.html</guid>
  <pubDate>Sun, 06 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/ode-in-stan/unnamed-chunk-5-1.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>Sub-exponential growth</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/sub-exponential-growth/index.html</link>
  <description><![CDATA[ 




<p> SIR        .</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cmathrm%7Bd%7DI%7D%7B%5Cmathrm%7Bd%7Dt%7D%20=%20%5Cbeta%20S%5Cfrac%7BI%7D%7BN%7D."></p>
<p>   .      <img src="https://latex.codecogs.com/png.latex?%5Cbeta">   ,          .        <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BI%7D%7BN%7D">  . <img src="https://latex.codecogs.com/png.latex?N">    .     frequency-dependent  .</p>
<p>           exponential growth (EG)  .  <a href="https://royalsocietypublishing.org/doi/10.1098/rsif.2016.0659">Chowell <em>et al</em>.</a>             SIR       sub-exponential growth (SEG)   .        SEG  .        inhomogeneous mixing  .  inhomogeneous mixing SEG        .                      .  inhomogeneous mixing            (   clustering)            . Inhomogeneous mixing             SEG   .</p>
<p>SEG         <a href="https://royalsocietypublishing.org/doi/10.1098/rsif.2016.0659"><img src="https://latex.codecogs.com/png.latex?%5Calpha"></a>     .</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cmathrm%7Bd%7DI%7D%7B%5Cmathrm%7Bd%7Dt%7D%20=%20%5Cbeta%20S%5Cfrac%7BI%5E%5Calpha%7D%7BN%7D."></p>
<p>  SEG SEIR       EG   .</p>
<p>   SEIR  .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">seir_ode <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, y, params) {</span>
<span id="cb1-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># state variables </span></span>
<span id="cb1-3">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>]; </span>
<span id="cb1-4">  E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>]; </span>
<span id="cb1-5">  I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>]; </span>
<span id="cb1-6">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>];</span>
<span id="cb1-7">  CI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CI"</span>]</span>
<span id="cb1-8">  </span>
<span id="cb1-9">  epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsilon"</span>]] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/epsilon = latent period</span></span>
<span id="cb1-10">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/gamma = duration of infectiousness</span></span>
<span id="cb1-11">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0 = beta/gamma</span></span>
<span id="cb1-12">  alpha <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alpha"</span>]]</span>
<span id="cb1-13">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> E <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># total population size</span></span>
<span id="cb1-14">  muSE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (I<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(alpha)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> N <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate from S to E</span></span>
<span id="cb1-15">  muEI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> epsilon <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> E <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate from E to I, i.e., 1/epsilon = latent period</span></span>
<span id="cb1-16">  muIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> I <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate from I to R</span></span>
<span id="cb1-17">  </span>
<span id="cb1-18">  dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muSE <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate of change for S</span></span>
<span id="cb1-19">  dE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muSE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muEI <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate of change for E</span></span>
<span id="cb1-20">  dI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muEI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> muIR <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate of change for I</span></span>
<span id="cb1-21">  dR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muIR <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate of change for R</span></span>
<span id="cb1-22">  dCI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muSE <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rate of change for R</span></span>
<span id="cb1-23">  </span>
<span id="cb1-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dS, dE, dI, dR, dCI))) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># return as a list to use deSolve package</span></span>
<span id="cb1-25">}</span></code></pre></div>
</div>
<p>  .    global   .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial conditions as global variables</span></span>
<span id="cb2-2">I0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initially infected people</span></span>
<span id="cb2-3">y0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> I0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">E=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span>I0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">CI=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial values for state variables</span></span>
<span id="cb2-4">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># simulation end time 50 days</span></span>
<span id="cb2-5">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, tend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># daily output for 150 days</span></span></code></pre></div>
</div>
<p>           .       .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># baseline parameters</span></span>
<span id="cb3-2">pinit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb3-3">  params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameter input for the SIR model</span></span>
<span id="cb3-4">  params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb3-5">  params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb3-6">  params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta</span>
<span id="cb3-7">  params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>alpha <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> alpha</span>
<span id="cb3-8">  </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(params)</span>
<span id="cb3-10">}</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb3-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb3-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># incidence over a given time interval, delta_t</span></span>
<span id="cb3-15">incidence <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta_t=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>) {</span>
<span id="cb3-16">  parm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pinit</span>()</span>
<span id="cb3-17">  parm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>]]</span>
<span id="cb3-18">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb3-19">     parm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>alpha <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alpha"</span>]]</span>
<span id="cb3-20">  }</span>
<span id="cb3-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span>times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func=</span>seir_ode, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span>parm) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> out</span>
<span id="cb3-23">  di <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(out<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CI))</span>
<span id="cb3-24"></span>
<span id="cb3-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(di[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(di), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span>delta_t)])</span>
<span id="cb3-26">}</span></code></pre></div>
</div>
<p>        .           .       .        .    EG SEG .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create fake data</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for reproducibility</span></span>
<span id="cb4-3"></span>
<span id="cb4-4">inc1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">incidence</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pinit</span>()) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># baseline parameters, i.e., alpha=1</span></span>
<span id="cb4-5">dat1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(inc1), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>inc1)</span>
<span id="cb4-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(dat1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Week"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of cases"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponential growth"</span>)</span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(inc1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/sub-exponential-growth/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">inc2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">incidence</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pinit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)) </span>
<span id="cb5-2">dat2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(inc2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>inc2)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(dat2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Week"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of cases"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sub-exponential growth"</span>)</span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(inc2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/sub-exponential-growth/index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>      .           . <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Bexpit%7D"> 0 1    (i.e., <img src="https://latex.codecogs.com/png.latex?%5Calpha">)             <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Blogit%7D"> . <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BAIC%7D"> (Akaike information criterion)   (quality)    . AIC                . <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BAIC%7D">              . <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BAIC_c%7D">            .</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Cmathrm%7Blogit%7D(p)%20:=%20%5Cmathrm%7Bln%7D%20(%5Cfrac%7Bp%7D%7B1-p%7D)"> <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Bexpit%7D(x)%20:=%20%20%5Cfrac%7B1%7D%7B1+%5Cmathrm%7Bexp%7D(-x)%7D"> <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BAIC%7D%20:=%202k%20-%202%5Cmathrm%7Bln%7D(%5Chat%7BL%7D)"> <img src="https://latex.codecogs.com/png.latex?%20%5Cmathrm%7BAIC_c%7D%20:=%20%5Cmathrm%7BAIC%7D%20+%20%5Cfrac%7B2%20k%5E2+2%20k%7D%7Bn-k-1%7D"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">expit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb6-2">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x))  </span>
<span id="cb6-3">}</span>
<span id="cb6-4">logit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x))  </span>
<span id="cb6-6">}</span>
<span id="cb6-7">aic <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(k, L){</span>
<span id="cb6-8">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(L)</span>
<span id="cb6-9">}</span>
<span id="cb6-10">aicc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(k, L, n){</span>
<span id="cb6-11">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(L) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(n<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>k<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)</span>
<span id="cb6-12">}</span></code></pre></div>
</div>
<p>      likelihood  .    optim      negative log likelihood . SEG   <img src="https://latex.codecogs.com/png.latex?%5Cbeta,%20%5Calpha">    .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">negloglik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (p, y) {</span>
<span id="cb7-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">incidence</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pinit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])))</span>
<span id="cb7-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">incidence</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pinit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expit</span>(p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])))</span>
<span id="cb7-4">  nll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpois</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(nll)</span>
<span id="cb7-6">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn=</span>negloglik, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>dat1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brent"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>))</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(dat1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Week"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of cases"</span>)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">incidence</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pinit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fit"</span>),</span>
<span id="cb8-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/sub-exponential-growth/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>    SEG    EG  SEG     .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn=</span>negloglik, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>dat2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brent"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>))</span>
<span id="cb9-2">fit3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">logit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn=</span>negloglik, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>dat2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check log likelihood</span></span>
<span id="cb9-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -54.8522</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>fit3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -33.3477</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(dat2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Week"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of cases"</span>)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">incidence</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pinit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">incidence</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pinit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expit</span>(fit3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exponental fit"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sub-exponential fit"</span>),</span>
<span id="cb13-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/sub-exponential-growth/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>  SEG         <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BAIC%7D">   . <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BAIC%7D">  <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BAIC_c%7D">   SEG       .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Akaike information criterion to compare models</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aic</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">L=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 83.75242</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 94.48891</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aic</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">L=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 69.54993</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 113.7044</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aicc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">L=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dat2)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#84.06011</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 94.7966</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aicc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">L=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(dat2)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#70.54993</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 114.7044</code></pre>
</div>
</div>



 ]]></description>
  <category>news</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://kimfinale.github.io/myblog/posts/sub-exponential-growth/index.html</guid>
  <pubDate>Sun, 06 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/sub-exponential-growth/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>   </title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/modeling-philosophy/index.html</link>
  <description><![CDATA[ 




<p>      (mathematical model)    .           ? <a href="https://plato.stanford.edu/entries/models-science/#EpisCognFuncMode">  </a>         .      .</p>
<p>   (building),  (manipulation),  (application),  (evaluation)    (reasoning)        .   surrogative reasoning  model-based reasoning    .                   .              .     (parameter)         .         (target system)     ?     (represent)          (       )                .       .    ?</p>



 ]]></description>
  <category>modeling</category>
  <category>philosophy</category>
  <guid>https://kimfinale.github.io/myblog/posts/modeling-philosophy/index.html</guid>
  <pubDate>Thu, 03 Aug 2023 15:00:00 GMT</pubDate>
</item>
</channel>
</rss>
