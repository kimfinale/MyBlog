<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Jong-Hoon Kim&#39;s Blog</title>
<link>https://kimfinale.github.io/myblog/index.html</link>
<atom:link href="https://kimfinale.github.io/myblog/index.xml" rel="self" type="application/rss+xml"/>
<description>Jong-Hoon Kim&#39;s Blog</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Wed, 01 Nov 2023 15:00:00 GMT</lastBuildDate>
<item>
  <title>Negative binomial regression with censored data: POLYMOD data</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/nb-censored-regression/index.html</link>
  <description><![CDATA[ 




<p>This post describes my attempt to reproduce Table 1 of the paper, <a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0050074">Social Contacts and Mixing Patterns Relevant to the Spread of Infectious Diseases</a>. Data were downloaded from <a href="http://www.socialcontactdata.org/">Social Contact Data</a>, which was hosted in <a href="https://zenodo.org/record/3746312#.Xo85CcgzZPY">zenodo</a>. I used the version 1.1. In summary, I wasn’t successful at reproducing the table exatly but still wanted to document the processes that I went through.</p>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data preparation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb1-2">d1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008_Mossong_POLYMOD_participant_common.csv"</span>)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d1 &lt;- fread("data/2008_Mossong_POLYMOD_participant_common.csv")</span></span>
<span id="cb1-4">d2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008_Mossong_POLYMOD_contact_common.csv"</span>)</span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d2 &lt;- fread("data/2008_Mossong_POLYMOD_contact_common.csv")</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># count the number of contacts for each participant using part_id variable</span></span>
<span id="cb1-8">d2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(part_id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">contacts =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> d2_contacts</span>
<span id="cb1-10">d12 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d1, d2_contacts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"part_id"</span>)</span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add household information</span></span>
<span id="cb1-12">d3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008_Mossong_POLYMOD_hh_common.csv"</span>)</span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d3 &lt;- fread("data/2008_Mossong_POLYMOD_hh_common.csv")</span></span>
<span id="cb1-14">d123 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d12, d3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hh_id"</span>)</span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add day of week information</span></span>
<span id="cb1-16">d4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008_Mossong_POLYMOD_sday.csv"</span>)</span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d4 &lt;- fread("data/2008_Mossong_POLYMOD_sday.csv")</span></span>
<span id="cb1-18">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d123, d4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"part_id"</span>)</span></code></pre></div>
</div>
</section>
<section id="data-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation">Data manipulation</h3>
<p>Categorize the age group into different 10 age groups: 0-4, 5-9, 10-14, 15-19, and 20 to 70 by 10 years and 70 and above</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">age_grp_label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5-9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10-14"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15-19"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20-29"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"30-39"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40-49"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50-59"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60-69"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"70+"</span>)</span>
<span id="cb2-2"></span>
<span id="cb2-3">classify_age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(d){</span>
<span id="cb2-4">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Missing"</span></span>
<span id="cb2-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb2-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i])){</span>
<span id="cb2-7">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>){</span>
<span id="cb2-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d$age_grp[i] &lt;- 0</span></span>
<span id="cb2-9">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb2-10">      }</span>
<span id="cb2-11">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>){</span>
<span id="cb2-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>){</span>
<span id="cb2-13">          <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>j<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)){</span>
<span id="cb2-14">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb2-15">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb2-16">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb2-17">          }</span>
<span id="cb2-18">        }</span>
<span id="cb2-19">      }</span>
<span id="cb2-20">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>){</span>
<span id="cb2-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (k <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>){</span>
<span id="cb2-22">          <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k)){</span>
<span id="cb2-23">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb2-24">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]</span>
<span id="cb2-25">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]</span>
<span id="cb2-26">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>]</span>
<span id="cb2-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>]</span>
<span id="cb2-28">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d$age_grp[i] &lt;- k+3</span></span>
<span id="cb2-29">          }</span>
<span id="cb2-30">        }</span>
<span id="cb2-31">      } </span>
<span id="cb2-32">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb2-33">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d$age_grp[i] &lt;- 9</span></span>
<span id="cb2-34">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> age_grp_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]</span>
<span id="cb2-35">      }</span>
<span id="cb2-36">    } </span>
<span id="cb2-37">  }</span>
<span id="cb2-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(d)</span>
<span id="cb2-39">}</span>
<span id="cb2-40"></span>
<span id="cb2-41">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classify_age</span>(dat)</span></code></pre></div>
</div>
<p>Compare the number of participants by age group (the third column of Table 1)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(age_grp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npart=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> npart_ag</span>
<span id="cb3-2">npart_ag<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">660</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">661</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">713</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">685</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">879</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">815</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">908</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">906</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">728</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">270</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hard-coded using the values in Table 1.</span></span>
<span id="cb3-3">npart_ag</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
   age_grp npart  true
   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt;
 1 0-4       660   660
 2 10-14     713   661
 3 15-19     685   713
 4 20-29     879   685
 5 30-39     815   879
 6 40-49     908   815
 7 5-9       661   908
 8 50-59     906   906
 9 60-69     728   728
10 70+       270   270
11 Missing    65    65</code></pre>
</div>
</div>
<p>Categorize the household size</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">classify_household <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(d){</span>
<span id="cb5-2">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Missing"</span></span>
<span id="cb5-3">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6+"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size))</span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(d)</span>
<span id="cb5-5">}</span>
<span id="cb5-6">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classify_household</span>(dat)</span></code></pre></div>
</div>
<p>Classify gender</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">classify_gender <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(d) {</span>
<span id="cb6-2">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Missing"</span></span>
<span id="cb6-3">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>, d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender))</span>
<span id="cb6-4">  </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(d)</span>
<span id="cb6-6">}</span>
<span id="cb6-7"></span>
<span id="cb6-8">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classify_gender</span>(dat)</span></code></pre></div>
</div>
<p>Classify day of week</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">dayofweek_label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sunday"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Monday"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tuesday"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Wednesday"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Thursday"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Friday"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Saturday"</span>)</span>
<span id="cb7-2"></span>
<span id="cb7-3">classify_dayofweek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(d) {</span>
<span id="cb7-4">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Missing"</span></span>
<span id="cb7-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb7-6">    day <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek[i]</span>
<span id="cb7-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(day)) {</span>
<span id="cb7-8">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb7-9">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dayofweek_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb7-10">      }</span>
<span id="cb7-11">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb7-12">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dayofweek_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb7-13">      }</span>
<span id="cb7-14">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb7-15">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dayofweek_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb7-16">      }</span>
<span id="cb7-17">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) {</span>
<span id="cb7-18">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dayofweek_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb7-19">      }</span>
<span id="cb7-20">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb7-21">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dayofweek_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb7-22">      }</span>
<span id="cb7-23">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) {</span>
<span id="cb7-24">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dayofweek_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]</span>
<span id="cb7-25">      }</span>
<span id="cb7-26">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>) {</span>
<span id="cb7-27">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dayofweek_label[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]</span>
<span id="cb7-28">      }</span>
<span id="cb7-29">    }</span>
<span id="cb7-30">  }</span>
<span id="cb7-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(d)</span>
<span id="cb7-32">}</span>
<span id="cb7-33">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classify_dayofweek</span>(dat)</span>
<span id="cb7-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># change names for conveninence</span></span>
<span id="cb7-35">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_integer <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek</span>
<span id="cb7-36">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek_f</span></code></pre></div>
</div>
<p>Make categorical variables factor for regression Set reference groups <code>relevel(x, ref=ref)</code> as in Table 1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the categorical variables as factor for regression</span></span>
<span id="cb8-2">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(age_grp_label,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Missing"</span>))</span>
<span id="cb8-3">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relevel</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-4"</span>)</span>
<span id="cb8-4">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Missing"</span>))</span>
<span id="cb8-5">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relevel</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>)</span>
<span id="cb8-6">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dayofweek_label,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Missing"</span>))</span>
<span id="cb8-7">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relevel</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sunday"</span>)</span>
<span id="cb8-8">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp)</span>
<span id="cb8-9">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relevel</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>)</span>
<span id="cb8-10">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>country <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DE"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FI"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GB"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IT"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LU"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NL"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PL"</span>))</span>
<span id="cb8-11">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>country <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relevel</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BE"</span>)</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fwrite(dat, "POLYMOD_2017.csv")</span></span></code></pre></div>
</div>
<p>Assign weights to individual participants based on the supplementary Table 2. My approach was to identify a row and a column for the relevant weight based on the age and household size. Weight of an age group for the sample was calculated by dividing the proportion of the age group in the population (in the census) with the proportion of the age group in the sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">find_age_row_column <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(d) {</span>
<span id="cb9-2">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_row <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb9-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb9-4">    ag <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i]</span>
<span id="cb9-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(ag)){</span>
<span id="cb9-6">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>) {</span>
<span id="cb9-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (ag <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> (j<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> ag <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (j<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) {</span>
<span id="cb9-8">          d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_row[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> j</span>
<span id="cb9-9">          <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb9-10">        }</span>
<span id="cb9-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (ag <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>) {</span>
<span id="cb9-12">          d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_row[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span></span>
<span id="cb9-13">          <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb9-14">        }</span>
<span id="cb9-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>{}</span>
<span id="cb9-16">      }</span>
<span id="cb9-17">    }</span>
<span id="cb9-18">  }</span>
<span id="cb9-19">  </span>
<span id="cb9-20">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_col <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb9-21">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb9-22">    hs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size[i]</span>
<span id="cb9-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(hs)){</span>
<span id="cb9-24">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb9-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (hs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> j) {</span>
<span id="cb9-26">          d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_col[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> j</span>
<span id="cb9-27">          <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb9-28">        }</span>
<span id="cb9-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (hs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) {</span>
<span id="cb9-30">          d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_col[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb9-31">        }</span>
<span id="cb9-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>{}</span>
<span id="cb9-33">      }</span>
<span id="cb9-34">    }</span>
<span id="cb9-35">  }</span>
<span id="cb9-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(d)</span>
<span id="cb9-37">}</span>
<span id="cb9-38"></span>
<span id="cb9-39">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">find_age_row_column</span>(dat)</span>
<span id="cb9-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># wlist &lt;- rio::import_list("data/sampling_weight.xlsx")</span></span>
<span id="cb9-41">wlist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rio<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">import_list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sampling_weight.xlsx"</span>)</span>
<span id="cb9-42"></span>
<span id="cb9-43">classify_weight <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(d){</span>
<span id="cb9-44">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb9-45">  cnames <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(wlist)</span>
<span id="cb9-46">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(cnames)) {</span>
<span id="cb9-47">    wtable <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wlist[[i]]</span>
<span id="cb9-48">    w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wtable[wtable<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Household size</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ratio C/S"</span>,] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sampling weight</span></span>
<span id="cb9-49">    W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w1[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Household size</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>),] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove the first row</span></span>
<span id="cb9-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View(W)</span></span>
<span id="cb9-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)){</span>
<span id="cb9-52">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>country[j] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> cnames[i]) {</span>
<span id="cb9-53">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt[j] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> W[d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_row[j], d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_col[j]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb9-54">      }</span>
<span id="cb9-55">    }</span>
<span id="cb9-56">  }</span>
<span id="cb9-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(d)</span>
<span id="cb9-58">}</span>
<span id="cb9-59"></span>
<span id="cb9-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># grep("-", as.character(d$wt), value = T)</span></span>
<span id="cb9-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hist(as.numeric(d$wt))</span></span>
<span id="cb9-62">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classify_weight</span>(dat)</span>
<span id="cb9-63">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt)</span></code></pre></div>
</div>
</section>
<section id="data-for-fitting-only-complete-cases" class="level3">
<h3 class="anchored" data-anchor-id="data-for-fitting-only-complete-cases">Data for fitting only complete cases</h3>
<p>There are missing values for contacts (n=36) and weight (n=65). It is not clear how those observations were treated in the model. This may be a reason why I can’t reproduce the results in Table 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">dat_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat</span>
<span id="cb10-2">model_var <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contacts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_grp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dayofweek"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hh_size_grp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wt"</span>)</span>
<span id="cb10-3">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[,..model_var]</span>
<span id="cb10-4">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(dat),]</span></code></pre></div>
</div>
</section>
<section id="negbin-regression-no-censoring-and-no-weighting" class="level3">
<h3 class="anchored" data-anchor-id="negbin-regression-no-censoring-and-no-weighting">NegBin regression: no censoring and no weighting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MASS)</span>
<span id="cb11-2">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm.nb</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> dayofweek <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hh_size_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># summary(m4)</span></span>
<span id="cb11-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(m<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept)         age_grp5-9       age_grp10-14       age_grp15-19 
         5.6857510          1.4019037          1.6762018          1.6833557 
      age_grp20-29       age_grp30-39       age_grp40-49       age_grp50-59 
         1.4462183          1.4174179          1.3863664          1.2947477 
      age_grp60-69         age_grp70+            genderM      genderMissing 
         1.0529527          0.8124860          0.9924908          1.0587098 
   dayofweekMonday   dayofweekTuesday dayofweekWednesday  dayofweekThursday 
         1.3185353          1.3982732          1.3879456          1.3841452 
   dayofweekFriday  dayofweekSaturday   dayofweekMissing       hh_size_grp2 
         1.4392738          1.1530067          1.2210911          1.0981942 
      hh_size_grp3       hh_size_grp4       hh_size_grp5      hh_size_grp6+ 
         1.1239890          1.2616597          1.3378869          1.4626972 
         countryDE          countryFI          countryGB          countryIT 
         0.7053508          0.9489218          0.9788132          1.6280160 
         countryLU          countryNL          countryPL 
         1.4066252          1.2481860          1.3210892 </code></pre>
</div>
</div>
<p>Regression that account for censored number of contacts. The paper reads: <em>The data were right censored at 29 contacts for all countries because of a limited number of possible diary entries in some countries</em></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7Blog%20%7DL%20=%20%5Csum_%7Bi=1%7D%5En%20w_i%5Cleft(%5Cdelta_i~%5Ctext%7Blog%7D%20%5Cleft(P%5Cleft(Y=y_i%7CX%5Cright)%5Cright)%20+%20%5Cleft(1-%5Cdelta_i%5Cright)~%5Ctext%7Blog%7D%20%5Cleft(1-%5Csum_%7Bi=1%7D%5E%7B28%7DP(Y=y_i%7CX)%5Cright)%0A%5Cright)%0A"> , where</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%20%20%5Cdelta_i=%5Cbegin%7Bcases%7D%0A%20%20%20%201,%20&amp;%20%5Ctext%7Bif$~y_i%3C29$%7D.%5C%5C%0A%20%20%20%200,%20&amp;%20%5Ctext%7Botherwise%7D.%0A%20%20%5Cend%7Bcases%7D%0A%5Cend%7Bequation%7D%0A"></p>
</section>
<section id="take-censoring-into-account" class="level3">
<h3 class="anchored" data-anchor-id="take-censoring-into-account">Take censoring into account</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model.matrix</span>(m)</span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ini = c(coef(m1), log_theta = log(summary(m1)$theta))</span></span>
<span id="cb13-3">init <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>theta)</span>
<span id="cb13-4"></span>
<span id="cb13-5">negll_censor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(par, y, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>) {</span>
<span id="cb13-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb13-7">  size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb13-8">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb13-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create indicator depending on chosen limit</span></span>
<span id="cb13-10">  indicator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ul</span>
<span id="cb13-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># linear predictor</span></span>
<span id="cb13-12">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta)</span>
<span id="cb13-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log likelihood</span></span>
<span id="cb13-14">  ll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(indicator <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnbinom</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-15">             (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>indicator) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnbinom</span>(ul, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb13-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ll)</span>
<span id="cb13-17">}</span>
<span id="cb13-18"></span>
<span id="cb13-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># you can check if two methods (glm.nb vs. optim) match by setting ul high (e.g., 100)</span></span>
<span id="cb13-20">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init,</span>
<span id="cb13-21">            negll_censor,</span>
<span id="cb13-22">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts,</span>
<span id="cb13-23">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb13-24">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>,</span>
<span id="cb13-25">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>,</span>
<span id="cb13-26">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxit=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-10</span>))</span>
<span id="cb13-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept)         age_grp5-9       age_grp10-14       age_grp15-19 
         4.5855609          1.3916624          1.4966316          1.5652781 
      age_grp20-29       age_grp30-39       age_grp40-49       age_grp50-59 
         1.4564096          1.4115250          1.3826403          1.3460117 
      age_grp60-69         age_grp70+            genderM      genderMissing 
         1.1839554          0.9651761          1.0024010          0.6274391 
   dayofweekMonday   dayofweekTuesday dayofweekWednesday  dayofweekThursday 
         1.3465799          1.3984083          1.3947227          1.3841057 
   dayofweekFriday  dayofweekSaturday   dayofweekMissing       hh_size_grp2 
         1.4321288          1.2394701          1.2100137          1.1537831 
      hh_size_grp3       hh_size_grp4       hh_size_grp5      hh_size_grp6+ 
         1.2130191          1.3521520          1.3266735          1.4746099 
         countryDE          countryFI          countryGB          countryIT 
         0.7690842          1.0289869          1.0255593          1.3862301 
         countryLU          countryNL          countryPL               size 
         1.2297382          1.1517266          1.2230124         59.4967671 </code></pre>
</div>
</div>
</section>
<section id="take-censoring-into-account-censoring-weighting" class="level3">
<h3 class="anchored" data-anchor-id="take-censoring-into-account-censoring-weighting">Take censoring into account censoring &amp; weighting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model.matrix</span>(m)</span>
<span id="cb15-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ini = c(coef(m1), log_theta = log(summary(m1)$theta))</span></span>
<span id="cb15-3">init <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>theta)</span>
<span id="cb15-4"></span>
<span id="cb15-5">negll_censor_weight <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(par, y, X, wt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>) {</span>
<span id="cb15-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb15-7">  size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb15-8">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb15-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create indicator depending on chosen limit</span></span>
<span id="cb15-10">  indicator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ul</span>
<span id="cb15-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># linear predictor</span></span>
<span id="cb15-12">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta)</span>
<span id="cb15-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log likelihood</span></span>
<span id="cb15-14">  ll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(wt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(indicator <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnbinom</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T)</span>
<span id="cb15-15">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>indicator) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnbinom</span>(ul, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb15-16"></span>
<span id="cb15-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ll)</span>
<span id="cb15-18">}</span>
<span id="cb15-19"></span>
<span id="cb15-20">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init,</span>
<span id="cb15-21">            negll_censor_weight,</span>
<span id="cb15-22">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts,</span>
<span id="cb15-23">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb15-24">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wt =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wt,</span>
<span id="cb15-25">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>,</span>
<span id="cb15-26">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>,</span>
<span id="cb15-27">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxit=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-10</span>))</span>
<span id="cb15-28"></span>
<span id="cb15-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(fit2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept)         age_grp5-9       age_grp10-14       age_grp15-19 
         4.7466571          1.2879540          1.3859414          1.4462284 
      age_grp20-29       age_grp30-39       age_grp40-49       age_grp50-59 
         1.3172763          1.3318052          1.3149374          1.2721719 
      age_grp60-69         age_grp70+            genderM      genderMissing 
         1.1104417          0.9120070          1.0004660          0.5928397 
   dayofweekMonday   dayofweekTuesday dayofweekWednesday  dayofweekThursday 
         1.3345340          1.3581757          1.3475945          1.3643580 
   dayofweekFriday  dayofweekSaturday   dayofweekMissing       hh_size_grp2 
         1.3961514          1.2217065          1.2141038          1.1707231 
      hh_size_grp3       hh_size_grp4       hh_size_grp5      hh_size_grp6+ 
         1.2011692          1.3934719          1.3528140          1.5582583 
         countryDE          countryFI          countryGB          countryIT 
         0.7842677          1.0386946          1.0376580          1.4411177 
         countryLU          countryNL          countryPL               size 
         1.3011867          1.2646338          1.2477932         64.2627549 </code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>regression</category>
  <category>contact</category>
  <category>censor</category>
  <guid>https://kimfinale.github.io/myblog/posts/nb-censored-regression/index.html</guid>
  <pubDate>Wed, 01 Nov 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/nb-censored-regression/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Apartment transactions in Korea via API provided by the Ministry of Land, Infrastructure, and Transport</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/apartment-data-api/index.html</link>
  <description><![CDATA[ 




<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data preparation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(XML)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RCurl)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># service_key &lt;- readRDS("data/apartment_key_datagokr.rds")</span></span>
<span id="cb1-6">service_key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apartment_key_datagokr.rds"</span>)</span>
<span id="cb1-7">datlist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"list"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine the data in 2022</span></span>
<span id="cb1-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (m <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>){</span>
<span id="cb1-11">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) {</span>
<span id="cb1-12">    dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20220"</span>, m)</span>
<span id="cb1-13">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb1-14">    dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022"</span>, m)</span>
<span id="cb1-15">  } </span>
<span id="cb1-16">  uri <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://openapi.molit.go.kr/OpenAPI_ToolInstallPackage/service/rest/RTMSOBJSvc/getRTMSDataSvcAptTradeDev?LAWD_CD=11110&amp;DEAL_YMD="</span>, dt, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;serviceKey="</span>, service_key)</span>
<span id="cb1-17"></span>
<span id="cb1-18">  xml_doc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xmlTreeParse</span>(uri, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">useInternalNodes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encoding =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span>)</span>
<span id="cb1-19">  root_node <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xmlRoot</span>(xml_doc)</span>
<span id="cb1-20">  xml_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xmlToDataFrame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nodes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getNodeSet</span>(root_node, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'//item'</span>))</span>
<span id="cb1-21"></span>
<span id="cb1-22">  datlist[[m]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> xml_data</span>
<span id="cb1-23">}</span>
<span id="cb1-24"></span>
<span id="cb1-25">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rbind'</span>, datlist)</span></code></pre></div>
</div>
<p>I will plot the price</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># million won</span></span>
<span id="cb2-2">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>price <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>거래금액)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-3">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_sq_meter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>전용면적) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># q</span></span>
<span id="cb2-4">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_category <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb2-7">  ar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_sq_meter[i]</span>
<span id="cb2-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(ar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>){</span>
<span id="cb2-9">    d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_category[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;50"</span></span>
<span id="cb2-10">  }</span>
<span id="cb2-11">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(ar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> ar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>) {</span>
<span id="cb2-12">    d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_category[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50-80"</span></span>
<span id="cb2-13">  }</span>
<span id="cb2-14">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(ar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> ar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) {</span>
<span id="cb2-15">    d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_category[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80-100"</span></span>
<span id="cb2-16">  }</span>
<span id="cb2-17">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(ar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) {</span>
<span id="cb2-18">    d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_category[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;100"</span></span>
<span id="cb2-19">  }</span>
<span id="cb2-20">}</span>
<span id="cb2-21"></span>
<span id="cb2-22">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_category <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_category, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;50"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50-80"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80-100"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;100"</span>))</span>
<span id="cb2-23">                             </span>
<span id="cb2-24">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>levels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>층)</span>
<span id="cb2-25"></span>
<span id="cb2-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb2-27"></span>
<span id="cb2-28">d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(area_category, price, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>levels)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Area~(m^2)"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Price (million won)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Levels"</span>)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Apartment price in Jongno-gu, Seoul, 2022"</span>) </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/apartment-data-api/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("apt_price.png", width=3.4*1.5, height=2.7*1.5, units="in")</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>API</category>
  <category>apartment</category>
  <guid>https://kimfinale.github.io/myblog/posts/apartment-data-api/index.html</guid>
  <pubDate>Tue, 31 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/apartment-data-api/apt_price.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>SIR model using SymPy</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/SIR-sympy/index.html</link>
  <description><![CDATA[ 




<p>I attempted to replicate some of the simple analytical resutls presented in the book, Mathematical Epidemiology by Brauer <em>et al</em>.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS/%5Cmathrm%7Bd%7Dt%20&amp;=%20-%5Cbeta%20I%20S%20%5C%5C%0A%5Cmathrm%7Bd%7DI/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cbeta%20I%20S%20-%20%5Cgamma%20I%5C%5C%0A%5Cend%7Balign%7D%0A"> The first part is simply to compute <img src="https://latex.codecogs.com/png.latex?dI/dS">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sympy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-2"></span>
<span id="cb1-3">R_0, b, g, dIdt, dSdt, S, I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R_0 b g dIdt dSdt S I'</span>)</span>
<span id="cb1-4"></span>
<span id="cb1-5">dSdt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb1-6">dIdt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I</span>
<span id="cb1-7">dSdI <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dIdt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dSdt <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#-(I*S*b - I*g)/(I*S*b)</span></span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># b &lt;- R0*g</span></span>
<span id="cb1-10">simplify(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R_0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>R_0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g)) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-1 + 1/(R_0*S)</code></pre>
</div>
</div>
<p>The second part is integrate the equation, <img src="https://latex.codecogs.com/png.latex?dI/dS"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">S, I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S I"</span>, cls<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Function)</span>
<span id="cb3-2">b, g, t, R_0, S0, I0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b g t R_0 S0 I0"</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4">eq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Eq(I(t).diff(t), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> S(t).diff(t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R_0)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>S(t))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>S(t).diff(t))</span>
<span id="cb3-5"></span>
<span id="cb3-6">integrate(eq, t)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Eq(I(t), -S(t) + log(S(t))/R_0)</code></pre>
</div>
</div>



 ]]></description>
  <category>SIR</category>
  <category>SymPy</category>
  <guid>https://kimfinale.github.io/myblog/posts/SIR-sympy/index.html</guid>
  <pubDate>Sun, 15 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/SIR-sympy/SimPy_logo.svg.png" medium="image" type="image/png" height="55" width="144"/>
</item>
<item>
  <title>Regression with censorted data: AER::tobit and optim</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/censored-regression-optim/index.html</link>
  <description><![CDATA[ 




<p>The following example was adapted from the Tobit model in <a href="https://m-clark.github.io/models-by-example/tobit.html">Model Estimation by Example</a>. The dataset contains 200 observations. The academic aptitude variable is <code>apt</code>, the reading and math test scores are <code>read</code> and <code>math</code>, respectively. The variable <code>prog</code> is the type of program the student is in, it is a categorical (nominal) variable that takes on three values, academic (prog = 1), general (prog = 2), and vocational (prog = 3). The variable <code>id</code> is an identification variable. More details of the dataset available at https://stats.oarc.ucla.edu/r/dae/tobit-models/.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb1-2">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://stats.idre.ucla.edu/stat/data/tobit.csv"</span>)</span>
<span id="cb1-3">dat[, prog <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(prog)]</span>
<span id="cb1-4">dat</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      id read math       prog apt
  1:   1   34   40 vocational 352
  2:   2   39   33 vocational 449
  3:   3   63   48    general 648
  4:   4   44   41    general 501
  5:   5   47   43    general 762
 ---                             
196: 196   44   49    general 539
197: 197   50   50    general 594
198: 198   47   51    general 616
199: 199   52   50    general 558
200: 200   68   75    general 800</code></pre>
</div>
</div>
<p>Following codes were borrowed from the <a href="https://stats.oarc.ucla.edu/r/dae/tobit-models/">UCLA Advanced Research Computing</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function that gives the density of normal distribution</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for given mean and sd, scaled to be on a count metric</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for the histogram: count = density * sample size * bin width</span></span>
<span id="cb3-4">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, var, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bw =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>) {</span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(var), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(var)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> bw</span>
<span id="cb3-6">}</span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># setup base plot</span></span>
<span id="cb3-9">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> apt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>prog))</span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># histogram, coloured by proportion in different programs</span></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># with a normal distribution overlayed</span></span>
<span id="cb3-12">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_bin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> f, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb3-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">args =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>apt))</span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apt_censored.png"</span>, p)</span></code></pre></div>
</div>
<p>Looking at the above histogram, we can see the censoring in the values of <code>apt</code>, that is, there are far more cases with scores of 750 to 800 than one would expect looking at the rest of the distribution. Below is an alternative histogram that further highlights the excess of cases where <code>apt=800</code>.</p>
<p><strong>Note on the difference between truncation and censoring</strong>: With censored variables, all of the observations are in the dataset, but we don’t know the “true” values of some of them. With truncation some of the observations are not included in the analysis because of the value of the variable.</p>
<p>The Tobit model can be used for such a case. It is a class of regression models in which the observed range of the dependent variable is censored in some way, according to the [Wikipedia article] (https://en.wikipedia.org/wiki/Tobit_model). The possible maximum score 800, which</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">tobit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> AER<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tobit</span>(</span>
<span id="cb4-2">  apt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> read <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> math <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> prog,</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat,</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">left =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>,</span>
<span id="cb4-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">right =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span></span>
<span id="cb4-6">)</span></code></pre></div>
</div>
<p>To account for censoring, likelihood function is modified to so that it reflects the unequal sampling probability for each observation depending on whether the latent dependent variable fell above or below the determined threshold. It appears that this approach was first proposed by <a href="https://en.wikipedia.org/wiki/James_Tobin">James Tobin</a>. For a sample that, as in Tobin’s original case, was censored from below at zero, the sampling probability for each non-limit observation is simply the height of the appropriate density function. For any limit observation, it is the cumulative distribution, i.e.&nbsp;the integral below zero of the appropriate density function. The likelihood function is thus a mixture of densities and cumulative distribution functions, according to the <a href="https://en.wikipedia.org/wiki/Tobit_model">Wikipedia article</a>.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7Blog%20%7DL%20=%20%5Csum_%7Bi=1%7D%5En%20w_i%5Cleft(%5Cdelta_i~%5Ctext%7Blog%7D%20%5Cleft(P%5Cleft(Y=y_i%7CX%5Cright)%5Cright)%20+%20%5Cleft(1-%5Cdelta_i%5Cright)~%5Ctext%7Blog%7D%20%5Cleft(1-%5Csum_%7Bi=1%7D%5E%7Bl_U%7DP(Y=y_i%7CX)%5Cright)%0A%5Cright)%0A"> , where <img src="https://latex.codecogs.com/png.latex?l_U"> represents the upper limit and</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%20%20%5Cdelta_i=%5Cbegin%7Bcases%7D%0A%20%20%20%201,%20&amp;%20%5Ctext%7Bif%20%7Dy_i%20%3C%20l_U.%5C%5C%0A%20%20%20%200,%20&amp;%20%5Ctext%7Botherwise%7D.%0A%20%20%5Cend%7Bcases%7D%0A%5Cend%7Bequation%7D%0A"></p>
<section id="log-likelihood-accounting-for-censoring" class="level3">
<h3 class="anchored" data-anchor-id="log-likelihood-accounting-for-censoring">Log likelihood accounting for censoring</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">negloglik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(par, y, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) {</span>
<span id="cb5-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters</span></span>
<span id="cb5-3">  sd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb5-4">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> par[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb5-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create indicator depending on chosen limit</span></span>
<span id="cb5-6">  indicator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ul</span>
<span id="cb5-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># linear predictor</span></span>
<span id="cb5-8">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta</span>
<span id="cb5-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log likelihood</span></span>
<span id="cb5-10">  loglik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> indicator <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sd, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-11">             (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>indicator) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnorm</span>(ul, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sd))</span>
<span id="cb5-12"></span>
<span id="cb5-13">  sumloglik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(loglik, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>sumloglik)</span>
<span id="cb5-15">}</span></code></pre></div>
</div>
</section>
<section id="optim" class="level3">
<h3 class="anchored" data-anchor-id="optim">optim</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Setup data and initial values.</span></span>
<span id="cb6-2">mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(apt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> read <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> math <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> prog, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb6-3">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model.matrix</span>(mod)</span>
<span id="cb6-4">init <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(mod), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(mod)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sigma)</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># negloglik(par=init, y=acad_apt$apt, X=X, ul=800)</span></span>
<span id="cb6-7"></span>
<span id="cb6-8">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par =</span> init,</span>
<span id="cb6-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn =</span> negloglik,</span>
<span id="cb6-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>apt,</span>
<span id="cb6-11">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb6-12">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>)</span>
<span id="cb6-13"></span>
<span id="cb6-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(tobit)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept)           read           math    proggeneral progvocational 
    209.565971       2.697939       5.914485     -12.714763     -46.143904 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">(fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept)           read           math    proggeneral progvocational 
    211.054867       2.813491       5.763177     -12.354492     -45.847701 
         sigma 
     65.652919 </code></pre>
</div>
</div>
</section>
<section id="optim-control-parameters" class="level3">
<h3 class="anchored" data-anchor-id="optim-control-parameters"><code>optim</code> control parameters</h3>
<p>By adjusting control parameters of the <code>optim</code> function, results can match more closely. Below is such an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par =</span> init,</span>
<span id="cb10-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn =</span> negloglik,</span>
<span id="cb10-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>apt,</span>
<span id="cb10-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X,</span>
<span id="cb10-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ul =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>,</span>
<span id="cb10-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nelder-Mead"</span>,</span>
<span id="cb10-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxit=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2e4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-15</span>))</span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(tobit)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept)           read           math    proggeneral progvocational 
    209.565971       2.697939       5.914485     -12.714763     -46.143904 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">(fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept)           read           math    proggeneral progvocational 
    209.565967       2.697937       5.914486     -12.714777     -46.143838 
         sigma 
     65.676724 </code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>regression</category>
  <category>censor</category>
  <category>tobit</category>
  <guid>https://kimfinale.github.io/myblog/posts/censored-regression-optim/index.html</guid>
  <pubDate>Sat, 14 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/censored-regression-optim/apt_censored.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>Mulitple regression: POLYMOD data</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/POLYMOD-multiple-regression/index.html</link>
  <description><![CDATA[ 




<p>This post describes my attempt to reproduce Table 1 of the paper, <a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0050074">Social Contacts and Mixing Patterns Relevant to the Spread of Infectious Diseases</a>. Data were downloaded from <a href="http://www.socialcontactdata.org/">Social Contact Data</a>, which was hosted in <a href="https://zenodo.org/record/3746312#.Xo85CcgzZPY">zenodo</a>. I used the version 1.1. In summary, I wasn’t successful at reproducing the table exatly but still wanted to document the processes that I went through.</p>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data preparation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb1-2"></span>
<span id="cb1-3">d1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008_Mossong_POLYMOD_participant_common.csv"</span>)</span>
<span id="cb1-4">d2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008_Mossong_POLYMOD_contact_common.csv"</span>)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># count the number of contacts for each participant using part_id variable</span></span>
<span id="cb1-7">d2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(part_id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">contacts =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> d2_contacts</span>
<span id="cb1-9">d12 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d1, d2_contacts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"part_id"</span>)</span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add household information</span></span>
<span id="cb1-11">d3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008_Mossong_POLYMOD_hh_common.csv"</span>)</span>
<span id="cb1-12">d123 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d12, d3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hh_id"</span>)</span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add day of week information</span></span>
<span id="cb1-14">d4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008_Mossong_POLYMOD_sday.csv"</span>)</span>
<span id="cb1-15">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d123, d4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"part_id"</span>)</span></code></pre></div>
</div>
</section>
<section id="data-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation">Data manipulation</h3>
<p>Categorize the age group into different 10 age groups: 0-4, 5-9, 10-14, 15-19, and 20 to 70 by 10 years and 70 and above</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">classify_age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(d){</span>
<span id="cb2-2">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span></span>
<span id="cb2-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)) {</span>
<span id="cb2-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i])){</span>
<span id="cb2-5">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>){</span>
<span id="cb2-6">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb2-7">      }</span>
<span id="cb2-8">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>){</span>
<span id="cb2-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>){</span>
<span id="cb2-10">          <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>j<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)){</span>
<span id="cb2-11">            d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> j</span>
<span id="cb2-12">          }</span>
<span id="cb2-13">        }</span>
<span id="cb2-14">      }</span>
<span id="cb2-15">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>){</span>
<span id="cb2-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (k <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>){</span>
<span id="cb2-17">          <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_age[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>k)){</span>
<span id="cb2-18">            d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb2-19">          }</span>
<span id="cb2-20">        }</span>
<span id="cb2-21">      } </span>
<span id="cb2-22">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb2-23">        d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span></span>
<span id="cb2-24">      }</span>
<span id="cb2-25">    } </span>
<span id="cb2-26">  }</span>
<span id="cb2-27">  d</span>
<span id="cb2-28">}</span>
<span id="cb2-29"></span>
<span id="cb2-30">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classify_age</span>(dat)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-2">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>contacts)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/POLYMOD-multiple-regression/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Compare the number of participants by age group (the third column)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(age_grp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npart=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb4-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_contacts =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(contacts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> dat_ag</span>
<span id="cb4-5"></span>
<span id="cb4-6">dat_ag<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>npart_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">660</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">661</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">713</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">685</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">879</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">815</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">908</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">906</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">728</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">270</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>)</span>
<span id="cb4-7">dat_ag<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>avg_contacts_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.21</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.81</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.22</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">17.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.57</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.14</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.83</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12.30</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.21</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.89</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.63</span>)</span>
<span id="cb4-8">dat_ag</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   age_grp npart avg_contacts npart_true avg_contacts_true
     &lt;dbl&gt; &lt;int&gt;        &lt;dbl&gt;      &lt;dbl&gt;             &lt;dbl&gt;
 1       0   660        10.2         660             10.2 
 2       1   661        14.8         661             14.8 
 3       2   713        18.2         713             18.2 
 4       3   685        17.6         685             17.6 
 5       4   879        13.6         879             13.6 
 6       5   815        14.1         815             14.1 
 7       6   908        13.8         908             13.8 
 8       7   906        12.3         906             12.3 
 9       8   728         9.21        728              9.21
10       9   270         6.89        270              6.89
11      99    65         9.63         65              9.63</code></pre>
</div>
</div>
<p>Categorize the household size</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">classify_hh <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(d){</span>
<span id="cb6-2">  d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size), d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span>))</span>
<span id="cb6-3">  d</span>
<span id="cb6-4">}</span>
<span id="cb6-5">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">classify_hh</span>(dat)</span></code></pre></div>
</div>
<p>Make categorical variables factor for regression</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the categorical variables as factor for regression</span></span>
<span id="cb7-2">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age_grp)</span>
<span id="cb7-3">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hh_size_grp)</span>
<span id="cb7-4">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>part_gender)</span>
<span id="cb7-5">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dayofweek)</span>
<span id="cb7-6">data.table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fwrite</span>(dat, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POLYMOD_2017.csv"</span>)</span></code></pre></div>
</div>
</section>
<section id="data-for-fitting-only-complete-cases" class="level3">
<h3 class="anchored" data-anchor-id="data-for-fitting-only-complete-cases">data for fitting only complete cases</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">dat_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat</span>
<span id="cb8-2">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(dat),]</span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the maximum number of contacts 29</span></span>
<span id="cb8-4">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts)</span></code></pre></div>
</div>
</section>
<section id="negbin-regression" class="level3">
<h3 class="anchored" data-anchor-id="negbin-regression">NegBin regression</h3>
<p>Negative binomial regression was modeled using <code>MASS::glm.nb</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MASS)</span>
<span id="cb9-2">m1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm.nb</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age_grp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = contacts ~ age_grp, data = dat, init.theta = 2.895747992, 
    link = log)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.30861    0.02626  87.919  &lt; 2e-16 ***
age_grp1     0.32714    0.03648   8.967  &lt; 2e-16 ***
age_grp2     0.49578    0.03556  13.943  &lt; 2e-16 ***
age_grp3     0.46119    0.03600  12.812  &lt; 2e-16 ***
age_grp4     0.24010    0.03442   6.975 3.05e-12 ***
age_grp5     0.28582    0.03483   8.206 2.29e-16 ***
age_grp6     0.24679    0.03418   7.220 5.21e-13 ***
age_grp7     0.14499    0.03429   4.228 2.35e-05 ***
age_grp8    -0.09882    0.03656  -2.703  0.00687 ** 
age_grp9    -0.36270    0.05032  -7.208 5.66e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(2.8957) family taken to be 1)

    Null deviance: 8055.6  on 7068  degrees of freedom
Residual deviance: 7390.5  on 7059  degrees of freedom
AIC: 47802

Number of Fisher Scoring iterations: 1

              Theta:  2.8957 
          Std. Err.:  0.0597 

 2 x log-likelihood:  -47780.1930 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(m1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 
 10.0604651   1.3869981   1.6417727   1.5859529   1.2713769   1.3308557 
   age_grp6    age_grp7    age_grp8    age_grp9 
  1.2799167   1.1560315   0.9059023   0.6957929 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">m5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm.nb</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hh_size_grp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> dayofweek, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m5)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = contacts ~ age_grp + gender + hh_size_grp + 
    country + dayofweek, data = dat, init.theta = 3.763576898, 
    link = log)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   1.75583    0.19669   8.927  &lt; 2e-16 ***
age_grp1      0.30090    0.03321   9.060  &lt; 2e-16 ***
age_grp2      0.45196    0.03238  13.956  &lt; 2e-16 ***
age_grp3      0.44934    0.03271  13.738  &lt; 2e-16 ***
age_grp4      0.31340    0.03190   9.824  &lt; 2e-16 ***
age_grp5      0.31068    0.03213   9.668  &lt; 2e-16 ***
age_grp6      0.27568    0.03146   8.763  &lt; 2e-16 ***
age_grp7      0.21717    0.03260   6.661 2.72e-11 ***
age_grp8      0.03470    0.03617   0.959 0.337387    
age_grp9     -0.19923    0.04890  -4.074 4.62e-05 ***
genderF      -0.01755    0.19240  -0.091 0.927340    
genderM      -0.02768    0.19241  -0.144 0.885592    
hh_size_grp2  0.09645    0.02827   3.412 0.000646 ***
hh_size_grp3  0.11854    0.02964   3.999 6.36e-05 ***
hh_size_grp4  0.22913    0.02979   7.692 1.45e-14 ***
hh_size_grp5  0.30497    0.03213   9.492  &lt; 2e-16 ***
countryDE    -0.31802    0.02839 -11.202  &lt; 2e-16 ***
countryFI    -0.01234    0.02921  -0.423 0.672627    
countryGB     0.02936    0.02918   1.006 0.314328    
countryIT     0.43331    0.02960  14.637  &lt; 2e-16 ***
countryLU     0.28600    0.02862   9.994  &lt; 2e-16 ***
countryNL     0.20892    0.04306   4.851 1.23e-06 ***
countryPL     0.25610    0.02860   8.956  &lt; 2e-16 ***
dayofweek1    0.27813    0.02810   9.898  &lt; 2e-16 ***
dayofweek2    0.32401    0.02758  11.747  &lt; 2e-16 ***
dayofweek3    0.31329    0.02812  11.140  &lt; 2e-16 ***
dayofweek4    0.31717    0.02774  11.434  &lt; 2e-16 ***
dayofweek5    0.34216    0.02745  12.465  &lt; 2e-16 ***
dayofweek6    0.14626    0.02887   5.066 4.07e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(3.7636) family taken to be 1)

    Null deviance: 9794.6  on 7068  degrees of freedom
Residual deviance: 7372.6  on 7040  degrees of freedom
AIC: 46396

Number of Fisher Scoring iterations: 1

              Theta:  3.7636 
          Std. Err.:  0.0843 

 2 x log-likelihood:  -46336.2000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(m5<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)     age_grp1     age_grp2     age_grp3     age_grp4     age_grp5 
   5.7882277    1.3510687    1.5713835    1.5672725    1.3680647    1.3643573 
    age_grp6     age_grp7     age_grp8     age_grp9      genderF      genderM 
   1.3174272    1.2425566    1.0353045    0.8193574    0.9826079    0.9726948 
hh_size_grp2 hh_size_grp3 hh_size_grp4 hh_size_grp5    countryDE    countryFI 
   1.1012549    1.1258570    1.2575100    1.3565872    0.7275872    0.9877342 
   countryGB    countryIT    countryLU    countryNL    countryPL   dayofweek1 
   1.0297905    1.5423491    1.3310865    1.2323420    1.2918884    1.3206527 
  dayofweek2   dayofweek3   dayofweek4   dayofweek5   dayofweek6 
   1.3826643    1.3679193    1.3732405    1.4079890    1.1575004 </code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>regression</category>
  <category>contact</category>
  <guid>https://kimfinale.github.io/myblog/posts/POLYMOD-multiple-regression/index.html</guid>
  <pubDate>Wed, 11 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/POLYMOD-multiple-regression/polymod-age-contact.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Regression using optim</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/nb-regression-optim/index.html</link>
  <description><![CDATA[ 




<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>I will use the <code>cars</code> data with give the speed of cars and the distances taken to stop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> datasets<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>cars</span>
<span id="cb1-2">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(dist <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> speed, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>d)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = dist ~ speed, data = d)

Residuals:
    Min      1Q  Median      3Q     Max 
-29.069  -9.525  -2.272   9.215  43.201 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -17.5791     6.7584  -2.601   0.0123 *  
speed         3.9324     0.4155   9.464 1.49e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.38 on 48 degrees of freedom
Multiple R-squared:  0.6511,    Adjusted R-squared:  0.6438 
F-statistic: 89.57 on 1 and 48 DF,  p-value: 1.49e-12</code></pre>
</div>
</div>
</section>
<section id="plot" class="level3">
<h3 class="anchored" data-anchor-id="plot">Plot</h3>
<p>Plot estimates with confidence and prediction intervals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prediction"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prediction interval</span></span>
<span id="cb3-2">conf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># confidence interval</span></span>
<span id="cb3-3"></span>
<span id="cb3-4">mdat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> m<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model</span>
<span id="cb3-5">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pred_estimate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb3-6">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pred_lb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb3-7">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pred_ub <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb3-8">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>conf_estimate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conf[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb3-9">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>conf_lb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conf[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb3-10">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>conf_ub <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conf[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb3-11"></span>
<span id="cb3-12">mdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>residuals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(m)</span>
<span id="cb3-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb3-17"></span>
<span id="cb3-18">pltcar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mdat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(speed, dist))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_point(aes(size = abs(m$residuals)))+</span></span>
<span id="cb3-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pred_estimate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>pred_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>pred_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_line(aes(y=conf_estimate), color="steelblue")+</span></span>
<span id="cb3-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>conf_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>conf_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Speed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distance"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Speed and Stopping Distances of Cars"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span>
<span id="cb3-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot_car.png"</span>, pltcar)</span>
<span id="cb3-31">pltcar</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/nb-regression-optim/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="optim-function" class="level3">
<h3 class="anchored" data-anchor-id="optim-function">optim function</h3>
<p>Now let’s take an alternative approach to write down the likelihood function and maximize it using the <code>optim</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define our likelihood function we like to optimize</span></span>
<span id="cb4-2">negloglik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(par, y, X){</span>
<span id="cb4-3">  sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-4">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> par[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(par)]</span>
<span id="cb4-5">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta </span>
<span id="cb4-6">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb4-7">}</span>
<span id="cb4-8"></span>
<span id="cb4-9">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model.matrix</span>(m)</span>
<span id="cb4-10">init <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(m)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sigma)</span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check</span></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># negloglik(par=init, y=d$y, X=X)</span></span>
<span id="cb4-13">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>init, </span>
<span id="cb4-14">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn=</span>negloglik, </span>
<span id="cb4-15">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dist, </span>
<span id="cb4-16">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span>X, </span>
<span id="cb4-17">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reltol=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>))</span></code></pre></div>
</div>
<p>Let’s compare the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       speed       sigma 
 -17.579095    3.932409   15.379587 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(m)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       speed 
 -17.579095    3.932409 </code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>optim</category>
  <category>regression</category>
  <guid>https://kimfinale.github.io/myblog/posts/nb-regression-optim/index.html</guid>
  <pubDate>Tue, 10 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/nb-regression-optim/plot_car.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>Extract raster based on a polygon</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/crop-raster-polygon/index.html</link>
  <description><![CDATA[ 




<p>raster 이미지의 일부를 추출해보자. 특히, <code>shapefile</code>에 담겨져 있는 polygon에 해당하는 raster 를 추출해보자. <code>raster</code> 패키지의 <code>crop</code> 과 <code>mask</code> 함수를 이용할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create some data using meuse </span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(raster)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(meuse)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coordinates</span>(meuse) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">~</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>y</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">proj4string</span>(meuse) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:28992"</span>)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(meuse.grid)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coordinates</span>(meuse.grid) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">~</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>y</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">proj4string</span>(meuse.grid) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:28992"</span>)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gridded</span>(meuse.grid) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>    </span>
<span id="cb1-10">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">raster</span>(meuse.grid) </span>
<span id="cb1-11">r[] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncell</span>(r))</span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a polygon</span></span>
<span id="cb1-14">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rgeos<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gBuffer</span>(meuse[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byid=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, </span>
<span id="cb1-15">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">joinStyle=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ROUND"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quadsegs=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)   </span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot full raster and polygon                       </span></span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r)</span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(f,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/crop-raster-polygon/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Crop using extent, rasterize polygon and finally, create poly-raster</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#          **** This is the code that you are after ****  </span></span>
<span id="cb2-3">cr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crop</span>(r, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extent</span>(f), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">snap=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"out"</span>)                    </span>
<span id="cb2-4">fr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rasterize</span>(f, cr)   </span>
<span id="cb2-5">lr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mask</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>cr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mask=</span>fr)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot results</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(lr)</span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(f,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/crop-raster-polygon/index_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>R</category>
  <category>raster</category>
  <category>shapefile</category>
  <category>crop</category>
  <category>mask</category>
  <category>sf</category>
  <guid>https://kimfinale.github.io/myblog/posts/crop-raster-polygon/index.html</guid>
  <pubDate>Fri, 22 Sep 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/crop-raster-polygon/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>odin package</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/odin/index.html</link>
  <description><![CDATA[ 




<p>이번 <a href="https://www.vaccineimpact.org/">Vaccine Impact Modeling Consoritum (VIMC)</a> 연례회의에서 <code>odin</code>이라는 패키지에 대해 알게 되었다. <code>deSolve</code>의 업그레이드 버전이라고 보면 될까? R 코드를 C언어로 컴파일하기 때문에 최종 모형의 구동속도가 빠르다. 따라서 모형을 여러번 돌려야 하는 경우 (예를 들어 MCMC) 에 유리하다. <code>pomp</code> 보다도 훨씬 더 빠르다고 했는데 정확한 비교 수치는 잘 기억이 안남. 종종 C++로 모형을 만들었는데 <code>odin</code> 패키지를 사용하면 훨씬 쉬워질 것 같다. 좀 더 살펴보아야 할 텐데 일단 잊지 않기 위해 간단히 SIR 모형만 만들어 보았다.</p>
<section id="deterministic-sir-model" class="level3">
<h3 class="anchored" data-anchor-id="deterministic-sir-model">Deterministic SIR model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">path_sir_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/odin/sir.R"</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(path_sir_model))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Core equations for transitions between compartments:
update(S) &lt;- S - beta * S * I / N
update(I) &lt;- I + beta * S * I / N - gamma * I
update(R) &lt;- R + gamma * I

## Total population size (odin will recompute this at each timestep:
## automatically)
N &lt;- S + I + R

## Initial states:
initial(S) &lt;- S_ini # will be user-defined
initial(I) &lt;- I_ini # will be user-defined
initial(R) &lt;- 0

## User defined parameters - default in parentheses:
S_ini &lt;- user(1000)
I_ini &lt;- user(1)
beta &lt;- user(0.2)
gamma &lt;- user(0.1)</code></pre>
</div>
</div>
<p>Run the model and plot the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(odin)</span>
<span id="cb3-2">sir_generator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> odin<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odin</span>(path_sir_model)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sir_generator<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># see what the object is like</span></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x</span></span>
<span id="cb4-4">sir_col <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#8c8cd9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#cc0044"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#999966"</span>)</span>
<span id="cb4-5">x_res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">las =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matplot</span>(x_res[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], x_res[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>,</span>
<span id="cb4-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> sir_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> sir_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/odin/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="stochastic-sir-model" class="level3">
<h3 class="anchored" data-anchor-id="stochastic-sir-model">Stochastic SIR model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">path_sir_stoch_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/odin/sir_stoch.R"</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readLines</span>(path_sir_stoch_model))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Core equations for transitions between compartments:
update(S) &lt;- S - n_SI
update(I) &lt;- I + n_SI - n_IR
update(R) &lt;- R + n_IR

## Individual probabilities of transition:
p_SI &lt;- 1 - exp(-beta * I / N) # S to I
p_IR &lt;- 1 - exp(-gamma) # I to R

## Draws from binomial distributions for numbers changing between
## compartments:
n_SI &lt;- rbinom(S, p_SI)
n_IR &lt;- rbinom(I, p_IR)

## Total population size
N &lt;- S + I + R

## Initial states:
initial(S) &lt;- S_ini
initial(I) &lt;- I_ini
initial(R) &lt;- 0

## User defined parameters - default in parentheses:
S_ini &lt;- user(1000)
I_ini &lt;- user(1)
beta &lt;- user(0.2)
gamma &lt;- user(0.1)</code></pre>
</div>
</div>
<p>Run the model and plot the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">sir_generator <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> odin<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">odin</span>(path_sir_stoch_model)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb8-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sir_generator<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb8-3">x_res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">las =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matplot</span>(x_res[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], x_res[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>,</span>
<span id="cb8-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> sir_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> sir_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/odin/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>ODE</category>
  <category>R</category>
  <category>odin</category>
  <guid>https://kimfinale.github.io/myblog/posts/odin/index.html</guid>
  <pubDate>Thu, 14 Sep 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/odin/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>PubMed search, ChatGPT summary, and sending an email in Python</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/pubmed-chatgpt-summary-python/index.html</link>
  <description><![CDATA[ 







 ]]></description>
  <category>ChatGPT</category>
  <category>R</category>
  <category>xml</category>
  <category>httr</category>
  <guid>https://kimfinale.github.io/myblog/posts/pubmed-chatgpt-summary-python/index.html</guid>
  <pubDate>Thu, 31 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/pubmed-chatgpt-summary-python/chatgpt.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>PubMed search, ChatGPT summary, and sending an email in R</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/pubmed-chatgpt_summary/index.html</link>
  <description><![CDATA[ 




<p>최신 연구 동향을 잘 알기 위해서 ChatGPT의 요약기능을 사용해보자. PubMed에서 검색을 하고 ChatGPT를 이용하여 초록을 한 두 문장으로 요약하여 그 결과를 이메일로 보내주는 것이다. 이 모든 것을 R에서 쉽게 할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">chatgpt_api_token <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G:/My Drive/Personal/chatGPT_api_key.rds"</span>)</span></code></pre></div>
</div>
<ol type="1">
<li>Search the PubMed database Use the entrez_search function from the rentrez package to search the PubMed database</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rentrez)</span>
<span id="cb2-2"></span>
<span id="cb2-3">query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"typhoid"</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the search query</span></span>
<span id="cb2-4">search_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entrez_search</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">db=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pubmed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">term=</span>query, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">datetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pdat"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reldate=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># any other useful parameters?</span></span></code></pre></div>
</div>
<ol start="2" type="1">
<li>Fetch the details of the article in xml format</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the IDs of the articles</span></span>
<span id="cb3-2">ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> search_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids</span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retrieve the details of the data in xml format</span></span>
<span id="cb3-4">article_details <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entrez_fetch</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">db=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pubmed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span>ids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rettype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xml"</span>)</span></code></pre></div>
</div>
<ol start="3" type="1">
<li>Parse the XML using the xml2 package</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(xml2)</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parse the XML data</span></span>
<span id="cb4-3">doc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xml</span>(article_details)</span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the titles and abstracts</span></span>
<span id="cb4-5">titles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//ArticleTitle"</span>))</span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># abstracts &lt;- xml_text(xml_find_all(doc, "//AbstractText"))</span></span>
<span id="cb4-7">abstracts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//Abstract"</span>))</span>
<span id="cb4-8">dois <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".//PubmedData/ArticleIdList/ArticleId[@IdType='doi']"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to get the doi's</span></span></code></pre></div>
</div>
<ol start="4" type="1">
<li>Call ChatGPT to summarize the abstract in 1-2 sentences This is a subscription-based service. You must have a ChatGPT API key and must have signed up for their paid service.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">get_completion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(prompt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-3.5-turbo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb5-2">  response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">POST</span>(</span>
<span id="cb5-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.openai.com/v1/chat/completions"</span>, </span>
<span id="cb5-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_headers</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Authorization =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bearer"</span>, chatgpt_api_token)),</span>
<span id="cb5-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content_type_json</span>(),</span>
<span id="cb5-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json"</span>,</span>
<span id="cb5-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> model,</span>
<span id="cb5-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature =</span> temperature, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this is the degree of randomness of the model's output</span></span>
<span id="cb5-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">messages =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">role =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, </span>
<span id="cb5-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content =</span> prompt</span>
<span id="cb5-13">     ))</span>
<span id="cb5-14">   )</span>
<span id="cb5-15">  )</span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content</span>(response)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>choices[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>content)</span>
<span id="cb5-17">}</span>
<span id="cb5-18"></span>
<span id="cb5-19"></span>
<span id="cb5-20"></span>
<span id="cb5-21">abstract_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstracts))</span>
<span id="cb5-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># You may want to try various prompts to suit your needs</span></span>
<span id="cb5-23"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstracts)) {</span>
<span id="cb5-24">  prompt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your task is to generate a short summary of a scientific article based on its title and abstract. Summarize the text delimited by triple backticks into one sentence. ``` Title: "</span>, titles[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">". Abstract: "</span>, abstracts[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"```"</span>)</span>
<span id="cb5-25">  abstract_summary[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_completion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prompt=</span>prompt)</span>
<span id="cb5-26">}</span></code></pre></div>
</div>
<ol start="5" type="1">
<li>Make R send you an email everyday Use simple HTML syntaxes (<code>&lt;p&gt;&lt;/p&gt;</code> or <code>&lt;b&gt;&lt;/b&gt;</code>) to compose an email message using <code>blastula</code> package</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(blastula)</span>
<span id="cb6-2"></span>
<span id="cb6-3">create_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(titles, abstract_summary, ids, dois){</span>
<span id="cb6-4">  summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstract_summary), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;b&gt; "</span>, titles[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;/b&gt; "</span>, abstract_summary[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" PMID="</span>, ids[i] , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" DOI="</span>, dois[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;/p&gt;"</span>))</span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(summary)</span>
<span id="cb6-6">}</span>
<span id="cb6-7"></span>
<span id="cb6-8">email <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compose_email</span>(</span>
<span id="cb6-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Test Email"</span>,</span>
<span id="cb6-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_summary</span>(titles, abstract_summary, ids, dois)))</span>
<span id="cb6-11"></span>
<span id="cb6-12">email <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">smtp_send</span>( </span>
<span id="cb6-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kimfinale@gmail.com"</span>,</span>
<span id="cb6-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jonghoon.kim@ivi.int"</span>,</span>
<span id="cb6-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subject =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily summary of PubMed search"</span>,</span>
<span id="cb6-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># credentials = creds_key(id = "gmail"),</span></span>
<span id="cb6-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">credentials =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">creds_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gmail_cred"</span>)</span>
<span id="cb6-19">  )</span>
<span id="cb6-20"></span>
<span id="cb6-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># email %&gt;%</span></span>
<span id="cb6-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   smtp_send(</span></span>
<span id="cb6-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     from = "jonghoon.kim@ivi.int",</span></span>
<span id="cb6-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     to = "jonghoon.kim@ivi.int",</span></span>
<span id="cb6-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     subject = "Testing the `smtp_send()` function",</span></span>
<span id="cb6-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     credentials = creds_key(id = "outlook")</span></span>
<span id="cb6-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   )</span></span></code></pre></div>
</div>
<section id="make-it-into-a-single-function" class="level2">
<h2 class="anchored" data-anchor-id="make-it-into-a-single-function">Make it into a single function</h2>
<p>Make the above functions into a single function and register it for Windows task scheduler such that it can happen every day.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">pubmed_search_chatgpt_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb7-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">query=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"typhoid"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reldate=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_sentence=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-3.5-turbo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rentrez)</span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr)</span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(xml2)</span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(blastula)</span>
<span id="cb7-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># chatgpt_api_token &lt;- readRDS("chatGPT_api_key.rds")</span></span>
<span id="cb7-8">  chatgpt_api_token <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G:/My Drive/Personal/chatGPT_api_key.rds"</span>)</span>
<span id="cb7-9"></span>
<span id="cb7-10">  get_completion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(prompt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-3.5-turbo"</span>,</span>
<span id="cb7-11">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_token=</span>chatgpt_api_token){</span>
<span id="cb7-12">  response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">POST</span>(</span>
<span id="cb7-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.openai.com/v1/chat/completions"</span>, </span>
<span id="cb7-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_headers</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Authorization =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bearer"</span>, api_token)),</span>
<span id="cb7-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content_type_json</span>(),</span>
<span id="cb7-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json"</span>,</span>
<span id="cb7-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> model,</span>
<span id="cb7-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature =</span> temperature,</span>
<span id="cb7-20">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">messages =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">role =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, </span>
<span id="cb7-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content =</span> prompt))</span>
<span id="cb7-23">    )</span>
<span id="cb7-24">  )</span>
<span id="cb7-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content</span>(response)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>choices[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>content)</span>
<span id="cb7-26">}</span>
<span id="cb7-27">  </span>
<span id="cb7-28">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entrez_search</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">db=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pubmed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">term=</span>query, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">datetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pdat"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reldate=</span>reldate)</span>
<span id="cb7-29">  </span>
<span id="cb7-30">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># one or more hits</span></span>
<span id="cb7-31">    ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids</span>
<span id="cb7-32">    details <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entrez_fetch</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">db=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pubmed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span>ids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rettype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xml"</span>)</span>
<span id="cb7-33">    doc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xml</span>(details)</span>
<span id="cb7-34">    titles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//ArticleTitle"</span>))</span>
<span id="cb7-35">    abstracts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//Abstract"</span>))</span>
<span id="cb7-36">    dois <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xml_find_all</span>(doc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//PubmedData/ArticleIdList/ArticleId[@IdType='doi']"</span>))</span>
<span id="cb7-37">    </span>
<span id="cb7-38">    abstract_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstracts))</span>
<span id="cb7-39"></span>
<span id="cb7-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstracts)) {</span>
<span id="cb7-41">      prompt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your task is to generate a short summary of a scientific article based on its title and abstract. Summarize the text delimited by triple backticks into "</span>, num_sentence , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" sentence. ``` Title: "</span>, titles[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">". Abstract: "</span>, abstracts[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"```"</span>)</span>
<span id="cb7-42">      abstract_summary[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_completion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prompt=</span>prompt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span>model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature=</span>temperature)</span>
<span id="cb7-43">    }</span>
<span id="cb7-44">  summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(abstract_summary), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;b&gt; "</span>, titles[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" &lt;/b&gt; "</span>, abstract_summary[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" PMID="</span>, ids[i] , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" DOI="</span>, dois[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;/p&gt;"</span>))</span>
<span id="cb7-45"></span>
<span id="cb7-46">  email <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compose_email</span>(</span>
<span id="cb7-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weekly summary of PubMed search"</span>,</span>
<span id="cb7-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md</span>(summary))</span>
<span id="cb7-49">  </span>
<span id="cb7-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">smtp_send</span>(</span>
<span id="cb7-51">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">email =</span> email,</span>
<span id="cb7-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jonghoon.kim@ivi.int"</span>,</span>
<span id="cb7-53">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kimfinale@gmail.com"</span>,</span>
<span id="cb7-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subject =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily summary of PubMed search"</span>,</span>
<span id="cb7-55">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># credentials = creds_key(id = "gmail")</span></span>
<span id="cb7-56">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">credentials =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">creds_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gmail_cred"</span>)</span>
<span id="cb7-57">  )</span>
<span id="cb7-58">  }</span>
<span id="cb7-59">}</span>
<span id="cb7-60"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pubmed_search_chatgpt_summary</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(taskscheduleR)</span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Schedule the script to run daily at a specific time</span></span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">taskscheduler_create</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">taskname =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PubMed ChatGPT Summary"</span>,</span>
<span id="cb8-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rscript =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G:/My Drive/Personal/pubmed_search_chatgpt_summary.R"</span>),</span>
<span id="cb8-5">schedule <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAILY"</span>, starttime <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"08:00"</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>ChatGPT</category>
  <category>R</category>
  <category>xml</category>
  <category>httr</category>
  <guid>https://kimfinale.github.io/myblog/posts/pubmed-chatgpt_summary/index.html</guid>
  <pubDate>Thu, 31 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/pubmed-chatgpt_summary/chatgpt.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Polygon 면적 구하기: sf 와 raster 패키지</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/area-polygon/index.html</link>
  <description><![CDATA[ 




<p><code>shapefile</code>에 담겨져 있는 polygon의 면적을 구해보자 <code>raster</code> 패키지의 <code>area</code> 혹은 <code>sf</code> 패키지의 <code>st_area</code> 함수를 이용할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-2">kor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/area-polygon/gadm41_KOR_1.shp"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `gadm41_KOR_1' from data source 
  `C:\Users\jonghoon.kim\Documents\myblog\posts\area-polygon\gadm41_KOR_1.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 17 features and 11 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 124.6097 ymin: 33.11236 xmax: 131.8715 ymax: 38.61177
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># another way</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kor &lt;- read_sf(dsn="C:/Users/jonghoon.kim/Documents/myblog/posts/area-polygon", layer="gadm41_KOR_1")</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1e6 to get population density per 1 km^2</span></span>
<span id="cb3-5">kor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>area_sqkm1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_area</span>(kor))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e6</span></span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raster package way</span></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(raster)</span></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kor &lt;- shapefile("C:/Users/jonghoon.kim/Documents/myblog/posts/area-polygon/gadm41_KOR_1.shp")</span></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raster pkg works for the Spatial* object</span></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kor$area_sqkm2 &lt;- raster::area(as(kor, 'Spatial'))/1e6</span></span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot population density</span></span>
<span id="cb3-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-15">labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">atop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population density"</span>, per<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>km<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb3-16">plt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(kor)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>area_sqkm1))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span>labels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>)</span>
<span id="cb3-21">plt</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/area-polygon/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use RColorBrewer </span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RColorBrewer)</span>
<span id="cb4-3">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YlOrBr"</span>)</span>
<span id="cb4-4">plt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradientn</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span>labels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colors=</span>pal)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/area-polygon/index_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>R</category>
  <category>shapefile</category>
  <category>ggplot2</category>
  <category>sf</category>
  <category>raster</category>
  <category>RcolorBrewer</category>
  <guid>https://kimfinale.github.io/myblog/posts/area-polygon/index.html</guid>
  <pubDate>Tue, 29 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/area-polygon/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>ggplot2로 지도 그리기</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/drawing-map/index.html</link>
  <description><![CDATA[ 




<p><code>ggplot2</code>를 이용하여 지도 그리기를 해보자. 지도는 shapefile에 담겨져 있다고 가정하자. shapefile을 읽는 방법은 여러가지가 있을 수 있는데 <code>sf</code> 패키지의 <code>st_read</code> 혹은 <code>read_sf</code> 함수를 이용한 후 <code>ggplot2</code>의 <code>geom_sf</code>를 이용하여 그리는 것이 가장 쉬운 것 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-2">kor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:/Users/jonghoon.kim/Documents/myblog/posts/drawing-map/gadm41_KOR_1.shp"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `gadm41_KOR_1' from data source 
  `C:\Users\jonghoon.kim\Documents\myblog\posts\drawing-map\gadm41_KOR_1.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 17 features and 11 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 124.6097 ymin: 33.11236 xmax: 131.8715 ymax: 38.61177
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kor &lt;- read_sf(dsn="C:/Users/jonghoon.kim/Documents/myblog/posts/drawing-map", layer="gadm41_KOR_1")</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalized number of characters of the name of the admin unit (level 1)</span></span>
<span id="cb3-4">char_len <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(kor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>NAME_1, nchar)</span>
<span id="cb3-5">kor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>prop_char <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> char_len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(char_len)</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-8">plt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(kor)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>prop_char))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normalized</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">character length"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>)</span>
<span id="cb3-13"></span>
<span id="cb3-14">plt</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/drawing-map/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use color brewer </span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RColorBrewer)</span>
<span id="cb4-3">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YlOrBr"</span>)</span>
<span id="cb4-4">plt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> plt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradientn</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normalized</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">character length"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colors=</span>pal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb4-6">  </span>
<span id="cb4-7">plt</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/drawing-map/index_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clear some background stuff</span></span>
<span id="cb5-2">plt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> plt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bg of the panel</span></span>
<span id="cb5-4">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bg of the plot</span></span>
<span id="cb5-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get rid of legend bg</span></span>
<span id="cb5-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.box.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"null"</span>),</span>
<span id="cb5-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"null"</span>),</span>
<span id="cb5-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb5-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb5-20">plt</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/drawing-map/index_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>R</category>
  <category>map</category>
  <category>ggplot2</category>
  <category>sf</category>
  <category>RColorBrewer</category>
  <guid>https://kimfinale.github.io/myblog/posts/drawing-map/index.html</guid>
  <pubDate>Tue, 29 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/drawing-map/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Writing a paper: Start with an outline</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/how-to-write-a-paper/index.html</link>
  <description><![CDATA[ 




<p>연구자의 업무 중에 연구 만큼 중요한 것이 글쓰기, 특히 논문 쓰기이다. 논문으로 쓰여지지 못한 연구는 타인에게는 존재하지 않는 것이나 다름 없는 것이다.. <a href="https://onlinelibrary.wiley.com/doi/10.1002/adma.200400767">Writing a paper</a> by George M. Whitesides 에 논문 쓰기에 유용한 팁이 있어 여기에 기록으로 남긴다. 한 마디로 요약하면 outline (개요)을 이용하는 것이다. 개요를 연구과제의 초기에 작성하여 연구의 계획표로 활용하며 공저자 (주로 제 1저자와 책임저자) 간에 논문에 대한 의견 교환시 개요를 사용하는 것이다. 그리고, 표, 수식, 그림 등이 거의 최종 상태에 가까워지면 개요를 바탕으로 논문 쓰기를 시작한다. 이렇게 하면 불필요한 실험 및 쓰기 등을 줄일 수 있다.</p>
<p>지금까지 연구 과정을 돌아보니 프로젝트 초기에 논문의 개요를 작성하는 과정을 대체로 하긴 했었고 최종 논문 쓰기에 효과적임을 느끼고는 있었다. 그런데 개요를 이용하여 논문의 구조를 고민하고 그림이나 표를 최종 상태로 만든 후에 눈문 텍스트를 작성하는 일은 하지 않았던 것 같다. 대체로 개요, 그림, 그리고 표가 최종 상태가 되기 전에 텍스트를 작성하여, Whitesides 가 적었듯이 최종 논문에 사용되지 않은 텍스트가 많았던 것 같다. 개요를 이용하여 논문의 구조를 고민하고, 그림, 표를 최종본으로 만드는 과정에 노력을 기울이고 텍스트를 더하는 일은 그 이후에 하는 것이 더 효과적일 것 같다.</p>



 ]]></description>
  <category>writing</category>
  <category>paper</category>
  <guid>https://kimfinale.github.io/myblog/posts/how-to-write-a-paper/index.html</guid>
  <pubDate>Tue, 29 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/how-to-write-a-paper/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Important figures from the book, How to avoid a climate diaster? by Bill Gates</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/climate-disaster/index.html</link>
  <description><![CDATA[ 




<p><a href="https://www.amazon.com/How-Avoid-Climate-Disaster-Breakthroughs/dp/059321577X">How to Avoid a Climate Disaster: The Solutions We Have and the Breakthroughs We Need</a> by Bill Gates is a comprehensive and accessible guide on how to tackle the urgent issue of climate change. Gates begins by laying out the scope of the problem, explaining that the world needs to reduce its greenhouse gas emissions to zero to avoid a catastrophe. I’ve compiled important numbers from the book to understand the climate change issues.</p>
<ul>
<li><p>51 Billion Tonnes: This is the amount of greenhouse gases, measured in CO2 equivalent (<img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BCO_%7B2%7De%7D">), that humanity adds to the atmosphere every year.</p></li>
<li><p>Zero: According to Bill Gates, we need to bring this number down to zero to avoid a climate disaster. And he thinks it is possible through our technological advances. Watch his TED talk, <a href="https://www.youtube.com/watch?v=JaF-fq2Zn7I&amp;t=999s">Innovating to zero!</a>. He is a great speaker!</p></li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>Percentage</th>
<th>Item</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>27%</td>
<td>How we generate electricity</td>
</tr>
<tr class="even">
<td>31%</td>
<td>How we make things</td>
</tr>
<tr class="odd">
<td>18%</td>
<td>How we grow our food</td>
</tr>
<tr class="even">
<td>16%</td>
<td>How we move around</td>
</tr>
<tr class="odd">
<td>6%</td>
<td>How we keep warm or cool</td>
</tr>
</tbody>
</table>



 ]]></description>
  <category>parameter estimation</category>
  <category>R</category>
  <category>maximum likelihood</category>
  <category>profile likelihood</category>
  <guid>https://kimfinale.github.io/myblog/posts/climate-disaster/index.html</guid>
  <pubDate>Sun, 27 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/climate-disaster/gates-climate-book.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Regression toward the mean</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/regression-toward-mean/index.html</link>
  <description><![CDATA[ 




<p>In his <a href="https://www.youtube.com/watch?v=dzFf3r1yph8&amp;t=209s">lecture</a> Joseph Blitzstein talks about two basic statistical phenomena: Regression toward to the mean (RTTM) and survivor bias. The RTTM is today’s topic. Topic was mainly written by GPT 4.</p>
<p>Regression toward the mean is a statistical phenomenon where extreme data points are likely to be followed by less extreme ones when measured again. In simpler terms, it means that if an extreme observation is observed, the next observation is likely to be closer to the mean or average.</p>
<section id="why-does-it-happen" class="level3">
<h3 class="anchored" data-anchor-id="why-does-it-happen">Why does it happen?</h3>
<p>It’s primarily a matter of probability. Extreme values are, by definition, rare. So, when you take a second measurement, it’s simply more probable that the new value will be closer to the mean than the previous extreme value was.</p>
</section>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">Examples:</h3>
<p>Sports Performance: Imagine a basketball player who has an outstanding game, scoring well above their average number of points. If they’ve played at such an exceptional level, it’s likely that in the next game they will score closer to their average (not necessarily because their skill has decreased, but simply due to the natural variability in performance).</p>
<p>Student Test Scores: If a student who typically scores around the average on exams gets an exceptionally high score on one test, they might score closer to their average on a subsequent test. Conversely, if they score exceptionally low on one test, they might score higher the next time.</p>
<p>Investment Returns: If a particular stock has an exceptionally good year with returns way above the market average, it might have more modest (or even below-average) returns the following year.</p>
<p>Height of Parents and their Children: This is a classic example by Sir Francis Galton. He found that very tall parents tend to have children who are shorter than them (but still above average), and very short parents tend to have children who are taller than them (but still below average). The children’s heights tend to “regress” towards the mean height.</p>
<p>Medical Treatments: If patients are selected for a clinical trial because they have exceptionally high blood pressure, some of them will probably show a reduction in blood pressure over time even without any treatment. This isn’t because of any therapeutic effect, but simply because their initial measurements were unusually high and subsequent measurements tend to be closer to the mean.</p>
</section>
<section id="misunderstandings" class="level3">
<h3 class="anchored" data-anchor-id="misunderstandings">Misunderstandings:</h3>
<p>This concept is often misunderstood. For instance, if a student performs poorly on a test and then improves on the next one, it might be tempting to attribute this improvement to a particular intervention (like tutoring). While the intervention might have had an effect, it’s also possible that some of the improvement was due to regression toward the mean.</p>
<p>In research and experimental designs, this phenomenon needs to be taken into account, especially when making causal inferences from observed changes.</p>
<p>Toward the end of his talk, he mentions about the quote by Daniel Kahneman that very clearly explain the concept of RTTM.</p>
<p>I had the most satisfying Eureka experience of my career while attempting to teach flight instructors that praise is more effective than punishment for promoting skill-learning. …. [A flight instructor objected:] “On many occasions I have praised flight cadets for clean execution of some aerobatic maneuver, and in general when they try it again, they do worse. On the other hand, I have often screamed at cadets for bad execution, and in general they do better the next time. So please don’t tell us that reinforcement works and punishment does not, because the opposite is the case.” …</p>
<p>This was a joyous moment, in which I understood an important truth about the world: because we tend to reward others when they do well and punish them when they do badly, and because there is regression to the mean, it is part of the human condition that we are statistically punished for rewarding others and rewarded for punishing them.</p>
<p>Full details of Kahneman’s quote can be found from the following <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3292229/">article</a></p>


</section>

 ]]></description>
  <category>parameter estimation</category>
  <category>R</category>
  <category>maximum likelihood</category>
  <category>profile likelihood</category>
  <guid>https://kimfinale.github.io/myblog/posts/regression-toward-mean/index.html</guid>
  <pubDate>Thu, 24 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/regression-toward-mean/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Survivor bias</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/survivor-bias/index.html</link>
  <description><![CDATA[ 




<p>In his <a href="https://www.youtube.com/watch?v=dzFf3r1yph8&amp;t=209s">lecture</a> titled “The Soul of statistics” Joseph Blitzstein talks about a survivor bias (or conditioning more broadly) Dr.&nbsp;Derek Muller also talks about various examples of Korean houses in <a href="https://english.visitkorea.or.kr/svc/whereToGo/locIntrdn/locIntrdnList.do?vcontsId=97932&amp;menuSn=351">Bukchon Hanok Village</a> on his <a href="https://www.youtube.com/watch?v=_Qd3erAPI9w">YouTube</a></p>
<p>Survivor bias is today’s topic and the following was written mostly by GPT 4.</p>
<p><strong>Survivor Bias: What Remains Tells Only Half the Story</strong></p>
<p>Imagine walking through a forest and noticing the tallest trees. You marvel at their height and strength, thinking that this is the natural order of things. But what about the saplings and smaller trees that didn’t survive? This is the essence of survivor bias.</p>
<p><strong>What is Survivor Bias?</strong></p>
<p>Survivor bias, or survivorship bias, is a logical error of focusing on the people or things that made it past some selection process and overlooking those that did not, typically because of their lack of visibility. This can lead to false conclusions in numerous different ways.</p>
<p><strong>A Classic Example: WWII Airplanes</strong></p>
<p>During World War II, military officials examined planes returning from combat missions to determine where they were most frequently hit by enemy fire. The plan was simple: reinforce these areas to improve the aircraft’s survival rate. The bullet holes were predominantly in the wings, body, and tail. So, it might seem logical to reinforce these parts.</p>
<p>However, a statistician named Abraham Wald pointed out a flaw in this reasoning. The planes they were inspecting had survived. The real question was: where were the bullet holes on the planes that didn’t return? Wald hypothesized that the missing airplanes had been hit in the engine, a critical area absent of damage in the returning planes. By only looking at the survivors, the military had almost made a grave error.</p>
<p><strong>Why Does It Matter?</strong></p>
<p>Survivor bias can skew our understanding and lead to incorrect conclusions in various fields:</p>
<ul>
<li><p><strong>Business:</strong> When studying successful companies, we might conclude that their practices are best. But what about companies that followed the same practices and failed?</p></li>
<li><p><strong>Medicine:</strong> If we only focus on patients who return for follow-up after treatment, we might miss side effects or outcomes in those who didn’t return.</p></li>
<li><p><strong>Culture:</strong> Celebrating only the top artists or authors might make us think that a particular style or theme is the key to success, overlooking other potential talents.</p></li>
</ul>
<p><strong>Overcoming Survivor Bias</strong></p>
<p>Awareness is the first step. Whenever you’re examining successes, ask yourself: “What am I not seeing?” Seek out the failures, the unseen, the unreturned. By considering the whole picture, not just the apparent survivors, you get a clearer, more accurate view of reality.</p>
<p>In conclusion, while it’s natural to focus on winners and success stories, it’s crucial to remember the unseen and unspoken failures. They often hold the most valuable lessons.</p>



 ]]></description>
  <category>parameter estimation</category>
  <category>R</category>
  <category>maximum likelihood</category>
  <category>profile likelihood</category>
  <guid>https://kimfinale.github.io/myblog/posts/survivor-bias/index.html</guid>
  <pubDate>Thu, 24 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/survivor-bias/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Maximum Likelihood and Profile Likelihood for the SEIR model</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/max-likelihood/index.html</link>
  <description><![CDATA[ 




<p>통계학은 많은 부분 확률모형의 모수를 추정하는 (inferential statistics) 과정이고 모수 추정방법으로 가장 많이 사용되는 방법이 maximum likelihood (ML)이다. 이번 포스트는 2014년 출간된 Cole <em>et al</em>.의 <a href="https://academic.oup.com/aje/article/179/2/252/123902">Maximum Likelihood, Profile Likelihood, and Penalized Likelihood: A Primer</a>을 차용하여 maximum likelihood (ML) 와 profile likelihood에 대하여 기술하여 보고자 한다.</p>
<section id="최대-가능도-ml" class="level3">
<h3 class="anchored" data-anchor-id="최대-가능도-ml">최대 가능도 (ML)</h3>
<p>잠복기를 추정하기 위해 증상 발현일과 기존 감염자와의 접촉일을 묻는 설문조사를 했다고 하자. <img src="https://latex.codecogs.com/png.latex?n"> 명을 인터뷰하고 <img src="https://latex.codecogs.com/png.latex?n"> 개의 관찰값 <img src="https://latex.codecogs.com/png.latex?y_1,%20y_2,%20...,%20y_n"> 을 얻었다고 하자. 잠복기의 분포에 대한 확률모형 <img src="https://latex.codecogs.com/png.latex?f%20(y%7C%5Cboldsymbol%7B%5Ctheta%7D)"> 은 주어진 모수<img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D=(%5Ctheta_1,%20%5Ctheta_2,%20...,%20%5Ctheta_j)"> 하에서 <img src="https://latex.codecogs.com/png.latex?Y=y">가 될 확률을 나타낸다.</p>
<p>최대 가능도 방법은 미지의 모수 하에서 관찰값의 확률의 나타낸다. 확률 모형 <img src="https://latex.codecogs.com/png.latex?f(y%7C%5Cboldsymbol%7B%5Ctheta%7D)">이 주어진 모수 <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D"> 하에서 <img src="https://latex.codecogs.com/png.latex?Y">의 확률을 나타내는 반면 최대 가능도 방법은 <img src="https://latex.codecogs.com/png.latex?Y">를 관찰값에 고정한 채 <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D">의 함수로 표현하게 된다. 따라서 확률모형과는 다르게 다음과 같은 식 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;y_i)"> 을 사용한다. 즉, 우리가 관심있어 하는 것은 확률모형 <img src="https://latex.codecogs.com/png.latex?f%20(y%7C%5Cboldsymbol%7B%5Ctheta%7D)">이 <img src="https://latex.codecogs.com/png.latex?Y"> 가 아니고 <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D"> 에 따라 어떻게 변하는가 하는 것이다. <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;y_i)"> 를 <img src="https://latex.codecogs.com/png.latex?i"> 번째 관찰값이 가능도에 영향을 미치는 정도라 하고 관찰값이 상호독립적이라고 가정하면 관찰값 전체의 가능도는 아래와 같이 표현할 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;%5Cboldsymbol%7By%7D)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;y_i)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20f(y_i;%5Cboldsymbol%7B%5Ctheta%7D)"></p>
<p>위 식에서 <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7By%7D=(y_1,%20y_2,%20...,%20y_n)">을 나타낸다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D(%5Cboldsymbol%7B%5Ctheta%7D;%5Cboldsymbol%7By%7D)"> 는 <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D">에 대한 확률을 알 수는 없기 때문에 확률모형이 아닌 가능도 (혹은 우도) 함수라고 한다. ML은 가능도 함수를 최대로 만들어 주는 <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D">로 모수에 대한 추정치를 정의한다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Ctheta%7D%20=%20%5Ctextrm%7Bargmax%7D_%7B%5Ctheta%7D%5C%7B%7B%5Cmathrm%7Blog%7D%20%5Cmathcal%7BL%7D(%5Ctheta)%7D%5C%7D"></p>
<p>위 식에서 <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Blog%7D">를 사용한 이유는 가능도 값이 매우 작은 수가되는 경우가 많고 따라서 컴퓨터를 이용한 계산상의 안정성을 위해서 (i.e., <a href="https://en.wikipedia.org/wiki/Arithmetic_underflow">arithmetic underflow</a> 가 일어나지 않게 하기 위해) 실제로는 <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Blog%7D%20%5Cmathcal%7BL%7D(%5Ctheta)">를 사용하기 때문이다. 추가적으로 많은 최적화 알고리듬의 경우 최소화가 기본값으로 설정되어 있어 최대 가능도법을 구현할 때는 <img src="https://latex.codecogs.com/png.latex?-%5Cmathrm%7Blog%7D%20%5Cmathcal%7BL%7D(%5Ctheta)">를 사용하는 경우가 많다.</p>
<p>최대 가능도법을 이용하여 푸아송 분포의 모수를 추정하는 과정을 살펴보자.</p>
</section>
<section id="푸아송-분포-모수-추정" class="level3">
<h3 class="anchored" data-anchor-id="푸아송-분포-모수-추정">푸아송 분포 모수 추정</h3>
<p>위에서 언급했던 잠복기의 예를 살펴보자. 잠복기는 Weibull, Gamma, 혹은 Lognormal 등 두 개의 모수를 가지는 확률모형이 많이 사용되는 데 아래 예에서는 계산상의 편의를 위해서 하나의 모수를 가지는 푸아송 분포를 사용하였다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1220</span>)</span>
<span id="cb1-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of observations</span></span>
<span id="cb1-3">lamb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true parameter value</span></span>
<span id="cb1-4">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>lamb) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># observations</span></span>
<span id="cb1-5">nll_theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(theta){</span>
<span id="cb1-6">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpois</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># negative log likelihood</span></span>
<span id="cb1-7">}</span>
<span id="cb1-8">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optimize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">f=</span>nll_theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e6</span>))</span>
<span id="cb1-9">res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>minimum <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#\hat{\theta} compare w/ lamb</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>minimum) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># likelihood</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.090828e-11</code></pre>
</div>
</div>
<p>다음 번 포스팅에는 ML로 추정된 모수의 신뢰구간을 구하는 방법을 샆펴보자.</p>


</section>

 ]]></description>
  <category>parameter estimation</category>
  <category>R</category>
  <category>maximum likelihood</category>
  <category>profile likelihood</category>
  <guid>https://kimfinale.github.io/myblog/posts/max-likelihood/index.html</guid>
  <pubDate>Sun, 13 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/max-likelihood/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Population Monte Carlo 파퓰레이션 몬테카를로</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/R0-sympy/index.html</link>
  <description><![CDATA[ 




<p>감염병의 전파를 이해하는 데 있어 가장 기본적인 개념이 <a href="https://jonghoonkim.ghost.io/ghost/#/editor/post/63aae251d7d6b5003d2967d1">재감염지수</a>, 특히 기초재감염지수 (<img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">) 이다. 재감염지수는 한 명의 감염자로부터 생산되는 평균 후속 감염자의 수를 일컫는데 기초재감염지수는 코로나19의 경우 처럼 인구 집단에 면역력을 가진 사람이 없어 모든 사람이 감염될 수 있는 상태하 에서의 재감염지수를 말한다. 기초 재감염 지수는 다음과 같은 수식으로 표현할 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Cmathcal%7BR%7D_0%20=%20%5Cbeta%20c%20D%20"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta"> 는 한 명의 감염자가 타인을 접촉할 때 상대방을 감염시킬 수 있는 확률, <img src="https://latex.codecogs.com/png.latex?c"> 는 단위 시간 당 접촉이 일어나는 횟수, <img src="https://latex.codecogs.com/png.latex?D"> 는 감염 상태가 지속되는 시간을 나타낸다. <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> 만으로 <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20c"> 를 대신해 사용하는 경우도 흔하다. 그 경우 <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> 는 단위 시간 당 후속 감염자의 수로 표현할 수 있을 것 같다. 미분방정식에 기반한 감염병 모형의 경우는 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">를 어떻게 계산할까? 아래와 같이 SIR 모형을 정의해 보자.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS/%5Cmathrm%7Bd%7Dt%20&amp;=%20-%5Cbeta%20I%20S/N%20%5C%5C%0A%5Cmathrm%7Bd%7DI/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cbeta%20I%20S/N%20-%20%5Cgamma%20I%5C%5C%0A%5Cmathrm%7Bd%7DR/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cgamma%20I%0A%5Cend%7Balign%7D"></p>
<p>위의 정의에서 사용되었던 개념을 적용한다면 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0%20=%20%5Cbeta/%5Cgamma"> 라고 할 수 있다. 이는 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">가 감염병이 집단 내에서 유행을 일으킬 수 있는 역치조건임을 이용해도 동일한 결론에 이를 수 있다. (i.e., <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Bd%7DI/%5Cmathrm%7Bd%7Dt%3E0">)</p>
<p>위와는 달리 <a href="https://link.springer.com/article/10.1007/BF00178324">Diekmann <em>et al.</em></a> 에 의해서 도입된 next generation 방법으로 좀 더 다양한 상황 하에서 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">를 구할 수 있다. 이 방법에서는 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">가 next generation operator의 spectral radius 가 된다. 위 논문 보다는 <a href="https://www.sciencedirect.com/science/article/pii/S0025556402001086">van den Driessche <em>et al.</em></a> 가 좀 더 이해하기 쉬운 것 같아 이 방법을 기준으로 살펴보겠다. 그리고 그 계산을 python의 SymPy 라이브러리를 이용해서 구현을 해보겠다. 먼저 간단한 우선 ( SEIR ) 모형의 경우부터 살펴보자.</p>
<p>Next generation operator <img src="https://latex.codecogs.com/png.latex?G"> 은 전파를 통해서 생산되는 새로운 감염이 발생하는 속도를 나타내는 행렬 <img src="https://latex.codecogs.com/png.latex?F">와 감염이 다른 상태로 변화되는 속도 (V)로 구성되며 다음과 같은 관계를 갖는다. <img src="https://latex.codecogs.com/png.latex?G=FV%5E%7B-1%7D">. 그리고 <img src="https://latex.codecogs.com/png.latex?R_0">는 <img src="https://latex.codecogs.com/png.latex?G">의 <a href="https://en.wikipedia.org/wiki/Spectral_radius">spectral radius</a>가 된다. 아래 파이썬 구현에서는 <img src="https://latex.codecogs.com/png.latex?%5Cbeta,%20%5Cgamma"> 를 b, g로 나타내었다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sympy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-2">b, k, g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p k g'</span>)</span>
<span id="cb1-3">F <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, b],[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb1-4">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[k, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>k, g]])</span>
<span id="cb1-5">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-6">eigval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> M.eigenvals(simplify<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true)</span>
<span id="cb1-7">init_printing(use_unicode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-8">eigval</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>⎧      p   ⎫
⎨0: 1, ─: 1⎬
⎩      g   ⎭</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#⎧      b   ⎫</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#⎨0: 1, ─: 1⎬</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#⎩      g   ⎭</span></span>
<span id="cb3-4">lst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(eigval.keys())</span>
<span id="cb3-5">lst[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p
─
g</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#b</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#─</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#g</span></span></code></pre></div>
</div>
<p>위에서 언급한 SEIR 모형의 경우는 너무 간단하니 그 보다 조금 더 복잡한 그 예로 다음 연구를 살펴보자. <a href="https://journals.plos.org/plosntds/article?id=10.1371/journal.pntd.0002642">Pitzer <em>et al</em>.</a>의 연구인데 사용된 감염병 모형은 사람 간 직접 전파와 물을 통한 간접 전파 두 가지의 전파 메케니즘을 구현 하였고 (<img src="https://latex.codecogs.com/png.latex?%5Clambda_p"> 와 <img src="https://latex.codecogs.com/png.latex?%5Clambda_w">) 최초 감염 <img src="https://latex.codecogs.com/png.latex?S_1%20%5Crightarrow%20I_1"> 과 중복 감염<img src="https://latex.codecogs.com/png.latex?R%20%5Crightarrow%20S_2%20%5Crightarrow%20I_2"> 을 다르게 취급하였다. 부록 (supplementary material)을 보면 사용된 미분식을 볼 수 있다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS_1/%5Cmathrm%7Bd%7Dt%20&amp;=%20B%20+%20%5Cepsilon%20S_2%20-%20(%5Clambda_p+%5Clambda_w-%5Cmu)S_1%5C%5C%0A%5Cmathrm%7Bd%7DI_1/%5Cmathrm%7Bd%7Dt%20&amp;=%20(%5Clambda_p+%5Clambda_w)S_1%20-%20(%5Cdelta+%5Cmu)%20I_1%20%5C%5C%0A%5Cmathrm%7Bd%7DR/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cdelta(1-%5Ctheta-%5Calpha)(I_1+I_2)%20-%20(%5Comega%20+%5Cmu)R%20%5C%5C%0A%5Cmathrm%7Bd%7DC/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cdelta%5Ctheta(I_1+I_2)%20-%20%5Cmu%20C%20%5C%5C%0A%5Cmathrm%7Bd%7DS_2/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Comega%20R%20-%5Cepsilon%20S_2%20-%20(%5Clambda_p+%5Clambda_w-%5Cmu)%20S_2%5C%5C%0A%5Cmathrm%7Bd%7DI_2/%5Cmathrm%7Bd%7Dt%20&amp;=%20(%5Clambda_p+%5Clambda_w)%20S_2%20-%20(%5Cdelta+%5Cmu)%20I_2%20%5C%5C%0A%5Cmathrm%7Bd%7DW/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cgamma(I_1+rI_2+rC)%20-%20%5Cxi%20W%0A%5Cend%7Balign%7D"></p>
<p>또한 아래와 같이 기초재감염지수도 계산 결과를 보여준다. SymPy를 통해 동일한 결과를 얻을 수 있는지 확인해보자.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0AR_0%20=%20%5Cfrac%7B1%7D%7B%5Cmu+%5Cdelta%7D%20%5Cleft(%5Cbeta_p%20+%5Cfrac%7B%5Cgamma%20%5Cbeta_w%7D%7B%5Cxi%7D%5Cright)%20%5Cleft(1%20+%5Cfrac%7B%5Cdelta%5Ctheta%20r%7D%7B%5Cmu%7D%5Cright)%0A%5Cend%7Balign%7D"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">p, r, w, N, d, m, t, m, g, x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p r w N d m t m g x'</span>)</span>
<span id="cb6-2">F <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[p, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p, w<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>N], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb6-3">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t, m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g, x]])</span>
<span id="cb6-4">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-5">eigval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> M.eigenvals(simplify<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true)</span>
<span id="cb6-6">init_printing(use_unicode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-7">eigval </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>⎧      (N⋅g⋅w + p⋅x)⋅(d⋅r⋅t + m)   ⎫
⎨0: 3, ─────────────────────────: 1⎬
⎩             m⋅x⋅(d + m)          ⎭</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">lst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(eigval.keys())</span>
<span id="cb8-2">R0_eig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lst[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb8-3">R0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>x)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>r)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>m) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0 from the Pitzer (2014)</span></span>
<span id="cb8-4">simplify(R0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R0_eig) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0 for the same expression (symbolic assessment)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0</span></span>
<span id="cb10-2">R0.equals(R0_eig) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True for the same expression (numerical assessment)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#True</span></span></code></pre></div>
</div>
<p>부록에 보면 기초 재감염지수에 이르는 상세한 과정이 나와있는데 <img src="https://latex.codecogs.com/png.latex?V_%7B3,3%7D"> 에 오류가 있음을 알아냈다. <img src="https://latex.codecogs.com/png.latex?%5Cdelta%20+%5Cmu"> 가 <img src="https://latex.codecogs.com/png.latex?%5Cmu"> 로 바뀌어야 한다. 이유는 위 미분식에서 <img src="https://latex.codecogs.com/png.latex?C"> 식을 보면 알 수 있는데 이는 만성 감염자를 나타내고 따라서 회복을 의미하는 <img src="https://latex.codecogs.com/png.latex?%5Cdelta"> 가 없어야 한다. 이는 기록하는 과정에서의 오류인 듯 하고 결과로 얻어진 <img src="https://latex.codecogs.com/png.latex?R_0"> 는 우리가 계산한 결과와 동일하다. 다만, 계산 결과를 식 (18) 에서와 같이 의미있는 구획으로 나누어서 표현하려면 SymPy 결과를 직접 수정하여야 한다.</p>



 ]]></description>
  <category>Monte Carlo</category>
  <category>R</category>
  <category>parameter estimation</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://kimfinale.github.io/myblog/posts/R0-sympy/index.html</guid>
  <pubDate>Thu, 10 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/R0-sympy/SimPy_logo.svg.png" medium="image" type="image/png" height="55" width="144"/>
</item>
<item>
  <title>Population Monte Carlo 파퓰레이션 몬테카를로</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/pop-monte-carlo/index.html</link>
  <description><![CDATA[ 




<p>최근에 파티클필터링 (particle filtering; PF) 방법을 이용하여 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_t"> 추정하는 과정에 대한 논문을 썼다. 그런데, 항상 의문이었던 것은 PF를 조금만 변형하면 감염병 모형의 감염속도 <img src="https://latex.codecogs.com/png.latex?%5Cbeta=%5Cmathcal%7BR%7D_0%20%5Cgamma"> 와 같은 time-invariant 파라미터를 추정할 수도 있지 않을까 하는 것이었다. <a href="https://www.tandfonline.com/doi/abs/10.1198/106186004X12803?journalCode=ucgs20">Population Monte Carlo (PMC)</a>가 바로 그 방법이었다.</p>
<p>이번 포스트에서는 SIR 모형의 모수 <img src="https://latex.codecogs.com/png.latex?%5Cbeta">를 PMC 방법으로 추정하여 보았다. 추정하는 PMC 알고리즘을 아래에 구현하였다. 전에 구현했던 <a href="">particle filtering</a> 와 유사하다. 즉 중요도 샘플링 (importance sampling)을 연속으로 구현하는 데 연속으로 샘플링 하기 위해 Markov Chain Monte Carlo 에서 사용하듯이 proposal 을 이용하여 다음 단계의 샘플을 만들고 중요도 샘플링을 이용하여 추정을 하는 것이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(truncnorm) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># draw or evaluate according to a truncated normal dist  </span></span>
<span id="cb1-2">pmc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb1-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial values</span></span>
<span id="cb1-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># observation</span></span>
<span id="cb1-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npart =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of particles </span></span>
<span id="cb1-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">niter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># iterations</span></span>
<span id="cb1-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to control the number of daily y to be fitted</span></span>
<span id="cb1-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dt for the ODE integration</span></span>
<span id="cb1-9">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior_mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb1-10">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior_sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-11">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior_lb =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-12">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior_ub =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb1-13">  </span>
<span id="cb1-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># makes it easy to use truncated normal distribution</span></span>
<span id="cb1-15">  nstate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x0) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of state variables (i.e., S, I, R, CI)</span></span>
<span id="cb1-16">  </span>
<span id="cb1-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial betas are sampled according to the prior distribution</span></span>
<span id="cb1-18">  beta0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rtruncnorm</span>(npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>prior_mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>prior_sd)</span>
<span id="cb1-19">  beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to store the samples for beta</span></span>
<span id="cb1-20">  beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta0 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the initial values for the first row</span></span>
<span id="cb1-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># proposal for the next iteration, which is then resampled according to the  weight</span></span>
<span id="cb1-22">  sd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale for the proposal is adapted according to the current sample </span></span>
<span id="cb1-23">  beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rtruncnorm</span>(npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sd)</span>
<span id="cb1-24">  </span>
<span id="cb1-25">  lik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># likelihood </span></span>
<span id="cb1-26">  proposal_prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter)</span>
<span id="cb1-27">  wt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># weight </span></span>
<span id="cb1-28">  W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalized weights</span></span>
<span id="cb1-29">  A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> niter) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Resample according to the normalized weight</span></span>
<span id="cb1-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial value  </span></span>
<span id="cb1-31">  proposal_prob[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-32">  wt[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> npart  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial weights</span></span>
<span id="cb1-33">  W[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wt[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]</span>
<span id="cb1-34"> </span>
<span id="cb1-35">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>niter) {</span>
<span id="cb1-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cat("i =", i, "\n")</span></span>
<span id="cb1-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tend increases by 1 accounts for the initial values</span></span>
<span id="cb1-38">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(npart, tend<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nstate),</span>
<span id="cb1-39">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(x0)))</span>
<span id="cb1-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (nm <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(x0)) {<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># starting values for each particle</span></span>
<span id="cb1-41">      X[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nm] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x0[[nm]]</span>
<span id="cb1-42">    }</span>
<span id="cb1-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># run process model (i.e., SIR model) </span></span>
<span id="cb1-44">    x_1_tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-45">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">process_model</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params =</span> params,</span>
<span id="cb1-46">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> X,</span>
<span id="cb1-47">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt,</span>
<span id="cb1-48">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta =</span> beta[i,])</span>
<span id="cb1-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate weights (likelihood)</span></span>
<span id="cb1-50">    lik[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assign_weights</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x_1_tend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>tend])</span>
<span id="cb1-51">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalize particle weights</span></span>
<span id="cb1-52">    proposal_prob[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dtruncnorm</span>(beta[i,], beta[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sd)</span>
<span id="cb1-53">    prior_prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dtruncnorm</span>(beta[i,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>prior_mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>prior_sd)</span>
<span id="cb1-54">    wt[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lik[i,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> prior_prob <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> proposal_prob[i,]</span>
<span id="cb1-55">    </span>
<span id="cb1-56">    W[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wt[i,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(wt[i,])</span>
<span id="cb1-57">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># resample particles by sampling parent particles according to normalized weights</span></span>
<span id="cb1-58">    A[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob=</span>W[i,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span>T)</span>
<span id="cb1-59">    beta[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta[i, A[i,]] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># resampled beta according to the normalized weight</span></span>
<span id="cb1-60">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sd for the proposal can be adapted in various other ways, but we use the sd of the current sample</span></span>
<span id="cb1-61">    sd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(beta[i,]) </span>
<span id="cb1-62">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate proposals for the next iteration</span></span>
<span id="cb1-63">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> niter) {</span>
<span id="cb1-64">      beta[i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rtruncnorm</span>(npart, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>prior_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>prior_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span>beta[i,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span>sd)</span>
<span id="cb1-65">    } </span>
<span id="cb1-66">  } <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># end iteration</span></span>
<span id="cb1-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta=</span>beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lik=</span>lik, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W=</span>W, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A=</span>A))</span>
<span id="cb1-68">}</span></code></pre></div>
</div>
<p>감염병 확산 과정을 나타내는 SIR 모형을 구현해보자. 파티클수에 따라 벡터형태로 SIR 모형을 구현하였다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">process_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb2-2">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb2-3">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb2-4">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) {</span>
<span id="cb2-5">  </span>
<span id="cb2-6">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a vector of initial S across the particles</span></span>
<span id="cb2-7">  I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a vector of initial I across the particles</span></span>
<span id="cb2-8">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a vector of initial S across the particles</span></span>
<span id="cb2-9">  </span>
<span id="cb2-10">  len <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>]) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># length of model predictions (same as the data points) + 1 accounting for the initial values</span></span>
<span id="cb2-11">         </span>
<span id="cb2-12">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> R</span>
<span id="cb2-13">  gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>]]</span>
<span id="cb2-14">  </span>
<span id="cb2-15">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>len) {</span>
<span id="cb2-16">    daily_infected <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to track the daily infection</span></span>
<span id="cb2-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(dt, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dt)) { <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># steps per day</span></span>
<span id="cb2-18">      FOI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N</span>
<span id="cb2-19">      S_to_I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FOI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt</span>
<span id="cb2-20">      I_to_R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt</span>
<span id="cb2-21">  </span>
<span id="cb2-22">      S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> S_to_I</span>
<span id="cb2-23">      I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> S_to_I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> I_to_R</span>
<span id="cb2-24">      R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> I_to_R</span>
<span id="cb2-25">      </span>
<span id="cb2-26">      daily_infected <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> daily_infected <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> S_to_I</span>
<span id="cb2-27">    }</span>
<span id="cb2-28">    </span>
<span id="cb2-29">    x[, j, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S</span>
<span id="cb2-30">    x[, j, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> I</span>
<span id="cb2-31">    x[, j, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R</span>
<span id="cb2-32">    x[, j, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inc"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> daily_infected</span>
<span id="cb2-33">  }</span>
<span id="cb2-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>len, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inc"</span>])</span>
<span id="cb2-35">}</span></code></pre></div>
</div>
<p>모수 추정에 사용할 거짓 일별 감염자수를 만들어보자. 위에서 구현한 process_model에서 예측되는 일별 감염자 수를 평균으로 하는 푸아송 분포를 이용하여 만들었다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">parm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb3-2">x0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9990</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Inc=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb3-3">tend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the number of observations</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tend + 1 to account for the initial values</span></span>
<span id="cb3-5">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, tend<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), </span>
<span id="cb3-6">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(x0)))</span>
<span id="cb3-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (nm <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(x0)) {<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># starting values for each particle</span></span>
<span id="cb3-8">  X[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nm] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x0[[nm]]</span>
<span id="cb3-9">}</span>
<span id="cb3-10">truebeta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true beta</span></span>
<span id="cb3-11">pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">process_model</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">params=</span>parm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span>truebeta)</span>
<span id="cb3-12">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(tend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(pred))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span></code></pre></div>
</div>
<p>pmc 함수에 사용된 또 다른 함수 assign_weights를 아래에 구현하였다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">assign_weights <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> (x, y) {</span>
<span id="cb4-2">  di <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(x)</span>
<span id="cb4-3">  npart <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> di[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of particles</span></span>
<span id="cb4-4">  nobs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> di[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of observations</span></span>
<span id="cb4-5">  loglik <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, npart)</span>
<span id="cb4-6">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>npart) {</span>
<span id="cb4-7">    mean_case <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x[i,] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for the ith particle</span></span>
<span id="cb4-8">    expected_case <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, mean_case)</span>
<span id="cb4-9">    obs_case <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(y)</span>
<span id="cb4-10">    loglik[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpois</span>(obs_case, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span>expected_case, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log=</span>T), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb4-11">  }</span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(loglik)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert to normal probability</span></span>
<span id="cb4-13">}</span></code></pre></div>
</div>
<p>PMC를 이용하여 모수 추정을 해보고 결과를 그림으로 나타내보자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gamma and x0 are set to the same as the model used to generate the data</span></span>
<span id="cb5-3">parm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamma=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span>
<span id="cb5-4">x0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9990</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">I=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Inc=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial condition</span></span>
<span id="cb5-5">niter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># out = pmc(params = parm, x0 = x0, y=y, npart=10000, niter=niter, </span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#    tend = length(y), dt=0.1, prior_mean=0.5, prior_sd=0.1, prior_lb=0,</span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#    prior_ub=2)</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># saveRDS(out, "out_20230811.rds")</span></span>
<span id="cb5-10">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"out_20230811.rds"</span>)</span>
<span id="cb5-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(out<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>theta[niter,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(beta), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb5-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>truebeta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/pop-monte-carlo/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>Monte Carlo</category>
  <category>R</category>
  <category>parameter estimation</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://kimfinale.github.io/myblog/posts/pop-monte-carlo/index.html</guid>
  <pubDate>Wed, 09 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/pop-monte-carlo/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Simple mathematical models with very complicated dynamics</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index.html</link>
  <description><![CDATA[ 




<section id="simple-mathematical-models-with-very-complicated-dynamics" class="level3">
<h3 class="anchored" data-anchor-id="simple-mathematical-models-with-very-complicated-dynamics">Simple mathematical models with very complicated dynamics</h3>
<p>Robert M. May Nature Vol. 261 June 10, 1976</p>
<p>This article discusses a simple first order difference equations that can display very complicated dynamics.</p>
<p><img src="https://latex.codecogs.com/png.latex?X_%7Bt+1%7D%20=%20F(X_t)"></p>
<p>In biological population, the nonlinear function <img src="https://latex.codecogs.com/png.latex?F(x)"> often has the following properties. <img src="https://latex.codecogs.com/png.latex?F(0)=0">; <img src="https://latex.codecogs.com/png.latex?F(x)"> increases monotonically as <img src="https://latex.codecogs.com/png.latex?X"> increases through the range of <img src="https://latex.codecogs.com/png.latex?0%3CX%3CA"> (with <img src="https://latex.codecogs.com/png.latex?F(x)"> attaining its maximum value at <img src="https://latex.codecogs.com/png.latex?X=A">); <img src="https://latex.codecogs.com/png.latex?F(X)"> decreases monotonically as <img src="https://latex.codecogs.com/png.latex?X"> increases beyond <img src="https://latex.codecogs.com/png.latex?X=A"> <img src="https://latex.codecogs.com/png.latex?N_%7Bt+1%7D%20=%20N_t(a-bN_t)"></p>
<p><img src="https://latex.codecogs.com/png.latex?X_%7Bt+1%7D%20=%20a%20X_t%20(1-X_t)"></p>
<p>X must remain on the interval <img src="https://latex.codecogs.com/png.latex?0%3CX%3C1">; if <img src="https://latex.codecogs.com/png.latex?X"> ever exceeds unity, subsequent iterations diverge towards <img src="https://latex.codecogs.com/png.latex?-%5Cinfty">. Furthermore, <img src="https://latex.codecogs.com/png.latex?F(X)"> attains a maximum value of <img src="https://latex.codecogs.com/png.latex?a/4"> at <img src="https://latex.codecogs.com/png.latex?X=1/2">; the equation therefore possesses non-trivial dynamical behaviour only if <img src="https://latex.codecogs.com/png.latex?a%3C4">. On the other hand, all trajectories are attracted to <img src="https://latex.codecogs.com/png.latex?X=0"> if <img src="https://latex.codecogs.com/png.latex?a%3C1">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function to compute the value at the next time step</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0 &lt; x &lt; 1</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a &lt; 1 for x to go to zero</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a &gt; 4 leads to x &gt; 1 at one point, which then leads to - infinity</span></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 &lt; a &lt; 4 for x to exhibit non-trivial dynamics</span></span>
<span id="cb1-6">x_next <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a, x){</span>
<span id="cb1-7">  a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x)</span>
<span id="cb1-8">}</span>
<span id="cb1-9"></span>
<span id="cb1-10">x0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb1-11">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.707</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.414</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># values were adopted from the paper by May Nature Vol. 261 June 10, 1976</span></span>
<span id="cb1-12">xnext <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(x0, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">x_next</span>(a, x))</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x0, xnext[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'l'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb1-15">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(X[t]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(X[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x0, xnext[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,])</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># line y = x</span></span>
<span id="cb1-18"></span>
<span id="cb1-19">xstar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>a <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># points where X(t+1) = X(t)</span></span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># slope at the point x given a</span></span>
<span id="cb1-23">dx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a,x){</span>
<span id="cb1-24">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>a</span>
<span id="cb1-25">}</span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function to compute intercept at the given slope b and point x</span></span>
<span id="cb1-28">intcpt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(b,x){</span>
<span id="cb1-29">  x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> b<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x</span>
<span id="cb1-30">}</span>
<span id="cb1-31"></span>
<span id="cb1-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intcpt</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intcpt</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xstar[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">x_iter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a, x, iter, func){</span>
<span id="cb2-2">  xvec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, iter)</span>
<span id="cb2-3">  xvec[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x</span>
<span id="cb2-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>iter){</span>
<span id="cb2-5">    xvec[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">func</span>(a, xvec[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>])  </span>
<span id="cb2-6">  }</span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(xvec)</span>
<span id="cb2-8">}</span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">x_iter</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, x_next), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?X_%7Bt+1%7D%20=%20X_t%20%5Ctextrm%7Bexp%7D%5Br(1-X_t)%5D"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">x_next_exp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r, x){</span>
<span id="cb3-2">  x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x))</span>
<span id="cb3-3">}</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">x_iter</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, x_next_exp), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">x_next2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r, x){</span>
<span id="cb4-2"> x1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x)</span>
<span id="cb4-3"> x2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x1)</span>
<span id="cb4-4"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(x2)</span>
<span id="cb4-5">}</span>
<span id="cb4-6"></span>
<span id="cb4-7">xnext <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(x0, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">x_next2</span>(a, x))</span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x0, xnext[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'l'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb4-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(X[t]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(X[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))</span>
<span id="cb4-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x0, xnext[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,])</span>
<span id="cb4-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># line y = x</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/index.html</guid>
  <pubDate>Mon, 07 Aug 2023 15:00:00 GMT</pubDate>
  <media:content url="https://kimfinale.github.io/myblog/posts/simple-model-complicated-dynamics/image.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
