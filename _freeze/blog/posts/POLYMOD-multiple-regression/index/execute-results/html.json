{
  "hash": "2187b2fc3c9b14f19d9c2833c75880af",
  "result": {
    "markdown": "---\ntitle: \"Mulitple regression: POLYMOD data\"\nauthor: \"Jong-Hoon Kim\"\ndate: \"2023-10-12\"\ncategories: [R, regression, contact]\nimage: \"polymod-age-contact.jpg\"\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\nThis post describes my attempt to reproduce Table 1 of the paper, [Social Contacts and Mixing Patterns Relevant to the Spread of Infectious Diseases](https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0050074). Data were downloaded from [Social Contact Data](http://www.socialcontactdata.org/), which was hosted in [zenodo](https://zenodo.org/record/3746312#.Xo85CcgzZPY). I used the version 1.1. While I wasn't successful at reproducing the table exatly but still wanted to document the processes that I went through. Potential reasons include: a) results of numerical computations vary depending on the system and the software and b) datasets that were analyzed might be slightly different because of the missing values.\n\n### Data preparation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\nd1 <- fread(\"2008_Mossong_POLYMOD_participant_common.csv\")\nd2 <- fread(\"2008_Mossong_POLYMOD_contact_common.csv\")\nlibrary(dplyr)\n# count the number of contacts for each participant using part_id variable\nd2 |> group_by(part_id) |>\n  summarize(contacts = n()) -> d2_contacts\nd12 <- left_join(d1, d2_contacts, by=\"part_id\")\n# add household information\nd3 <- fread(\"2008_Mossong_POLYMOD_hh_common.csv\")\nd123 <- left_join(d12, d3, by=\"hh_id\")\n# add day of week information\nd4 <- fread(\"2008_Mossong_POLYMOD_sday.csv\")\ndat <- left_join(d123, d4, by=\"part_id\")\n```\n:::\n\n\n### Data manipulation\n\nCategorize the age group into different 10 age groups: 0-4, 5-9, 10-14, 15-19, and 20 to 70 by 10 years and 70 and above\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclassify_age <- function(d){\n  d$age_grp <- 99\n  for (i in 1:nrow(d)) {\n    if(!is.na(d$part_age[i])){\n      if(d$part_age[i] < 5){\n        d$age_grp[i] <- 0\n      }\n      else if (d$part_age[i] >= 5 && d$part_age[i] < 20){\n        for(j in 1:3){\n          if(d$part_age[i] >= 5*j && d$part_age[i] < (5*j+5)){\n            d$age_grp[i] <- j\n          }\n        }\n      }\n      else if (d$part_age[i] >= 20 && d$part_age[i] < 70){\n        for (k in 1:5){\n          if (d$part_age[i] >= (10+10*k) && d$part_age[i] < (20+10*k)){\n            d$age_grp[i] <- k+3\n          }\n        }\n      } \n      else {\n        d$age_grp[i] <- 9\n      }\n    } \n  }\n  d\n}\n\ndat <- classify_age(dat)\n```\n:::\n\n\nVisualize the distribution of the number of contacts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndat |> ggplot(aes(x=contacts)) + \n  geom_histogram(binwidth=5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nCompare the number of participants by age group (the third column)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat |> \n  group_by(age_grp) |> \n  summarize(npart=n(),\n            avg_contacts = round(sum(contacts, na.rm=T) / npart, digits=2)) -> dat_ag\n\ndat_ag$npart_true <- c(660,661,713,685,879,815,908,906,728,270,65)\ndat_ag$avg_contacts_true <- c(10.21,14.81, 18.22,17.58,13.57,14.14,13.83,12.30,9.21,6.89,9.63)\ndat_ag\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 11 Ã— 5\n   age_grp npart avg_contacts npart_true avg_contacts_true\n     <dbl> <int>        <dbl>      <dbl>             <dbl>\n 1       0   660        10.2         660             10.2 \n 2       1   661        14.8         661             14.8 \n 3       2   713        18.2         713             18.2 \n 4       3   685        17.6         685             17.6 \n 5       4   879        13.6         879             13.6 \n 6       5   815        14.1         815             14.1 \n 7       6   908        13.8         908             13.8 \n 8       7   906        12.3         906             12.3 \n 9       8   728         9.21        728              9.21\n10       9   270         6.89        270              6.89\n11      99    65         9.63         65              9.63\n```\n:::\n:::\n\n\nCategorize the household size\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclassify_hh <- function(d){\n  d$hh_size_grp <- ifelse(d$hh_size > 4, 5, ifelse(!is.na(d$hh_size), d$hh_size, 99))\n  d\n}\ndat <- classify_hh(dat)\n# data.table::fwrite(dat, \"data/POLYMOD_2017.csv\")\n```\n:::\n\n\nMake categorical variables factor for regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# dat <- data.table::fread(\"data/POLYMOD_2017.csv\")\n# set the categorical variables as factor for regression\ndat$age_grp <- as.factor(dat$age_grp)\ndat$hh_size_grp <- as.factor(dat$hh_size_grp)\ndat$gender <- ifelse(dat$part_gender==\"M\", 0, ifelse(dat$part_gender==\"F\", 1, 99))\ndat$gender <- as.factor(dat$gender)\ndat$dayofweek <- as.factor(dat$dayofweek)\n# dat <- dat[complete.cases(dat),]\n# data.table::fwrite(dat, \"data/POLYMOD_2017_gender_modified.csv\")\n```\n:::\n\n\n### Linear regression\n\nWhile I will eventually use the negative binomial regresssion, I tried linear regression with which my colleague who uses Stata is familiar.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\n# to remove missing values\ndat <- dat[complete.cases(dat),]\n\nm <- lm(contacts ~ age_grp + gender + hh_size_grp + country + dayofweek, data = dat)\nsummary(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = contacts ~ age_grp + gender + hh_size_grp + country + \n    dayofweek, data = dat)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-21.204  -6.129  -1.718   3.880  80.052 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    2.5978     0.7067   3.676 0.000239 ***\nage_grp1       4.1734     0.5168   8.076 7.80e-16 ***\nage_grp2       7.7402     0.5072  15.262  < 2e-16 ***\nage_grp3       7.4715     0.5117  14.602  < 2e-16 ***\nage_grp4       4.6392     0.4934   9.402  < 2e-16 ***\nage_grp5       4.5177     0.4981   9.070  < 2e-16 ***\nage_grp6       4.1732     0.4863   8.581  < 2e-16 ***\nage_grp7       3.2931     0.5024   6.554 5.99e-11 ***\nage_grp8       1.2232     0.5501   2.224 0.026206 *  \nage_grp9      -1.1332     0.7209  -1.572 0.115997    \ngender1        0.1746     0.2216   0.788 0.430686    \ngender99       2.0543     2.9437   0.698 0.485271    \nhh_size_grp2   0.8352     0.4244   1.968 0.049133 *  \nhh_size_grp3   1.0815     0.4498   2.404 0.016231 *  \nhh_size_grp4   2.7105     0.4549   5.959 2.67e-09 ***\nhh_size_grp5   3.9035     0.4951   7.884 3.64e-15 ***\ncountryDE     -3.5686     0.4315  -8.270  < 2e-16 ***\ncountryFI     -0.5878     0.4519  -1.301 0.193398    \ncountryGB     -0.3451     0.4530  -0.762 0.446204    \ncountryIT      7.5967     0.4691  16.194  < 2e-16 ***\ncountryLU      5.0942     0.4500  11.321  < 2e-16 ***\ncountryNL      2.9129     0.6754   4.313 1.63e-05 ***\ncountryPL      4.0530     0.4489   9.029  < 2e-16 ***\ndayofweek1     3.7578     0.4317   8.705  < 2e-16 ***\ndayofweek2     4.5691     0.4244  10.767  < 2e-16 ***\ndayofweek3     4.4291     0.4336  10.214  < 2e-16 ***\ndayofweek4     4.5608     0.4277  10.664  < 2e-16 ***\ndayofweek5     4.7862     0.4234  11.303  < 2e-16 ***\ndayofweek6     1.6347     0.4414   3.703 0.000214 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 9.271 on 7040 degrees of freedom\nMultiple R-squared:  0.2383,\tAdjusted R-squared:  0.2352 \nF-statistic: 78.64 on 28 and 7040 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n### NegBin regression\n\nNegative binomial regression was modeled using `MASS::glm.nb` function\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\nm1 <- glm.nb(contacts ~ age_grp, data = dat)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm.nb(formula = contacts ~ age_grp, data = dat, init.theta = 2.349538851, \n    link = log)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  2.33297    0.02847  81.959  < 2e-16 ***\nage_grp1     0.34973    0.03963   8.826  < 2e-16 ***\nage_grp2     0.57379    0.03861  14.862  < 2e-16 ***\nage_grp3     0.53545    0.03908  13.702  < 2e-16 ***\nage_grp4     0.28592    0.03733   7.660 1.86e-14 ***\nage_grp5     0.31980    0.03780   8.460  < 2e-16 ***\nage_grp6     0.29453    0.03707   7.946 1.93e-15 ***\nage_grp7     0.18429    0.03716   4.959 7.09e-07 ***\nage_grp8    -0.09048    0.03958  -2.286   0.0223 *  \nage_grp9    -0.38437    0.05435  -7.072 1.53e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for Negative Binomial(2.3495) family taken to be 1)\n\n    Null deviance: 8082.4  on 7068  degrees of freedom\nResidual deviance: 7381.8  on 7059  degrees of freedom\nAIC: 49343\n\nNumber of Fisher Scoring iterations: 1\n\n              Theta:  2.3495 \n          Std. Err.:  0.0452 \n\n 2 x log-likelihood:  -49321.1310 \n```\n:::\n\n```{.r .cell-code}\nexp(m1$coefficients)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept)    age_grp1    age_grp2    age_grp3    age_grp4    age_grp5 \n 10.3085271   1.4186911   1.7749820   1.7082181   1.3309824   1.3768472 \n   age_grp6    age_grp7    age_grp8    age_grp9 \n  1.3424987   1.2023627   0.9134947   0.6808798 \n```\n:::\n\n```{.r .cell-code}\nm5 <- glm.nb(contacts ~ age_grp + gender + hh_size_grp + country + dayofweek, data = dat)\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm.nb(formula = contacts ~ age_grp + gender + hh_size_grp + \n    country + dayofweek, data = dat, init.theta = 3.032960306, \n    link = log)\n\nCoefficients:\n              Estimate Std. Error z value Pr(>|z|)    \n(Intercept)   1.733148   0.050127  34.575  < 2e-16 ***\nage_grp1      0.320217   0.036004   8.894  < 2e-16 ***\nage_grp2      0.513597   0.035093  14.635  < 2e-16 ***\nage_grp3      0.512688   0.035437  14.468  < 2e-16 ***\nage_grp4      0.359741   0.034520  10.421  < 2e-16 ***\nage_grp5      0.343102   0.034802   9.859  < 2e-16 ***\nage_grp6      0.313841   0.034051   9.217  < 2e-16 ***\nage_grp7      0.253024   0.035267   7.175 7.25e-13 ***\nage_grp8      0.048104   0.039074   1.231 0.218283    \nage_grp9     -0.211659   0.052694  -4.017 5.90e-05 ***\ngender1       0.007832   0.015357   0.510 0.610050    \ngender99      0.077826   0.207001   0.376 0.706941    \nhh_size_grp2  0.098342   0.030472   3.227 0.001250 ** \nhh_size_grp3  0.117260   0.031984   3.666 0.000246 ***\nhh_size_grp4  0.235206   0.032164   7.313 2.62e-13 ***\nhh_size_grp5  0.323285   0.034725   9.310  < 2e-16 ***\ncountryDE    -0.345037   0.030616 -11.270  < 2e-16 ***\ncountryFI    -0.054068   0.031613  -1.710 0.087209 .  \ncountryGB    -0.023021   0.031609  -0.728 0.466429    \ncountryIT     0.488765   0.032064  15.244  < 2e-16 ***\ncountryLU     0.340195   0.030948  10.993  < 2e-16 ***\ncountryNL     0.219279   0.046632   4.702 2.57e-06 ***\ncountryPL     0.281896   0.030944   9.110  < 2e-16 ***\ndayofweek1    0.278478   0.030363   9.172  < 2e-16 ***\ndayofweek2    0.336024   0.029800  11.276  < 2e-16 ***\ndayofweek3    0.328357   0.030383  10.807  < 2e-16 ***\ndayofweek4    0.326135   0.029980  10.879  < 2e-16 ***\ndayofweek5    0.365918   0.029655  12.339  < 2e-16 ***\ndayofweek6    0.143777   0.031178   4.611 4.00e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for Negative Binomial(3.033) family taken to be 1)\n\n    Null deviance: 9903.4  on 7068  degrees of freedom\nResidual deviance: 7310.7  on 7040  degrees of freedom\nAIC: 47832\n\nNumber of Fisher Scoring iterations: 1\n\n              Theta:  3.0330 \n          Std. Err.:  0.0626 \n\n 2 x log-likelihood:  -47771.7930 \n```\n:::\n\n```{.r .cell-code}\nexp(m5$coefficients)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n (Intercept)     age_grp1     age_grp2     age_grp3     age_grp4     age_grp5 \n   5.6584394    1.3774273    1.6712925    1.6697736    1.4329588    1.4093123 \n    age_grp6     age_grp7     age_grp8     age_grp9      gender1     gender99 \n   1.3686718    1.2879141    1.0492799    0.8092407    1.0078631    1.0809342 \nhh_size_grp2 hh_size_grp3 hh_size_grp4 hh_size_grp5    countryDE    countryFI \n   1.1033402    1.1244116    1.2651689    1.3816597    0.7081939    0.9473682 \n   countryGB    countryIT    countryLU    countryNL    countryPL   dayofweek1 \n   0.9772421    1.6303023    1.4052212    1.2451789    1.3256406    1.3211173 \n  dayofweek2   dayofweek3   dayofweek4   dayofweek5   dayofweek6 \n   1.3993730    1.3886852    1.3856028    1.4418376    1.1546267 \n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}