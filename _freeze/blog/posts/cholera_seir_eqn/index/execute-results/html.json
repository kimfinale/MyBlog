{
  "hash": "ce27c75d82db26eba4cc4cf425fc3f0e",
  "result": {
    "markdown": "---\ntitle: \"Solutions for the steady states of the SEIR model\"\nauthor: \"Jong-Hoon Kim\"\ndate: \"2024-03-28\"\ncategories: [SEIR model, steady states, ODE, deSolve, Mathematica]\nimage: \"sample_figure.png\"\neditor_options: \n  chunk_output_type: console\nformat: \n  html:\n    page-layout: full\n    toc-location: left\n    html-math-method: katex\n---\n\n\n\n\nIn this post, I compared the numerical solutions obtained using `deSolve::ode` \nwith the algebraic solutions derived from Mathematica for the steady states of \na SEIR model. The model considers the waning of natural immunity over time \nin a dynamically changing population.\n\n### $SEIR$ model with waning immunity and vital dynamics\n$$\ndS/dt = \\mu (S+E+I+R) - \\beta SI - \\mu S + \\omega R\\\\\ndE/dt = \\beta SI - (\\mu+\\kappa)E\\\\\ndI/dt = \\kappa E - (\\mu+\\gamma)I\\\\\ndR/dt = \\gamma I - (\\mu+\\omega) R\n$$\nFollowing Mathematica command produces the solutions for the steady states.\n\n::: {.cell}\n\n```{.r .cell-code}\nFullSimplify[\n Solve[{\\[Mu]*(S + E1 + I1 + R) - (\\[Beta]*I1 + \\[Mu])*S + \\[Omega]*\n      R == 0, \\[Beta]*I1*S - (\\[Mu] + \\[Kappa])*E1 == \n    0, \\[Kappa]*E1 - (\\[Mu] + \\[Gamma])*I1 == \n    0, \\[Gamma]*I1 - (\\[Omega] + \\[Mu])*R == 0, \n   S + E1 + I1 + R == 1, \\[Mu] > 0, \\[Beta] > 0, \\[Kappa] > \n    0, \\[Gamma] > 0, \\[Omega] > 0, S > 0, E1 > 0, I1 > 0, R > 0, \n   S \\[Element] Reals, E1 \\[Element] Reals, I1 \\[Element] Reals, \n   R \\[Element] Reals}, {S, E1, I1, R}]]\n```\n:::\n\n\n$$s = \\frac{(\\gamma +\\mu ) (\\kappa +\\mu )}{\\beta  \\kappa } \\\\\ne = -\\frac{(\\gamma +\\mu ) (\\mu +\\omega ) ((\\gamma +\\mu ) (\\kappa +\\mu )-\\beta  \\kappa )}{\\beta  \\kappa  (\\gamma  (\\kappa +\\mu +\\omega )+(\\kappa +\\mu ) (\\mu +\\omega ))} \\\\\ni = \\frac{(\\mu +\\omega ) (\\beta  \\kappa -(\\gamma +\\mu ) (\\kappa +\\mu ))}{\\beta  \\omega  (\\gamma +\\kappa +\\mu )+\\beta  (\\gamma +\\mu ) (\\kappa +\\mu )} \\\\\nr = \\frac{\\beta  \\gamma  \\kappa -\\gamma  (\\gamma +\\mu ) (\\kappa +\\mu )}{\\beta  \\omega  (\\gamma +\\kappa +\\mu )+\\beta  (\\gamma +\\mu ) (\\kappa +\\mu )}\n$$\nI used `latex2r` package to convert the LaTex expressions from the Mathematica to R codes\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(latex2r)\ns <- latex2r(\"\\\\frac{(\\\\gamma +\\\\mu ) (\\\\kappa +\\\\mu )}{\\\\beta  \\\\kappa }\")\ne <- latex2r(\"-\\\\frac{(\\\\gamma +\\\\mu ) (\\\\mu +\\\\omega ) ((\\\\gamma +\\\\mu ) (\\\\kappa +\\\\mu )-\\\\beta  \\\\kappa )}{\\\\beta  \\\\kappa  (\\\\gamma  (\\\\kappa +\\\\mu +\\\\omega )+(\\\\kappa +\\\\mu ) (\\\\mu +\\\\omega ))}\")\ni <- latex2r(\"\\\\frac{(\\\\mu +\\\\omega ) (\\\\beta  \\\\kappa -(\\\\gamma +\\\\mu ) (\\\\kappa +\\\\mu ))}{\\\\beta  \\\\omega  (\\\\gamma +\\\\kappa +\\\\mu )+\\\\beta  (\\\\gamma +\\\\mu ) (\\\\kappa +\\\\mu )}\")\nr <- latex2r(\"\\\\frac{\\\\beta  \\\\gamma  \\\\kappa -\\\\gamma  (\\\\gamma +\\\\mu ) (\\\\kappa +\\\\mu )}{\\\\beta  \\\\omega  (\\\\gamma +\\\\kappa +\\\\mu )+\\\\beta  (\\\\gamma +\\\\mu ) (\\\\kappa +\\\\mu )}\")\n\nkappa <- 1.115044 / 2 # mean late period is still around 1.4 days, \ngamma <- 1/2\nmu <- 1/(65*365)\nomega <- 1/(4*365)\nbeta <- 0.6\n\nstates <- list(s=s, e=e, i=i, r=r)\nval = sapply(states, function(x) eval(parse(text = x)))\nval[[\"e\"]]/(val[[\"i\"]]+val[[\"e\"]])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4728244\n```\n:::\n\n```{.r .cell-code}\ngamma/(gamma+kappa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4728034\n```\n:::\n\n```{.r .cell-code}\n(gamma+mu)/(gamma+kappa+mu)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4728244\n```\n:::\n\n```{.r .cell-code}\n(1/kappa)/(1/kappa + 1/gamma) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4728034\n```\n:::\n:::\n\n\nNumerical solutions based on `deSolve::ode`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseir_vital <- function(t, u, p){\n  N <- sum(u)\n  beta <- p[\"beta\"]\n  kappa <- p[\"kappa\"]\n  gamma <- p[\"gamma\"]\n  omega <- p[\"omega\"]\n  mu <- p[\"mu\"]\n  \n  du1 <- - beta*u[1]*u[3] + omega*u[4] - mu*u[1] + mu*N\n  du2 <- + beta*u[1]*u[3] - kappa*u[2] - mu*u[2]\n  du3 <- + kappa*u[2] - gamma*u[3] - mu*u[3]\n  du4 <- + gamma*u[3] - omega*u[4] - mu*u[4]\n  \n  return(list(c(du1,du2,du3,du4))) \n}\n\nlibrary(deSolve)\nu0 <- c(0.99, 0, 0.01, 0)\np <- c(kappa=1.115044/2, gamma=1/2, mu=1/(65*365), \n      omega=1/(4*365), beta=0.6)\ntspan <- seq(from=0, to=300*100)\noutdf <- as.data.frame(ode(y=u0, times=tspan, func=seir_vital, parms=p))\nnames(outdf) <- c(\"day\",\"s\",\"e\",\"i\",\"r\")\ntail(outdf, 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        day         s            e            i         r\n30001 30000 0.8334656 0.0002166031 0.0002415018 0.1660763\n```\n:::\n:::\n\n\n\n### $SE_1E_2I_1I_2R_1R_2$ model\n\nThis model incorporates two consecutive compartments for the Exposed (E), \nInfectious (I), and Recovered (R) states, effectively changing the distribution\nof waiting times in each states from an exponential to an Erlang distribution\nwith a shape parameter of 2, offering a more realistic representation.\n\n$$\ndS/dt = \\mu (S+E_1+I_1+R_1+E_2+I_2+R_2) - \\beta S(I_1+I_2) - \\mu S + 2 \\omega R_2\\\\\ndE_1/dt = \\beta S(I_1+I_2) - (\\mu+2\\kappa)E1\\\\\ndE_2/dt = 2\\kappa E_1 - (\\mu+2\\kappa)E2\\\\\ndI_1/dt = 2 \\kappa E_2 - (\\mu+2\\gamma)I_1\\\\\ndI_2/dt = 2\\gamma I_1 - (\\mu+2\\gamma)I_2\\\\\ndR_1/dt = 2 \\gamma I_2 - (\\mu+2\\omega) R_1\\\\\ndR_2/dt = 2 \\omega R_1 - (\\mu+2\\omega) R_2\n$$\n\nThe following Mathematica command produces the solutions for the steady states.\n\n::: {.cell}\n\n```{.r .cell-code}\nFullSimplify[\n Solve[{\\[Mu]*(S + E1 + E2 + I1 + I2 + R1 + \n        R2) - (\\[Beta]*(I1 + I2) + \\[Mu])*S + 2*\\[Omega]*R2 == \n    0, \\[Beta]*(I1 + I2)*S - (\\[Mu] + 2*\\[Kappa])*E1 == 0, \n   2*\\[Kappa]*E1 - (2*\\[Kappa] + \\[Mu])*E2 == 0, \n   2*\\[Kappa]*E2 - (\\[Mu] + 2*\\[Gamma])*I1 == 0, \n   2*\\[Gamma]*I1 - (2*\\[Gamma] + \\[Mu])*I2 == 0, \n   2*\\[Gamma]*I2 - (2*\\[Omega] + \\[Mu])*R1 == 0, \n   2*\\[Omega]*R1 - (\\[Mu] + 2*\\[Omega])*R2 == 0, \n   S + E1 + E2 + I1 + I2 + R1 + R2 == 1, \\[Mu] > 0, \\[Beta] > \n    0, \\[Kappa] > 0, \\[Gamma] > 0, \\[Omega] > 0, S > 0, E1 > 0, \n   E2 > 0, I1 > 0, I2 > 0, R1 > 0, R2 > 0, S \\[Element] Reals, \n   E1 \\[Element] Reals, E2 \\[Element] Reals, I1 \\[Element] Reals, \n   I2 \\[Element] Reals, R1 \\[Element] Reals, R2 \\[Element] Reals}, {S,\n    E1, E2, I1, I2, R1, R2}]]\n```\n:::\n\n\n$$\ns= \\frac{(2 \\gamma +\\mu )^2 (2 \\kappa +\\mu )^2}{4 \\beta  \\kappa ^2 (4 \\gamma +\\mu )}\\\\\n$$\n$$\ne_1 = - \\frac{(2 \\gamma +\\mu )^2 (2 \\kappa +\\mu ) (\\mu +2 \\omega )^2 \\left((2 \\gamma +\\mu )^2 (2 \\kappa +\\mu )^2-4 \\beta  \\kappa ^2 (4 \\gamma +\\mu )\\right)}{4 \\beta  \\kappa ^2 (4 \\gamma +\\mu ) \\left(4 \\gamma ^2 (2 \\kappa +\\mu +2 \\omega ) (2 \\kappa  (\\mu +4 \\omega )+\\mu  (\\mu +2 \\omega ))+4 \\gamma  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2+\\mu  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2\\right)}\\\\\n$$\n$$\ne_2 = -\\frac{(2 \\gamma +\\mu )^2 (\\mu +2 \\omega )^2 \\left((2 \\gamma +\\mu )^2 (2 \\kappa +\\mu )^2-4 \\beta  \\kappa ^2 (4 \\gamma +\\mu )\\right)}{2 \\beta  \\kappa  (4 \\gamma +\\mu ) \\left(4 \\gamma ^2 (2 \\kappa +\\mu +2 \\omega ) (2 \\kappa  (\\mu +4 \\omega )+\\mu  (\\mu +2 \\omega ))+4 \\gamma  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2+\\mu  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2\\right)}\\\\\n$$\n$$\ni_1 = - \\frac{(2 \\gamma +\\mu ) (\\mu +2 \\omega )^2 \\left((2 \\gamma +\\mu )^2 (2 \\kappa +\\mu )^2-4 \\beta  \\kappa ^2 (4 \\gamma +\\mu )\\right)}{\\beta  (4 \\gamma +\\mu ) \\left(4 \\gamma ^2 (2 \\kappa +\\mu +2 \\omega ) (2 \\kappa  (\\mu +4 \\omega )+\\mu  (\\mu +2 \\omega ))+4 \\gamma  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2+\\mu  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2\\right)}\\\\\n$$\n$$\ni_2 = -\\frac{2 \\gamma  (\\mu +2 \\omega )^2 \\left(4 \\beta  \\kappa ^2 (4 \\gamma +\\mu )-(2 \\gamma +\\mu )^2 (2 \\kappa +\\mu )^2\\right)}{\\beta  (4 \\gamma +\\mu ) \\left(4 \\gamma ^2 (2 \\kappa +\\mu +2 \\omega ) (2 \\kappa  (\\mu +4 \\omega )+\\mu  (\\mu +2 \\omega ))+4 \\gamma  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2+\\mu  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2\\right)}\\\\\n$$\n$$\nr_1 = -\\frac{4 \\gamma ^2 (\\mu +2 \\omega ) \\left((2 \\gamma +\\mu )^2 (2 \\kappa +\\mu )^2-4 \\beta  \\kappa ^2 (4 \\gamma +\\mu )\\right)}{\\beta  (4 \\gamma +\\mu ) \\left(4 \\gamma ^2 (2 \\kappa +\\mu +2 \\omega ) (2 \\kappa  (\\mu +4 \\omega )+\\mu  (\\mu +2 \\omega ))+4 \\gamma  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2+\\mu  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2\\right)}\\\\\n$$\n$$\nr_2 = -\\frac{8 \\gamma ^2 \\omega  \\left((2 \\gamma +\\mu )^2 (2 \\kappa +\\mu )^2-4 \\beta  \\kappa ^2 (4 \\gamma +\\mu )\\right)}{\\beta  (4 \\gamma +\\mu ) \\left(4 \\gamma ^2 (2 \\kappa +\\mu +2 \\omega ) (2 \\kappa  (\\mu +4 \\omega )+\\mu  (\\mu +2 \\omega ))+4 \\gamma  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2+\\mu  (2 \\kappa +\\mu )^2 (\\mu +2 \\omega )^2\\right)}\n$$\n\nAgain, LaTex expressions were converted to R codes using the `latex2r` package.\n\n::: {.cell}\n\n```{.r .cell-code}\ns <- latex2r(\"\\\\frac{(2 \\\\gamma +\\\\mu )^2 (2 \\\\kappa +\\\\mu )^2}{4 \\\\beta  \\\\kappa ^2 (4 \\\\gamma +\\\\mu )}\")\ne1 <- latex2r(\"-\\\\frac{(2 \\\\gamma +\\\\mu )^2 (2 \\\\kappa +\\\\mu ) (\\\\mu +2 \\\\omega )^2 \\\\left((2 \\\\gamma +\\\\mu )^2 (2 \\\\kappa +\\\\mu )^2-4 \\\\beta  \\\\kappa ^2 (4 \\\\gamma +\\\\mu )\\\\right)}{4 \\\\beta  \\\\kappa ^2 (4 \\\\gamma +\\\\mu ) \\\\left(4 \\\\gamma ^2 (2 \\\\kappa +\\\\mu +2 \\\\omega ) (2 \\\\kappa  (\\\\mu +4 \\\\omega )+\\\\mu  (\\\\mu +2 \\\\omega ))+4 \\\\gamma  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2+\\\\mu  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2\\\\right)}\")\n\ne2 <- latex2r(\"-\\\\frac{(2 \\\\gamma +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2 \\\\left((2 \\\\gamma +\\\\mu )^2 (2 \\\\kappa +\\\\mu )^2-4 \\\\beta  \\\\kappa ^2 (4 \\\\gamma +\\\\mu )\\\\right)}{2 \\\\beta  \\\\kappa  (4 \\\\gamma +\\\\mu ) \\\\left(4 \\\\gamma ^2 (2 \\\\kappa +\\\\mu +2 \\\\omega ) (2 \\\\kappa  (\\\\mu +4 \\\\omega )+\\\\mu  (\\\\mu +2 \\\\omega ))+4 \\\\gamma  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2+\\\\mu  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2\\\\right)}\")\n\ni1 <- latex2r(\"-\\\\frac{(2 \\\\gamma +\\\\mu ) (\\\\mu +2 \\\\omega )^2 \\\\left((2 \\\\gamma +\\\\mu )^2 (2 \\\\kappa +\\\\mu )^2-4 \\\\beta  \\\\kappa ^2 (4 \\\\gamma +\\\\mu )\\\\right)}{\\\\beta  (4 \\\\gamma +\\\\mu ) \\\\left(4 \\\\gamma ^2 (2 \\\\kappa +\\\\mu +2 \\\\omega ) (2 \\\\kappa  (\\\\mu +4 \\\\omega )+\\\\mu  (\\\\mu +2 \\\\omega ))+4 \\\\gamma  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2+\\\\mu  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2\\\\right)}\")\n\ni2 <- latex2r(\"\\\\frac{2 \\\\gamma  (\\\\mu +2 \\\\omega )^2 \\\\left(4 \\\\beta  \\\\kappa ^2 (4 \\\\gamma +\\\\mu )-(2 \\\\gamma +\\\\mu )^2 (2 \\\\kappa +\\\\mu )^2\\\\right)}{\\\\beta  (4 \\\\gamma +\\\\mu ) \\\\left(4 \\\\gamma ^2 (2 \\\\kappa +\\\\mu +2 \\\\omega ) (2 \\\\kappa  (\\\\mu +4 \\\\omega )+\\\\mu  (\\\\mu +2 \\\\omega ))+4 \\\\gamma  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2+\\\\mu  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2\\\\right)}\")\n\nr1 <- latex2r(\"-\\\\frac{4 \\\\gamma ^2 (\\\\mu +2 \\\\omega ) \\\\left((2 \\\\gamma +\\\\mu )^2 (2 \\\\kappa +\\\\mu )^2-4 \\\\beta  \\\\kappa ^2 (4 \\\\gamma +\\\\mu )\\\\right)}{\\\\beta  (4 \\\\gamma +\\\\mu ) \\\\left(4 \\\\gamma ^2 (2 \\\\kappa +\\\\mu +2 \\\\omega ) (2 \\\\kappa  (\\\\mu +4 \\\\omega )+\\\\mu  (\\\\mu +2 \\\\omega ))+4 \\\\gamma  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2+\\\\mu  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2\\\\right)}\")\n\nr2 <- latex2r(\"-\\\\frac{8 \\\\gamma ^2 \\\\omega  \\\\left((2 \\\\gamma +\\\\mu )^2 (2 \\\\kappa +\\\\mu )^2-4 \\\\beta  \\\\kappa ^2 (4 \\\\gamma +\\\\mu )\\\\right)}{\\\\beta  (4 \\\\gamma +\\\\mu ) \\\\left(4 \\\\gamma ^2 (2 \\\\kappa +\\\\mu +2 \\\\omega ) (2 \\\\kappa  (\\\\mu +4 \\\\omega )+\\\\mu  (\\\\mu +2 \\\\omega ))+4 \\\\gamma  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2+\\\\mu  (2 \\\\kappa +\\\\mu )^2 (\\\\mu +2 \\\\omega )^2\\\\right)}\")\n\nkappa <- 1.115044 / 2 # mean late period is still around 1.4 days, \ngamma <- 1/2 \nmu <- 1/(65*365)\nomega <- 1/(4*365)\nbeta <- 0.6\n\nstates <- list(s=s, e1=e1, e2=e2, i1=i1, i2=i2, r1=r1, r2=r2)\nsapply(states, function(x) eval(parse(text = x)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           s           e1           e2           i1           i2           r1 \n0.8334490274 0.0001067747 0.0001067707 0.0001190490 0.0001190440 0.0843079955 \n          r2 \n0.0817913389 \n```\n:::\n:::\n\nNumerical solutions are based on `deSolve::ode`.\n\n::: {.cell}\n\n```{.r .cell-code}\nseir_2stg_vital <- function(t, u, p){\n  N <- sum(u)\n  beta <- p[\"beta\"]\n  kappa <- p[\"kappa\"]\n  gamma <- p[\"gamma\"]\n  omega <- p[\"omega\"]\n  mu <- p[\"mu\"]\n  \n  du1 <- - beta*u[1]*(u[4]+u[5]) + 2*omega*u[7] - mu*u[1] + mu*N\n  du2 <- + beta*u[1]*(u[4]+u[5]) - 2*kappa*u[2] - mu*u[2]\n  du3 <- + 2*kappa*u[2] - 2*kappa*u[3] - mu*u[3]\n  du4 <- + 2*kappa*u[3] - 2*gamma*u[4] - mu*u[4]\n  du5 <- + 2*gamma*u[4] - 2*gamma*u[5] - mu*u[5]\n  du6 <- + 2*gamma*u[5] - 2*omega*u[6] - mu*u[6]\n  du7 <- + 2*omega*u[6] - 2*omega*u[7] - mu*u[7]\n  \n  return(list(c(du1,du2,du3,du4,du5,du6,du7))) \n}\n\nu0 <- c(0.99, 0, 0, 0.01, 0, 0, 0)\np <- c(kappa=1.115044/2, gamma=1/2, mu=1/(65*365), \n      omega=1/(4*365), beta=0.6)\ntspan <- seq(from=0, to=365*300)\noutdf <- as.data.frame(ode(y=u0, times=tspan, func=seir_2stg_vital, parms=p))\nnames(outdf) <- c(\"day\",\"s\",\"e1\",\"e2\",\"i1\",\"i2\",\"r1\",\"r2\")\ntail(outdf, 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          day         s           e1           e2           i1           i2\n109501 109500 0.8334488 0.0001067726 0.0001067686 0.0001190467 0.0001190417\n               r1         r2\n109501 0.08430817 0.08179142\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}