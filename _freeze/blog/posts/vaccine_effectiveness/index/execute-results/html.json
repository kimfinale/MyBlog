{
  "hash": "5de23029b191d0b6a7e550b2b8e8babd",
  "result": {
    "markdown": "---\ntitle: \"Vaccine effectiveness\"\nauthor: \"Jong-Hoon Kim\"\ndate: \"2024-03-26\"\ncategories: [SEIR, vaccine efficacy, direct, indirect, total, overall]\nimage: \"study_design.png\"\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n## Vaccine efficacy and effectiveness\n\nVaccine efficacy and effectiveness (VE) is generally estimated as one minus some measure of relative risk (RR) in the vaccinated group compared to the unvaccinated group [Halloran *et al*.](https://pubmed.ncbi.nlm.nih.gov/10520474/):\n\n$$\n\\text{VE} = 1 - \\text{RR}\n$$\n\nRR measures may include relative infection probability given exposure, hazard ratio, or the ratio of cumulative incidence (or attack rate). I will explain different effects of the vaccine using the cumulative incidence ($C$) measure, as outlined in the [Study design for dependent happenings](https://pubmed.ncbi.nlm.nih.gov/1742381/).\n\n![](study_design.png)\n\nIn population $A$, a fraction, $f$, of the population was vaccinated (denoted as $1$) and the rest, $1-f$, of the Population A remains unvaccinated (denoted as $0$). In Population $B$, no one was vaccinated. I will use $C_{A0}$ and $C_{A1}$ to denote cumulative incidence, $C$, in the unvaccinated and vaccinated individuals of Population $A$. Similarly, $C_{B0}$ will denote the cumulative incidence in the unvaccinated population $B$.\n\nVaccine effectiveness (VE) can be divided into four different measures: direct, indirect, total, and overall VE, which are denoted as DVE, IVE, TVE, and OVE, respectively.\n\n$$\n\\text{DVE} = 1 - \\frac{C_{A1}}{C_{A0}},~\n\\text{IVE} = 1 - \\frac{C_{A0}}{C_{B0}},~\n\\text{TVE} = 1 - \\frac{C_{A1}}{C_{B0}},~\n\\text{OVE} = 1 - \\frac{f C_{A1}+(1-f) C_{A0}}{C_{B0}}.\n$$\n\nGiven the above equations, the following relationships hold:\n\n$$\n\\text{IVE} = 1-\\frac{1-\\text{TVE}}{1-\\text{DVE}},~\n$$ {#eq-ive}\n\n$$\\text{OVE} = 1-\\left(f\\left(1-\\text{TVE}\\right)+(1-f)\\left(1-\\text{IVE}\\right)\\right)$$ TVE may be replaced using IVE and DVE as below.\n\n$$\\text{OVE} = 1-\\left(f\\left(1-\\text{DVE})(1-\\text{IVE}\\right)+(1-f)\\left(1-\\text{IVE}\\right)\\right)\n$$ {#eq-ove}\n\nI will illustrate the different metrics of VE using simple $SEIR$ model simulations.\\\nThe model, `seir_2grp`, includes two subgroups, which will be used to differentiate vaccinated and unvaccinated populations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseir_2grp <- function(t, y, params) {\n  S0 <- y[\"S0\"]; E0 <- y[\"E0\"]; I0 <- y[\"I0\"]; R0 <- y[\"R0\"]; C0 <- y[\"C0\"]\n  S1 <- y[\"S1\"]; E1 <- y[\"E1\"]; I1 <- y[\"I1\"]; R1 <- y[\"R1\"]; C1 <- y[\"C1\"]\n \n  beta <- params[\"beta\"]\n  epsilon <- params[\"epsilon\"]\n  gamma <- params[\"gamma\"]\n  \n  # vaccinated and unvaccinated population are well mixed\n  muSE <- beta * (I1+I0) / (S1 + E1 + I1 + R1 + S0 + E0 + I0 + R0)\n  muEI <- epsilon\n  muIR <- gamma\n  \n  dS0 <- - muSE*S0\n  dE0 <-  muSE*S0 - muEI*E0\n  dI0 <-  muEI*E0 - muIR*I0\n  dR0 <-  muIR*I0\n  dC0 <-  muEI*E0 ## cumulative symtom onset\n  \n  dS1 <- - muSE*S1\n  dE1 <-  muSE*S1 - muEI*E1\n  dI1 <-  muEI*E1 - muIR*I1\n  dR1 <-  muIR*I1\n  dC1 <-  muEI*E1 ## cumulative symtom onset\n  \n  return(list(c(dS0,dE0,dI0,dR0,dC0,dS1,dE1,dI1,dR1,dC1)))\n}\n```\n:::\n\n\n### Population A\n\nA fraction $f$ of population A received the vaccine, with vaccine efficacy denoted as VE. Vaccination is implemented using an all-or-nothing approach, meaning a fraction of the vaccine recipients, $Nf\\text{VE}$, are completely protected from infection. Here, $N$, $f$, and VE represent the population size, the fraction of the population that is vaccinated, and vaccine efficacy, respectively. In the SEIR model, we can mimic the vaccination scenario by setting the initial population size for the $R$ compartment to $Nf\\text{VE}$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nN <- 1\ntend <- 200\nbeta <- 2.5/4.5\nepsilon <- 1/5.2\ngamma <- 1/4.5\nparams <- c(beta=beta, epsilon=epsilon, gamma=gamma)\n\nVE <- 0.7 # vaccine efficacy on susceptibility\nf <- 0.3 # vacccine coverage proportion\nN0 <- N*(1-f)  # unvaccinated population\nN1 <- N*f # vaccinated population\npop_A <- c(N0=N0, N1=N1)\ny0_A <- c(S0=N0, E0=0, I0=0.01, R0=0, C0=0, \n        S1=N1*(1-VE), E1=0, I1=0.0, R1=N1*VE, C1=0)\ntend <- 200\ntimes <- seq(from=0, to=tend, by=1)\n\nout <- deSolve::ode(y=y0_A, times=times, func=seir_2grp, parms=params)\npop_A_out <- as.data.frame(out)\n```\n:::\n\n\n### Population B\n\nNo one in the population is vaccinated.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop_B <- c(N0=N)\n# no need for the vaccinated group\ny0_B <- c(S0=pop_B[[\"N0\"]], E0=0, I0=0.01, R0=0, C0=0, \n          S1=0.0, E1=0, I1=0.0, R1=0.0, C1=0)\nout <- deSolve::ode(y=y0_B, times=times, func=seir_2grp, parms=params)\npop_B_out <- as.data.frame(out) \n```\n:::\n\n\nLet's compute the four VE measures based on the cumulative incidence.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(DVE <- 1 - (pop_A_out[tend,\"C1\"]/pop_A[[\"N1\"]])/(pop_A_out[tend,\"C0\"]/pop_A[[\"N0\"]]))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7\n```\n:::\n\n```{.r .cell-code}\n(IVE <- 1 - (pop_A_out[tend,\"C0\"]/pop_A[[\"N0\"]])/(pop_B_out[tend,\"C0\"]/pop_B[[\"N0\"]]))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1118712\n```\n:::\n\n```{.r .cell-code}\n(OVE <- 1 - ((1-f)*pop_A_out[tend,\"C0\"]/pop_A[[\"N0\"]] + f*pop_A_out[tend,\"C1\"]/pop_A[[\"N1\"]])/ (pop_B_out[tend,\"C0\"]/pop_B[[\"N0\"]]))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.2983782\n```\n:::\n\n```{.r .cell-code}\n(TVE <- 1 - (pop_A_out[tend,\"C1\"]/pop_A[[\"N1\"]])/(pop_B_out[tend,\"C0\"]/pop_B[[\"N0\"]]))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7335613\n```\n:::\n:::\n\n\nLet's compare the VE metrics using the equations derived above (@eq-ive and @eq-ove).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(IVE == 1 - (1-TVE)/(1-DVE))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\n(OVE == 1 - (f*(1-TVE)+(1-f)*(1-IVE)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\n(IVE == 1 - (1 - OVE - f*(1-TVE))/(1-f))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\n(TVE == 1 - (1-DVE)*(1-IVE))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n:::\n\n\nLet's examine the dynamics of the four VE measures, where each metric is computed based on the cumulative incidence at each point in time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndve <- 1 - (pop_A_out[,\"C1\"]/pop_A[[\"N1\"]])/(pop_A_out[,\"C0\"]/pop_A[[\"N0\"]])\nive <- 1 - (pop_A_out[,\"C0\"]/pop_A[[\"N0\"]])/(pop_B_out[,\"C0\"]/pop_B[[\"N0\"]])\nove <- 1 - ((1-f)*pop_A_out[,\"C0\"]/pop_A[[\"N0\"]] + f*pop_A_out[,\"C1\"]/pop_A[[\"N1\"]])/ (pop_B_out[,\"C0\"]/pop_B[[\"N0\"]])\ntve <- 1 - (pop_A_out[,\"C1\"]/pop_A[[\"N1\"]])/(pop_B_out[,\"C0\"]/pop_B[[\"N0\"]])\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ive, pch=1, main=\"Indirect vaccine effectiveness\", xlab=\"day\", ylab=\"IVE\")\nlines(1 - (1-tve)/(1-dve), col=\"firebrick\")\nlines(1 - (1 - ove - f*(1-tve))/(1-f), col=\"magenta\")\n\nlegend(\"topright\", \n  legend=c(\"IVE definition\",\"Based on Eq. 1\",\"Based on Eq. 2\"), \n  col = c(\"black\", \"firebrick\",\"magenta\"),\n  pch = c(1, NA, NA),\n  lty = c(NA, 1, 1),\n  bty = \"n\", \n  cex = 1.0, \n  text.col = \"black\", \n  horiz = F , \n  inset = c(0.02,0.02))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ove, pch=1, main=\"Overall vaccine effectiveness\", xlab=\"day\", ylab=\"OVE\")\nlines(1 - (f*(1-tve)+(1-f)*(1-ive)), col=\"firebrick\")\nlegend(\"topright\", \n  legend = c(\"OVE definition\",\"Based on Eq. 2\"), \n  col = c(\"black\", \"firebrick\"),\n  pch = c(1, NA),\n  lty = c(NA, 1),\n  bty = \"n\", \n  cex = 1.0, \n  text.col = \"black\", \n  horiz = F , \n  inset = c(0.02,0.02))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(tve, pch=1, main=\"Total vaccine effectiveness\", xlab=\"day\", ylab=\"TVE\")\nlines(1 - (1-dve)*(1-ive), col=\"firebrick\")\nlegend(\"topright\", \n  legend = c(\"TVE definition\",\"Based on Eq. 1\"), \n  col = c(\"black\", \"firebrick\"),\n  pch = c(1, NA),\n  lty = c(NA, 1),\n  bty = \"n\", \n  cex = 1.0, \n  text.col = \"black\", \n  horiz = F , \n  inset = c(0.02,0.02))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}