{
  "hash": "e3c942eae5f052707753a53844c588e3",
  "result": {
    "markdown": "---\ntitle: \"Estimating serial interval for a growing epidemic\"\nauthor: \"Jong-Hoon Kim\"\ndate: \"2023-11-17\"\ncategories: [R, serial interval, interval censoring]\nimage: \"right_trunc.png\"\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\nIn this case, the above likelihood function may be modified as follows:\n\n$$\\mathcal{L}(X;\\theta) = \\prod_{i=1}^{n} f_{\\theta}(B_i-A_i)$$ , where $A^L, A^R, B$ present the times for lower end and upper bound on the potential dates of symptom onset of the infector, and the symptom onset time of the infectee, respectively.\n\n$$f^t_{\\theta}(B_i-A_i) = \\frac{f_{\\theta}(B_i-A_i)}{F(T-A_i)}$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nn <- 1000\nshape_true <- 2.2\nscale_true <- 3.3\n\ndf <- data.frame(A=sample(0:30, size=n, replace=TRUE))\nsi <- rgamma(n, shape=shape_true, scale=scale_true)\ndf$B <- df$A + si\nmax(df$B)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 57.03661\n```\n:::\n\n```{.r .cell-code}\nsummary(df$B)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n 0.3967 13.9763 22.4103 22.4031 30.3811 57.0366 \n```\n:::\n\n```{.r .cell-code}\nTmax <- 35\nunder_Tmax <- df$B < Tmax\n\nnewdf <- df[under_Tmax,]\n\nnll <- function(parms, A, B) -sum(dgamma(B-A, shape=parms[[1]], scale=parms[[2]], log=TRUE))\nres1 = optim(par=c(1,2), fn=nll, A=newdf$A, B=newdf$B,\n             method = \"Nelder-Mead\",\n            control = list(maxit=2e4, reltol=1e-15))\nres1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$par\n[1] 2.366494 2.735134\n\n$value\n[1] 2389.103\n\n$counts\nfunction gradient \n     101       NA \n\n$convergence\n[1] 0\n\n$message\nNULL\n```\n:::\n\n```{.r .cell-code}\nnll_right_trunc <- function(parms, A, B, Tmax) -sum(log(dgamma(B-A, shape=parms[[1]], scale=parms[[2]])/pgamma(Tmax-A, shape=parms[[1]], scale=parms[[2]])))\n\nres2 = optim(par=c(1,2), \n             fn=nll_right_trunc, \n             A=newdf$A, \n             B=newdf$B,\n             Tmax=Tmax,\n             method = \"Nelder-Mead\",\n             control = list(maxit=2e4, reltol=1e-15))\nres2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$par\n[1] 2.230993 3.230118\n\n$value\n[1] 2317.955\n\n$counts\nfunction gradient \n     115       NA \n\n$convergence\n[1] 0\n\n$message\nNULL\n```\n:::\n\n```{.r .cell-code}\nn <- 1e5\nx1 <- rgamma(n, shape=res1$par[[1]], scale=res1$par[[2]])\nx2 <- rgamma(n, shape=res2$par[[1]], scale=res2$par[[2]])\n\nsummary(x1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n 0.01066  3.36629  5.58653  6.47582  8.62659 44.32536 \n```\n:::\n\n```{.r .cell-code}\nsummary(x2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n 0.0263  3.6574  6.1697  7.2078  9.6218 43.8174 \n```\n:::\n\n```{.r .cell-code}\ndf = data.frame(model=rep(c(\"No truncation\", \"Right truncated\"), each=n), val=c(x1,x2))\n\nlibrary(ggplot2)\nextrafont::loadfonts()\ntheme_set(hrbrthemes::theme_ipsum_rc(base_size=14, subtitle_size=16, axis_title_size=12))\n\ndf |> ggplot(aes(x=val, fill=model))+\n  geom_density(alpha=0.2) +\n  labs(x=\"value\", y=\"density\")+\n  theme(legend.position = \"bottom\", \n        legend.title = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/no_censoring-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ggsave(\"right_trunc.png\", gg, units=\"in\", width=3.4*2, height=2.7*2)\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}