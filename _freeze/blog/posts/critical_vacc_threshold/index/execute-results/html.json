{
  "hash": "1331e9100abb99d662691c9d39cba85f",
  "result": {
    "markdown": "---\ntitle: \"Critical vaccination threshold\"\nauthor: \"Jong-Hoon Kim\"\ndate: \"2023-12-14\"\ncategories: [vaccine, population immunity, critical vaccination threshold]\nimage: \"Vc_R0.png\"\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\nThe following [article by Fine](https://academic.oup.com/cid/article/52/7/911/299077) provides a great introduction to the critical vaccination threshold.\n\n#### Critical vaccination threshold\n\nThe simplest scenario would be to assume that individuals are well-mixed and vaccine recipients are completely protected from infection. For this scenario, the critical threshold for random vaccination, $V_c$, is as follows: $$\nV_c = 1-1/R_0\n$$ If vaccines are only partially protective and $E$ fraction of the vaccine recipients are completely protected, $V_c$ becomes as follows: $$\nV_c = \\frac{1-1/R_0}{E}\n$$\n\nI used the population [World Population Prospects 2022](https://population.un.org/wpp/Download/Standard/MostUsed/).\n\n#### Plot the results\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nextrafont::loadfonts(\"win\", quiet=TRUE)\ntheme_set(hrbrthemes::theme_ipsum_rc(base_size=14, subtitle_size=16, axis_title_size=12))\nR0 <- seq(1,5,length.out=100)\nVE <- c(0.4, 0.6, 0.8)\nVc <- lapply(VE, function(x) ifelse((1-1/R0)/x <= 1.0, 100*(1-1/R0)/x, NA))\n\ndf <- data.frame(R0=R0, Vc1=Vc[[1]], Vc2=Vc[[2]], Vc3=Vc[[3]])\n\ngg <- ggplot(df, aes(x = R0)) +\n  geom_rect(aes(xmin=1.15, xmax=2.78, ymin=0, ymax=max(df$Vc3)),\n                   fill = \"pink\", alpha=0.01)+\n  geom_line(aes(y=Vc3, linetype=\"80%\")) +\n  geom_line(aes(y=Vc2, linetype=\"60%\")) +\n  geom_line(aes(y=Vc1, linetype=\"40%\")) +\n  scale_linetype_manual(\"Vaccine efficacy\", values=c(\"80%\"=\"solid\",\n                                   \"60%\"=\"dashed\", \n                                   \"40%\"=\"dotted\"))+\n  # labs(y=\"Critical vaccination threshold\", x=expression(R[0])) +\n  labs(y=expression(paste(\"Critical vaccination threshold (%), \", V[C])), \n       x=expression(paste(\"Basic reproduction number, \", R[0]))) +\n  theme(text = element_text(size=16),\n        axis.text = element_text(size=16),\n        legend.text=element_text(size=15), \n        legend.position = \"bottom\")\n\ngg\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ggsave(\"Vc_R0.png\", gg, units=\"in\", width=3.4*2, height=2.7*2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nR0 <- c(1.15, 2.78)\n(Vc <- 1-1/R0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1304348 0.6402878\n```\n:::\n:::\n\n\n### India simulation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\nlibrary(readxl)\nlibrary(dplyr)\n# d <- read_xlsx(\"C:/Users/jonghoon.kim/Documents/myblog/posts/critical_vacc_threshold/WPP2022_POP_F01_1_POPULATION_SINGLE_AGE_BOTH_SEXES.xlsx\", sheet= \"Medium variant\")\n# d2 <- d[-(1:11),]\n# india <- d2[(d2$...3 == \"India\" & d2$...11 > 2023),]\n# names(india) <- c(1:2, \"country\", 4:10 ,\"year\", paste0(\"age_\", 0:100))\n\n# saveRDS(india, \"C:/Users/jonghoon.kim/Documents/myblog/posts/critical_vacc_threshold/WPP2022_India.rds\")\n\nindia <- readRDS(\"WPP2022_India.rds\")\nindia$year <- as.numeric(india$year)\n# india[,paste0(\"age_\", 0:100)] <- as.numeric(india[,paste0(\"age_\", 0:100)])\nindia <- india %>% mutate_at(paste0(\"age_\", 0:100), as.numeric)\n\nyrs <- 2024:2100\n# simulate\nVE <- c(0.4, 0.6, 0.8)\nprop_immune <- rep(NA, length(yrs))\n\nfor(i in seq_along(yrs)) {\n  numerator <- sum(india[india$year == yrs[i], paste0(\"age_\", 0:(i-1))])\n  denominator <- sum(india[india$year == yrs[i], paste0(\"age_\", 0:100)])\n  prop_immune[i] <- numerator / denominator\n} \n\nexisting_immune <- 20\npop_immune_ve <- lapply(VE, function(z) 100*z*prop_immune)\n# add the existing immunity, assumed to be 15%\npop_immune_ve_added <- lapply(VE, function(z) 100*z*prop_immune + existing_immune)\n\ndf <- data.frame(years=yrs-2024, \n                 pi1=pop_immune_ve[[1]], \n                 pi2=pop_immune_ve[[2]], \n                 pi3=pop_immune_ve[[3]], \n                 pi4=pop_immune_ve_added[[1]], \n                 pi5=pop_immune_ve_added[[2]], \n                 pi6=pop_immune_ve_added[[3]])\n\nextrafont::loadfonts(\"win\", quiet=TRUE)\ntheme_set(hrbrthemes::theme_ipsum_rc(base_size=14, subtitle_size=16, axis_title_size=12))\n\n\ngg <- ggplot(df, aes(x = years)) +\n  geom_rect(aes(xmin=0, xmax=30, ymin=14, ymax=63),\n                   fill = \"pink\", alpha=0.01)+\n  geom_line(aes(y=pi3, linetype=\"80%\")) +\n  geom_line(aes(y=pi2, linetype=\"60%\")) +\n  geom_line(aes(y=pi1, linetype=\"40%\")) +\n  geom_line(aes(y=pi6, linetype=\"80%\"), color=\"dark green\") +\n  geom_line(aes(y=pi5, linetype=\"60%\"), color=\"dark green\") +\n  geom_line(aes(y=pi4, linetype=\"40%\"), color=\"dark green\") +\n  scale_x_continuous(limits=c(0,30))+\n  scale_linetype_manual(\"Vaccine efficacy\", \n                        values=c(\"80%\"=\"solid\",\n                                 \"60%\"=\"dashed\", \n                                 \"40%\"=\"dotted\"))+\n  # labs(y=\"Critical vaccination threshold\", x=expression(R[0])) +\n  labs(y=\"Population immune (%)\", x=\"Years since vaccination\") +\n  theme(text = element_text(size=16),\n        axis.text = element_text(size=16),\n        legend.text=element_text(size=15), \n        legend.position = \"bottom\")\ngg\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ggsave(\"immune_time.png\", gg, units=\"in\", width=3.4*2, height=2.7*2)\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}