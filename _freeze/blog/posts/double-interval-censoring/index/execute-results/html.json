{
  "hash": "88b479b9350609609a2c067875c33e13",
  "result": {
    "markdown": "---\ntitle: \"Estimating serial interval: doubly interval-censored data\"\nauthor: \"Jong-Hoon Kim\"\ndate: \"2023-11-17\"\ncategories: [R, serial interval, interval censoring]\nimage: \"double_interval_censor.png\"\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n\nWe start simple. Our task is to estimate parameters of a probability density function used to model the serial interval. Suppose dates of onsets of infectors, $A$, and infectees, $B$, are given as specific dates. Then the likelihood function for the serial interval may be written down as follows:\\\n$$\\mathcal{L}(X;\\theta) = \\prod_{i=1}^{n} f_{\\theta}(B_i - A_i)$$, where $f$ is the probability density function for the serial interval with the unknown parameters, $\\theta$.\n\nNow suppose that the dates of symptom onset of the infectors are given as intervals. We can use the following argument also for the case where dates of symptom onset of the infectees are given as intervals. In this case, the above likelihood function may be modified as follows:\n\n$$\\mathcal{L}(X;\\theta) = \\prod_{i=1}^{n} \\int_{A^L_i}^{A^R_i} f_{\\theta}(B_i-a) ~\\text{d}a$$ , where $A^L, A^R, B$ present the times for lower end and upper bound on the potential dates of symptom onset of the infector, and the symptom onset time of the infectee, respectively. \n\nNow suppose that both the dates of onset of the infectors and infectees are given as intervals. This is so called the doubly interval-censored data discussed by [Reich *et al* 2009](https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.3659). The likelihood function may be given as follows:\n\n$$\\mathcal{L}(X;\\theta,\\lambda) = \\prod_{i=1}^{n} \\int_{A^L_i}^{A^R_i} \\int_{B^L_i}^{B^R_i} h_{\\lambda}(a) f_{\\theta}(b-a) ~\\text{d}b \\text{d}a$$ , where $A^L, A^R, B^L, B^R$ present the times for left and right boundaires on the possible onset times of the infector, $A$, and the infectee, $B$, respectively.  $h_{\\lambda}(x)$ represents the probability density function for the time of symptom onset of the infector, which we assume follows a uniform distribution.\n\nMore detailed analyses of doubly interval-censored data were discussed by [Reich *et al* 2009](https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.3659). The same concept has recently been applied to estimation of serial interval of CVODI-19 by [Nishiura *et al*. 2020](https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext#supplementaryMaterial).\n\nIn the following codes, we create the fake data set and add intervals such that the serial intervals may become shorter. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nn <- 100\nshape_true <- 2.2\nscale_true <- 3.3\n\nonset_infector <- sample(20:30, size=n, replace=TRUE)\nonset_infectee <- onset_infector + rgamma(n, shape=shape_true, scale=scale_true)\nnll <- function(parms, x) -sum(dgamma(x, shape=parms[[1]], scale=parms[[2]], log=TRUE))\nres1 = optim(par=c(1,2), fn=nll, x=onset_infectee - onset_infector, method = \"Nelder-Mead\",\n            control = list(maxit=2e4, reltol=1e-15))\n\n# singly interval-censored data\ntau <- sample(1:5, n, replace=TRUE)\nAL <- onset_infector \nAR <- onset_infector + 2*tau # this will lead to shorter serial interval\n\nnll_single_censor <- function(parms, AL, AR, B){\n  -sum(log(pgamma(B-AL, shape=parms[[1]], scale=parms[[2]]) - pgamma(B-AR, shape=parms[[1]], scale=parms[[2]])))\n}\n\nres2 = optim(par=c(1,2), fn=nll_single_censor, AL=AL, AR=AR, \n             B=onset_infectee, method=\"Nelder-Mead\",\n            control = list(maxit=2e4, reltol=1e-15))\n\n# doubly interval-censored data\nBL <- onset_infectee - 2*tau # this will lead to even shorter serial interval\nBR <- onset_infectee\n\nnll_double_censor <- function(parms, AL, AR, BL, BR){\n  -sum(log(dunif(AL, min=AL, max=AR)*(pgamma(BR-AL, shape=parms[[1]], scale=parms[[2]]) - pgamma(BL-AR, shape=parms[[1]], scale=parms[[2]]))))\n}\n\nres3 = optim(par=c(1,2), fn=nll_double_censor, AL=AL, AR=AR,\n             BL=BL, BR=BR, method=\"Nelder-Mead\",\n            control=list(maxit=2e4, reltol=1e-15))\n\nx1 <- rgamma(1e3, shape=res1$par[[1]], scale=res1$par[[2]])\nx2 <- rgamma(1e3, shape=res2$par[[1]], scale=res2$par[[2]])\nx3 <- rgamma(1e3, shape=res3$par[[1]], scale=res3$par[[2]])\nsummary(x1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n 0.1677  3.8165  6.4303  7.5411 10.3268 36.0535 \n```\n:::\n\n```{.r .cell-code}\nsummary(x2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n 0.03203  1.37089  3.37988  4.70497  6.48863 38.89572 \n```\n:::\n\n```{.r .cell-code}\nsummary(x3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n 0.00001  0.36330  1.48009  2.92934  4.04038 46.12810 \n```\n:::\n\n```{.r .cell-code}\ndf = data.frame(model=rep(c(\"No censoring\", \"Singly interval-censored\",\n                            \"Doubly interval-censored\"), each=1e3),\n                val=c(x1,x2, x3))\n\nlibrary(ggplot2)\ntheme_set(hrbrthemes::theme_ipsum_rc(base_size=14, subtitle_size=16, axis_title_size=12))\n\ndf |> ggplot(aes(x=val, fill=model))+\n  geom_density(alpha=0.2) +\n  labs(x=\"value\", y=\"density\")+\n  theme(legend.position = \"bottom\", \n        legend.title = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/no_censoring-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ggsave(\"double_interval_censor.png\", gg, units=\"in\", width=3.4*2, height=2.7*2)\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}